var UnisignWebEngine=function(z,ia){function Da(){if(!(n.Mode&4))return null;eval(F({eval:!1,intergrity:!1,name:"nimservice",url:"unisignweb/js/nimservice.js"}));return eval("__nimservice")(a)}function Ea(){if(!(n.Mode&2))return null;eval(F({eval:!1,intergrity:!1,name:"nimservice",url:"unisignweb/js/sharestorage.js"}));return eval("__crosscertlocalstorage")(a)}function F(a){var b=null,b=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");b.open("GET",n.SRCPath+a.url+"?version="+V,!1);b.send(null);if(200==b.status){if(!0===a.intergrity){var d={};d.name=a.name+".js";d.data=b.responseText;L[sa++]=d}return null==a.eval||!0==a.eval?eval(b.responseText):b.responseText}H=!1;return null}function ta(){a.nimservice()?a.nimservice().GetE2EInfo(function(c,b,d){0==c?a.touchEn_pubkey="-----BEGIN CERTIFICATE-----"+d+"-----END CERTIFICATE-----":a.ESVS.SecureKeyboardType=""}):setTimeout(ta,1E3)}function Fa(){G&&Y.log("Do retry to initialize module.");VerifyPFLicense()&&(__ForgeryUtil=new D.FORGERY)}function Ga(c){var b;if(!c||0>=c.length)return null;var d=c+".js";b=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");a.uiUtil().isItPortableDevice()?"gridlist"!=c?(d="m_"+d,b.open("GET",n.SRCPath+"unisignweb/js/mobile/m_"+c+".js?version="+V,!1)):b.open("GET",n.SRCPath+"unisignweb/js/"+c+".js?version="+V,!1):b.open("GET",n.SRCPath+"unisignweb/js/"+c+".js?version="+V,!1);b.send(null);var g=b.responseText,e=null;"certprocessing.js"!=d&&(e=a.forgeryUtil().verify(d,g),"success"!=e&&null!=e&&(a.uiUtil().flagAlert(e),H=!1));eval(b.responseText);return eval("__"+c)(a)}function k(a,b){var d={};d.resultCode=a?a:0;d.resultMessage=b?b:"";d.jsonSignedData="";d.certAttrs="";d.certIndex="";d.b64RValue="";d.hashValue="";d.encryptedData="";d.decryptedData="";d.signedData="";d.theCert="";d.theDN="";d.thePri="";d.kmCert="";d.kmPri="";d.curDrive="";d.curDevice="";d.tokenLabel="";d.password="";d.pin="";d.mac="";return d}function ba(c,b,d,g,e,f,h,m){if(c)ua(c,b,d,g,e,f,h,m);else{var l=a.loadUI("ssn")({type:null,onConfirm:function(a){ua(a,b,d,g,e,f,h,m);l.dispose()},onCancel:function(){m(k(-1,a.uiUtil().getUserCancelErrCodeNMsg()));l.dispose()}});l.show()}}function ua(c,b,d,g,e,f,h,m){a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_VID_VERIFY_MESSAGE);var l=k();l.certAttrs=e;l.curDevice=f;l.tokenLabel=h;if("undefined"!==typeof b&&"undefined"!==typeof d)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(f))a.nimservice()?a.nimservice().VerifyVID(b,d,c,function(c,d){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0==c?(l.signedData=g,m(l)):(a.ERROR.Code=c,a.ERROR.Message=d,m(k(c,d)))}):(a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER,a.uiUtil().createLoadingBox("hide","us-div-loading-dialog"),m(k(a.ERROR.Code,a.ERROR.Message)));else{a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");try{var r=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[b].signcert),s=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[b].signpri),p=a.usWebToolkit.pkcs8.verifyVID(s,d,c,r);d=c="";p?(l.signedData=g,m(l)):(a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_MSGBOX_VID_ERROR_VERIFICATION,m(k(a.ERROR.Code,a.ERROR.Message)))}catch(q){d=c="",a.ERROR.Code=q.code,a.ERROR.Message=q.message,m(k(q.code,q.message))}d=c=""}}function va(c){try{var b=a.PFSH.GetP12ForBuToPc(1,c,"binary"),d=b.p12,g=a.certUtil().getCN(b.dn),g=g+".p12";a.fileUtil().save(g,d)}catch(e){alert("failure\nerr code : "+e.code+"\nerr msg : "+e.message)}}function wa(){var c=null,b=null,d=null;try{c=a.PFSH.GetP12ForBuToMo(1,"hex"),b=c.key,d=c.p12}catch(g){b=window.console||{log:function(){}};G&&(b.log("***** GetP12ForBuToMo error *****"),b.log("e.code : ",g.code,"e.message : ",g.message,"e.detail : ",g.detail));alert("failure\nerr code : "+g.code+"\nerr msg : "+g.message);return}try{c="default";"android"===a.osName?"android samsung"===a.browserName||"android lg"===a.browserName||"android browser"===a.browserName?c="default":"android chrome"===a.browserName&&(c="chrome"):"ios"==a.osName&&("ios safari"===a.browserName?c="default":"ios chrome"===a.browserName&&(c="googlechrome"));var e=window.location.href.split(/[?#]/)[0],f=e.lastIndexOf("/"),e=e.substr(0,f+1)+a.ESVS.SRCPath+"unisignweb/rsrc/layout/mobile/w2a/m_exportcertresult.html";UniSignW2A.backupStore(e,c,d,b,"0","recall")}catch(h){alert("failure\ne : "+h)}}function xa(c){try{a.CCPFSH().GetP12ForBuToPc(1,c,"base64",function(c,b,e,f){c=a.usWebToolkit.util.decode64(f);b=Array(c.length);for(f=0;f<c.length;f++)b[f]=c.charCodeAt(f);c=new Uint8Array(b);e=a.certUtil().getCN(e);e+=".p12";a.fileUtil().save(e,c)})}catch(b){alert("failure\nerr code : "+b.code+"\nerr msg : "+b.message)}}function ya(){var c=null,b=null;a.CCPFSH().GetP12ForBuToMo(1,"base64",function(d,g,e,f){if(0==d){c=e;d=a.usWebToolkit.util.decode64(f);b=crosscert.util.bytesToHex(d);try{d="default";"android"===a.osName?"android samsung"===a.browserName||"android lg"===a.browserName||"android browser"===a.browserName?d="default":"android chrome"===a.browserName&&(d="chrome"):"ios"==a.osName&&("ios safari"===a.browserName?d="default":"ios chrome"===a.browserName&&(d="googlechrome"));var h=window.location.href.split(/[?#]/)[0],m=h.lastIndexOf("/"),h=h.substr(0,m+1)+a.ESVS.SRCPath+"unisignweb/rsrc/layout/mobile/w2a/m_exportcertresult.html";UniSignW2A.backupStore(h,d,b,c,"0","recall")}catch(l){alert("failure\ne : "+l)}}else h=window.console||{log:function(){}},G&&(h.log("***** GetP12ForBuToMo error *****"),h.log("rv : ",d,"msg : ",g)),alert("failure\nerr code : "+d+"\nerr msg : "+g)})}function Z(c,b,d,g,e){a.SELCERTINFO={index:c,pw:b,curdevice:d,cert:g,certattrs:e}}function ja(c,b,d,g,e,f,h,m,l){var r={},s=k();if("undefined"!==typeof g&&"undefined"!==typeof e)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(f))if(a.nimservice()){f=function(c){if(!c)return"";var d=null;if("SHA1"==b||"sha1"==b)d="1.3.14.3.2.26";else if("MD5"==b||"md5"==b)d="1.2.840.113549.2.5";else if("SHA256"==b||"sha256"==b)d="2.16.840.1.101.3.4.2.1";c=crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.SEQUENCE,!0,[crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.SEQUENCE,!0,[crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.OID,!1,crosscert.asn1.oidToDer(d).getBytes()),crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.NULL,!1,"")]),crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.OCTETSTRING,!1,c)]);return a.usWebToolkit.asn1.toDer(c).getBytes()};var p=0,q=[];if(c)for(var t in c){var w=a.usWebToolkit.util.decode64(c[t]),w=f(w),w=a.usWebToolkit.util.encode64(w);q[p]=w;p++}a.nimservice().GetSignDataP7(g,e,1,q,!1,h,function(b,f,h,p,q,t){if(0!=b)a.ERROR.Code=b,a.ERROR.Message=f,a.uiUtil().errMsgBox(f,a.ERROR.Code),l(k(a.ERROR.Code,a.ERROR.Message));else{b=0;if("object"==typeof h)for(var w in c)r[w]=h[b++];else r=h;s.jsonSignedData=r;s.b64RValue=p;s.tokenLabel=t;s.certAttrs=a.certUtil().getTheCertAttributes(d,"Base64");l(s)}g=e=cert=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");null!=m&&setTimeout(function(){m.dispose()},10)})}else l(null),null!=m&&setTimeout(function(){m.dispose()},10);else null!=m&&setTimeout(function(){m.dispose()},10);else l(null),null!=m&&setTimeout(function(){m.dispose()},10)}if(z&&ia){var Q=z.Mode,x=z.EncAlgo,M=z.HashAlgo,N=z.UniCRS,A=z.DebugConsole,S=z.SecureKeyboardType,ca=z.PKI,ka=z.SRCPath,W=z.Language,R=z.TargetObj,$=z.TabIndex,aa=z.Embedded,X=z.LimitNumOfTimesToTryToInputPW,la=z.CMPIP,da=z.CMPPort,ma=z.CMPURL,na=z.SHARESTORAGE,T=z.NimCheckURL,C=z.Media,oa=z.Organization,ea=z.Policy,fa=z.ShowExpiredCerts,I=z.LimitMinNewPWLen,K=z.LimitMaxNewPWLen,U=z.LimitNewPWPattern,pa=z.ChangePWByNPKINewPattern,ga=z.CertRequestPageEnable,Ha=z.License,G=!1,E=function(a){!1!=G&&window.console&&window.console.log&&window.console.log(a)},H=null,V="1.0.60.4",qa=null,n={};if(!Q||"undefined"===typeof Q||1>Q||6<Q)Q=2;n.Mode=Q;x&&"undefined"!==typeof x||(x="3des");n.EncAlgo=x;M&&"undefined"!==typeof M||(M="sha256");n.HashAlgo=M;ka||(ka="");n.SRCPath=ka;S?"ahnlab"==S&&(eval(F({eval:!1,intergrity:!1,name:"astx2.min.js",url:"unisignweb/framework/keyboard/astx2.min.js"})),eval(F({eval:!1,intergrity:!1,name:"astx2_custom.js",url:"unisignweb/framework/keyboard/astx2_custom.js"}))):S="";n.SecureKeyboardType=S;n.DebugConsole=A?A:!0;ca||(ca="NPKI");n.PKI=ca;W=W?"ko-kr"==W.toLowerCase()?"ko_kr":"en_us":!navigator.browserLanguage||"ko"!=navigator.browserLanguage.toLowerCase()&&"kr"!=navigator.browserLanguage.toLowerCase()&&"ko-kr"!=navigator.browserLanguage.toLowerCase()?!document.documentElement.lang||"ko"!=document.documentElement.lang.toLowerCase()&&"kr"!=document.documentElement.lang.toLowerCase()&&"ko-kr"!=document.documentElement.lang.toLowerCase()?!navigator.language||"ko"!=navigator.language.toLowerCase()&&"kr"!=navigator.language.toLowerCase()&&"ko-kr"!=navigator.language.toLowerCase()?"en_us":"ko_kr":"ko_kr":"ko_kr";n.Language=W;T||(T="../install/VestCert_Obj_check.html");n._NimCheckURL=T;if(!1==aa||!aa){var za=function(){!R&&document.body&&(R=document.createElement("div"),R.style.width="0px",R.style.height="0px",document.body.insertBefore(R,document.body.firstChild));R?n.TargetObj=R:setTimeout(za,500)};setTimeout(za,300)}n.TargetObj=R;if(0>$||!$)$=0;n.TabIndex=$;aa||(aa=!1);n.Embedded=aa;if(0>=X||10<X||!X)X=3;n.LimitNumOfTimesToTryToInputPW=X;la||(la="211.192.169.70");n.CMPIP=la;if(0>da||!da)da=4502;n.CMPPort=da;ma||(ma="http://ca.crosscert.com:9992/webcmp/");n.CMPURL=ma;na||(na="http://testca.crosscert.com/pftest/");n.SHARESTORAGE=na;C?(C.list=C.list?C.list.toLowerCase():null,C.defaultdevice?(C.defaultdevice=C.defaultdevice.toLowerCase(),null!=C.list&&(C.defaultdevice=0>C.list.indexOf(C.defaultdevice)?C.list.split("|")[0]:C.defaultdevice)):C.defaultdevice=null):C={defaultdevice:null,list:"removable|sectoken|savetoken|mobilephone|harddisk|mobiletoken|webstorage|cloudsign|sharestorage|touchsign|smartsign|websectoken|websofttoken"};if(void 0==C.defaultdevice||null==C.defaultdevice)C.defaultdevice=2==Q?"webstorage":"harddisk";n.Media=C;oa||(oa=null);n.Organization=oa;ea||(ea=null);n.Policy=ea;"boolean"!==typeof fa&&(fa=!0);n.ShowExpiredCerts=fa;if("NPKI"===n.PKI){if(10>I||64<I||!I)I=10;n.LimitMinNewPWLen=I;if(10>K||64<K||!K||I>K)K=64;n.LimitMaxNewPWLen=K;U=2}else{if(8>I||64<I||!I)I=8;n.LimitMinNewPWLen=I;if(8>K||64<K||!K||I>K)K=64;n.LimitMaxNewPWLen=K;if(0>U||2<U||!U)U=0}n.LimitNewPWPattern=U;pa||(pa=!1);n.ChangePWByNPKINewPattern=pa;"undefined"===typeof ga&&(ga=1);n.CertRequestPageEnable=ga;n.License=Ha;if(0>N||!N)N="disabled";n.UniCRS=N;window.ESVS=n;var ha=null,L=[],sa=0,x={};x.name=ia.NAME;x.data=ia.DATA;L[sa++]=x;var O=[{eval:!0,intergrity:!0,name:"json2",url:"unisignweb/framework/json2.js"},{eval:!0,intergrity:!0,name:"Blob",url:"unisignweb/framework/Blob.js"},{eval:!1,intergrity:!0,name:"FileSaver",url:"unisignweb/framework/FileSaver.js"},{eval:!1,intergrity:!0,name:"UniSignW2AUtil",url:"unisignweb/framework/UniSignW2AUtil.js"},{eval:!1,intergrity:!0,name:"UniSignW2AExtension",url:"unisignweb/framework/UniSignW2AExtension.js"},{eval:!0,intergrity:!0,name:"draggable",url:"unisignweb/framework/draggable.js"},{eval:!0,intergrity:!0,name:"jsustoolkitErrCode",url:"jsustoolkit/jsustoolkitErrCode.js"},{eval:!0,intergrity:!0,name:"asn1",url:"jsustoolkit/toolkit/asn1.js"},{eval:!0,intergrity:!0,name:"jsbn",url:"jsustoolkit/toolkit/jsbn.js"},{eval:!0,intergrity:!0,name:"oids",url:"jsustoolkit/toolkit/oids.js"},{eval:!0,intergrity:!0,name:"util",url:"jsustoolkit/toolkit/util.js"},{eval:!0,intergrity:!0,name:"unicode",url:"jsustoolkit/toolkit/unicode.js"},{eval:!0,intergrity:!0,name:"aes",url:"jsustoolkit/crypto/aes.js"},{eval:!0,intergrity:!0,name:"des",url:"jsustoolkit/crypto/des.js"},{eval:!0,intergrity:!0,name:"desofb",url:"jsustoolkit/crypto/desofb.js"},{eval:!0,intergrity:!0,name:"seed",url:"jsustoolkit/crypto/seed.js"},{eval:!0,intergrity:!0,name:"rc2",url:"jsustoolkit/crypto/rc2.js"},{eval:!0,intergrity:!0,name:"hmac",url:"jsustoolkit/crypto/hmac.js"},{eval:!0,intergrity:!0,name:"md5",url:"jsustoolkit/crypto/md5.js"},{eval:!0,intergrity:!0,name:"sha1",url:"jsustoolkit/crypto/sha1.js"},{eval:!0,intergrity:!0,name:"sha256",url:"jsustoolkit/crypto/sha256.js"},{eval:!0,intergrity:!0,name:"rsa",url:"jsustoolkit/crypto/rsa.js"},{eval:!0,intergrity:!0,name:"prng",url:"jsustoolkit/crypto/prng.js"},{eval:!0,intergrity:!0,name:"random",url:"jsustoolkit/crypto/random.js"},{eval:!0,intergrity:!0,name:"pki",url:"jsustoolkit/toolkit/pki.js"},{eval:!0,intergrity:!0,name:"pkcs5",url:"jsustoolkit/toolkit/pkcs5.js"},{eval:!0,intergrity:!0,name:"pkcs8",url:"jsustoolkit/toolkit/pkcs8.js"},{eval:!0,intergrity:!0,name:"pkcs7",url:"jsustoolkit/toolkit/pkcs7.js"},{eval:!0,intergrity:!0,name:"pkcs7asn1",url:"jsustoolkit/toolkit/pkcs7asn1.js"},{eval:!0,intergrity:!0,name:"pkcs12",url:"jsustoolkit/toolkit/pkcs12.js"},{eval:!0,intergrity:!0,name:"x509Certificate",url:"jsustoolkit/toolkit/x509Certificate.js"},{eval:!0,intergrity:!0,name:"cmpasn1",url:"jsustoolkit/toolkit/cmpasn1.js"},{eval:!0,intergrity:!0,name:"cmp",url:"jsustoolkit/toolkit/cmp.js"},{eval:!0,intergrity:!0,name:"usWebCMPXMLHttp",url:"jsustoolkit/webcmp/usWebCMPXMLHttp.js"},{eval:!0,intergrity:!0,name:"usWebCMP",url:"jsustoolkit/webcmp/usWebCMP.js"}];"Enabled"===N&&(O.push({eval:!1,intergrity:!0,name:"unicrs_nimservice",url:"unicrsv3/js/unicrs_nimservice.js"}),O.push({eval:!1,intergrity:!0,name:"unicrsv3client",url:"unicrsv3/js/unicrsv3client.js"}),O.push({eval:!1,intergrity:!0,name:"unicrsv3",url:"unicrsv3/js/unicrsv3.js"}));var Aa=[{eval:!1,intergrity:!0,name:"npkicacerts",url:"unisignweb/js/storage/ins/npkicacerts.js"},{eval:!1,intergrity:!0,name:"encryptstorage",url:"unisignweb/js/storage/enc/encryptstorage.js"},{eval:!1,intergrity:!0,name:"localstorage",url:"unisignweb/js/storage/ls/localstorage.js"},{eval:!1,intergrity:!0,name:"localstoragehandler",url:"unisignweb/js/storage/ls/localstoragehandler.js"},{eval:!1,intergrity:!0,name:"storagehandler",url:"unisignweb/js/storage/storagehandler.js"},{eval:!1,intergrity:!0,name:"storageerrcode",url:"unisignweb/js/storage/err/storageerrcode.js"}];new function(){for(var a=0;a<O.length;a++)0==a?"object"!==typeof JSON&&F(O[a]):1==a||2==a?document.createElementNS&&(2==a?(eval(F(O[a])),ha=eval("saveAs")):F(O[a])):3==a?(F(O[3]),F(O[4]),a=4):F(O[a]);if(2&n.Mode){for(var b=null,a=0;a<Aa.length;a++)b=eval(F(Aa[a]));try{qa=new StorageHandler(1,{enc_algo:n.EncAlgo,hash_algo:n.HashAlgo,pki:n.PKI,domain:document.domain,error_code:b})}catch(d){a=window.console||{log:function(){}},a.log("*** StorageHandler initializing error ***"),a.log("e.code : ",d.code,"e.message : ",d.message,"e.detail : ",d.detail),qa=null}}};var D={BSUTIL:function(){}};D.BSUTIL.prototype={isKeyProtected:function(){return"touchen"==a.ESVS.SecureKeyboardType&&a.bsUtil().isTouchEnKeyUsable()||"ahnlab"==a.ESVS.SecureKeyboardType&&a.bsUtil().isAhnlabProtectorUsable()?!0:!1},GetKeyboardType:function(){if("touchen"==a.ESVS.SecureKeyboardType){if("undefined"!=typeof TouchEnNxInit&&!1!=TouchEnNxInit)return a.ESVS.SecureKeyboardType}else if("ahnlab"==a.ESVS.SecureKeyboardType&&!0==a.isSKModule)return a.ESVS.SecureKeyboardType;return""},isTouchEnKeyUsable:function(){return"undefined"==typeof TouchEnNxInit||!1==TouchEnNxInit?!1:!0},ahnlabInit:function(){0<=S.indexOf("ahnlab")&&"undefined"!=typeof $ASTX2&&"undefined"!=typeof $ASTX2.init&&"undefined"!=typeof $ASTX2.initNonE2E&&!1!=a.isSKModule&&$ASTX2.initNonE2E(2189)},isAhnlabProtectorUsable:function(){return 2&a.ESVS.Mode||"undefined"==typeof $ASTX2||"undefined"==typeof $ASTX2.init||"undefined"==typeof $ASTX2.initNonE2E?!1:a.isSKModule},GetAhnlabEncInputInfo:function(a){return{type:3,value:{pageID:$ASTX2.getE2EPageID()+"",inputID:$ASTX2.getE2EInputID(document.getElementById(a))}}},SetSecurityStatus:function(c){c=document.getElementById(c);"touchen"==a.ESVS.SecureKeyboardType&&this.isTouchEnKeyUsable()?c.setAttribute("data-enc","on"):c.setAttribute("data-enc","off")},SetReScan:function(c,b){"touchen"==a.ESVS.SecureKeyboardType&&this.isTouchEnKeyUsable()&&TK_Rescan_HTML(c,b)},TouchEn_Clear:function(c,b){"touchen"==a.ESVS.SecureKeyboardType&&this.isTouchEnKeyUsable()&&TK_Clear(c,b)},GetEncryptPwd:function(c,b,d){null==a.touchEn_pubkey||0>=a.touchEn_pubkey.length?d(""):TK_GetEncCrossCert?TK_GetEncCrossCert(c,b,a.touchEn_pubkey,function(a){a?d({type:8,value:{data:a}}):d("")}):d("")},GetDecryptPwd:function(c,b){var d=GetEncDataFun("-----BEGIN CERTIFICATE-----MIIDZzCCAk+gAwIBAgIBATANBgkqhkiG9w0BAQsFADBKMQswCQYDVQQGEwJLUjESMBAGA1UEChMJQ3Jvc3NDZXJ0MQ4wDAYDVQQLEwVTVExhYjEXMBUGA1UEAxMOQ3Jvc3NDZXJ0V2ViVjMwHhcNMTQwNjI1MDAwMDAwWhcNMjkxMjMxMjM1OTAwWjBKMQswCQYDVQQGEwJLUjESMBAGA1UEChMJQ3Jvc3NDZXJ0MQ4wDAYDVQQLEwVTVExhYjEXMBUGA1UEAxMOQ3Jvc3NDZXJ0V2ViVjMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDIm9p0HiCrpFVSfRVdnC3V4kEC75F8bUWV/Ewa7TmuirbVOYsdtSpz+Yceh+Tindducrf6zGNlhhNpyhFQ6+4/f0qLdwALapojECOUQg/lISRD2FO88hEhBj/rOjZiVzHYyHm8K2bTtBJXNauBBCb1yUKNdHuAvw4xub/jcgZ2PRtWORrQwuStcGBSSnqCIHZcGb5KKdHtY15ppcZoZBXB75kKKdK8qJm/6A/bBW0S+o3ooN+oaGrFFEVH61AHi45sBHGO4e1oyRT8dfIgKUzUQOKSZ1r3Wln4CSqQR8tZOd/T+LzzSB7r4N/rzNo3T4oO5O6lkQBw3NZg25nMXBj7AgMBAAGjWDBWMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFJ7NboZBgBMwRmav8MSGpsMab+NjMA4GA1UdDwEB/wQEAwIGwDAXBgNVHSAEEDAOMAwGCiqDGoyaRAUEAQEwDQYJKoZIhvcNAQELBQADggEBAIU2d1CH6vsZaTAeSCdBM1tKcl/8YpnUSqt3w6DB45E9akGCODgEI1K/KPtRIhrjBBYopQJN9Z3F411xiw2Te0LJQKA9snAtRZCEbL/1FzjyUXKEv5QB9Zgch4KvbqhOdVb1bJsztJH1kV/lbeNbil2TI1NntWbKyPWDKlzdPsGbSAgaFkUtbt7fxcGJBoXAEsaohtNiDM3chfJWv4d0dlDito5isOMIMDN+bfLcBp745T+wEpig6bfbVZnDjzGbXhJJjVvFKydQrZfrLBnVLCpElD1xN1Ipw+6UGJXEuxqXS51drnG9jVU1FL9JDtDE7BNByXV2V9y9b1/6PSeSYMw=-----END CERTIFICATE-----",c,b);if(0>=d.length)return"";var d=a.usWebToolkit.util.decode64(d),g=d.substr(0,256),d=d.substr(256,d.length),e=a.usWebToolkit.pki.privateKeyFromBase64("MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDIm9p0HiCrpFVSfRVdnC3V4kEC75F8bUWV/Ewa7TmuirbVOYsdtSpz+Yceh+Tindducrf6zGNlhhNpyhFQ6+4/f0qLdwALapojECOUQg/lISRD2FO88hEhBj/rOjZiVzHYyHm8K2bTtBJXNauBBCb1yUKNdHuAvw4xub/jcgZ2PRtWORrQwuStcGBSSnqCIHZcGb5KKdHtY15ppcZoZBXB75kKKdK8qJm/6A/bBW0S+o3ooN+oaGrFFEVH61AHi45sBHGO4e1oyRT8dfIgKUzUQOKSZ1r3Wln4CSqQR8tZOd/T+LzzSB7r4N/rzNo3T4oO5O6lkQBw3NZg25nMXBj7AgMBAAECggEATCIZ/geRDpMHbo7aFPS40HtVgO+6nyY5Snq9x1pQkdVDHhkAmv2uZuVESmn4i6irodcXy67V6inAJF3zxGpFuQNuHw/CjJKgfL4bQqDvt12kjbsDzKlxpr7gcz1cdmXxHPy4dpliJOYqL77Gn+gbgRwojdavKGVZ1bVRBdi4axaImRM8khRckQnQbypLuFAIoptbKLo940P/LC3lFmVZDvDW0I4CG/gvTpxdDo58y7jeMngeklJDJ+aKv1Ji6Cqo0eSNhjz1hBm6Go1eob/7JxyZ07Vykr9y718SoHhjGMDlX6zoR1NV0/bYDuwRhddcokvJxGvFKudSNgZI7tVpQQKBgQD/IT8wPbbwyftCZsYdnqCLKhyoxg492ci5aLKfHZNVhOatFlIPKCqvWDVAQPqMIisFk1X7PNajEK8y2SOwy6rhy36fqrAf9WC8yYpUiInf4SdItHoQiCKDq0vmae/Jua4Rwmiut2L4soLyTTXvQ7b51Hv+ZkcuDHqewvGca1YZLQKBgQDJSwEasIPwNbvANIajgsrB6jpegtEn58dpzF0dM9ErEts+xhf2h3VRglbhRm3mroy72Dul+urmUD/9tGNOmF9ON3teVmBzmvB5QZUlDaHtfoHA5MTL35f0Hpt8T7sGzIu97HxLSbD5WuoIPSMO/1yX3m4Vi7oJfgctWfojso8DxwKBgQCS7yLlNaXWp3z9kRMom+L6QxaeXPJ2zKa9oX6+BNqFtjTkGqbH8+ohcju49bNWYZdFbsVmHHPBFirQrh3QBHw17mzOqA8nWLqN/8SbSsedGJ73UHm8a6r1CgJ8gSaIl1eZAs4nUZa+hJDF25HkaqtG1wlSSrVT3/v+02czHt5HQQKBgQC6klKLsmAYHTXQiN7iXzAfXEKNpyLFogcrAMitcIHHMssT+/fqANO0oOJ2GxlyXwcCdQGUbmWa43bsaG5DQufTT4mBfv4XKN0LBsZ+eYxE3KTXbTMa5DurgVMMfboUKzK67p6mCb+G38VbrY75L6da/Ed8oO3mLnHojyVSQQZdsQKBgAar8TGlK5fe+TKFa81jR5n8pD9rVHpLoagsjK3ueA7tnRHwXHxVTItGU/S9HyZxPuA1EA9VVSol73a924Q569sFd/sd9rJCF5Z3EUmM3IXKpfEhA5E5lJ9ZkqjjWVgNiu2cJG4MDdAB3FSJ0tB+WjAHUrXWkQrF7D+Av0XUP0uB").decrypt(g);if(32>e.length)return"";g=e.substr(0,16);e=e.substr(16,e.length);g=a.usWebToolkit.cipher.algorithms.seed.startDecrypting(g,e);g.update(a.usWebToolkit.util.createBuffer(d));g.finish();return g.output.getBytes()}};D.UI=function(){this._errormsglang=eval(eval(function(){return F({eval:!1,intergrity:!1,name:"errormsg_"+n.Language,url:"unisignweb/rsrc/lang/errormsg_"+n.Language+".js"})})())};D.UI.prototype={isValidDevice:function(c){for(var b in a.CONST.medias)if(a.CONST.medias[b].device===c)return!0;return!1},getMediaName:function(c){var b="",d;for(d in a.CONST.medias)if(a.CONST.medias[d].device===c){b=a.CONST.medias[d].name;break}return b},getMediaDevice:function(c){var b=-1,d;for(d in a.CONST.medias)if(a.CONST.medias[d].name===c){b=a.CONST.medias[d].device;break}return b},isItPortableDevice:function(){return"android"===a.osName||"ios"===a.osName?!0:!1},isItLGAndroidBrowser:function(){return"android lg"===a.browserName?!0:!1},isItSamsungAndroidBrowser:function(){return"android samsung"===a.browserName?!0:!1},isItSupportingPFCertBackUp:function(){if(!(2&a.ESVS.Mode))return!1;if(this.isItPortableDevice())return"android samsung"===a.browserName||"android lg"===a.browserName||"android browser"===a.browserName||"android chrome"===a.browserName||"ios safari"===a.browserName||"ios chrome"===a.browserName?!0:!1;if("chrome"===a.browserName)return!0;if("msie"===a.browserName){if(10<=parseInt(a.browserVersion))return!0}else{if("firefox"===a.browserName)return parseInt(a.browserVersion),!0;if("safari"===a.browserName){if(6.1<=parseFloat(a.browserVersion))return!0}else if("opera"===a.browserName)return parseInt(a.browserVersion),!0}return!1},isItPFDevice:function(c){switch(c){case a.CONST.__PF_M_SS.device:case a.CONST.__PF_M_LS.device:case a.CONST.__PF_M_TOUCHSIGN.device:case a.CONST.__PF_M_SMARTSIGN.device:case a.CONST.__PF_M_WEBSECTOKEN.device:case a.CONST.__PF_M_WEBSOFTTOKEN.device:case a.CONST.__PF_M_CLOUDSIGN.device:return!0}return!1},isItSupportingThisStorage:function(c){if(!c)return!1;var b=!1;if(1===(255&a.ESVS.Mode)||4===a.ESVS.Mode)switch(c.device){case a.CONST.__USFB_M_DISK.device:case a.CONST.__USFB_M_HSMKEY.device:case a.CONST.__USFB_M_SMARTCARD.device:case a.CONST.__USFB_M_MOBILE.device:case a.CONST.__USFB_M_HDD.device:case a.CONST.__USFB_M_MOBILETOKEN.device:b=this.isItPortableDevice()?!1:!0;break;default:b=!1}else if(2===(255&a.ESVS.Mode))switch(c.device){case a.CONST.__PF_M_SS.device:case a.CONST.__PF_M_LS.device:case a.CONST.__PF_M_CLOUDSIGN.device:b=!0;break;case a.CONST.__PF_M_TOUCHSIGN.device:case a.CONST.__PF_M_SMARTSIGN.device:case a.CONST.__PF_M_WEBSECTOKEN.device:case a.CONST.__PF_M_WEBSOFTTOKEN.device:b=this.isItPortableDevice()?!1:!0;break;default:b=!1}else if(3===(255&a.ESVS.Mode)||6===(255&a.ESVS.Mode))switch(c.device){case a.CONST.__USFB_M_DISK.device:case a.CONST.__USFB_M_HSMKEY.device:case a.CONST.__USFB_M_SMARTCARD.device:case a.CONST.__USFB_M_MOBILE.device:case a.CONST.__USFB_M_HDD.device:case a.CONST.__USFB_M_MOBILETOKEN.device:b=this.isItPortableDevice()?!1:!0;break;case a.CONST.__PF_M_LS.device:case a.CONST.__PF_M_SS.device:case a.CONST.__PF_M_CLOUDSIGN.device:b=!0;break;case a.CONST.__PF_M_TOUCHSIGN.device:case a.CONST.__PF_M_SMARTSIGN.device:case a.CONST.__PF_M_WEBSECTOKEN.device:case a.CONST.__PF_M_WEBSOFTTOKEN.device:b=this.isItPortableDevice()?!1:!0;break;default:b=!1}return b},getScrollTop:function(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop},getScrollLeft:function(){return self.pageXOffset?self.pageXOffset:document.documentElement&&document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft},getViewportHeight:function(){return window.undefined!=window.innerHeight?window.innerHeight:"CSS1Compat"==document.compatMode?document.documentElement.clientHeight:document.body?document.body.clientHeight:window.undefined},getViewportWidth:function(){return window.undefined!=window.innerWidth?window.innerWidth:"CSS1Compat"==document.compatMode?document.documentElement.clientWidth:document.body?document.body.clientWidth:window.undefined},getStyle:function(a,b,d){if(!a||!b||!d)return null;var g=null;return g=a.currentStyle?a.currentStyle[b]:window.getComputedStyle?window.getComputedStyle(a,"").getPropertyValue(d):null},getNumSize:function(a){if(!a)return-1;a=a.toLowerCase();var b="";if(-1<a.indexOf("px"))b=a.substring(0,a.indexOf("px"));else return-1;return parseInt(b)},getOverlay:function(a){if(0>a||!a)return null;var b=document.createElement("div");b.style.zIndex=a;b.style.backgroundImage="none";b.style.margin="0px";b.style.cursor="auto";b.style.display="none";b.onclick=null;b.style.position="fixed";b.style.width="100%";b.style.height="100%";b.style.top="0";b.style.left="0";b.style.filter="alpha(opacity=50)";b.style.backgroundColor="#000";b.style.opacity="0.5";return b},isLoadingBox:function(a){a=document.getElementById(a);return null!=a&&"none"!=a.style.display?!0:!1},loadingBox:function(c,b,d){if(null==b||""==b)b="us-div-list-load";b=document.getElementById(b);if(null!=b){document.getElementById("us-cert-processing-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/processing-img.gif",0);null==d&&(d=0);var g=document.getElementById("us-cert-processing-text");g.innerHTML="";g.appendChild(document.createTextNode(this._errormsglang.IDS_CERT_LOADING_MSG[d]));b.style.display=c?"":"none"}},createLoadingBox:function(c,b,d){if(null==b||""==b)b="us-div-loading-dialog";null==document.getElementById(b)?(a.ESVS.TargetObj.innerHTML='<div id="us-div-loading-dialog" class="us-layout-loading-o"></div><div class="us-layout-loading"><span class="us-layout-cert-processing-img"><img id="us-div-loading-dialog-img" class="us-layout-cert-processing-img"></span><span id="us-div-loading-dialog-text" class="us-layout-cert-processing-text"></span></div>',document.getElementById("us-div-loading-dialog-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/processing-img.gif",0),c=document.getElementById("us-div-loading-dialog-text"),c.innerHTML="",c.appendChild(document.createTextNode(d))):"change"==c?(c=document.getElementById("us-div-loading-dialog-text"),c.innerHTML="",c.appendChild(d)):a.ESVS.TargetObj.innerHTML=""},addCapsLockEvent:function(a,b,d,g){a=document.getElementById(a);var e=document.getElementById(b);if(!e||!a)return null;document.getElementById(b+"-text").appendChild(document.createTextNode(d));var f=function(){e&&(e.style.display="block")},h=!1,m=!1;a.onkeyup=function(a){a=a||event;a.which&&16==a.which&&(h=!1)};a.onkeydown=function(a){a=a||event;var c=0;a.which&&16==a.which&&(h=!0);window.event?c=a.keyCode:a.which&&(c=a.which);c&&20==c?m?(m=!1,e&&(e.style.display="none")):(m=!0,f()):c&&13==c&&g&&g(a?a:event)};a.onkeypress=function(a){a=a||event;var c=0,b=!1;window.event?(c=a.keyCode,b=a.shiftKey):a.which&&(c=a.which,b=h);65<=c&&90>=c&&!b?(m=!0,f()):97<=c&&122>=c&&b?(m=!0,f()):(m=!1,e&&(e.style.display="none"))};try{-1!=navigator.appVersion.toLowerCase().indexOf("win")&&(document.msCapsLockWarningOff=!0)}catch(l){}},offsetResize:function(a,b){if(a){var d=this.getViewportHeight()/2-a.offsetHeight/2,g=this.getViewportWidth()/2-a.offsetWidth/2;0>d&&(d=0);0>g&&(g=0);a.style.position="fixed";!b||"center"!=b&&"center"!=b.split(",")[0]?b&&"center"!=b?(a.style.top=b.split(",")[0]+"px",a.style.left=b.split(",")[1]+"px"):(a.style.top="30px",a.style.left=g+"px"):(a.style.top=d+"px",a.style.left=g+"px")}},setFirstFocus:function(a){a&&("string"==typeof a&&(a=document.getElementById(a)),a&&(a.focus(),setTimeout(function(){a.focus()},10)))},setRotationTabFocus:function(a,b,d){function g(a){return"string"==typeof a?document.getElementById(a):a}a&&b&&d&&(a=g(a),b=g(b),d=g(d),a.onkeydown=function(g){var f=g||window.event;9==(f.which||f.keyCode)&&(a.onblur=function(){setTimeout(function(){(f.shiftKey?b:d).focus()},10)})})},msgBox:function(a){a&&alert(a)},flagAlert:function(a){a&&!1!=H&&alert(a)},errMsgBox:function(a,b){a&&alert(a+"\n\nError Code [ "+b+" ]")},getErrorMessageLang:function(){return this._errormsglang},getUserCancelErrCodeNMsg:function(){11003!=a.ERROR.Code&&210020!=a.ERROR.Code&&(a.ERROR.Code=999,a.ERROR.Message=this._errormsglang.IDS_ERROR_USER_CANCEL)},CheckPwdPattern:function(c){var b=!0;a.ESVS.LimitMinNewPWLen>c.length&&(b=!1);if("NPKI"===a.ESVS.PKI||2===a.ESVS.LimitNewPWPattern){var d=/^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[^a-zA-Z0-9])/g;d.exec(c)||(b=!1)}else 1===a.ESVS.LimitNewPWPattern&&(d=/^(?=.*[a-zA-Z])(?=.*[0-9])/g,d.exec(c)||(b=!1));if("NPKI"===a.ESVS.PKI&&(d=/['"\\|]/g,d.exec(c)&&(b=!1),2<c.length)){for(d=0;d<c.length-2;d++)if(c.charAt(d)===c.charAt(d+1)&&c.charAt(d)===c.charAt(d+2)){b=!1;break}for(d=0;d<c.length-2;d++)if(c.charCodeAt(d)===c.charCodeAt(d+1)-1&&c.charCodeAt(d)===c.charCodeAt(d+2)-2){b=!1;break}}return b}};D.CERT=function(){var a=eval(eval(function(){return F({intergrity:!1,name:"errormsg_"+n.Language,url:"unisignweb/rsrc/lang/certlist_"+n.Language+".js"})})());this._certOidNameTable={};this._certOidNameTable["1.2.410.200004.5.1.1.5"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.1.1.7"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.2.1.1"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.2.1.2"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.3.1.1"]=a.IDS_AGENCY_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.3.1.2"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.3.1.9"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.4.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.4.1.2"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.4.1.3"]=a.IDS_SERVER_CERTIFICATE;this._certOidNameTable["1.2.410.200005.1.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200005.1.1.5"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200012.1.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200012.1.1.3"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.2.1.7.1"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.2.1.7.2"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.2.1.7.3"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200004.5.1.1.9"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.1.1.9.2"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200005.1.1.4"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200005.1.1.6.2"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200004.5.4.1.101"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.4.1.102"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.4.1.103"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200004.5.4.1.104"]=a.IDS_PERSON_ELECTRONIC_CIVIL_APPEAL;this._certOidNameTable["1.2.410.200012.1.1.101"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200012.1.1.103"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200012.1.1.105"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.1.1.1.1.1.1.1.1.1"]=a.IDS_VERISIGN;this._certOidNameTable.restriction=a.IDS_RESTRICTION;this._certCAOidTable={};this._certCAOidTable.crosscert="1.2.410.200004.5.4";this._certCAOidTable.yessign="1.2.410.200005.1.1";this._certCAOidTable.koscom="1.2.410.200004.5.1";this._certCAOidTable.ktnet="1.2.410.200012.1.1";this._certCAOidTable.kica="1.2.410.200004.5.2";this._certCAOidTable.verisign="1.1.1.1.1.1";this._certCANameTable={};this._certCANameTable.crosscert=a.IDS_CA_CROSSCERT;this._certCANameTable.yessign=a.IDS_CA_YESSIGN;this._certCANameTable.koscom=a.IDS_CA_KOSCOM;this._certCANameTable.ktnet=a.IDS_CA_KTNET;this._certCANameTable.kica=a.IDS_CA_KICA;this._certCANameTable.verisign=a.IDS_VERISIGN;this._certValidState={};this._certValidState.valid=a.IDS_CERT_STATE_VALID;this._certValidState.invalid=a.IDS_CERT_STATE_INVALID;this._certValidState.notice1=a.IDS_CERT_STATE_NOTICE_1;this._certValidState.notice2=a.IDS_CERT_STATE_NOTICE_2;this.certDNAttribute=[];this.certDNAttribute[0]="cn";this.certDNAttribute[1]="c";this.certDNAttribute[2]="l";this.certDNAttribute[3]="s";this.certDNAttribute[4]="st";this.certDNAttribute[5]="street";this.certDNAttribute[6]="o";this.certDNAttribute[7]="ou";this.certDNAttribute[8]="dnqualifier";this.certDNAttribute[9]="dc";this.certDNAttribute[10]="serialnumber";this.certDNAttribute[11]="e"};D.CERT.prototype={getCN:function(a){if(!a)return"undefined";var b=null,d=a.replace(/(^\s*)|(\s*$)/gi,"").split("="),g=d.length,e=[],f=0;if(1<g){for(var h=0;h<g;h++)if(-1!=d[h].indexOf(","))for(var m=d[h].split(","),l=m.length,r=0;r<l;r++)e[f++]=m[r];else e[f++]=d[h];for(d=0;d<f;d++)if(this.certDNAttribute[0]==e[d].toLowerCase()){b=e[++d];break}if(f<=d+1)return null===b?this.getOU(a):b;a=this.certDNAttribute.length;do{++d;for(r=1;r<a;r++)if(this.certDNAttribute[r]==e[d].toLowerCase())return b;b=b+", "+e[d]}while(d<f)}return"undefined"},getO:function(a){if(!a)return"undefined";var b=null,d=a.replace(/\s/g,"").replace(/(^\s*)|(\s*$)/gi,"").split("="),g=d.length;a=[];var e=0;if(1<g){for(var f=0;f<g;f++)if(-1!=d[f].indexOf(","))for(var h=d[f].split(","),m=h.length,l=0;l<m;l++)a[e++]=h[l];else a[e++]=d[f];for(d=0;d<e;d++)if(this.certDNAttribute[6]==a[d].toLowerCase()){b=a[++d];break}if(e<=d+1)return null===b?"undefined":b;g=this.certDNAttribute.length;do{++d;for(l=0;l<g;l++)if(this.certDNAttribute[l]==a[d].toLowerCase())return b;b=b+", "+a[d]}while(d<e)}return"undefined"},getOU:function(a){if(!a)return"undefined";var b=null,d=a.replace(/(^\s*)|(\s*$)/gi,"").split("="),g=d.length;a=[];var e=0;if(1<g){for(var f=0;f<g;f++)if(-1!=d[f].indexOf(","))for(var h=d[f].split(","),m=h.length,l=0;l<m;l++)a[e++]=h[l];else a[e++]=d[f];for(d=0;d<e;d++)if(this.certDNAttribute[7]==a[d].toLowerCase()){b=a[++d];break}if(e<=d+1)return null===b?"undefined":b;g=this.certDNAttribute.length;do{++d;for(l=0;l<g;l++)if(this.certDNAttribute[l]==a[d].toLowerCase())return b;b=b+", "+a[d]}while(d<e)}return"undefined"},getLocalDate:function(a){if(!a)return"undefined";var b=new Date(a);a=b.getFullYear();var d=b.getMonth()+1,b=b.getDate();10>d&&(d="0"+d);10>b&&(b="0"+b);return a+"-"+d+"-"+b},getLocalDateNTime:function(a){if(!a)return"undefined";var b=new Date(a);a=b.getFullYear();var d=b.getMonth()+1,g=b.getDate(),e=b.getHours(),f=b.getMinutes(),b=b.getSeconds();10>d&&(d="0"+d);10>g&&(g="0"+g);10>e&&(e="0"+e);10>f&&(f="0"+f);10>b&&(b="0"+b);return a+"-"+d+"-"+g+" "+e+":"+f+":"+b},getCertType:function(a){if(!a)return"undefined";a=this._certOidNameTable[a];return null==a||""==a?this._certOidNameTable.restriction:a},getIssuerName:function(a){if(!a)return"undefined";var b=null;return b=-1!=a.indexOf(this._certCAOidTable.crosscert)?this._certCANameTable.crosscert:-1!=a.indexOf(this._certCAOidTable.yessign)?this._certCANameTable.yessign:-1!=a.indexOf(this._certCAOidTable.koscom)?this._certCANameTable.koscom:-1!=a.indexOf(this._certCAOidTable.ktnet)?this._certCANameTable.ktnet:-1!=a.indexOf(this._certCAOidTable.kica)?this._certCANameTable.kica:-1!=a.indexOf(this._certCAOidTable.verisign)?this._certCANameTable.verisign:"undefined"},getIssuerEnName:function(a){if(!a)return"undefined";var b=null;return b=-1!=a.indexOf(this._certCAOidTable.crosscert)?"crosscert":-1!=a.indexOf(this._certCAOidTable.yessign)?"yessign":-1!=a.indexOf(this._certCAOidTable.koscom)?"koscom":-1!=a.indexOf(this._certCAOidTable.ktnet)?"ktnet":-1!=a.indexOf(this._certCAOidTable.kica)?"kica":-1!=a.indexOf(this._certCAOidTable.verisign)?"verisign":"undefined"},getExpirationState:function(a){if(!a)return"undefined";a=new Date(a);var b=(new Date).getTime();a=a.getTime()-b;return 0<a?2592E6<=a?this._certValidState.valid:this._certValidState.notice1+parseInt(a/1E3/60/60/24)+this._certValidState.notice2:this._certValidState.invalid},getExpirationStateValue:function(a){if(!a)return-1;a=new Date(a);var b=(new Date).getTime();a=a.getTime()-b;return 0<a?2592E6<=a?0:1:2},getTheCertAttributes:function(c,b){if(!c||!b)return{};a.usWebToolkit.x509Certificate.parser(c,b);var d=null;try{d=a.usWebToolkit.x509Certificate.getVersion()}catch(g){}var e=null;try{e=a.usWebToolkit.x509Certificate.getSerialNumber()}catch(f){}var h=null;try{h=a.usWebToolkit.x509Certificate.getSignAlgo()}catch(m){}var l=null;try{l=a.usWebToolkit.x509Certificate.getIssuerName()}catch(r){}var k=null;try{k=a.usWebToolkit.x509Certificate.getNotBefore()}catch(p){}var q=null;try{q=a.usWebToolkit.x509Certificate.getNotAfter()}catch(t){}var w=null;try{w=a.usWebToolkit.x509Certificate.getSubjectName()}catch(u){}var B=null;try{B=a.usWebToolkit.x509Certificate.getPublickey()}catch(v){}var P=null;try{P=a.usWebToolkit.x509Certificate.getAuthorityKeyIndentifier()}catch(Ka){}var n=null;try{n=a.usWebToolkit.x509Certificate.getSubjectKeyIdentifier()}catch(La){}var Ba=null;try{Ba=a.usWebToolkit.x509Certificate.getKeyUsage()}catch(Ma){}var Ca=null;try{Ca=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid()}catch(y){}var x=null;try{x=a.usWebToolkit.x509Certificate.getSubjectAltName()}catch(A){}var z=null;try{z=a.usWebToolkit.x509Certificate.getAuthorityInfoAccess()}catch(D){}var C=null;try{C=a.usWebToolkit.x509Certificate.getcRLDistributionPoints()}catch(F){}var E=null;try{E=a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS()}catch(H){}var G=null;try{G=a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice()}catch(J){}var I=null;try{I=a.usWebToolkit.x509Certificate.getSignature()}catch(K){}return{version:d,serialNumber:e,signAlgo:h,issuerName:l,validateFrom:k,validateTo:q,subjectName:w,publicKey:B,authorityKeyIndentifier:P,subjectKeyIndentifier:n,keyUsage:Ba,policiesOid:Ca,subjectAltName:x,authorityInfoAccess:z,crlDistributionPoints:C,policiesCps:E,policiesUserNotice:G,signature:I}}};D.FORGERY=function(){this._lang=eval(eval(function(){return F({eval:!1,intergrity:!1,name:"forgery_"+n.Language,url:"unisignweb/rsrc/lang/forgery_"+n.Language+".js"})})());this._md=a.usWebToolkit.md.algorithms.sha256.create();this._integrityList=[];var c=F({eval:!1,intergrity:!1,name:"unisign",url:"unisignweb/integrity/unisign.js"}),b=null;if(!(1&a.ESVS.Mode)){var d=window.console||{log:function(){}};null!=c||11<c.length?a.logger(" >>>> SignData : ["+c.length+"] "+c.substring(0,10)+"..."+c.substring(c.length-10,c.length)):a.logger(" >>>> SignData ERROR : "+c);var g=null,e,f;try{e=c,g=a.usWebToolkit.pkcs7.messageFromBase64(c),f=c,g.verify()}catch(h){a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : "+h.code);H=!1;a.logger(H+" >> signdata :: ("+(e==f)+") "+this._lang.IDS_MSGBOX_ERROR_VERIFY_SIGNED_DATA_OF_MD_TABLE+"\nerror code : "+h.code+"\nerror msg : "+h.message+"\na:"+e+"\nb:"+f);G&&d.log("error code : ",h.code,"\nerror msg : ",h.message);return}E("verify result : "+g.verifyResult);if(!0==g.verifyResult)a.intergrity.data=g.content;else if(-1<navigator.userAgent.indexOf("compatible"))a.nimservice()?a.nimservice().VerifySignedData(null,c,function(c,b){0!=c?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1368"),H=!1):a.intergrity.data=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(b))}):(a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1509"),H=!1);else{a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1513");H=!1;a.logger(">> verifyResult :: "+this._lang.IDS_MSGBOX_ERROR_VERIFY_SIGNED_DATA_OF_MD_TABLE);return}try{b=a.usWebToolkit.pki.certificateToBase64(g.certificates[0])}catch(m){a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : "+m.code);H=!1;a.logger(">> certificate error :: "+this._lang.IDS_MSGBOX_ERROR_GET_THE_CERT_FROM_SIGNED_DATA);G&&d.log("error code : ",m.code,"\nerror msg : ",m.message);return}}a.usWebToolkit.x509Certificate.parser(b,"Base64");ra();c=a.usWebToolkit.x509Certificate.getSubjectName();if(!c||0>=c.length||"cn=crosscertwebv3,ou=stlab,o=crosscert,c=kr"!==c.toLowerCase())a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1401"),H=!1,a.logger(">> get dn : "+this._lang.IDS_MSGBOX_ERROR_VERIFY_THE_CERT);else if(c=a.usWebToolkit.x509Certificate.getSubjectKeyIdentifier(),!c||0>=c.length||"9ecd6e86418013304666aff0c486a6c31a6fe363"!==c)a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1411"),H=!1,a.logger(">> get ski : "+this._lang.IDS_MSGBOX_ERROR_VERIFY_THE_CERT)};D.FORGERY.prototype={verify:function(c,b){ra();var d=a.intergrity.getList();if(!d||0>=d.length)return null;if(!c||!b)return this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE;var g=null;this._md.start();this._md.update(b);for(var g=this._md.digest().toHex(),e=0;e<d.length;e++)if(d[e].name==c){if(d[e].data==g)return"success";var f=window.console||{log:function(){}};a.logger("*** Suspicion Forgery ***\nintergrity file name : "+d[e].name+"\nintergrity file md data : "+d[e].data+"\ndownloaded file name : "+c+"\ndownloaded file md data : "+g+"\n"+this._lang.IDS_MSGBOX_WARNING_SUSPICION_FORGERY);G&&(f.log("*** Suspicion Forgery ***"),f.log("intergrity file name : ",d[e].name,"\nintergrity file md data : ",d[e].data),f.log("downloaded file name : ",c,"\ndownloaded file md data : ",g));break}return this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE}};CheckIntergrity=function(){ra();var c=null,b=null;E("==================================== CheckIntergrity START");for(var d=0;d<L.length;d++)if(c=L[d].name,b=L[d].data,rstr=a.forgeryUtil().verify(c,b),"success"===rstr)L[d].name=null,L[d].data=null,L[d]=null;else if(rstr){L[d].name=null;L[d].data=null;L[d]=null;a.uiUtil().flagAlert(rstr);H=!1;break}else return!1;return!0};D.FILE=function(){};D.FILE.prototype={save:function(a,b){if(a&&!(0>=a.length)&&b){var d=new Blob([b],{type:"application/octet-stream"});ha(d,a)}}};var y=N=null,J=0,x=null,M=navigator.platform,A=navigator.userAgent,N=0<=M.indexOf("Win")?"win":0<=M.indexOf("Mac")?"mac":0<=M.indexOf("Linux")?"linux":0<=M.indexOf("iPhone")||0<=M.indexOf("iPad")||0<=M.indexOf("iPod")?"ios":"unknown";0<=A.indexOf("Android")&&(N="android");"android"===N?0<=A.indexOf("SAMSUNG")?(y="android samsung",x=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("OPR")?(y="android opera",x=/OPR\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Opera")?(y="android opera classic",x=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Firefox")?(y="android firefox",x=/Firefox\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("NAVER")?y="android naver":0<=A.indexOf("DaumApps")?(y="android daum",x=/DaumApps\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("nate_app")?y="android nate":0<=A.indexOf("UCBrowser")?(y="android uc",x=/UCBrowser\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Chrome")?0<=A.indexOf("Version")?(y=0<=A.indexOf("LG")?"android lg":"android browser",x=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("LG")?((x=/Chrome\/([0-9]{1,}[.0-9]{0,})/)&&x.exec(A)&&(J=parseFloat(RegExp.$1)),y=39>J?"android lg":"android chrome"):(y="android chrome",x=/Chrome\/([0-9]{1,}[.0-9]{0,})/):(y="unknown",J=0):"ios"===N?0<=A.indexOf("CriOS")?(y="ios chrome",x=/CriOS\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("NAVER")?y="ios naver":0<=A.indexOf("DaumApps")?(y="ios daum",x=/DaumApps\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Coast")?(y="ios opera coast",x=/Coast\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Safari")?(y="ios safari",x=/Version\/([0-9]{1,}[.0-9]{0,})/):(y="unknown",J=0):0<=A.indexOf("MSIE")?(y="msie","BackCompat"==document.compatMode?J=5:document.documentMode?J=document.documentMode:x=/MSIE ([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Chrome")?(y="chrome",x=/Chrome\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Firefox")?(y="firefox",x=/Firefox\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Safari")?(y="safari",x=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Opera")?(y="opera",x=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("rv:11.")?(y="msie",x=/rv:([0-9]{1,}[.0-9]{0,})/):(y="unknown",J=0);x&&x.exec(A)&&(J=parseFloat(RegExp.$1));var ra=function(){return"msie"==y?10>J:"chrome"==y?10>J:"firefox"==y?10>J:"safari"==y?6.1>J:"opera"==y?15>J:!0},Y=window.console||{log:function(){}};G&&(Y.log("UI ver : ",V,"\nplatform : ",M,"\nuseragent : ",A),Y.log("OS name : ",N,"\nbrowser name : ",y,"\nbrowser version : ",J));var a={ver:V,nimVersion:"2.4.0.0",osName:N,browserName:y,browserVersion:J,usWebToolkit:window.crosscert,isAvailable:function(){return G?!0:null==H?!1:H},isSKModule:null,touchEn_pubkey:null,intergrity:{data:null,list:null,getList:function(){null==this.list&&(this.list=this.parser(this.data));return this.list},parser:function(a){"string"!==typeof a&&(a=new String(a));var b=[];a=a.split(/\r\n|\r|\n/g);for(var d=0;d<a.length;d++){var g=a[d].split("|"),e={};e.name=g[0];e.data=g[1];b[d]=e}return b}},logger:function(a){},trace:E,nimCheckUrl:T,plugin:function(){return document.getElementById("unisignwebplugin")},nimservice:function(){return Ia},options:{img_src:null},ubiKeyEnv:{version:"1,3,0,7",siteInfo:"CROSSCERT|http://www.ubikey.co.kr/infovine/download.html",securityInfo:"CROSSCERT|NULL",downloadURL:"http://www.ubikey.co.kr/infovine/download.html"},usimEnv:{sitecode:"303010001",modecode:"0003",siteURL:document.location.hostname,serviceIP:"service.smartcert.kr",servicePort:"443",downloadURL:"http://download.smartcert.kr"},xmlNormalizer:{using:!1,installcheck:!1,name:"Q0NYbWxOb3JtYWxpemVyLmRsbA==",version:"1.0.0.0"},uiUtil:function(){return __UIUtil},certUtil:function(){return __CertUtil},forgeryUtil:function(){return __ForgeryUtil},fileUtil:function(){return __FileUtil},bsUtil:function(){return __BSUtil},uiLayerLevel:1E4,certsList:null,reInitialize:Fa,loadUI:Ga,currentObject:null,CCPFSH:function(){return Ja},ESVS:n,STATUS:{HadCheckedLicense:!1},PFSH:qa,PFUC:null,ERROR:{Code:0,Message:null},CONST:{__USFB_M_DISK:{device:1,name:"removable"},__USFB_M_HSMKEY:{device:2,name:"sectoken"},__USFB_M_SMARTCARD:{device:3,name:"savetoken"},__USFB_M_MOBILE:{device:4,name:"mobilephone"},__USFB_M_HDD:{device:5,name:"harddisk"},__USFB_M_MOBILETOKEN:{device:6,name:"mobiletoken"},__USFB_M_ETC:{device:9,name:"USFB_M_ETC"},__PF_M_LS:{device:11,name:"webstorage"},__PF_M_SS:{device:21,name:"sharestorage"},__PF_M_TOUCHSIGN:{device:12,name:"touchsign"},__PF_M_SMARTSIGN:{device:13,name:"smartsign"},__PF_M_WEBSECTOKEN:{device:14,name:"websectoken"},__PF_M_WEBSOFTTOKEN:{device:15,name:"websofttoken"},__PF_M_CLOUDSIGN:{device:16,name:"cloudsign"},__PF_M_ETC:{device:19,name:"PF_M_ETC"},medias:{}},SELCERTINFO:{index:0,pw:null,curdevice:5,cert:null,certattrs:null}};__UIUtil=new D.UI;__CertUtil=new D.CERT;__ForgeryUtil=new D.FORGERY;__FileUtil=new D.FILE;__BSUtil=new D.BSUTIL;"ahnlab"==a.ESVS.SecureKeyboardType?(a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_KS_INSTALL_CHECK),$ASTX2.init(function(){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");a.isSKModule=!0},function(){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");a.isSKModule=!1;$ASTX2.getLastError()})):"touchen"==a.ESVS.SecureKeyboardType&&ta();var Ia=Da(a),Ja=Ea(a);a.CONST.medias={removable:a.CONST.__USFB_M_DISK,sectoken:a.CONST.__USFB_M_HSMKEY,savetoken:a.CONST.__USFB_M_SMARTCARD,mobilephone:a.CONST.__USFB_M_MOBILE,harddisk:a.CONST.__USFB_M_HDD,mobiletoken:a.CONST.__USFB_M_MOBILETOKEN,sharestorage:a.CONST.__PF_M_SS,webstorage:a.CONST.__PF_M_LS,touchsign:a.CONST.__PF_M_TOUCHSIGN,smartsign:a.CONST.__PF_M_SMARTSIGN,websectoken:a.CONST.__PF_M_WEBSECTOKEN,websofttoken:a.CONST.__PF_M_WEBSOFTTOKEN,cloudsign:a.CONST.__PF_M_CLOUDSIGN};VerifyPFLicense=function(){return!0};if(VerifyPFLicense())return T=function(){CheckIntergrity()?(L=null,!1==G&&null==H&&(H=!0)):E("## It couldnt check intergrity of files.")},null!=a.intergrity.data?T():setTimeout(T,1E3),G&&Y.log("Is this Browser supporting plugin free cert backup? ",a.uiUtil().isItSupportingPFCertBackUp()),!0==n.DebugConsole&&(document.onkeydown=function(a){a=a||window.event;var b=a.keyCode;try{123==b&&(+"\v1"?a.preventDefault():a.keyCode=a.returnValue=0)}catch(d){}}),{Available:function(){return a.isAvailable()},IsValidity:function(){return!1==a.isAvailable()?(a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE),!1):a.nimservice()?!0:!1},GetLastError:function(c){!1==a.isAvailable()?a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE):(c(a.ERROR.Code,a.ERROR.Message),a.ERROR.Code=0,a.ERROR.Message=null)},SetEmbeddedUI:function(c){!1==a.isAvailable()?a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE):a.ESVS.Embedded=c?!0:!1},SignDataP1:function(c,b,d){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c||!d||document.getElementById("us-div-cert-select"))return!1;var g=k(),e=function(a){1==d.length?d(a):(null==a&&(a=k()),d(a.signedData,a.theCert,a.theDN))};a.reInitialize();var f=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:b},onConfirm:function(b,d,l,r,s,p,q){g.theCert=b;g.theDN=d;if("undefined"!==typeof r&&"undefined"!==typeof s)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(p))a.nimservice()?(l=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c)),a.nimservice().GetSignDataP1(r,s,l,null,function(b,c,d){0!=b?(a.ERROR.Code=b,a.ERROR.Message=c,a.uiUtil().errMsgBox(c,a.ERROR.Code),e(k(a.ERROR.Code,a.ERROR.Message))):(g.signedData=d,e(g));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){f.dispose()},10)})):(e(null),setTimeout(function(){f.dispose()},10));else if(p==a.CONST.__PF_M_CLOUDSIGN.device)a.uiUtil().loadingBox(!0,"us-div-list-load",1),reqGenSign(r,s,q,a.usWebToolkit.util.encodeUtf8(c),function(b,c,d,h){0!=b?(a.ERROR.Code=b,a.ERROR.Message=c,e(k(b,c))):(b=a.usWebToolkit.util.hexToBytes(d),g.signedData=a.usWebToolkit.util.encode64(b),g.curDevice=p,g.b64RValue=h,e(g));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){f.dispose()},10);r=s=w=pri=null});else{try{var t=window.console||{log:function(){}};G&&(t.log("b64 cert : ",a.PFUC[r].signcert),t.log("b64 pri : ",a.PFUC[r].signpri));var w=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[r].signcert),u=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[r].signpri),u=crosscert.pki.privateKeyFromAsn1(crosscert.asn1.fromDer(u));b=null;switch(oids[w.signatureOid]){case "sha1WithRSAEncryption":b=crosscert.md.algorithms[sha1].create();break;case "kcdsaWithSHA1":w.md=crosscert.md.algorithms[sha1].create();break;case "md5WithRSAEncryption":b=crosscert.md.algorithms[md5].create();break;case "sha256WithRSAEncryption":b=crosscert.md.algorithms[sha256].create();break;case "RSASSA-PSS":b=crosscert.md.algorithms[sha256].create()}b.update(c);var B=u.sign(b);g.signedData=a.usWebToolkit.pkcs7.messageToBase64(B);e(g)}catch(v){a.ERROR.Code=v.code,a.ERROR.Message=v.message,a.uiUtil().errMsgBox(l,a.ERROR.Code),e(k(a.ERROR.Code,a.ERROR.Message))}setTimeout(function(){f.dispose()},10);r=s=w=pri=null}},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message));f.dispose()}});f.show();return!0}},VerifySignedDataP1:function(c,b,d,g){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(c&&b&&d||g(-1),a.reInitialize(),!(1&a.ESVS.Mode))if(4&a.ESVS.Mode)a.nimservice()&&(c=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c)),a.nimservice().VerifySignature(c,b,d,function(b,c){0!=b&&(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage());g(b);a.uiUtil().loadingBox(!1,"us-div-list-load")}));else{b=a.usWebToolkit.util.decode64(b);d=a.usWebToolkit.pki.certificateFromBase64(d);var e="1.2.840.113549.1.1.5"==d.signatureOid||"1.2.410.200004.1.9"==d.signatureOid?a.usWebToolkit.md.sha1.create():"1.2.840.113549.1.1.4"==d.signatureOid?a.usWebToolkit.md.md5.create():"1.2.840.113549.1.1.11"==d.signatureOid||"1.2.840.113549.1.1.10"==d.signatureOid?a.usWebToolkit.md.sha256.create():null;e.update(c);var f;try{f=d.publicKey.verify(e.digest().getBytes(),b)}catch(h){a.ERROR.Code=h.code,a.ERROR.Message=h.message,f=!1}f?g(0):g(a.ERROR.Code)}},SignDataP7:function(c,b,d,g,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c||!e||document.getElementById("us-div-cert-select"))return!1;var f=k(),h=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.signedData,a.curDevice,a.certAttrs,a.b64RValue))};a.reInitialize();var m=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:b},onConfirm:function(b,e,s,p,q,t,w){var u=s;f.certAttrs=s;if("undefined"!==typeof p&&"undefined"!==typeof q)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(t))a.nimservice()?(b=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c)),a.nimservice().GetSignDataP7(p,q,0,b,d,g,function(b,c,d,g,l,s){0!=b?(a.ERROR.Code=b,a.ERROR.Message=c,h(k(b,c))):(null==u&&a.CONST.__USFB_M_MOBILETOKEN.device==t?(u=a.certUtil().getTheCertAttributes(l,"Base64"),f.certAttrs=u,Z(p,q,t,l,u)):Z(p,q,t,e,u),f.signedData=d,f.curDevice=t,f.b64RValue=g,f.tokenLabel=s,h(f));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){m.dispose()},10);p=q=e=v=null})):(h(null),setTimeout(function(){m.dispose()},10));else if(t==a.CONST.__PF_M_CLOUDSIGN.device)a.uiUtil().loadingBox(!0,"us-div-list-load",1),reqGenSign(p,q,w,a.usWebToolkit.util.encodeUtf8(c),function(b,d,g,l){0!=b?(a.ERROR.Code=b,a.ERROR.Message=d,h(k(b,d))):(Z(p,q,t,e,u),b=a.usWebToolkit.util.hexToBytes(g),d=a.usWebToolkit.pki.certificateFromBase64(e),g=crosscert.pkcs7.createSignedData(),g.signWithP1(b,c,d,null,null),f.signedData=a.usWebToolkit.pkcs7.messageToBase64(g),f.curDevice=t,f.b64RValue=l,h(f));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){m.dispose()},10);p=q=e=v=null});else{try{var B=window.console||{log:function(){}};G&&(B.log("b64 cert : ",a.PFUC[p].signcert),B.log("b64 pri : ",a.PFUC[p].signpri));e=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[p].signcert);var v=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[p].signpri),P=a.usWebToolkit.pkcs7.createSignedData();P.sign(c,e,v,q,null,null);f.signedData=a.usWebToolkit.pkcs7.messageToBase64(P);f.curDevice=t;h(f)}catch(n){a.ERROR.Code=n.code,a.ERROR.Message=n.message,112047==n.code&&(a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_MATTCHED_PWD),a.uiUtil().errMsgBox(a.ERROR.Message,a.ERROR.Code),h(k(n.code,n.message))}setTimeout(function(){m.dispose()},10);p=q=e=v=null}},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message));m.dispose()}});m.show();return!0}},VerifySignedDataP7:function(c,b){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c)return null;var d=null;a.reInitialize();if(!(1&a.ESVS.Mode))if(2&a.ESVS.Mode){d=null;try{d=a.usWebToolkit.pkcs7.messageFromBase64(c),d.verify()}catch(g){if(a.ERROR.Code=g.code,a.ERROR.Message=g.message,b)b(null);else return null}if(d.verifyResult)if(d=d.content,b)b(d);else return d}else if(4&a.ESVS.Mode)a.nimservice()&&a.nimservice().VerifySignedData(null,c,function(c,d){0!=c?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),b(null)):b(a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(d)));a.uiUtil().loadingBox(!1,"us-div-list-load")});else{d=null;try{d=a.usWebToolkit.pkcs7.messageFromBase64(c),d.verify()}catch(e){a.ERROR.Code=e.code,a.ERROR.Message=e.message,b(null)}if(d.verifyResult)if(d=d.content,b)b(d);else return d;else b(null)}}},SignDataP7Ext:function(c,b,d,g,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b&&!d||document.getElementById("us-div-cert-select")||!e)return!1;var f=k(),h=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.resultMessage,a.signedData,a.certIndex,a.password,a.curDevice,a.curDrive))};c||(c="DIGITAL_SIGNATURE_P7_EXT");a.reInitialize();var m=a.loadUI("certselect")({type:c,args:{dn:g},onConfirm:function(b,c,g,e,q){4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(e)&&(a.nimservice()?a.nimservice().GetSignDataP7(c,g,0,d,!0,null,function(b,d,l,B,v,n){0!=b?(a.ERROR.Code=b,a.ERROR.Message=d,a.uiUtil().errMsgBox(d,a.ERROR.Code),h(k(b,d))):(f.resultCode=b,f.resultMessage=d,f.signedData=l,f.certIndex=c,f.password=g,f.curDevice=e,f.curDrive=q,f.tokenLabel=n,h(f));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){m.dispose()},10)}):h(k(rv,rvMsg)))},onCancel:function(){m.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});m.show();return!0}},SelectMedia:function(c,b){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b)return!1;var d=c;d||(d="CERT_STORAGE");var g=k(),e=function(a){1==b.length?b(a):(null==a&&(a=k(-1)),b(a.curDevice,a.curDrive,a.pin))};a.reInitialize();Dialog=a.loadUI("storageselect")({type:d,args:null,onConfirm:function(b,c){g.curDevice=b;g.curDrive=c;Dialog.dispose();2===b||3===b?(d=2===b?"PIN_SECURITY_TOKEN":"PIN_SAVE_TOKEN",PINDialog=a.loadUI("pin")({type:d,args:null,onConfirm:function(a){PINDialog.dispose();g.pin=a;e(g)},onCancel:function(){PINDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}}),PINDialog.show()):e(g)},onCancel:function(){Dialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}});Dialog.show()}},SelectMediaForCertImporting:function(c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c)return!1;var b=k(),d=function(a){1==c.length?c(a):(null==a&&(a=k(-1)),c(a.resultCode,a.resultMessage,a.curDevice,a.curDrive,a.pin,a.password))};a.reInitialize();Dialog=a.loadUI("storageselect")({type:"CERT_STORAGE",args:null,onConfirm:function(c,e){Dialog.dispose();b.curDevice=c;b.curDrive=e;2===c||3===c?(PWDialog=a.loadUI("password")({type:null,args:null,onConfirm:function(f){PWDialog.dispose();var h=null,h=2===c?"PIN_SECURITY_TOKEN":"PIN_SAVE_TOKEN";PINDialog=a.loadUI("pin")({type:h,args:null,onConfirm:function(a){PINDialog.dispose();b.pin=a;b.password=f;d(b);f=null},onCancel:function(){PINDialog.dispose();f=null;a.uiUtil().getUserCancelErrCodeNMsg();d(k(a.ERROR.Code,a.ERROR.Message))}});PINDialog.show()},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();d(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show()):d(b)},onCancel:function(){Dialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();d(k(a.ERROR.Code,a.ERROR.Message))}});Dialog.show()}},ExportCert:function(c,b,d,g,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c)return null;var f=k(),h=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.resultMessage,a.theCert,a.thePri,a.kmCert,a.kmPri))};a.reInitialize();4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(d)&&(a.nimservice()?a.nimservice().ExportCertEx(d,g,c,b,function(a,b,c,d,e,g){f.resultCode=a;f.resultMessage=b;f.theCert=c;f.thePri=d;f.kmCert=e;f.kmPri=g;h(f)}):h(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)));return null}},ImportCert:function(c,b,d,g,e,f,h,m,l){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(1>e||0>f)return-1;k();var r=function(a){1==l.length?l(a):(null==a&&(a=k(-1)),l(a.resultCode,a.resultMessage))};a.reInitialize();4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(e)&&(a.nimservice()?a.nimservice().ImportCertEx(e,f,h,m,c,b,d,g,function(a,b){r(k(a,b))}):r(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)));return-1}},IssueCert:function(c,b,d){function g(b,c,d){if(4<=a.ESVS.Mode)return a.nimservice()?(IssuingDialog=a.loadUI("certprocessing")({type:"CERT_ISSUE",args:null,onConfirm:null,onCancel:null}),IssuingDialog.show(),a.nimservice().IssueCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,b,c,"",f,h,function(b,c){m.resultCode=b;m.resultMessage=c;if(0!=b)return a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),IssuingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message,!0,function(){l(m)}),!1;IssuingDialog.dispose(b,0,null,!0,function(){l(m)});return!0})):l(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE)),!1;c=null;c=2===b?a.loadUI("pin"):a.loadUI("newpassword");PWDialog=c({type:null,args:null,onConfirm:function(c){PWDialog.dispose();if(2&a.ESVS.Mode&&a.uiUtil().isItPFDevice(b)){IssuingDialog=a.loadUI("certprocessing")({type:"CERT_ISSUE",args:null,onConfirm:null,onCancel:null});IssuingDialog.show();var d;d=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");d.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/certbackup_"+a.ESVS.Language+".js?version="+a.ver,!1);d.send(null);var e=eval(d.responseText);setTimeout(function(d){if(b==a.CONST.__PF_M_LS.device){if(!a.PFSH)return l(null),!1;try{a.PFSH.LoadAllCerts(document.domain)}catch(g){301E5===g.code?(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain)):(d=window.console||{log:function(){}},G&&(d.log("***** Plugin Free LoadAllCerts error *****"),d.log("e.code : ",g.code,"e.message : ",g.message,"e.detail : ",g.detail)))}try{a.usWebToolkit.usWebCMP.issueCert(f,h,c,document.domain,"",a.PFSH,function(b,d,f){1===b?IssuingDialog.dispose(0,0,null,!0,function(){var b=a.loadUI("confirm")({type:null,args:{msg:e.IDS_CONFIRMBOX_WILL_YOU_BACKUP_CERT},onConfirm:function(){b.dispose();a.uiUtil().isItPortableDevice()?wa():va(c);c=null;l(m)},onCancel:function(){b.dispose();c=null;a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message))}});b.show()}):(2===b?(a.ERROR.Code=-1,a.ERROR.Message=d,IssuingDialog.dispose(-1,a.ERROR.Code,a.ERROR.Message,!0,function(){l(k(a.ERROR.Code,a.ERROR.Message))})):(a.ERROR.Code=f.code,a.ERROR.Message=f.message,IssuingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!0,function(){l(k(a.ERROR.Code,a.ERROR.Message))})),c=null)})}catch(r){a.ERROR.Code=r.code,a.ERROR.Message=r.message,IssuingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!0,function(){l(k(a.ERROR.Code,a.ERROR.Message))}),c=null}}else if(b==a.CONST.__PF_M_SS.device)try{var q=function(b,c,d,f){a.CCPFSH().SaveUserCert(d,c,!0,function(a,b){f(a)})},p=function(b,d,f){1==b?IssuingDialog.dispose(0,0,null,!0,function(){var b=a.loadUI("confirm")({type:null,args:{msg:e.IDS_CONFIRMBOX_WILL_YOU_BACKUP_CERT},onConfirm:function(){b.dispose();a.uiUtil().isItPortableDevice()?ya():xa(c);c=null;l(m)},onCancel:function(){b.dispose();c=null;a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message))}});b.show()}):2==b?IssuingDialog.dispose(b,b,d,!0,function(){l(k(b,d))}):3==b&&(b=f.code,IssuingDialog.dispose(b,b,f.message,!0,function(){l(k(f.code,f.message))}))};a.CCPFSH().GetCCStorageHandler(n.EncAlgo,n.HashAlgo,n.PKI,function(b,d){a.usWebToolkit.usWebCMP.issueCert(f,h,c,document.domain,"",d,p,null,null,q)})}catch(w){a.ERROR.Code=w.code,a.ERROR.Message=w.message,IssuingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!0,function(){l(k(w.code,w.message))}),c=null}},1E3)}},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message));PWDialog.dispose()}});PWDialog.show()}function e(){r=a.loadUI("storageselect")({type:"CERT_STORAGE_ISSUE",args:null,onConfirm:function(b,c,d){r.dispose();4&a.ESVS.Mode?g(b,c,""):3===b?(PINDialog=a.loadUI("pin")({type:"PIN_SAVE_TOKEN",args:null,onConfirm:function(a){PINDialog.dispose();g(b,c,a)},onCancel:function(){PINDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message))}}),PINDialog.show()):g(b,c,"")},onCancel:function(){r.dispose();a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message))}});r.show()}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d)return!1;var f=c,h=b,m=k(),l=function(a){1==d.length?d(a):(null==a&&(a=k(-1)),d(a.resultCode,a.resultMessage))};a.reInitialize();if(f&&h)e();else{var r=a.loadUI("certissue")({type:null,args:null,onConfirm:function(a,b){f=a;h=b;r.dispose();e()},onCancel:function(){r.dispose();a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message))}});r.show()}return!0}},IssueKMCert:function(c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(c&&!document.getElementById("us-div-cert-select")){var b=k();a.reInitialize();var d=a.loadUI("certselect")({type:"CERT_RENEWAL_KMCERT",args:{dn:null},onConfirm:function(g,e,f,h,m,l){d.dispose();if(confirm(e)){if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(f))return a.nimservice()?(RenewingDialog=a.loadUI("certprocessing")({type:"CERT_ISSUE",args:null,onConfirm:null,onCancel:null}),RenewingDialog.show(),a.nimservice().IssueKMCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,f,h,m,"","",function(d,f){0==d?RenewingDialog.dispose(0,0,null,!0,function(){c(b)}):(a.ERROR.Code=d,a.ERROR.Message=f,RenewingDialog.dispose(d,a.ERROR.Code,a.ERROR.Message,!0,function(){c(d)}))})):c(k(-1)),!1}else a.uiUtil().getUserCancelErrCodeNMsg(),c(k(a.ERROR.Code,a.ERROR.Message))},onCancel:function(){d.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();c(k(a.ERROR.Code,a.ERROR.Message))}});d.show();return!0}},RenewCert:function(c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(c&&!document.getElementById("us-div-cert-select")){var b=k(),d=function(a){1==c.length?c(a):(null==a&&(a=k(-1)),c(a.resultCode,a.resultMessage))};a.reInitialize();var g=a.loadUI("certselect")({type:"CERT_RENEWAL",args:{dn:null},onConfirm:function(c,f,h,m,l,r){g.dispose();c=!0;h!=a.CONST.__USFB_M_MOBILETOKEN.device&&(c=confirm(f));if(c){if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(h))return a.nimservice()?(f=a.loadUI("certprocessing"),RenewingDialog=f({type:"CERT_RENEWAL",args:null,onConfirm:null,onCancel:null}),RenewingDialog.show(),a.nimservice().RenewCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,h,m,l,"","",function(c,f){0==c?RenewingDialog.dispose(0,0,null,!0,function(){d(b)}):(a.ERROR.Code=c,a.ERROR.Message=f,RenewingDialog.dispose(c,a.ERROR.Code,a.ERROR.Message,!0,function(){d(k(c,f))}))})):d(null),!1;if(2&a.ESVS.Mode&&a.uiUtil().isItPFDevice(h)){f=a.loadUI("certprocessing");RenewingDialog=f({type:"CERT_RENEWAL",args:null,onConfirm:null,onCancel:null});RenewingDialog.show();m=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");m.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/certbackup_"+a.ESVS.Language+".js?version="+a.ver,!1);m.send(null);var s=eval(m.responseText);m=function(b,c,f){1==b?RenewingDialog.dispose(0,0,null,!0,function(){var b=a.loadUI("confirm")({type:null,args:{msg:s.IDS_CONFIRMBOX_WILL_YOU_BACKUP_CERT},onConfirm:function(){b.dispose();a.CONST.__PF_M_LS.device===h?a.uiUtil().isItPortableDevice()?wa():va(r):a.CONST.__PF_M_SS.device===h&&(a.uiUtil().isItPortableDevice()?ya():xa(r));pw=null;d(resultObejct)},onCancel:function(){b.dispose();pw=null;a.uiUtil().getUserCancelErrCodeNMsg();d(k(a.ERROR.Code,a.ERROR.Message))}});b.show()}):2==b?RenewingDialog.dispose(b,b,c,!0,function(){d(k(b,c))}):3==b&&(b=f.code,RenewingDialog.dispose(b,b,f.message,!0,function(){d(k(b,f.message))}))};a.CONST.__PF_M_LS.device===h?a.usWebToolkit.usWebCMP.update(a.PFUC[l].signcert,a.PFUC[l].signpri,a.PFUC[l].kmcert,a.PFUC[l].kmpri,r,document.domain,"",a.PFSH,m):a.CONST.__PF_M_SS.device===h&&a.usWebToolkit.usWebCMP.update(a.PFUC[l].signcert,a.PFUC[l].signpri,a.PFUC[l].kmcert,a.PFUC[l].kmpri,r,document.domain,"",a.CCPFSH,m,null,null,null,function(b,c,d,f){a.CCPFSH().SaveUserCert(d,c,!1,function(a,b){f(a)})})}else a.uiUtil().errMsgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_SUPPORT_DEVICE,-1)}},onCancel:function(){g.dispose();a.uiUtil().getUserCancelErrCodeNMsg();d(k(a.ERROR.Code,a.ERROR.Message))}});g.show();return!0}},RevocateCert:function(c){function b(b,c,e,l){var r=a.loadUI("certrevoke")({type:null,args:null,onConfirm:function(k){r.dispose();if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(e))if(a.nimservice()){var p=a.loadUI("certprocessing");RevokingDialog=p({type:"CERT_REVOCATION",args:null,onConfirm:null,onCancel:null});RevokingDialog.show();a.nimservice().RevokeCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,e,l,b,k,function(a,b){d.resultCode=a;0===a?RevokingDialog.dispose(0,null,null,!0,function(){g(d)}):RevokingDialog.dispose(a,a,b,!0,function(){g(d)})})}else g(null);else if(2&a.ESVS.Mode&&a.uiUtil().isItPFDevice(e)){p=a.loadUI("certprocessing");RevokingDialog=p({type:"CERT_REVOCATION",args:null,onConfirm:null,onCancel:null});RevokingDialog.show();var q=function(){if(e==a.CONST.__PF_M_LS.device)return a.PFSH;if(e==a.CONST.__PF_M_SS.device)return a.CCPFSH()};setTimeout(function(){E("b64 cert : ",a.PFUC[b].signcert);E("b64 pri : ",a.PFUC[b].signpri);var e=a.usWebToolkit.usWebCMP.revReason.keyCompromise;switch(k){case 1:e=a.usWebToolkit.usWebCMP.revReason.keyCompromise;E("cause : keyCompromise");break;case 3:e=a.usWebToolkit.usWebCMP.revReason.afilationChanged;E("cause : afilationChanged");break;case 5:e=a.usWebToolkit.usWebCMP.revReason.superseded,E("cause : superseded")}try{a.usWebToolkit.usWebCMP.revocation(a.PFUC[b].signcert,a.PFUC[b].signpri,a.PFUC[b].kmcert,c,document.domain,e,q(),function(e,l,m){b=0;c=null;1===e?RevokingDialog.dispose(0,0,null,!0,function(){g(d)}):2===e?(a.ERROR.Code=-1,a.ERROR.Message=l,d.resultCode=a.ERROR.Code,d.resultMessage=a.ERROR.Message,RevokingDialog.dispose(-1,a.ERROR.Code,a.ERROR.Message,!0,function(){g(d)})):(a.ERROR.Code=m.code,a.ERROR.Message=m.message,d.resultCode=a.ERROR.Code,d.resultMessage=a.ERROR.Message,RevokingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!0,function(){g(d)}))})}catch(l){b=0,c=null,a.ERROR.Code=l.code,a.ERROR.Message=l.message,d.resultCode=a.ERROR.Code,d.resultMessage=a.ERROR.Message,RevokingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!0,function(){g(d)})}},1E3)}},onCancel:function(){r.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g(k(a.ERROR.Code,a.ERROR.Message))}});r.show()}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(c&&!document.getElementById("us-div-cert-select")){var d=k(),g=function(a){1==c.length?c(a):(null==a&&(a=k(-1)),c(a.resultCode,a.resultMessage))};a.reInitialize();var e=a.loadUI("certselect")({type:"CERT_REVOCATION",args:{dn:null},onConfirm:function(c,d,m,l,r){e.dispose();var s=a.loadUI("confirm")({type:null,args:{msg:c},onConfirm:function(){s.dispose();b(d,m,l,r)},onCancel:function(){s.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g(k(a.ERROR.Code,a.ERROR.Message))}});s.show()},onCancel:function(){e.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g(k(a.ERROR.Code,a.ERROR.Message))}});e.show();return!0}},SOECert:function(c){function b(b,c,e,l){4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(e)&&(a.nimservice()?(RevokingDialog=a.loadUI("certprocessing")({type:"CERT_SOE",args:null,onConfirm:null,onCancel:null}),RevokingDialog.show(),a.nimservice().RevokeCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,e,l,b,6,function(a,b){d.resultCode=a;0===a?RevokingDialog.dispose(0,null,null,!0,function(){g(d)}):RevokingDialog.dispose(a,a,b,!0,function(){g(d)})})):g(null))}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(c&&!document.getElementById("us-div-cert-select")){var d=k(),g=function(a){1==c.length?c(a):(null==a&&(a=k(-1)),c(a.resultCode,a.resultMessage))};a.reInitialize();var e=a.loadUI("certselect")({type:"CERT_SOE",args:{dn:null},onConfirm:function(c,d,m,l,r){e.dispose();var s=a.loadUI("confirm")({type:null,args:{msg:c},onConfirm:function(){s.dispose();b(d,m,l,r)},onCancel:function(){s.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g(k(a.ERROR.Code,a.ERROR.Message))}});s.show()},onCancel:function(){e.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g(k(a.ERROR.Code,a.ERROR.Message))}});e.show();return!0}},VerifyVID:function(c,b){function d(b,c,d,f,s,p){if("PFS"==p)try{E("b64 cert : ",a.PFUC[c].signcert);E("b64 pri : ",a.PFUC[c].signpri);var q=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[c].signcert),t=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[c].signpri),w=a.usWebToolkit.pkcs8.verifyVID(t,d,b,q);d=b="";w?e(g):e(null)}catch(u){d=b="",a.ERROR.Code=u.code,a.ERROR.Message=u.message,e(k(u.code,u.message))}else"NIM"==p&&(a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_VID_VERIFY_MESSAGE),a.nimservice().VerifyVID(c,d,b,function(c,f){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0==c?e(g):(a.ERROR.Code=c,a.ERROR.Message=f,e(k(c,f)));d=b=""}))}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||document.getElementById("us-div-cert-select"))return!1;var g=k(),e=function(a){1==b.length?b(a):(null==a&&(a=k(-1)),b(a.resultCode,a.resultMessage))};a.reInitialize();var f=a.loadUI("certselect")({type:"VID_VERIFICATION",args:{dn:null},onConfirm:function(b,g,l,r,s){f.dispose();if(c)d(c,b,g,l,r,s);else{var p=a.loadUI("ssn")({type:null,onConfirm:function(a){d(a,b,g,l,r,s);p.dispose()},onCancel:function(){p.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}});p.show()}},onCancel:function(){f.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}});f.show();return!0}},ManageCert:function(){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{a.reInitialize();var c=a.loadUI("certmanage")({type:"CERT_MANAGEMENT",onConfirm:null,onCancel:function(){c.dispose();a.uiUtil().getUserCancelErrCodeNMsg();_rvCallback(k(a.ERROR.Code,a.ERROR.Message))}});c.show();return!0}},ManageCertByType:function(c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{a.reInitialize();var b=a.loadUI("certmanage")({type:"CERT_MANAGEMENT",args:{type:c},onConfirm:null,onCancel:function(){b.dispose();a.uiUtil().getUserCancelErrCodeNMsg();_rvCallback(k(a.ERROR.Code,a.ERROR.Message))}});b.show();return!0}},ImportCertFromMobileApp:function(c,b,d){function g(){try{try{a.PFSH.SelectStorage(1)}catch(d){E("***** Plugin Free SelectStorage error *****"),E("e.code : ",d.code,"e.message : ",d.message,"e.detail : ",d.detail),alert("error : "+d.detail),h(k(d.code,d.message))}try{a.PFSH.LoadAllCerts(document.domain)}catch(e){301E5===e.code?(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain)):(E("***** Plugin Free LoadAllCerts error *****"),E("e.code : ",e.code,"e.message : ",e.message,"e.detail : ",e.detail),alert("error : "+e.detail),h(k(e.code,e.message)))}var g=a.PFSH.SetP12HexOnMemory(c,b),s=g.aluc[g.index];a.usWebToolkit.x509Certificate.parser(s.signcert,"Base64");var p=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),q=a.certUtil().getIssuerEnName(p);a.PFSH.SaveUserCert(q,s,document.domain,!0);h(f)}catch(t){E("***** Plugin Free MobileImportCert error *****"),E("e.code : ",t.code,"e.message : ",t.message,"e.detail : ",t.detail),alert("error : "+t.detail),h(null)}}function e(){a.CCPFSH().SetP12HexOnMemory(c,b,function(b,c,e){0==b?(b=e.aluc[e.index],a.usWebToolkit.x509Certificate.parser(b.signcert,"Base64"),c=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),c=a.certUtil().getIssuerEnName(c),a.CCPFSH().SaveUserCert(c,b,!0,function(a){h(k(a))})):(alert("error : "+c),d(k(b,c)))})}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{var f=k(),h=function(a){1==d.length?d(a):(null==a&&(a=k(-1)),d(a.resultCode,a.resultMessage))};b&&c||h(null);a.reInitialize();a.PFSH||h(null);SSDialog=a.loadUI("storageselect")({type:"CERT_STORAGE",args:null,onConfirm:function(b,c){SSDialog.dispose();b==a.CONST.__PF_M_LS.device?g():b==a.CONST.__PF_M_SS.device&&a.CCPFSH().IsCCPFSHAvailable(function(b){0==b?e():a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.PKI,function(a,b){0==a?e():SSDialog.dispose()})})},onCancel:function(){SSDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});SSDialog.show()}},SetSelectedDevice:function(c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{var b="",d;for(d in a.CONST.medias)if(a.CONST.medias[d].device===c){b=a.CONST.medias[d].name;break}a.ESVS.Media.defaultdevice=b}},NimServiceLoaded:function(){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else return a.nimservice()?a.nimservice().GetIframeLoaded():null},SecureMail:function(c,b,d,g,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{k();var f=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.resultMessage))};if("seed"!=b)a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_SUPPORT_ALGORITHM,f(k(a.ERROR.Code,a.ERROR.Message));else if(null==d||""==d||1>d.length)alert(a.uiUtil().getErrorMessageLang().IDS_NOT_ENCRYPTED_DATA);else{a.reInitialize();var h=0,m=a.loadUI("securemail")({type:"SECURE_MAIL",args:{algorithm:b,data:d,decryptData:this.DecryptFileData,mode:c},onConfirm:function(b,d,e,p){if(3<h)null!=document.getElementById("html_encripted")&&(document.getElementById("html_encripted").innerHTML=""),alert(e.IDS_KEY_TYPE[c]+e.IDS_PASSWORD_WRONG),m.dispose();else{var q=document.getElementById("us-input-secure-mail-password");b=p(b,q.value,d,g);if(-10===b)return a.ERROR.Code=-10,a.ERROR.Message=e.IDS_ALGORITHM_ALERT,m.dispose(),f(k(a.ERROR.Code,a.ERROR.Message));if(-11===b){a.ERROR.Code=-11;a.ERROR.Message=e.IDS_KEY_TYPE[c]+e.IDS_PASSWORD_WRONG;if(4<h)return m.dispose(),f(k(a.ERROR.Code,a.ERROR.Message));h+=1;alert(e.IDS_KEY_TYPE[c]+e.IDS_DISCORDANCE_PASSWORD.replace("@",h));q.value=""}else{if(-12===b)return m.dispose(),f(k(-12));if(-13===b){a.ERROR.Code=-13;a.ERROR.Message=e.IDS_KEY_TYPE[c]+e.IDS_PASSWORD_WRONG;if(4<h)return m.dispose(),f(k(-13));h+=1;alert(e.IDS_KEY_TYPE[c]+e.IDS_DISCORDANCE_PASSWORD.replace("@",h));q.value=""}else m.dispose(),f(k(b))}}},onCancel:function(){m.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f(k(a.ERROR.Code,a.ERROR.Message))}});m.show()}}},DecryptFileData:function(c,b,d,g){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{var e,f=b;e=0;for(b=b.length;16>b;b++)f+="abcdefghijklmnopqrstuvwxyz".substr(e++,1);e=f+"0123450123456789";b=c.toLowerCase();if("seed"==b)f=e.substring(0,16),e=e.substring(16,32);else if("3des"==b)f=e.substring(0,24),e=e.substring(24,32);else if("rc2"==b)f=e.substring(0,5),e=e.substring(5,13);else if("des"==b)f=e.substring(0,8),e=e.substring(8,16);else return-10;d=a.usWebToolkit.util.decode64(d);"3des"==b&&(c="des");b=null;try{var h=a.usWebToolkit.cipher.algorithms[c].startDecrypting(f,e);h.update(a.usWebToolkit.util.createBuffer(d));if(!1==h.finish())return-11;0==g||null==g?b=h.output.toHex():1==g&&(b=h.output.getBytes())}catch(m){return a.ERROR.Code=m.code,a.ERROR.Message=m.message,-12}if(0==g||null==g)try{b=a.usWebToolkit.unicode.hex2UTF8(b)}catch(l){return-13}return b}},getFileDownload:function(c,b){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if("function"==typeof ha){if(null==b||""==b||1>b.length){var d=document.location.href.split("/");b=d[d.length-1]}d=new Blob([c],{type:"application/otect-stream"});try{ha(d,b)}catch(g){alert(a.uiUtil().getErrorMessageLang().IDS_ERROR_BROWSER_NOT_SUPPORT)}}else alert(a.uiUtil().getErrorMessageLang().IDS_ERROR_BROWSER_NOT_SUPPORT)},SignData_noConWithHash:function(c,b,d,g,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!e||!c||document.getElementById("us-div-cert-select"))return!1;k();var f=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.jsonSignedData,a.b64RValue,a.certAttrs))};a.reInitialize();var h=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:b},onConfirm:function(a,b,e,k,p,q){ja(c,d,a,k,p,q,g,h,f)},onCancel:function(){h.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f(null)}});h.show();return!0}},SignData_noConWithHashEx:function(c,b,d,g,e,f){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||!f)return!1;k();var h=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.jsonSignedData,a.b64RValue,a.certAttrs))};a.reInitialize();if(!1==c){var m=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:d},onConfirm:function(a,c,d,f,k,t){ja(b,g,a,f,k,t,e,m,h)},onCancel:function(){m.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});m.show()}else ja(b,g,a.SELCERTINFO.cert,a.SELCERTINFO.index,a.SELCERTINFO.pw,a.SELCERTINFO.curdevice,e,null,h)}},SignDataP7NVID_noConWithHash:function(c,b,d,g,e,f){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c||document.getElementById("us-div-cert-select")||!f)return!1;k();var h=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.resultCode,a.signedData,a.certAttrs,a.curDevice))};a.reInitialize();var m=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION",args:{dn:b},onConfirm:function(b,f,g,p,q,t){var w={};if("undefined"!==typeof b&&"undefined"!==typeof f)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(t))if(a.nimservice()){g=function(b){if(!b)return"";var c=null;if("SHA1"==d||"sha1"==d)c="1.3.14.3.2.26";else if("MD5"==d||"md5"==d)c="1.2.840.113549.2.5";else if("SHA256"==d||"sha256"==d)c="2.16.840.1.101.3.4.2.1";b=crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.SEQUENCE,!0,[crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.SEQUENCE,!0,[crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.OID,!1,crosscert.asn1.oidToDer(c).getBytes()),crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.NULL,!1,"")]),crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.OCTETSTRING,!1,b)]);return a.usWebToolkit.asn1.toDer(b).getBytes()};p=0;var u=[];if(c)for(var n in c){var v=a.usWebToolkit.util.decode64(c[n]),v=g(v),v=a.usWebToolkit.util.encode64(v);u[p]=v;p++}a.nimservice().GetSignDataP7(b,f,1,u,!1,null,function(d,g,p,s,u,n){if(0!=d)a.ERROR.Code=d,a.ERROR.Message=g,a.uiUtil().errMsgBox(g,a.ERROR.Code),h(k(d,g));else{d=0;if("object"==typeof p)for(var v in c)w[v]=p[d++];else w=p;null==q&&a.CONST.__USFB_M_MOBILETOKEN.device==t&&(q=a.certUtil().getTheCertAttributes(u,"Base64"));ba(e,b,f,w,q,t,n,h)}f=e="";a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){m.dispose()},10)})}else h(null),setTimeout(function(){m.dispose()},10);else setTimeout(function(){m.dispose()},10);else h(null),setTimeout(function(){m.dispose()},10)},onCancel:function(){m.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});m.show();return!0}},VerifySignData_noConWithHash:function(c,b,d){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c||!b)return!1;a.reInitialize();if(1&a.ESVS.Mode)a.plugin();else if(4&a.ESVS.Mode)a.nimservice()&&a.nimservice().VerifySignedDataWithHashValue(c,b,function(b,c){0!=b&&(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage());d(b)});else{var g=null;try{var e=a.usWebToolkit.util.decode64(c),g=a.usWebToolkit.pkcs7.messageFromBase64(b);g.verifyWithHash(e)}catch(f){return a.ERROR.Code=f.code,a.ERROR.Message=f.message,null}return g.verifyResult}return!1}},SignMultiDataP7:function(c,b,d,g,e,f){if(!c&&!b||!f||document.getElementById("us-div-cert-select"))return!1;var h=k(),m=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.jsonSignedData,a.b64RValue,a.certAttrs,a.curDevice))};a.reInitialize();var l=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:d},onConfirm:function(d,f,p,q,t,w){var u={},n=p;if("undefined"!==typeof q&&"undefined"!==typeof t)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(w))if(a.nimservice()){d=0;var v=[];if(c)if("object"==typeof c)for(var P in c)v[d++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c[P]));else v=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c));else if("object"==typeof jsonPlainData)for(P in jsonPlainData)v[d++]=b[P];else v=b;a.nimservice().GetSignDataP7(q,t,0,v,g,e,function(d,e,f,g,r,p){if(0!=d)a.ERROR.Code=d,a.ERROR.Message=e,m(k(d,e));else{d=0;e=c;b&&(e=b);if("object"==typeof f)for(var s in e)e=f[d++],v[d-1]&&""!=v[d-1]||(e=""),u[s]=e;else u=f;null==n&&a.CONST.__USFB_M_MOBILETOKEN.device==w&&(n=a.certUtil().getTheCertAttributes(r,"Base64"));h.jsonSignedData=u;h.b64RValue=g;h.certAttrs=n;h.curDevice=w;h.tokenLabel=p;m(h)}q=t=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");l.dispose()})}else m(null),l.dispose();else l.dispose(),q=t=pri=null;else m(null),l.dispose()},onCancel:function(){l.dispose();a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}});l.show();return!0},SignMultiDataP7NVerifyVID:function(c,b,d,g,e,f){if(!c&&!b||!f||document.getElementById("us-div-cert-select"))return!1;k();var h=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.resultCode,a.signedData,a.certAttrs,a.curDevice))};a.reInitialize();var m=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:d},onConfirm:function(d,f,s,p,q,t){var w={},u=s;if("undefined"!==typeof p&&"undefined"!==typeof q)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(t))if(a.nimservice()){d=0;var n=[];if(c)if("object"==typeof c)for(var v in c)n[d++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c[v]));else n=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c));else if("object"==typeof c)for(v in jsonPlainData)n[d++]=b[v];else n=b;a.nimservice().GetSignDataP7(p,q,0,n,g,null,function(d,f,g,l,r,s){if(0!=d)a.ERROR.Code=d,a.ERROR.Message=f,h(k(d,f));else{d=0;f=c;b&&(f=b);if("object"==typeof g)for(var v in f)f=g[d++],n[d-1]&&""!=n[d-1]||(f=""),w[v]=f;else w=g;null==u&&a.CONST.__USFB_M_MOBILETOKEN.device==t&&(u=a.certUtil().getTheCertAttributes(r,"Base64"));ba(e,p,q,w,u,t,s,h)}p=q=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");m.dispose()})}else h(null),m.dispose();else p=q=pri=null,m.dispose();else h(null),m.dispose()},onCancel:function(){m.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});m.show();return!0},Base64Encoding:function(c){c=a.usWebToolkit.util.encodeUtf8(c);return(c=a.usWebToolkit.util.encode64(c))?c:null},Base64Decoding:function(c){c=a.usWebToolkit.util.decode64(c);return(c=a.usWebToolkit.util.decodeUtf8(c))?c:null},SignPersonInfoReqP7:function(c,b,d,g,e){if(!c||!b||4>b.length||!e||document.getElementById("us-div-cert-select"))return!1;var f=k(),h=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.signedData,a.certAttrs))};a.reInitialize();g=null;try{g=a.usWebToolkit.util.encodeUtf8(c)}catch(m){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT UTIL ERROR] during encoding utf8 character set.\ndetail : "+m;h(k(a.ERROR.Code,a.ERROR.Message));return}c=null;try{c=a.usWebToolkit.asn1.create(a.usWebToolkit.asn1.Class.UNIVERSAL,a.usWebToolkit.asn1.Type.UTF8,!1,g)}catch(l){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during creating useragreement asn.1 struct.\ndetail : "+l;h(k(a.ERROR.Code,a.ERROR.Message));return}g=0;"1"===b.charAt(0)&&(g|=128);"1"===b.charAt(1)&&(g|=64);"1"===b.charAt(2)&&(g|=32);"1"===b.charAt(3)&&(g|=16);b=String.fromCharCode(4);var r=String.fromCharCode(g);g=null;try{g=a.usWebToolkit.asn1.create(a.usWebToolkit.asn1.Class.UNIVERSAL,a.usWebToolkit.asn1.Type.BITSTRING,!1,b+r)}catch(s){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during creating useragree asn.1 struct.\ndetail : "+s;h(k(a.ERROR.Code,a.ERROR.Message));return}b=null;try{b=a.usWebToolkit.asn1.create(a.usWebToolkit.asn1.Class.UNIVERSAL,a.usWebToolkit.asn1.Type.SEQUENCE,!0,[c,g])}catch(p){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during creating personinforeq asn.1 struct.\ndetail : "+p;h(k(a.ERROR.Code,a.ERROR.Message));return}c=null;try{c=a.usWebToolkit.asn1.toDer(b)}catch(q){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during converting object to der format.\ndetail : "+q;h(k(a.ERROR.Code,a.ERROR.Message));return}var t=null;try{t=a.usWebToolkit.util.encode64(c.getBytes())}catch(n){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT UTIL ERROR] during encoding base64 string.\ndetail : "+n;h(k(a.ERROR.Code,a.ERROR.Message));return}var u=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:d},onConfirm:function(b,c,d,e,g,m){"undefined"!==typeof e&&"undefined"!==typeof g&&4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(m)&&(a.nimservice()?a.nimservice().GetSignDataP7(e,g,0,t,!0,null,function(b,c,e){0!=b?(a.ERROR.Code=b,a.ERROR.Message=c,h(k(b,c))):(f.signedData=e,f.certAttrs=d,h(f));a.uiUtil().loadingBox(!1,"us-div-list-load");u.dispose()}):(h(null),u.dispose()))},onCancel:function(){u.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});u.show();return!0},SignMultiDataP1:function(c,b,d){if(!c||!d||document.getElementById("us-div-cert-select"))return!1;var g=k(),e=function(a){1==d.length?d(a):(null==a&&(a=k(-1)),d(a.jsonSignedData,a.theCert,a.theDN))};a.reInitialize();var f=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:b},onConfirm:function(b,d,l,r,s,p){var q={};if("undefined"!==typeof r&&"undefined"!==typeof s)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(p))if(a.nimservice()){l=0;var t=[];if(c)if("object"==typeof c)for(var n in c)t[l++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c[n]));else t=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c));a.nimservice().GetSignDataP1(r,s,t,null,function(l,r,p,s,n,w){if(0!=l)a.ERROR.Code=l,a.ERROR.Message=r,a.uiUtil().errMsgBox(r,a.ERROR.Code),e(k(l,r));else{l=0;if("object"==typeof p)for(var x in c)r=p[l++],t[l-1]&&""!=t[l-1]||(r=""),q[x]=r;else q=p;g.jsonSignedData=q;g.theCert=b;g.theDN=d;g.tokenLabel=w;e(g)}a.uiUtil().loadingBox(!1,"us-div-list-load");f.dispose()})}else e(null),f.dispose();else r=s=cert=pri=null,f.dispose();else f.dispose()},onCancel:function(){f.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}});f.show();return!0},VerifySignedDataP7ExcludedContent:function(c,b,d){if(!b)return null;a.reInitialize();if(4&a.ESVS.Mode)a.nimservice()&&(c=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c)),a.nimservice().VerifySignedData(c,b,function(b,c){0!=b&&(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage());d(b);a.uiUtil().loadingBox(!1,"us-div-list-load")}));else{var g=null;try{g=a.usWebToolkit.pkcs7.messageFromBase64(b),g.verify(void 0,a.usWebToolkit.util.encodeUtf8(c))}catch(e){a.ERROR.Code=e.code;a.ERROR.Message=e.message;_rvCallback(e.code);return}if(!0==g.verifyResult)return _rvCallback(0),0;_rvCallback(-1);return-1}},SignDataP7AndVerifyVID:function(c,b,d,g){if(!c&&!plainB64Text||!g||document.getElementById("us-div-cert-select"))return!1;k();var e=function(a){1==g.length?g(a):(null==a&&(a=k(-1)),g(a.resultCode,a.signedData,a.certAttrs,a.curDevice))};a.reInitialize();var f=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION",args:{dn:b},onConfirm:function(b,g,l,r,s,p){var q=s;if(a.uiUtil().isItPFDevice(p))try{var t=window.console||{log:function(){}};G&&(t.log("b64 cert : ",a.PFUC[b].signcert),t.log("b64 pri : ",a.PFUC[b].signpri));r=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[b].signcert);var n=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[b].signpri),u=a.usWebToolkit.pkcs7.createSignedData();u.sign(c,r,n,g,null,null);var B=a.usWebToolkit.pkcs7.messageToBase64(u);ba(d,b,g,B,s,p,null,e);f.dispose()}catch(v){a.ERROR.Code=v.code,a.ERROR.Message=v.message,a.uiUtil().errMsgBox(v.message,a.ERROR.Code),e(k(v.code,v.message))}else l=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c)),a.nimservice().GetSignDataP7(b,g,0,l,!0,null,function(c,l,s,t,n,u){0!=c?(a.ERROR.Code=c,a.ERROR.Message=l,e(k(c,l))):(null==q&&a.CONST.__USFB_M_MOBILETOKEN.device==p?(q=a.certUtil().getTheCertAttributes(n,"Base64"),Z(b,g,p,n,q)):Z(b,g,p,r,q),ba(d,b,g,s,q,p,u,e));g=d="";a.uiUtil().loadingBox(!1,"us-div-list-load");f.dispose()})},onCancel:function(){f.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}});f.show();return!0},MakeHash:function(c,b,d,g){function e(c,d){if(null==c||0>=c.length)d(0,"");else if(4&a.ESVS.Mode)if(a.nimservice())if("FilePath"===l){var e=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c));a.nimservice().HashData(1,e,b,function(b,c){0==b?d(b,c):(a.ERROR.Code=b,d(b,""))})}else e=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c)),a.nimservice().HashData(0,e,b,function(b,c){0==b?d(b,c):(a.ERROR.Code=b,d(b,""))});else a.ERROR.Code=-1,d(-1,"");else if("FilePath"!==l)try{var e=a.usWebToolkit.util.encodeUtf8(h),f=crosscert.md.algorithms[m.toLowerCase()].create();f.start();f.update(e);d(0,a.usWebToolkit.util.encode64(f.digest().getBytes()))}catch(g){a.ERROR.Code=g.code,a.ERROR.Message=g.message,d(g.code,"")}}function f(a){e(a,function(a,b){0!=a?p(k(a)):(r[q]=b,q++,h.length==q?(s.hashValue=r,p(s)):f(h[q]))})}if(!c)return null;var h=c,m=b,l=d,r=[];m&&"undefined"!==typeof m||(m="SHA256");var s=k(),p=function(a){1==g.length?g(a):(null==a&&(a=k(-1)),g(a.resultCode,a.hashValue))};"string"===typeof c&&(h=[c]);var q=0;f(h[q])},EncryptData:function(c,b,d,g,e){function f(b,c,d,e,f,g){4&a.ESVS.Mode&&(a.nimservice()?(c=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d)),a.nimservice().EnvelopData("kmcert",b,c,function(b,c,d){h.resultCode=b;0==b?h.encryptedData=d:(a.ERROR.Message=-2==b?a.uiUtil().getErrorMessageLang().IDS_NO_KMCERT:c,a.ERROR.Code=b,h.resultCode=b,h.resultMessage=a.ERROR.Message);f(h);g.dispose()})):(a.ERROR.Code=-1,f(null),g.dispose()))}if(!c||!e||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();var h=k(),m=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.encryptedData))};if(d&&0<d.length)f(d,c,null,m);else{var l=a.loadUI("certselect")({type:"ENCRYPT_P7",args:{dn:b},onConfirm:function(a,b,e){f(a,d,c,e,m,l)},onCancel:function(){l.dispose();a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}});l.show()}return!0},EncryptDataWithSymmKey:function(c,b,d,g,e){if(!d||!b)return null;var f="",h="",f="",m=0,l=k(),r=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.encryptedData))};c=c.toLowerCase();if("seed"==c){h=b.substring(0,16);f=crosscert.util.bytesToHex(h);b=h.length;for(i=0;i<16-b;i++)f+="00";b64SymmKey=a.usWebToolkit.util.encode64(crosscert.util.hexToBytes(f));f="0123456789012345"}else if("3des"==c){m=3;c="des";h=b.substring(0,24);f=crosscert.util.bytesToHex(h);b=h.length;for(i=0;i<24-b;i++)f+="00";b64SymmKey=a.usWebToolkit.util.encode64(crosscert.util.hexToBytes(f));f="01234567"}else return null;if(4&a.ESVS.Mode)if(a.nimservice()){d=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d));var h=a.usWebToolkit.util.encode64(f),s=0;"utf-8"==g.toLowerCase()&&(s=1);a.nimservice().EncryptData(m,h,b64SymmKey,d,1,s,function(b,c){l.resultCode=b;0==b?l.encryptedData=c:a.ERROR.Code=b;r(l)})}else a.ERROR.Code=-1,r(null);else try{s=crosscert.cipher.algorithms[c].startEncrypting(h,f),s.update(crosscert.util.createBuffer(d)),s.finish(),l.encryptedData=a.usWebToolkit.util.encode64(s.output.getBytes()),r(l)}catch(p){a.ERROR.Code=p.code,a.ERROR.Message=p.message,r(k(a.ERROR.Code,a.ERROR.Message))}},DecryptDataWithSymmKey:function(c,b,d,g,e,f){if(!d||!b)return null;var h="",m="",l=0,r=k(),s=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.resultCode,a.decryptedData))},p="";c=c.toLowerCase();if("seed"==c)h=b.substring(0,16),m="0123456789012345",p=a.usWebToolkit.util.encode64(b);else if("3des"==c){l=3;c="des";h=b.substring(0,24);p=crosscert.util.bytesToHex(h);b=h.length;for(i=0;i<24-b;i++)p+="00";p=a.usWebToolkit.util.encode64(crosscert.util.hexToBytes(p));m="01234567"}else return;if(4&a.ESVS.Mode)if(a.nimservice()){var h=a.usWebToolkit.util.encode64(m),q=0;"utf-8"==g.toLowerCase()&&(q=1);g=0;"utf-8"==e.toLowerCase()&&(g=1);a.nimservice().DecryptData(l,h,p,d,q,g,function(b,c){r.resultCode=b;0==b?r.decryptedData=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(c)):a.ERROR.Code=b;s(r)})}else a.ERROR.Code=-1,s(null);else try{var q=a.usWebToolkit.util.decode64(d),n=crosscert.cipher.algorithms[c].startDecrypting(h,m);n.update(crosscert.util.createBuffer(q));n.finish();r.decryptedData=n.output.getBytes();s(r)}catch(w){a.ERROR.Code=w.code,a.ERROR.Message=w.message,s(k(a.ERROR.Code,a.ERROR.Message))}},SetConfigInfo:function(c){c.Mode&&(a.ESVS.Mode=n.Mode=Q=c.Mode);c.PKI&&(a.ESVS.PKI=n.PKI=ca=c.PKI);"undefined"!=typeof c.SecureKeyboardType&&(a.ESVS.SecureKeyboardType=n.SecureKeyboardType=S=c.SecureKeyboardType,"ahnlab"==S&&(eval(F({eval:!1,intergrity:!1,name:"astx2.min.js",url:"unisignweb/framework/keyboard/astx2.min.js"})),eval(F({eval:!1,intergrity:!1,name:"astx2_custom.js",url:"unisignweb/framework/keyboard/astx2_custom.js"}))));c.Language&&("ko-kr"==c.Language.toLowerCase()?a.ESVS.Language=n.Language=W="ko_kr":a.ESVS.Language=n.Language=W="en_us",__FileUtil=__ForgeryUtil=__CertUtil=__UIUtil=null,__UIUtil=new D.UI,__CertUtil=new D.CERT,__ForgeryUtil=new D.FORGERY,__FileUtil=new D.FILE);if(c.Media){var b=c.Media;b.list=b.list?b.list.toLowerCase():null;b.defaultdevice?(b.defaultdevice=b.defaultdevice.toLowerCase(),null!=b.list&&(b.defaultdevice=0>b.list.indexOf(b.defaultdevice)?b.list.split("|")[0]:b.defaultdevice)):b.defaultdevice=null;if(void 0==b.defaultdevice||null==b.defaultdevice)b.defaultdevice=2==Q?"webstorage":"harddisk";a.ESVS.Media=n.Media=b}c.TabIndex&&(a.ESVS.TabIndex=n.TabIndex=$=c.TabIndex);c.LimitNumOfTimesToTryToInputPW&&(a.ESVS.LimitNumOfTimesToTryToInputPW=n.LimitNumOfTimesToTryToInputPW=X=c.LimitNumOfTimesToTryToInputPW);c.Policy&&(a.ESVS.Policy=n.Policy=ea=c.Policy);c.ShowExpiredCerts&&(a.ESVS.ShowExpiredCerts=n.ShowExpiredCerts=fa=c.ShowExpiredCerts);c.LimitMinNewPWLen&&(a.ESVS.LimitMinNewPWLen=n.LimitMinNewPWLen=I=c.LimitMinNewPWLen);c.LimitMaxNewPWLen&&(a.ESVS.LimitMaxNewPWLen=n.LimitMaxNewPWLen=K=c.LimitMaxNewPWLen);c.LimitNewPWPattern&&(a.ESVS.LimitNewPWPattern=n.LimitNewPWPattern=U=c.LimitNewPWPattern);"undefined"===typeof c.CertRequestPageEnable&&(a.ESVS.CertRequestPageEnable=n.CertRequestPageEnable=ga=c.CertRequestPageEnable)},SignFileP7:function(c,b,d,g,e,f){if(document.getElementById("us-div-cert-select")||!f||!c||0<d&&!g)return!1;var h=k(),m=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.resultCode,a.signedData,a.curDevice))};a.reInitialize();var l=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_FILE",args:{dn:b},onConfirm:function(b,f,p,q,n,w){4&a.ESVS.Mode?a.nimservice()?(p=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c)),q="",null!=g&&(q=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(g))),p=[p,d,q],a.nimservice().GetSignFileP7(b,f,p,e,null,function(c,e,g,q,p,n){0!=c?(a.ERROR.Code=c,a.ERROR.Message=e,m(k(c,e))):(h.curDevice=w,h.signedData=g,h.tokenLabel=n,0<d&&(c=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(g)),h.signedData=c),m(h));b=f=cert=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");l.dispose()})):(m(null),l.dispose()):(m(null),l.dispose())},onCancel:function(){l.dispose();a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}});l.show();return!0},SignMultiFileP7:function(c,b,d,g,e,f){if(!c||!f||document.getElementById("us-div-cert-select"))return!1;var h=k(),m=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.resultCode,a.jsonSignedData,a.curDevice))};a.reInitialize();var l=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_FILE",args:{dn:b},onConfirm:function(b,f,p,q,n,w){var u={};if(4&a.ESVS.Mode)if(a.nimservice()){p=0;q=[];n=[];if(c)if("object"==typeof c)for(var B in c)c[B]&&""!=c[B]&&(q[p++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c[B])));else q=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c));if(g)if(p=0,"object"==typeof c)for(B in g)c[B]&&""!=c[B]&&(n[p++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(g[B])));else n=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(g));B=[q,d,n];a.nimservice().GetSignFileP7(b,f,B,e,null,function(e,g,q,p,n,t){if(0!=e)a.ERROR.Code=e,a.ERROR.Message=g,m(k(e,g));else{e=0;if(0<d)if("object"==typeof q)for(var B in c)g=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(q[e++])),c[e-1]&&""!=c[e-1]||(g=""),u[B]=g;else u=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(q));else if("object"==typeof q)for(B in c)u[B]=c[B]&&""!=c[B]?q[e++]:"";else u=q;h.curDevice=w;h.jsonSignedData=u;h.tokenLabel=t;m(h)}b=f=cert=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");l.dispose()})}else m(null),l.dispose();else m(null),l.dispose()},onCancel:function(){l.dispose();a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}});l.show();return!0},SetUBIKeyEnvInfo:function(c,b,d,g){a.ubiKeyEnv={version:c,siteInfo:b,securityInfo:d,downloadURL:g}},SetXMLNormalizerInfo:function(c,b){a.xmlNormalizer={using:!0,installcheck:!1,name:a.usWebToolkit.util.encode64(c),version:b}},SetMobileTokenEnvInfo:function(c,b,d,g,e,f){var h=f;if("undefined"!==typeof f||null==f||0>=f.length)h="http://download.smartcert.kr";a.usimEnv={sitecode:c,modecode:b,siteURL:d,serviceIP:g,servicePort:e,downloadURL:h}},DecryptData:function(c,b){function d(b,d,f,k){4&a.ESVS.Mode&&(a.nimservice()?a.nimservice().DeenvelopData("kmcert",b,d,c,function(b,c,d){g.resultCode=b;0==b?g.decryptedData=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(d)):a.ERROR.Code=b;e(g);k.dispose()}):(a.ERROR.Code=-1,e(null),k.dispose()))}if(!c||!b||document.getElementById("us-div-cert-select"))return!1;var g=k(),e=function(a){1==b.length?b(a):(null==a&&(a=k(-1)),b(a.resultCode,a.decryptedData))};a.reInitialize();var f=a.loadUI("certselect")({type:"ENCRYPT_P7",args:{dn:null},onConfirm:function(a,b,c){d(a,b,c,f)},onCancel:function(){f.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}});f.show();return!0},VerifyKeyPair:function(c){function b(b,c,d,h,p,q){4&a.ESVS.Mode&&a.nimservice().GetSignDataP7(d,h,0,e,!0,null,function(b,c,e,h,l,m){0!=b?(a.ERROR.Code=b,a.ERROR.Message=c,f.errmsg=c,g(k(a.ERROR.Code,f))):a.nimservice().VerifySignedData(null,e,function(b,c){0!=b?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),f.signcert=a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_SIGN+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+a.uiUtil().getErrorMessageLang().IDS_VERIFY_SIGN+")",q(0)):a.nimservice().ValidateCertificate(d,function(b,c,d,e){f.signcert=0==b?999==d?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_SIGN+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_OK:a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_SIGN+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+e+")":a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_SIGN+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+c+")";q(0)})});a.uiUtil().loadingBox(!1,"us-div-list-load")})}function d(b,c,d,h,p,q){4&a.ESVS.Mode&&a.nimservice().EnvelopData("kmcert",d,e,function(b,c,e){0==b?a.nimservice().DeenvelopData("kmcert",d,h,e,function(b,c,d){f.kmcert=0==b?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_OK:-2==b?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_NONE:a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+c+")";q&&q.dispose();g(k(0,f))}):(f.kmcert=-2==b?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_NONE:a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+c+")",q&&q.dispose(),g(k(0,f)))})}if(!c)return!1;k();var g=function(a){1==c.length?c(a):(null==a&&(a=k(-1)),c(a.resultCode,a.resultMessage))},e="1234",f={errmsg:"",signcert:"",kmcert:""};a.reInitialize();var h=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:null},onConfirm:function(a,c,e,f,g,k){b(a,e,f,g,k,function(b){d(a,e,f,g,k,h)})},onCancel:function(){h.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f.errmsg=a.ERROR.Message;g(k(a.ERROR.Code,f))}});h.show();return!0},VerifyP7SignedFileWithFile:function(c,b,d,g,e,f){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d||1==g&&!e)return null;a.reInitialize();if(4&a.ESVS.Mode&&a.nimservice()){var h=null;null!=c&&(h=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c)));c=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d));e=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(e));a.nimservice().VerifySignedFile(h,b,c,g,e,function(b,c,d){0!=b?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),f(b,null)):1==g?(c=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(c)),f(b,c,d)):f(b,a.usWebToolkit.util.decode64(c),d);a.uiUtil().loadingBox(!1,"us-div-list-load")})}}},VerifyP7SignedDataWithFile:function(c,b,d,g,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||1==d&&!g)return null;a.reInitialize();if(4&a.ESVS.Mode&&a.nimservice()){var f=null;null!=c&&(f=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c)));c=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(g));a.nimservice().VerifySignedFile(f,0,b,d,c,function(b,c){if(0!=b)a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),e(b,null);else if(1==d){var f=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(c));e(b,f)}else e(b,a.usWebToolkit.util.decode64(c));a.uiUtil().loadingBox(!1,"us-div-list-load")})}}},RenewCertNSignedSubjectDn:function(c,b,d,g,e,f){function h(b,c,d,f,h,k,l,m){b=!0;d!=a.CONST.__USFB_M_MOBILETOKEN.device&&(b=confirm(c));if(b&&4<=a.ESVS.Mode)return a.nimservice()?(RenewingDialog=a.loadUI("certprocessing")({type:"CERT_RENEWAL",args:null,onConfirm:null,onCancel:null}),RenewingDialog.show(),a.nimservice().RenewCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,d,f,h,k,l,function(b,c){n.resultCode=b;n.resultMessage=c;n.certAttrs=m;n.curDevice=d;n.curDrive=f;if(0==b)RenewingDialog.dispose(0,0,null,!0,function(){s(n)});else if(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),null!=m&&m.subjectName){var k=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(m.subjectName));a.nimservice().ConvertStringFormat(k,g,function(b,c,d){a.nimservice().GetSignDataP7(h,l,0,d,!0,null,function(c,d,f){RenewingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message,e,function(){n.signedData=f;s(n);a.uiUtil().loadingBox(!1,"us-div-list-load")})})})}else RenewingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message,e,function(){s(n)}),a.uiUtil().loadingBox(!1,"us-div-list-load")})):s(null),!1}function m(b,c){if(a.bsUtil().isKeyProtected()){var d=[];d[0]=b;a.nimservice().CheckComplexPin(d,function(a,b){c(a)})}else d=a.uiUtil().CheckPwdPattern(b),c(!0==d?0:-1)}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(f&&!document.getElementById("us-div-cert-select")){var l=c;c&&a.uiUtil().isValidDevice(c)||(d=null,l=b=-1);var n=k(),s=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.resultCode,a.certAttrs,a.signedData))};a.reInitialize();var p=a.loadUI("certselect")({type:"CERT_RENEWAL_SIGN",args:{device:l,drive:b,dn:d},onConfirm:function(b,c,d,e,f,g,l){p.dispose();a.CONST.__USFB_M_HSMKEY.device!=d&&a.CONST.__USFB_M_SMARTCARD.device!=d&&a.CONST.__USFB_M_MOBILETOKEN.device!=d?m(g,function(m){0==m?h(b,c,d,e,f,g,g,l):(PWDialog=a.loadUI("newpassword")({type:null,args:{pw:g},onConfirm:function(a){PWDialog.dispose();h(b,c,d,e,f,a,g,l)},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();s(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show())}):h(b,c,d,e,f,g,g,l)},onCancel:function(){p.dispose();a.uiUtil().getUserCancelErrCodeNMsg();s(k(a.ERROR.Code,a.ERROR.Message))}});p.show();return!0}},SetOptions:function(c,b){a.options[c]=b},MakeTaxXMLDSIG:function(c,b,d,g){function e(b,c){var d="",e;for(e in f)d+=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(f[e])),d+="|";a.nimservice().XMLDllInitialize(a.xmlNormalizer.name,a.xmlNormalizer.version,function(e,f){if(0!=e)a.ERROR.Code=e,a.ERROR.Message=f,a.uiUtil().loadingBox(!1,"us-div-list-load"),b.dispose(),m(k(e,f));else{var g=a.usWebToolkit.util.encode64("XN_NormalizeDataEx"),h=a.usWebToolkit.util.encode64("XN_Free"),l=a.usWebToolkit.util.encode64("XN_GetLastErrorMsg");a.nimservice().XMLDllAction(g,h,l,d,function(d,e,f){a.nimservice().XMLDllFinalize(function(g,h){if(0!=d)a.ERROR.Code=d,a.ERROR.Message=e,a.uiUtil().loadingBox(!1,"us-div-list-load"),b.dispose(),m(k(d,e));else{var l=f.split("|");c(l)}})})}})}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(!1==a.xmlNormalizer.using)a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_XML_NORMALIZER);else{if(!c||!g||document.getElementById("us-div-cert-select"))return!1;var f=c;"string"===typeof c&&(f=[c]);var h=k(),m=function(b){1==g.length?g(b):(null==b&&(b=k(-1)),g(b.signedData,b.b64RValue,b.certAttrs));null==a.currentObject};a.reInitialize();var l=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_XML",args:{dn:b},onConfirm:function(b,c,g,k,t,w){if("undefined"!==typeof g&&"undefined"!==typeof k){if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(t))if(a.nimservice()){var u,x,v;u=g;x=k;v={};var y=0;"sha256WithRSAEncryption"!=c.signAlgo&&(y=1);var z=F({eval:!0,intergrity:!1,name:"xml_template_"+n.Language,url:"unisignweb/rsrc/lang/xml_template_"+n.Language+".js"}),A="sha1";1!=y&&(A="sha256");e(l,function(b){for(var e in b)if(!(null==b[e]||0>=b[e].length||"undefined"==b[e]||"undefined"==f[e])){var g=b[e].split(";"),k={};k.key=e;k.plainText=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(g[0]));var n=crosscert.md.algorithms[A].create();n.start();n.update(a.usWebToolkit.util.decode64(g[1]));g=a.usWebToolkit.util.encode64(n.digest().getBytes());k.Signature=z.XMLSignatureTemplate[y].replace("$$DV$$",g);k.SignedInfo=z.XMLSignedInfoTemplate[y].replace("$$DV$$",g);k.Signature=k.Signature.replace("$$Cert$$",w);f[e]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(k.SignedInfo));v[e]=k}a.nimservice().GetSignDataP1(u,x,f,d,function(b,d,e,f,g,k){h.resultCode=b;h.resultMessage=d;if(0!=b)a.ERROR.Code=b,a.ERROR.Message=d;else{"string"==typeof e&&(e=[e]);for(var n in e)v[n].Signature=v[n].Signature.replace("$$Sign$$",e[n]),b=v[n].plainText.substr(0,v[n].plainText.indexOf(z.KEY_START)),b+=v[n].Signature,b+=v[n].plainText.substr(v[n].plainText.indexOf(z.KEY_START),v[n].plainText.length),e[n]=b;h.signedData=e;h.b64RValue=f;h.certAttrs=c;h.tokenLabel=k}m(h);a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){l.dispose()},10)})})}else m(null),setTimeout(function(){l.dispose()},10);g=k=cert=pri=null}else m(null),setTimeout(function(){l.dispose()},10)},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message));l.dispose()}});l.show();return!0}},DecryptWithUserSymmKey:function(c,b,d,g,e){function f(b,d,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(0==c){for(;-1<d.indexOf("-");)d=d.replace("-","");if(10>d.length)return-11}else if(1==c&&6>d.length)return-11;var f,g=d;f=0;for(d=d.length;16>d;d++)g+="abcdefghijklmnopqrstuvwxyz".substr(f++,1);f=g+"0123450123456789";g=f.substring(0,16);f=f.substring(16,32);e=a.usWebToolkit.util.decode64(e);d=null;try{var h=a.usWebToolkit.cipher.algorithms[b].startDecrypting(g,f);h.update(a.usWebToolkit.util.createBuffer(e));if(!1==h.finish())return-11;d=h.output.getBytes()}catch(k){return a.ERROR.Code=k.code,a.ERROR.Message=k.message,-12}return d}}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{var h=k(),m=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.decryptedData))};if("seed"!=b)a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_SUPPORT_ALGORITHM,m(k(a.ERROR.Code,a.ERROR.Message));else if(null==g||""==g||1>g.length)alert(a.uiUtil().getErrorMessageLang().IDS_NOT_ENCRYPTED_DATA);else{a.reInitialize();var l=0,n=a.loadUI("securemail")({type:"SECURE_MAIL",args:{algorithm:b,data:g,decryptData:f,mode:c},onConfirm:function(b,d,e,g){3<l?(null!=document.getElementById("html_encripted")&&(document.getElementById("html_encripted").innerHTML=""),alert(e.IDS_KEY_TYPE[c]+e.IDS_PASSWORD_WRONG),n.dispose()):(g=document.getElementById("us-input-secure-mail-password"),b=f(b,g.value,d),h.resultCode=b,-10===b?(a.ERROR.Code=-10,a.ERROR.Message=e.IDS_ALGORITHM_ALERT,n.dispose(),m(h)):-11===b?(a.ERROR.Code=-11,a.ERROR.Message=e.IDS_KEY_TYPE[c]+e.IDS_PASSWORD_WRONG,4<l?(n.dispose(),m(h)):(l+=1,alert(e.IDS_KEY_TYPE[c]+e.IDS_DISCORDANCE_PASSWORD.replace("@",l)),g.value="")):-12===b?(n.dispose(),m(h)):-13===b?(a.ERROR.Code=-13,a.ERROR.Message=e.IDS_KEY_TYPE[c]+e.IDS_PASSWORD_WRONG,4<l?(n.dispose(),m(h)):(l+=1,alert(e.IDS_KEY_TYPE[c]+e.IDS_DISCORDANCE_PASSWORD.replace("@",l)),g.value="")):(h.resultCode=0,h.decryptedData=b,m(h),n.dispose()))},onCancel:function(){n.dispose();a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}});n.show()}}},EncryptDataWithCert:function(c,b,d){if(!c||!d)return!1;var g=k(),e=function(a){1==d.length?d(a):(null==a&&(a=k(-1)),d(a.resultCode,a.encryptedData))};a.reInitialize();try{var f=a.usWebToolkit.pki.certificateFromBase64(b),h=a.usWebToolkit.pkcs7.createEnvelopedData();h.addRecipient(f);h.encContent.algorithm=a.usWebToolkit.pki.oids["seed-CBC"];h.content=a.usWebToolkit.util.createBuffer(c);h.encrypt();g.encryptedData=a.usWebToolkit.pkcs7.messageToBase64(h);e(g)}catch(m){a.ERROR.Code=m.code,a.ERROR.Message=m.message,e(k(a.ERROR.Code,a.ERROR.Message))}},GetMacAddress:function(c,b){if(!b)return!1;var d=k();a.reInitialize();4&a.ESVS.Mode&&a.nimservice().GetMacAddress(c,function(c,e,f){0!=c?(a.ERROR.Code=c,a.ERROR.Message=e,b(k(a.ERROR.Code,a.ERROR.Message))):(d.mac=f,b(d))})}};G&&Y.log("It stop to load unisignweb module.")}else alert("Failed to initialize Unisign Core.")};