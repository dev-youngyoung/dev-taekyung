var __certselect=function(a){var P=function(g){function x(){if(!a.certsList)return null;var c=null,c=a.certsList,b=c.list.length,e=[],d=g.args.dn,h=null;null!=a.ESVS.Policy&&(-1!=a.ESVS.Policy.indexOf("|")?h=a.ESVS.Policy.split("|"):(h=[],h[0]=a.ESVS.Policy));var f=null;null!=a.ESVS.Organization&&(-1!=a.ESVS.Organization.indexOf("|")?f=a.ESVS.Organization.split("|"):(f=[],f[0]=a.ESVS.Organization));for(var r=0;r<b;r++){a.usWebToolkit.x509Certificate.parser(c.list[r].cert,"Base64");var k=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),m=a.usWebToolkit.x509Certificate.getSubjectName(),F=a.usWebToolkit.x509Certificate.getNotAfter(),s=a.usWebToolkit.x509Certificate.getNotAfter(),J=c.list[r].index,u=a.certUtil().getIssuerName(k);"undefined"==u&&(u=a.certUtil().getO(m));if(null==d||m.toLowerCase()==d.toLowerCase()){if(null!=a.ESVS.Policy){for(var y=0;y<h.length&&h[y]!=k;y++);if(h.length<=y)continue}if(null!=a.ESVS.Organization&&("CERT_RENEWAL"==g.type||"CERT_RENEWAL_SIGN"==g.type||"CERT_RENEWAL_KMCERT"==g.type||"CERT_REVOCATION"==g.type||"CERT_SOE"==g.type||"CERT_RENEWAL_SIGN"==g.type)){for(y=0;y<f.length&&f[y].toLowerCase()!=a.certUtil().getO(m).toLowerCase();y++);if(f.length<=y)continue}if(a.ESVS.ShowExpiredCerts||2!==a.certUtil().getExpirationStateValue(s))y=[""],y[1]=a.certUtil().getCertType(k),y[2]=a.certUtil().getCN(m),y[3]=u,y[4]=a.certUtil().getLocalDate(F),y[5]=J,y[6]=a.certUtil().getExpirationStateValue(s),e.push(y)}}return c={list:e}}function l(c,b,e,d,h,f,r){function k(){var a=x();"draw"==c?a?m.drawList(f,f.length,a.list,a.list.length,K,r):m.drawList(f,f.length,null,0,K,r):"redraw"==c&&(a?m.redrawList(a.list,a.list.length):m.redrawList(null,0))}if(a.CONST.__USFB_M_DISK.device>b||0>e||!d)return-1;var p=0;q=e;a.certsList&&(a.certsList=null);if(b==a.CONST.__PF_M_SS.device&&a.CCPFSH())a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.PKI,function(b,c){0==b&&a.CCPFSH().GetCertificateList(function(b,c){if(0==b){var d=0;(a.PFUC=c)&&(d=c.length-1);n.log("***** Plugin Free *****");n.log("user certificate counts : ",d);if(0<d){for(var e=[],f=0;f<d;f++){var h=f+1,r={};r.index=h;r.cert=c[h].signcert;e[f]=r}a.certsList={list:e}}(d=x())?m.redrawList(d.list,d.list.length):m.redrawList(null,0);return!0}return!1})});else if(b==a.CONST.__PF_M_CLOUDSIGN.device){a.uiUtil().loadingBox(!0,"us-div-list-load",0);if(g.CS_phoneNumber)s(g.CS_phoneNumber);else{var F=a.loadUI("phoneNumber")({type:"CLOUDSIGN_pNUMBER",args:null,onConfirm:function(a){M=a;s(a);F.dispose()},onCancel:function(){F.dispose();L()}});F.show()}var s=function(b){reqGetCert(b,function(b,c,d){a.uiUtil().loadingBox(!1,"us-div-list-load",0);if(0!=b)return a.uiUtil().errMsgBox(c,b),!1;if(0<d.length){b=[];for(c=0;c<d.length;c++){var e={};e.index=c+1;e.cert=d[c];b[c]=e}a.certsList={list:b}}(d=x())?m.redrawList(d.list,d.list.length):m.redrawList(null,0);return!0})}}else a.nimservice()?a.nimservice().GetAllMediaList(0,function(c,d){0==c?a.nimservice().GetAllUserCertListNum(b,e,"",a.ESVS.Policy,function(c,d){p=d;if(0==c)0<p?a.nimservice().GetAllUserCert(d,function(b,c){0==b?a.certsList={list:c}:a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),b);a.uiUtil().loadingBox(!1,"us-div-list-load");k()}):(k(),a.uiUtil().loadingBox(!1,"us-div-list-load"));else{if(b==a.CONST.__USFB_M_MOBILE.device&&(11003==c||11004==c))return a.ERROR.Code=11003,a.ERROR.Message=C.IDS_MSGBOX_NOT_INSTALL_MOBILE,confirm(C.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)?(document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"))&&a.uiUtil().msgBox(C.IDS_MSGBOX_BLOCK_POPUP_WINDOW)):a.uiUtil().loadingBox(!1,"us-div-list-load"),!1;if(-1===p)c=-1;else{var e=a.nimservice().GetLastErrorCode(),f=a.nimservice().GetLastErrorMessage();n.log("***** GetCerts *****");n.log("Err Code : ",e,"\nErr Msg : ",f);a.uiUtil().errMsgBox(f,c);c=e}k();done=1;a.uiUtil().loadingBox(!1,"us-div-list-load")}}):(c=-1,k(),done=1,a.uiUtil().loadingBox(!1,"us-div-list-load"))}):(k(),a.uiUtil().msgBox(d.IDS_MSGBOX_NIM_ERROR_UNLOAD))}function z(c,b,e,d){if(a.CONST.__USFB_M_DISK.device>c||0>b||!e)return-1;var h=0,f=0;q=b;a.certsList&&(a.certsList=null);if(a.CONST.__PF_M_LS.device===c&&2&a.ESVS.Mode){if(!a.PFSH)return-1;try{a.PFSH.SelectStorage(1)}catch(r){n.log("***** Plugin Free SelectStorage error *****"),n.log("e.code : ",r.code,"e.message : ",r.message,"e.detail : ",r.detail)}try{a.PFSH.LoadAllCerts(document.domain)}catch(g){301E5===g.code?(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain)):(n.log("***** Plugin Free LoadAllCerts error *****"),n.log("e.code : ",g.code,"e.message : ",g.message,"e.detail : ",g.detail))}c=null;try{c=a.PFSH.GetUserCerts(document.domain),a.PFUC=c}catch(k){n.log("***** Plugin Free GetUserCerts error *****"),n.log("e.code : ",k.code,"e.message : ",k.message,"e.detail : ",k.detail)}c&&(h=c.length-1);n.log("***** Plugin Free *****");n.log("user certificate counts : ",h);if(0<h){b=[];for(e=0;e<h;e++){d=e+1;var m={};m.index=d;m.cert=c[d].signcert;b[e]=m}a.certsList={list:b}}else a.certsList=null,f=0}else if(a.CONST.__PF_M_LS.device!==c&&1&a.ESVS.Mode)if(a.plugin().valid)if("GPKI"==a.ESVS.PKI?a.plugin().SetGPKI():a.ESVS.PKI&&"NPKI"!=a.ESVS.PKI&&a.plugin().SetPCA(a.ESVS.PKI),h=a.CONST.__USFB_M_SMARTCARD.device===c?a.plugin().GetAllUserCertListNum(c,b,d):a.plugin().GetAllUserCertListNum(c,b,""),0<h){b=[];for(e=0;e<h;e++)d=e+1,m={},m.index=d,m.cert=a.plugin().GetUserSignCertFromCertList(d),b[e]=m;a.certsList={list:b}}else 0===h?f=0:(h=a.plugin().GetLastErrorCode(),f=a.plugin().GetLastErrorMessage(),n.log("***** GetCerts *****"),n.log("Err Code : ",h,"\nErr Msg : ",f),f=h),a.certsList=null;else return a.uiUtil().msgBox(e.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),-1;return f}function B(c,b){if(!c||!b)return!1;if(!a.certsList||0>m.selectedIndex())return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var e=a.loadUI("certverify")({type:null,args:{idx:parseInt(m.selectedIndex())},onConfirm:function(){e.dispose();c.focus()},onCancel:function(){e.dispose();c.focus()}});e.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function Z(c,b){if(!c||!b)return!1;if(!a.certsList||0>m.selectedIndex())return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var e=a.loadUI("certview")({type:null,args:{type:"Base64",idx:parseInt(m.selectedIndex()),cert:a.certsList.list[parseInt(m.selectedIndex())-1].cert},onConfirm:function(){e.dispose();c.focus()},onCancel:function(){e.dispose();c.focus()}});e.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function Q(c,b,e,d){if(a.CONST.__USFB_M_DISK.device>c||!b||!e||!d)return!1;var h=a.loadUI("driveselect")({type:"DEVICE_REMOVABLE_DISK",args:b,onConfirm:function(b){0<b&&(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k?l("redraw",c,b,d,""):(b=z(c,b,d,""),0!=b?(a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),m.redrawList(null,0)):(b=x())?m.redrawList(b.list,b.list.length):m.redrawList(null,0)));a.ESVS.Embedded?setTimeout(function(){h.dispose()},10):h.dispose();e.focus();a.uiUtil().loadingBox(!1,"us-div-list-load")},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");h.dispose();e.focus()}});h.show();return!0}function R(c,b,e,d){if(a.CONST.__USFB_M_DISK.device>c||!e||!d)return!1;var h=a.loadUI("sectokenselect")({type:c,args:b,onConfirm:function(f){if(0<f){var r=b.list[f-1].name;if(("CERT_RENEWAL"==g.type||"CERT_RENEWAL_SIGN"==g.type||"CERT_RENEWAL_KMCERT"==g.type)&&-1!=r.indexOf("BIO")){a.uiUtil().msgBox(d.IDS_MSGBOX_BLOCK_BIOTOKEN_FORISSUE);return}if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k)l("redraw",c,f,d,"");else if(f=z(c,f,d,""),0!=f){switch(f){case 4812E4:case 4813E4:a.uiUtil().msgBox(d.IDS_MSGBOX_HSM_ERROR_CONNECTION);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,f)}m.redrawList(null,0)}else(f=x())?m.redrawList(f.list,f.list.length):m.redrawList(null,0)}a.ESVS.Embedded?setTimeout(function(){h.dispose()},10):h.dispose();e.focus()},onCancel:function(){h.dispose();e.focus()}});h.show();return!0}function $(c,b,e,d){if(a.CONST.__USFB_M_DISK.device>c||!b||!e||!d)return!1;var h=a.loadUI("driveselect")({type:"DEVICE_SAVE_TOKEN",args:b,onConfirm:function(b){h.dispose();if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k)l("redraw",c,b,d,"");else if(a.plugin().valid){var g=a.plugin().CheckSmartCard();0===g?(PINDialog=a.loadUI("pin")({type:"PIN_SAVE_TOKEN",args:null,onConfirm:function(b){g=a.plugin().CheckPinNumberSCard(b);if(0!=g){switch(g){case 49000004:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 49000005:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN,f)}m.redrawList(null,0)}else{var f=z(c,0,d,b);0!=f?(a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,f),m.redrawList(null,0)):(b=x())?m.redrawList(b.list,b.list.length):m.redrawList(null,0)}a.ESVS.Embedded?setTimeout(function(){PINDialog.dispose()},10):PINDialog.dispose();setTimeout(function(){e.focus()},10)},onCancel:function(){PINDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){e.focus()},10)}}),PINDialog.show()):(a.uiUtil().msgBox(d.IDS_MSGBOX_SMART_CARD_UNCONNECTED),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){e.focus()},10))}else a.uiUtil().msgBox(d.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){e.focus()},10)},onCancel:function(){h.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");e.focus()}});h.show();return!0}function aa(c,b){if(!c||!b)return!1;var e=null;k=a.CONST.__USFB_M_DISK.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);E(b);A();if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_DISK.device,function(d){if(0<d){for(var f=[],h=0;h<d;h++){var g=h+1,r={};r.index=g;r.name=a.nimservice().GetDiskDriveName(g);f[h]=r}e={list:f}}else return-1===d&&(d=a.nimservice().GetLastErrorCode(),f=a.nimservice().GetLastErrorMessage(),n.log("***** GetCertsFromRemovable *****"),n.log("Err Code : ",d,"\nErr Msg : ",f)),a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,!1;Q(a.CONST.__USFB_M_DISK.device,e,c,b)});else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else{if(a.plugin().valid){var d=a.plugin().GetDiskListNum();if(0<d){for(var h=[],f=0;f<d;f++){var g=f+1,t={};t.index=g;t.name=a.plugin().GetDiskDriveName(g);h[f]=t}e={list:h}}else return-1===d&&(d=a.plugin().GetLastErrorCode(),h=a.plugin().GetLastErrorMessage(),n.log("***** GetCertsFromRemovable *****"),n.log("Err Code : ",d,"\nErr Msg : ",h)),a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,!1}else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),!1;Q(a.CONST.__USFB_M_DISK.device,e,c,b)}return!0}function G(c,b){if(!c||!b)return!1;var e=null;k=a.CONST.__USFB_M_HSMKEY.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);ba(b);A();if(1&a.ESVS.Mode)if(a.plugin().valid){var d=[],h=a.plugin().GetHSMInstallListNum();if(0<h)for(var f=0;f<h;f++){var g=f+1,t={},p=a.plugin().GetHSMInstallDriverName(g).split("|");t.index=g;t.name=p[0];t.driver=p[1];t.passage=p[2];t.validity=p[3];d[f]=t}else-1===h&&(h=a.plugin().GetLastErrorCode(),f=a.plugin().GetLastErrorMessage(),n.log("***** GetCertsFromSecToken *****"),n.log("Err Code : ",h,"\nErr Msg : ",f));e={list:d}}else return a.uiUtil().msgBox(b.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),!1;else if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_HSMKEY.device,function(d){if(0<d){for(var f=[],h=0;h<d;h++){var g=h+1,r={},k=a.nimservice().GetSecureTokenName(g).split("|");r.index=g;r.name=k[0];r.driver=k[1];r.passage=k[2];f[h]=r}e={list:f}}else a.nimservice().GetLastErrorCode();R(a.CONST.__USFB_M_HSMKEY.device,e,c,b)});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;4&a.ESVS.Mode||R(a.CONST.__USFB_M_HSMKEY.device,e,c,b);return!0}function P(c,b){if(!c||!b)return!1;var e=null;k=a.CONST.__USFB_M_SMARTCARD.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);E(b);A();if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_SMARTCARD.device,function(d){if(0<d){for(var h=[],f=0;f<d;f++){var g=f+1,k={};k.index=g;k.name=a.nimservice().GetSmartCardName(g);h[f]=k}e={list:h}}else return-1===d&&(d=a.nimservice().GetLastErrorCode(),h=a.nimservice().GetLastErrorMessage(),n.log("***** GetCertsFromSaveToken *****"),n.log("Err Code : ",d,"\nErr Msg : ",h)),a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),!1;$(a.CONST.__USFB_M_SMARTCARD.device,e,c,b)});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),!1;return!0}function S(c,b){if(!c||!b)return!1;k=a.CONST.__USFB_M_MOBILETOKEN.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);E(b);A();if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_MOBILETOKEN.device,function(b){0<b?document.getElementById("us-confirm-btn").click():(a.ERROR.Code=210020,a.ERROR.Message=C.IDS_MSGBOX_NOT_INSTALL_SMARTCERT,confirm(C.IDS_CONFIRMBOX_NOT_INSTALL_SMARTCERT)?(document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.usimEnv.downloadURL,"usim_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.usimEnv.downloadURL,"usim_url","top=100px, left=100px, height=500px, width=380px"))&&a.uiUtil().msgBox(C.IDS_MSGBOX_BLOCK_POPUP_WINDOW)):(m.redrawList(null,-1),document.getElementById("us-div-cert-select").style.display=""))});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function ca(c,b){if(!c||!b)return!1;var e=[function(){S(c,b)},function(){da(c,b)}],d=a.loadUI("mobileselect")({type:null,args:null,onConfirm:function(a){e[a]();d.dispose()},onCancel:function(){d.dispose()}});d.show();return!0}function da(c,b){if(!c||!b)return!1;k=a.CONST.__USFB_M_MOBILE.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);E(b);A();if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_MOBILE.device,function(c){if(0<c)l("redraw",a.CONST.__USFB_M_MOBILE.device,0,b,"");else return a.ERROR.Code=11003,a.ERROR.Message=C.IDS_MSGBOX_NOT_INSTALL_MOBILE,document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"))&&a.uiUtil().msgBox(C.IDS_MSGBOX_BLOCK_POPUP_WINDOW),!1});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function H(c,b){if(!c||!b)return!1;a.uiUtil().MsgBox(b.IDS_MSGBOX_NOT_SUPPORTED_MEDIA);return!0}function E(a){if(!a)return!1;var b=document.getElementById("us-lbl-pw");b.removeChild(b.lastChild);b.appendChild(document.createTextNode(a.IDS_PASSWORD));document.getElementById("us-lbl-pw2").innerHTML=C.IDS_PASSWORD_DESCRIPTION;return!0}function ba(a){if(!a)return!1;var b=document.getElementById("us-lbl-pw");b.removeChild(b.lastChild);b.appendChild(document.createTextNode(a.IDS_PIN));document.getElementById("us-lbl-pw2").innerHTML="";return!0}function T(a){if(null==a||0>=a.length)return!1;var b=document.getElementById("us-pw-text");b.value=a;b.readOnly=!0;return b.disabled=!0}function A(){var a=document.getElementById("us-pw-text");a&&(a.value="",a.readOnly=!1,a.disabled=!1)}function N(c,b,e){function d(){a.certsList&&(a.certsList=null);m.redrawList(null,-1);A();b=""}if(4&a.ESVS.Mode){if(null==e)return!1}else if(null==b||0>=b.length||null==e)return!1;a.certsList&&(a.certsList=null);if(0<c){var h=[],f={},g=null;if(4&a.ESVS.Mode)f.index=c,a.nimservice().GetSelectUserCert(c,function(b,c){if(0==b){f.cert=c;h[0]=f;a.certsList={list:h};if(g=x())return m.redrawList(g.list,g.list.length),!0;d();return!1}d();return!1});else{f.index=c;f.cert=a.plugin().GetUserSignCertFromCertList(c);h[0]=f;a.certsList={list:h};if(g=x())return m.redrawList(g.list,g.list.length),T(b),b="",!0;d();return!1}}else{c=a.plugin().GetLastErrorCode();var k=a.plugin().GetLastErrorMessage();n.log("***** GetCertFromPFX *****");n.log("Err Code : ",c,"\nErr Msg : ",k);switch(c){case 4301E4:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED);break;default:a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c)}d();return!1}}function ea(c,b,e){if(null==c||0>=c.length||null==b||0>=b.length||null==e)return!1;a.plugin().valid?(c=a.plugin().GetPfxCertList(c,b),N(c,b,e)):a.uiUtil().msgBox(e.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD)}function fa(c,b,e){if(null==c||0>=c.length||null==b||0>=b.length||null==e)return!1;var d=!1;if(1&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k)a.plugin().valid?(d=a.plugin().GetPfxCertListString(c,b),d=N(d,b,e)):a.uiUtil().msgBox(e.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD);else a:if(c&&b&&e){var d=0,h={};try{var f=a.PFSH.SetP12OnMemory(c,b),d=f.index;a.PFUC=h=f.aluc}catch(g){n.log("***** Plugin Free SetP12OnMemory error *****");n.log("e.code : ",g.code,"e.message : ",g.message,"e.detail : ",g.detail);switch(g.code){case 1E7:0<=g.detail.indexOf("115010")?a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,g.detail);break;default:a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,g.code)}d=!1;break a}a.certsList&&(a.certsList=null);e=[];c={};f=null;c.index=d;c.cert=h[d].signcert;e[0]=c;a.certsList={list:e};(f=x())?(m.redrawList(f.list,f.list.length),T(b),d=!0):(a.certsList=null,m.redrawList(null,-1),A(),d=!1)}else d=!1;return d}function U(c,b){if(null==c||0>=c.length||null==b)return!1;if(0<c.length&&-1<c.indexOf(".")){var e=c.split("."),e=e[e.length-1].toLowerCase();if("pfx"!=e&&"p12"!=e)return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_NOT_PFX),!1}else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1;return!0}function ga(c){if(null==c)return!1;if(4&a.ESVS.Mode)if(k=a.CONST.__USFB_M_ETC.device,q=0,a.nimservice())a.nimservice().GetCertListWithP12(a.CONST.__USFB_M_ETC.device,0,"","",function(b,d){if(0==b)b=N(1,"",c,function(a){b=a;return 0==b?!0:!1});else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(d,b),!1});else return pw="",a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD),rv;else{var b=document.getElementById("us-file-search-hidden");if("safari"==a.browserName&&6>parseFloat(a.browserVersion))return a.uiUtil().msgBox(c.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_SAFARI),!1;if("opera"==a.browserName||"safari"==a.browserName||"msie"==a.browserName&&8===parseInt(a.browserVersion))b.style.display="block";b.value="";if(""!=b.value){var e=b.onchange,d=b.parentNode;d.removeChild(b);b=document.createElement("input");b.setAttribute("type","file",0);b.setAttribute("accept","application/x-pkcs12",0);b.setAttribute("id","us-file-search-hidden",0);b.className="us-layout-file-search-hidden";b.onchange=e;d.appendChild(b)}b.click();return!0}}function ha(c,b){if(!c||!b)return!1;k=a.CONST.__USFB_M_ETC.device;q=0;var e=null,d=null,h=document.getElementById("us-confirm-btn"),f=document.getElementById("us-cert-search-btn");if("opera"==a.browserName||"safari"==a.browserName)c.style.display="none";if(window.FileReader){var g=c.files;if(0<g.length){var m=g[0];if(!0==U(m.name,b)){var p=new FileReader;p.readAsBinaryString?(p.readAsBinaryString(m),p.addEventListener("load",function(){var c=p.result,e=c.length;if(m.size===e)d=a.usWebToolkit.util.encode64(c,e);else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1})):(p.readAsArrayBuffer(m),p.addEventListener("load",function(){var c=p.result,e=null;try{var f=String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(c)));try{e=decodeURIComponent(escape(f))}catch(h){if(h instanceof URIError)e=f;else throw h;}}catch(g){return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1}c=e.length;if(m.size===c)d=a.usWebToolkit.util.encode64(e,c);else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1}))}else return setTimeout(function(){f.focus()},10),!1}else return setTimeout(function(){f.focus()},10),!1}else{if("msie"==a.browserName&&8===parseInt(a.browserVersion))g=document.getElementById("us-div-cert-select"),g.onselectstart=function(){return!0},c.select(),e=c.value,c.style.display="none",g.onselectstart=function(){return!1};else if("msie"==a.browserName&&9===parseInt(a.browserVersion)){if(e=c.value,-1<e.indexOf("fakepath"))return a.uiUtil().msgBox(b.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_IE9),setTimeout(function(){f.focus()},10),!1}else e=c.value,n.log("file full path : ",e);if(!1==U(e,b))return setTimeout(function(){f.focus()},10),!1}Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(a){var c=!1,c=null!=e?ea(e,a,b):fa(d,a,b);a="";Dialog.dispose();!0===c?setTimeout(function(){h.focus()},10):setTimeout(function(){f.focus()},10)},onCancel:function(){Dialog.dispose();setTimeout(function(){f.focus()},10)}});Dialog.show();return!0}function ia(a){if(!a)return!1;a=a||window.event;13==(a.which||a.keyCode)&&document.getElementById("us-confirm-btn").click();return!0}function w(){g.onConfirm=V;O=!1}function ja(c){function b(b){function f(){W++;W>=a.ESVS.LimitNumOfTimesToTryToInputPW?a.ESVS.Embedded?(h.value="",setTimeout(function(){h.focus()},10)):(a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_BEFORE+a.ESVS.LimitNumOfTimesToTryToInputPW+d.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_AFTER),L()):(h.value="",setTimeout(function(){h.focus()},10))}a.bsUtil().TouchEn_Clear();if(a.CONST.__USFB_M_MOBILETOKEN.device!=k&&(!a.certsList||0>m.selectedIndex()))return a.uiUtil().msgBox(d.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),w(),h.value="",setTimeout(function(){h.focus()},10),!1;if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(k)){if(!a.nimservice())return!1;var p=function(){var f=parseInt(m.selectedIndex());if("DIGITAL_SIGNATURE_P7"===g.type){var l=a.nimservice().GetCert(f);if(!l||0>=l.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),w(),!1;var n=a.certUtil().getTheCertAttributes(l,"Base64");e(d.IDS_MSGBOX_SIGN_ERROR,l,n,f,b,k)}else if("DIGITAL_SIGNATURE_P7_EXT"===g.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==g.type)e(d.IDS_MSGBOX_SIGN_ERROR,f,b,k,q);else if("DIGITAL_SIGNATURE_P7_XML"===g.type){l=a.nimservice().GetCert(f);if(!l||0>=l.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),w(),!1;n=a.certUtil().getTheCertAttributes(l,"Base64");e(d.IDS_MSGBOX_SIGN_ERROR,n,f,b,k,l)}else if("DIGITAL_SIGNATURE_P1"===g.type){l=a.nimservice().GetCert(f);if(!l||0>=l.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),w(),!1;a.usWebToolkit.x509Certificate.parser(l,"Base64");n=a.usWebToolkit.x509Certificate.getSubjectName();if(!n||0>=n.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-2),w(),!1;e(l,n,d.IDS_MSGBOX_SIGN_ERROR,f,b,k)}else if("CERT_RENEWAL"==g.type||"CERT_RENEWAL_KMCERT"==g.type){l=a.certsList.list[f-1].cert;if(!l||0>=l.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-1),w(),!1;a.usWebToolkit.x509Certificate.parser(l,"Base64");var p=a.usWebToolkit.x509Certificate.getNotAfter();if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-2),w(),!1;"CERT_RENEWAL"==g.type?e(p,c.IDS_CONFIRMBOX_CERT_RENEWAL,k,q,f,b):e(p,c.IDS_CONFIRMBOX_KMCERT_ISSUE,k,q,f,b)}else if("CERT_REVOCATION"==g.type)e(d.IDS_CONFIRMBOX_CERT_REVOCATION,f,b,k,q);else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===g.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"==g.type){p={signErr:d.IDS_MSGBOX_SIGN_ERROR,verifySuc:d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:d.IDS_MSGBOX_VID_ERROR_VERIFICATION};l=a.certsList.list[f-1].cert;if(!l||0>=l.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),w(),!1;n=a.certUtil().getTheCertAttributes(l,"Base64");e(f,b,p,l,n,k);h.value=""}else if("DIGITAL_SIGNATURE_P7_FILE"===g.type){l=a.certsList.list[f-1].cert;if(!l||0>=l.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),w(),!1;n=a.certUtil().getTheCertAttributes(l,"Base64");e(f,b,d.IDS_MSGBOX_SIGN_ERROR,d.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,n,k)}else if("ENCRYPT_P7"==g.type)e(f,b,d.IDS_MSGBOX_ENCRYPT_ERROR);else if("VID_VERIFICATION"===g.type)e(f,b,d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,d.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM");else if("CERT_RENEWAL_SIGN"==g.type){l=a.certsList.list[f-1].cert;if(!l||0>=l.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-1),w(),!1;a.usWebToolkit.x509Certificate.parser(l,"Base64");p=a.usWebToolkit.x509Certificate.getNotAfter();if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-2),w(),!1;n=a.certUtil().getTheCertAttributes(l,"Base64");e(p,c.IDS_CONFIRMBOX_CERT_RENEWAL,k,q,f,b,n)}else"CERT_SOE"==g.type?e(d.IDS_CONFIRMBOX_CERT_SOE,f,b,k,q):e()};if(a.CONST.__USFB_M_MOBILETOKEN.device==k){if("DIGITAL_SIGNATURE_P7"===g.type)e(d.IDS_MSGBOX_SIGN_ERROR,null,null,-1,"",k);else if("DIGITAL_SIGNATURE_P1"===g.type)e(null,"",d.IDS_MSGBOX_SIGN_ERROR,-1,"",k);else if("CERT_RENEWAL"==g.type)e("",c.IDS_CONFIRMBOX_CERT_RENEWAL,k,q,-1,"");else if("CERT_RENEWAL_KMCERT"==g.type)e("",c.IDS_CONFIRMBOX_KMCERT_ISSUE,k,q,-1,"");else if("CERT_REVOCATION"==g.type)e(d.IDS_CONFIRMBOX_CERT_REVOCATION,-1,"",k,q);else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===g.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"===g.type){var l={signErr:d.IDS_MSGBOX_SIGN_ERROR,verifySuc:d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:d.IDS_MSGBOX_VID_ERROR_VERIFICATION};e(-1,"",l,null,null,k)}else"DIGITAL_SIGNATURE_P7_FILE"===g.type?e(-1,"",d.IDS_MSGBOX_SIGN_ERROR,d.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,null,k):"ENCRYPT_P7"==g.type?e(-1,b,d.IDS_MSGBOX_ENCRYPT_ERROR):"VID_VERIFICATION"===g.type?e(-1,"",d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,d.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM"):"CERT_RENEWAL_SIGN"==g.type?e("",c.IDS_CONFIRMBOX_CERT_RENEWAL,k,q,-1,"",null):"CERT_SOE"==g.type?e(d.IDS_CONFIRMBOX_CERT_SOE,-1,"",k,q):e();h.value="";a.ESVS.Embedded&&A();return!0}var s=parseInt(m.selectedIndex());if(k==a.CONST.__USFB_M_ETC.device||k==a.CONST.__USFB_M_HSMKEY.device||"CERT_RENEWAL_SIGN"!=g.type&&"DIGITAL_SIGNATURE_P1"!==g.type&&"DIGITAL_SIGNATURE_P7"!==g.type&&"DIGITAL_SIGNATURE_P7_EXT"!=g.type&&"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"!=g.type&&"DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"!==g.type&&"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"!==g.type&&"VID_VERIFICATION"!==g.type)return p(),h.value="",a.ESVS.Embedded&&A(),!0;if(!b)return a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){h.focus()},10),w(),!1;l=a.usWebToolkit.util.encode64("1234");a.nimservice().CheckPassword(s,b,l,function(b,c,e,g){if(0==b)return p(),h.value="",a.ESVS.Embedded&&A(),!0;w();"Enabled"===a.ESVS.UniCRS?a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED_URS):a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED);f();a.uiUtil().loadingBox(!1,"us-div-list-load")})}else if(2&a.ESVS.Mode&&a.uiUtil().isItPFDevice(k)){if(!b)return a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){h.focus()},10),w(),!1;if(k==a.CONST.__PF_M_CLOUDSIGN.device)u=!0;else{if(!a.PFUC)return!1;s=parseInt(m.selectedIndex());l=null;try{l=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[s].signpri)}catch(J){n.log("***** encryptedPrivateKeyFromBase64 error *****"),n.log("Err Code : ",J.code,"\nErr Msg : ",J.message)}var u=!1;try{u=a.usWebToolkit.pkcs8.checkUserCertPassword(l,b)}catch(v){n.log("***** CheckUserCertPassword error *****"),n.log("Err Code : ",v.code,"\nErr Msg : ",v.message)}finally{l=""}}if(!1===u)a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED),f();else{u=null;k==a.CONST.__PF_M_CLOUDSIGN.device?(s=parseInt(m.selectedIndex()),u=a.certsList.list[s-1].cert):u=a.PFUC[s].signcert;if("DIGITAL_SIGNATURE_P7"===g.type){if(!u||0>=u.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),w(),!1;var x=a.certUtil().getTheCertAttributes(u,"Base64");e(d.IDS_MSGBOX_SIGN_ERROR,u,x,s,b,k,M)}else if("DIGITAL_SIGNATURE_P1"===g.type){if(!u||0>=u.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),w(),!1;x=a.certUtil().getTheCertAttributes(u,"Base64");e(u,x.subjectName,d.IDS_MSGBOX_SIGN_ERROR,s,b,k,M)}else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"==g.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"==g.type){l={signErr:d.IDS_MSGBOX_SIGN_ERROR,verifySuc:d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:d.IDS_MSGBOX_VID_ERROR_VERIFICATION};if(!u||0>=u.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),w(),!1;x=a.certUtil().getTheCertAttributes(u,"Base64");e(s,b,l,u,x,k)}else if("CERT_RENEWAL"==g.type||"CERT_RENEWAL_KMCERT"==g.type){if(!u||0>=u.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-1),w(),!1;a.usWebToolkit.x509Certificate.parser(u,"Base64");l=a.usWebToolkit.x509Certificate.getNotAfter();if(!l||0>=l.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-2),w(),!1;"CERT_RENEWAL"==g.type?e(l,d.IDS_CONFIRMBOX_CERT_RENEWAL,k,q,s,b):e(l,c.IDS_CONFIRMBOX_KMCERT_ISSUE,k,q,s,b)}else"CERT_REVOCATION"===g.type?e(d.IDS_CONFIRMBOX_CERT_REVOCATION,s,b,k,q):"VID_VERIFICATION"===g.type?e(s,b,d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,d.IDS_MSGBOX_VID_ERROR_VERIFICATION,"PFS"):e();h.value="";a.ESVS.Embedded&&A();return!0}}return!1}m.restoreOnMouseEvent();if(!c)return!1;var e=g.onConfirm;if(!1==O)V=g.onConfirm,O=!0;else return!1;g.onConfirm=function(){};var d=c,h=document.getElementById("us-pw-text"),f=h.value;"touchen"==a.ESVS.SecureKeyboardType&&a.bsUtil().isTouchEnKeyUsable()?4&a.ESVS.Mode&&("CERT_RENEWAL"==g.type||"CERT_REVOCATION"==g.type||"CERT_SOE"==g.type||"CERT_RENEWAL_KMCERT"==g.type)?b(f):a.bsUtil().GetEncryptPwd("us-keyboard-secure-frm","us-pw-text",function(a){b(a)}):("ahnlab"==a.ESVS.SecureKeyboardType&&a.bsUtil().isAhnlabProtectorUsable()&&(4&a.ESVS.Mode&&("CERT_RENEWAL"==g.type||"CERT_REVOCATION"==g.type||"CERT_SOE"==g.type||"CERT_RENEWAL_KMCERT"==g.type)||(f=a.bsUtil().GetAhnlabEncInputInfo("us-pw-text"))),b(f))}function D(c){if(!c)return!1;I(c,C,"close");for(var b=a.ESVS.Media.list.split("|"),e=0;e<b.length;e++){var d=a.CONST.medias[b[e]];void 0!=d&&null!=d&&(d=document.getElementById("us-btn-"+d.name),void 0!=d&&null!=d&&"us-layout-storage-btn-none"!=d.className&&(d.className=c===d?"us-layout-storage-btn-on":"us-layout-storage-btn-off"))}return!0}function ka(c){if(null==c||void 0==c)return!1;var b=!a.uiUtil().isItSupportingThisStorage(c);!1==b&&null!=a.ESVS.Media&&null!=a.ESVS.Media.list&&0>a.ESVS.Media.list.indexOf(c.name)&&(b=!0);if(b)return!1;var b=document.getElementById("us-storage-btn-list"),e=document.createElement("li");e.setAttribute("id","us-storage-btn-li-"+c.name,0);e.setAttribute("mediaIndex",c.mediaIndex,0);7==c.mediaIndex&&(e.className="line-first");"hidden"===c.visibility?(e.style.display="none",e.style.visibility="hidden"):(e.style.display="block",e.style.visibility="visible");var d=document.createElement("button");d.setAttribute("type","button",0);d.setAttribute("id","us-btn-"+c.name,0);d.setAttribute("tabindex",c.tabIndex,0);c.disabled?(d.onclick=function(){a.uiUtil().msgBox(C.IDS_MSGBOX_NOT_SUPPORTED_MEDIA)},d.className="us-layout-storage-btn-none"):(d.onclick=c.onclick,d.className=c.device===k?"us-layout-storage-btn-on":"us-layout-storage-btn-off");e.appendChild(d);if("harddisk"!==c.name&&"webstorage"!==c.name){var h=document.createElement("span");h.className="us-drive-select";d.appendChild(h)}h=document.createElement("span");h.className="us-img-storage";var f=document.createElement("img");f.setAttribute("id","us-img-"+c.name,0);c.disabled?f.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+"_d.png",0):f.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+".png",0);h.appendChild(f);d.appendChild(h);h=document.createElement("span");h.setAttribute("id","us-lbl-"+c.name,0);h.className="us-layout-lbl-storage";h.appendChild(document.createTextNode(c.label));d.appendChild(h);e.appendChild(d);b.appendChild(e);return!0}function I(c,b,e){if("no_more"==e)a.uiUtil().msgBox(b.IDS_MSGBOX_NOT_MORE_MEDIA);else{if(c=document.getElementById("us-storage-wrap"))"open"==e?(c.className="us-layout-storage-more-wrap",c=document.getElementById("us-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN+b.IDS_BUTTON,0),c.onclick=function(){I(this,b,"close")},c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_close.png",0)):(c.className="us-layout-storage-wrap",c=document.getElementById("us-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.onclick=function(){I(this,b,"open")},c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));c=a.ESVS.Media.list.split("|");for(var d=0;d<c.length;d++){var h=a.CONST.medias[c[d]];if(void 0!=h&&null!=h){var f=document.getElementById("us-storage-btn-li-"+h.name);if(void 0!=f&&null!=f){var g=f.getAttribute("mediaIndex");"open"==e?(f.style.display="block",f.style.visibility="visible"):6<g?(f.style.display="none",f.style.visibility="hidden"):(f.style.display="block",f.style.visibility="visible");1==g&&document.getElementById("us-btn-"+h.name)}}}}return!0}function L(){m.restoreOnMouseEvent();g.onCancel()}var la=function(){var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+(a.ESVS.Embedded?"unisignweb/rsrc/layout/certselect_embedded.html?version="+a.ver:"unisignweb/rsrc/layout/certselect.html?version="+a.ver),!1);c.send(null);return c.responseText},X=function(){var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/certselect_"+a.ESVS.Language+".js?version="+a.ver,!1);c.send(null);return c.responseText},C=eval(eval(X)()),Y=null,m=null,W=0,v=a.ESVS.TabIndex,K=0,k=a.CONST.__USFB_M_HDD.device,q=0,M=null;if(null!=a.ESVS.Media&&null!=a.ESVS.Media.defaultdevice){if(k=a.uiUtil().getMediaDevice(a.ESVS.Media.defaultdevice),k==a.CONST.__USFB_M_SMARTCARD.device||k==a.CONST.__USFB_M_DISK.device)q=1}else 2==a.ESVS.Mode&&(k=a.CONST.__PF_M_LS.device);var n=window.console||{log:function(){}},O=!1,V=null;return function(){var c=eval(la),b=eval(eval(X)());a.ESVS.TargetObj.innerHTML=c();g.args.device&&a.uiUtil().isValidDevice(g.args.device)&&(k=g.args.device,q=g.args.drive);c=document.getElementById("us-lbl-title");if(a.ESVS.Embedded)e=document.getElementById("us-lbl-title"),e.appendChild(document.createTextNode(b.IDS_CERT_SELECTION+" "+b.IDS_CERT_SELECTION_PURPOSE_SIGN)),e.setAttribute("tabindex",v++,0),e=document.getElementById("us-cursor-disabled"),e.setAttribute("tabindex",v++,0);else{c.appendChild(document.createTextNode(b.IDS_CERT_SELECTION));c.setAttribute("title",b.IDS_SENSE_READER_INTRO,0);c.setAttribute("tabindex",v++,0);e=document.getElementById("us-cls-img-btn");e.setAttribute("title",b.IDS_CLOSE_CERT_SELECTION_CLOSE,0);e.onclick=function(){L()};document.getElementById("us-cls-btn-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_close_btn.png",0);e=document.getElementById("us-cursor-disabled");e=document.getElementById("us-logo-img");e.setAttribute("alt",b.IDS_LOGO,0);null!=a.options.logo?e.setAttribute("src",a.options.logo,0):e.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/main_cert_logo.png",0);var e=document.getElementById("us-legend-storage");e.appendChild(document.createTextNode(b.IDS_STORAGE_SELECT))}e=0;if(a.ESVS.Media.list!=a.CONST.__PF_M_CLOUDSIGN.name){for(var d=a.ESVS.Media.list.split("|"),h=0;h<d.length;h++){var f=a.CONST.medias[d[h]];if(void 0!=f&&null!=f){switch(f.device){case a.CONST.__USFB_M_DISK.device:f.label=b.IDS_STORAGE_REMOVABLE;f.disabled=2==a.ESVS.Mode;f.onclick=function(){aa(this,b);D(this)};break;case a.CONST.__USFB_M_HSMKEY.device:f.label=b.IDS_STORAGE_SECTOKEN;f.disabled=!("win"==a.osName&&2!=a.ESVS.Mode);f.onclick=function(){G(this,b);D(this)};break;case a.CONST.__USFB_M_SMARTCARD.device:f.label=b.IDS_STORAGE_SAVETOKEN;f.disabled=!("win"==a.osName&&2!=a.ESVS.Mode);f.onclick=function(){P(this,b);D(this)};break;case a.CONST.__USFB_M_MOBILE.device:f.label=b.IDS_STORAGE_MOBILEPHONE;f.disabled=2==a.ESVS.Mode;f.onclick=function(){ca(this,b);D(this)};break;case a.CONST.__USFB_M_HDD.device:f.label=b.IDS_STORAGE_HARDDISK;f.disabled=2==a.ESVS.Mode;f.onclick=function(){if(this&&b)if(k=a.CONST.__USFB_M_HDD.device,q=0,a.certsList&&(a.certsList=null),m.redrawList(null,-1),E(b),A(),4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k)l("redraw",a.CONST.__USFB_M_HDD.device,0,b,"");else{var c=z(a.CONST.__USFB_M_HDD.device,0,b,"");0!=c?(a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),m.redrawList(null,0)):(c=x())?m.redrawList(c.list,c.list.length):m.redrawList(null,0)}D(this)};break;case a.CONST.__USFB_M_MOBILETOKEN.device:f.label=b.IDS_STORAGE_MOBILETOKEN;f.disabled=2==a.ESVS.Mode;f.onclick=function(){document.getElementById("us-div-cert-select").style.display="none";S(this,b);D(this)};break;case a.CONST.__PF_M_SS.device:f.label=b.IDS_STORAGE_SS;f.disabled=1==a.ESVS.Mode;f.onclick=function(){this&&b&&(k=a.CONST.__PF_M_SS.device,q=0,a.certsList&&(a.certsList=null),m.redrawList(null,-1),E(b),A(),l("redraw",a.CONST.__PF_M_SS.device,0,b,""));D(this)};break;case a.CONST.__PF_M_LS.device:f.label=b.IDS_STORAGE_LS;f.disabled=1==a.ESVS.Mode;f.onclick=function(){if(this&&b){k=a.CONST.__PF_M_LS.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);E(b);A();var c=z(a.CONST.__PF_M_LS.device,0,b,"");0!=c?(a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),m.redrawList(null,0)):(c=x())?m.redrawList(c.list,c.list.length):m.redrawList(null,0)}D(this)};break;case a.CONST.__PF_M_TOUCHSIGN.device:f.label=b.IDS_STORAGE_TOUCHSIGN;f.disabled=!0;f.onclick=function(){H(this,b)};break;case a.CONST.__PF_M_SMARTSIGN.device:f.label=b.IDS_STORAGE_SMARTSIGN;f.disabled=!0;f.onclick=function(){H(this,b)};break;case a.CONST.__PF_M_WEBSECTOKEN.device:f.label=b.IDS_STORAGE_WEBSECTOKEN;f.disabled=!0;f.onclick=function(){H(this,b)};break;case a.CONST.__PF_M_WEBSOFTTOKEN.device:f.label=b.IDS_STORAGE_WEBSOFTTOKEN;f.disabled=!0;f.onclick=function(){H(this,b)};break;case a.CONST.__PF_M_CLOUDSIGN.device:f.label=b.IDS_STORAGE_CLOUDSIGN;f.disabled=1==a.ESVS.Mode;f.onclick=function(){this&&b&&(k=a.CONST.__PF_M_CLOUDSIGN.device,q=0,a.certsList&&(a.certsList=null),m.redrawList(null,-1),E(b),A(),l("redraw",a.CONST.__PF_M_CLOUDSIGN.device,0,b,""));D(this)};break;default:f.label=b.IDS_STORAGE_ETC,f.disabled=!0,f.onclick=function(){H(this,b)}}f.tabIndex=v;f.mediaIndex=e+1;f.visibility=6<f.mediaIndex?"hidden":"visible";ka(f)&&(v++,e++)}}d=document.getElementById("us-storage-more-btn");null!=d&&void 0!=d&&(d.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),6<e?(d.style.display="block",d.style.visibility="visible",d.setAttribute("tabindex",v++,0),d.onclick=function(){I(this,b,"open")}):(d.setAttribute("disabled","disabled",0),d.style.display="none",d.style.visibility="hidden",d.onclick=function(){I(this,b,"no_more")}),e=document.getElementById("us-storage-more-btn-img"),e.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW,0),e.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0))}e=document.getElementById("us-tbl-list-caption");e.setAttribute("tabindex",v++,0);e.appendChild(document.createTextNode(b.IDS_CERT_LIST_CAPTION));document.getElementById("us-tbl-list").setAttribute("title",b.IDS_CERT_LIST_CAPTION);a.ESVS.Mode&2&&a.uiUtil().loadingBox(!0,"us-div-list-load",0);var n=[{title:b.IDS_CERT_STATUS},{title:b.IDS_CERT_CLASSIFY},{title:b.IDS_CERT_USER},{title:b.IDS_CERT_ISSUER},{title:b.IDS_CERT_EXPIRATION_DAY}];K=v++;setTimeout(function(){if(n&&b){Y=a.loadUI("gridlist");m=Y({type:"certslist",tblid:"us-tbl-list",tbltitleid:"us-tbl-list-th",titlelistid:"us-grid-head-div",titlerowid:"us-list-title-row",titleelementid:"us-list-title-element",titledividerid:"us-list-title-divider",titlelistcn:"us-layout-grid-head-div",titlerowcn:"us-layout-grid-head-row",titleelementcn:"us-layout-grid-row-title-element",titledividercn:"us-layout-grid-row-title-divider",tblbodyid:"us-tbl-list-td",datalistid:"us-grid-body-div",datarowid:"us-list-body-row",dataelementid:"us-list-data-element",datalistcn:"us-layout-grid-body-div",datarowcn:"us-layout-grid-body-row",dataelementcn:"us-layout-grid-row us-layout-grid-row-data-element",dataselectcn:"us-layout-grid-row us-layout-grid-row-data-selected-element",textObj:b});var c=!0;"opera"==a.browserName&&(c=!1);m.drawList(n,n.length,null,0,K,c);4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k?l("redraw",k,q,b,"",n,c):a.CONST.__PF_M_CLOUDSIGN.device==k?l("redraw",k,q,b,"",n,c):(c=z(k,0,b,""),0!=c?a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c):(c=x())?m.redrawList(c.list,c.list.length):m.redrawList(null,0))}},100);e=document.getElementById("us-lbl-pw");e.appendChild(document.createTextNode(b.IDS_PASSWORD));d=document.getElementById("us-lbl-pw2");d.innerHTML=b.IDS_PASSWORD_DESCRIPTION;document.getElementById("us-file-search-hidden").onchange=function(){ha(this,b)};h=document.getElementById("us-cert-search-btn");h.setAttribute("value",b.IDS_CERT_SEARCH,0);h.onclick=function(){ga(b)};"Enabled"===a.ESVS.UniCRS&&4&a.ESVS.Mode&&(h.readOnly=!0,h.disabled=!0);a.uiUtil().addCapsLockEvent("us-pw-text","us-err-msg-capslock",b.IDS_MSGBOX_CAPSLOCK_ON,ia);f=document.getElementById("us-pw-text");f.value="";f.setAttribute("title",b.IDS_PASSWORD_LABEL+b.IDS_PASSWORD_DESCRIPTION);var t=document.getElementById("us-pw-text-lbl");t&&t.appendChild(document.createTextNode(b.IDS_PASSWORD_LABEL+b.IDS_PASSWORD_DESCRIPTION));a.ESVS.Embedded||(4&a.ESVS.Mode&&("CERT_RENEWAL"==g.type||"CERT_REVOCATION"==g.type||"CERT_SOE"==g.type||"CERT_RENEWAL_KMCERT"==g.type)?(document.getElementById("us-div-cert").style.display="none",document.getElementById("disabledpw").innerHTML='<input id="us-confirm-btn" class="us-normal-btn btn-confirm h35" type="button" />'):document.getElementById("enabledpw").innerHTML='<input id="us-confirm-btn" class="us-normal-btn btn-confirm h35" type="button" />');t=document.getElementById("us-confirm-btn");t.setAttribute("value",b.IDS_CONFIRM,0);t.onclick=function(){ja(b)};var p=document.getElementById("us-cert-verify-btn");p&&(p.setAttribute("value",b.IDS_CERT_VERIFY,0),p.onclick=function(){B(this,b)});var w=document.getElementById("us-cert-view-btn");w.setAttribute("value",b.IDS_CERT_VIEW,0);w.onclick=function(){Z(this,b)};var s=document.getElementById("us-cert-proposal-btn");s.setAttribute("value",b.IDS_CERT_PROPOSAL,0);s.setAttribute("title",b.IDS_SENSE_READER_BLANK_LINK,0);s.onclick=function(){this&&("firefox"==a.browserName?window.open("https://raadmin.crosscert.com/customer/tk/Main.jsp?","crosscert_url","scrollbars=1"):window.open("https://raadmin.crosscert.com/customer/tk/Main.jsp?"),this.focus())};0==a.ESVS.CertRequestPageEnable&&(s.readOnly=!0,s.disabled=!0);a.ESVS.Embedded?(f.setAttribute("tabindex",v++,0),t.setAttribute("tabindex",v++,0),h.setAttribute("tabindex",v++,0),s.setAttribute("tabindex",v++,0),w.setAttribute("tabindex",v++,0),p&&p.setAttribute("tabindex",v++,0)):(f.setAttribute("tabindex",v++,0),"none"!=document.getElementById("us-div-cert").style.display&&t.setAttribute("tabindex",v++,0),h.setAttribute("tabindex",v++,0),s.setAttribute("tabindex",v++,0),w.setAttribute("tabindex",v++,0),p&&p.setAttribute("tabindex",v++,0),"none"==document.getElementById("us-div-cert").style.display&&t.setAttribute("tabindex",v++,0),h=document.getElementById("us-cls-btn"),h.setAttribute("value",b.IDS_CLOSE,0),h.setAttribute("title",b.IDS_CLOSE+b.IDS_BUTTON,0),h.setAttribute("tabindex",v++,0),h.onclick=function(){L()},a.uiUtil().setRotationTabFocus(h,p,c),a.uiUtil().setRotationTabFocus(c,h,document.getElementById("us-btn-mobiletoken")),document.getElementById("us-lbl-notice").appendChild(document.createTextNode(b.IDS_NOTICE)));null!=a.options.popup&&(document.getElementById("us-div-cert-select").className=document.getElementById("us-div-cert-select").className+" popup");if(a.ESVS.Media.list==a.CONST.__PF_M_CLOUDSIGN.name){k=a.CONST.__PF_M_CLOUDSIGN.device;(h=document.getElementById("us-div-storage"))&&h.parentElement.removeChild(h);f=["us-cert-search-btn","us-cert-proposal-btn","us-cert-view-btn","us-cert-verify-btn"];for(h=0;h<f.length;h++)t=document.getElementById(f[h]),t.style.display="none",t.style.visibility="hidden";document.getElementById("us-lbl-notice").style["text-align"]="center";h=document.getElementById("us-ul-bottom-btns");h=h.children[h.children.length-1];t=document.getElementById("enabledpw");t.children[0].style.width="80px";h.parentElement.removeChild(h);t.parentElement.appendChild(h);h.style["margin-top"]="35px";h.style["margin-left"]="4px";h.children[0].style.height="36px";h.children[0].style.width="80px";document.getElementById("us-pw-text").style.width="363px";c.insertBefore(document.createTextNode(b.IDS_STORAGE_CLOUDSIGN+" "),c.firstChild);e.removeChild(e.firstChild);e.appendChild(document.createTextNode(b.IDS_PIN));d.innerHTML=b.IDS_PIN_DESCRIPTION}return document.getElementById("us-div-cert-select")}()};return function(g){function x(){function g(){0<l.value.length?l.value="":(5>x&&setTimeout(g,10),x++)}var l=document.getElementById("us-pw-text"),x=0;g();a.uiUtil().setFirstFocus("us-lbl-title");if(a.ESVS.Media.list!=a.CONST.__PF_M_CLOUDSIGN.name)for(var z=a.ESVS.Media.list.split("|"),B=0;B<z.length;B++){var G=a.CONST.medias[z[B]];if(void 0!=G&&null!=G&&"us-layout-storage-btn-on"==document.getElementById("us-btn-"+G.name).className){a.bsUtil().SetSecurityStatus("us-pw-text");a.bsUtil().SetReScan("us-keyboard-secure-frm","us-pw-text");break}}}var l=P({type:g.type,args:g.args,onConfirm:g.onConfirm,onCancel:g.onCancel});if(!a.ESVS.Embedded&&(null==a.options.popup||-1<a.options.popup.indexOf("overlay=true"))){g=a.uiLayerLevel;var z=a.uiUtil().getOverlay(g);l.style.zIndex=g+1;document.body.insertBefore(z,document.body.firstChild)}var B=window.onresize;return{show:function(){a.ESVS.Embedded?(l.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(l,"width","width")))/2+"px",l.style.display="block"):null==a.options.popup?(draggable(l,document.getElementById("us-div-title")),z.style.display="block",a.uiUtil().offsetResize(l)):(-1<a.options.popup.indexOf("move=true")?draggable(l,document.getElementById("us-div-title")):document.getElementById("us-div-title").style.cursor="default",-1<a.options.popup.indexOf("overlay=true")&&(z.style.display="block"),a.uiUtil().offsetResize(l,a.options.popup));window.onresize=a.ESVS.Embedded?function(){l&&(l.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(l,"width","width")))/2+"px");B&&B()}:function(){l&&a.uiUtil().offsetResize(l,a.options.popup);B&&B()};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;a.bsUtil().ahnlabInit();setTimeout(function(){x()},10)},hide:function(){a.ESVS.Embedded||(z.style.display="none",l.style.display="none")},dispose:function(){window.onresize=function(){B&&B()};if(!a.ESVS.Embedded&&(null==a.options.popup||-1<a.options.popup.indexOf("overlay=true"))){var g=l.parentNode;g&&g.removeChild(l);z.parentNode&&z.parentNode.removeChild(z);a.uiLayerLevel-=10;a.ESVS.TabIndex-=30}}}}};