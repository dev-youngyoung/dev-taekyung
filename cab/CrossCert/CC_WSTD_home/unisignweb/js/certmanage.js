var __certmanage=function(a){var T=function(q){function t(){if(!a.certsList)return null;for(var b=null,b=a.certsList,c=b.list.length,d=[],f=0;f<c;f++){a.usWebToolkit.x509Certificate.parser(b.list[f].cert,"Base64");var e=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),l=a.usWebToolkit.x509Certificate.getSubjectName(),g=a.usWebToolkit.x509Certificate.getNotAfter(),n=a.usWebToolkit.x509Certificate.getNotAfter(),p=b.list[f].index,h=a.certUtil().getIssuerName(e);"undefined"==h&&(h=a.certUtil().getO(l));var k=[""];k[1]=a.certUtil().getCertType(e);k[2]=a.certUtil().getCN(l);k[3]=h;k[4]=a.certUtil().getLocalDate(g);k[5]=p;k[6]=a.certUtil().getExpirationStateValue(n);d.push(k)}return b={list:d}}function s(b,c,d,f,e,l,g){function h(){var a=t();"draw"==b?a?k.drawList(l,l.length,a.list,a.list.length,L,g):k.drawList(l,l.length,null,0,L,g):"redraw"==b&&(a?k.redrawList(a.list,a.list.length):k.redrawList(null,0))}if(a.CONST.__USFB_M_DISK.device>c||0>d||!f)return-1;var p=0;m=d;a.certsList&&(a.certsList=null);if(c==a.CONST.__PF_M_SS.device&&a.CCPFSH())a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.PKI,function(b,c){0==b&&a.CCPFSH().GetCertificateList(function(b,c){if(0==b){var d=0;(a.PFUC=c)&&(d=c.length-1);if(0<d){for(var e=[],g=0;g<d;g++){var f=g+1,l={};l.index=f;l.cert=c[f].signcert;e[g]=l}a.certsList={list:e}}(d=t())?k.redrawList(d.list,d.list.length):k.redrawList(null,0);return!0}return!1})});else if(c==a.CONST.__PF_M_CLOUDSIGN.device){if(q.CS_phoneNumber)z(q.CS_phoneNumber);else{var r=a.loadUI("phoneNumber"),u=r({type:"phoneNumber",args:null,onConfirm:function(a){__PhoneNumber=a;z(a);u.dispose()},onCancel:function(){u.dispose()}});u.show()}var z=function(b){a.uiUtil().loadingBox(!0,"us-div-list-load",0);reqMemberInfo(b,function(c,d,e){if(0!=c)return a.uiUtil().loadingBox(!1,"us-div-list-load",0),alert(d+"\n\nError Code [ "+c+" ]"),!1;c=parseInt(e.split("|")[0]);if(0<c)y(b);else{if(-1==c){a.uiUtil().loadingBox(!1,"us-div-list-load",0);var g=r({type:"double",args:null,onCancel:function(){g.dispose()}})}else a.uiUtil().loadingBox(!1,"us-div-list-load",0),g=r({type:"joinus",args:{flag:parseInt(e.split("|")[1].split("=")[1]),pNumber:b},onCancel:function(){g.dispose()}});g.show()}})},y=function(b){reqGetCert(b,function(b,c,d){if(0!=b)return a.uiUtil().loadingBox(!1,"us-div-list-load",0),a.uiUtil().errMsgBox(c,b),!1;if(0<d.length){b=[];for(c=0;c<d.length;c++){var e={};e.index=c+1;e.cert=d[c];b[c]=e}a.certsList={list:b}}(d=t())?k.redrawList(d.list,d.list.length):k.redrawList(null,0);a.uiUtil().loadingBox(!1,"us-div-list-load",0);return!0})}}else 4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(c)&&(a.nimservice()?a.nimservice().GetAllMediaList(0,function(b,e){0==b?a.nimservice().GetAllUserCertListNum(c,d,"",a.ESVS.Policy,function(b,d){p=d;if(0==b)0<p?a.nimservice().GetAllUserCert(d,function(b,c){0==b?a.certsList={list:c}:a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),b);h()}):(h(),a.uiUtil().loadingBox(!1,"us-div-list-load"));else{if(c==a.CONST.__USFB_M_MOBILE.device&&(11003==b||11004==b))return a.ERROR.Code=11003,a.ERROR.Message=B.IDS_MSGBOX_NOT_INSTALL_MOBILE,confirm(B.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)?(document.getElementById("us-cert-manage-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"))&&a.uiUtil().msgBox(B.IDS_MSGBOX_BLOCK_POPUP_WINDOW)):a.uiUtil().loadingBox(!1,"us-div-list-load"),!1;if(-1===p)b=-1;else{var e=a.nimservice().GetLastErrorCode(),g=a.nimservice().GetLastErrorMessage();a.uiUtil().errMsgBox(g,b);b=e}h();done=1;a.uiUtil().loadingBox(!1,"us-div-list-load")}}):(b=-1,h(),done=1,a.uiUtil().loadingBox(!1,"us-div-list-load"))}):a.uiUtil().msgBox(__text.IDS_MSGBOX_NIM_ERROR_UNLOAD))}function v(b,c,d,f){if(a.CONST.__USFB_M_DISK.device>b||0>c||!d)return-1;f=d=0;m=c;a.certsList&&(a.certsList=null);if(a.CONST.__PF_M_LS.device===b){if(!a.PFSH)return-1;try{a.PFSH.SelectStorage(1)}catch(e){}try{a.PFSH.LoadAllCerts(document.domain)}catch(l){301E5===l.code&&(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain))}b=null;try{b=a.PFSH.GetUserCerts(document.domain),a.PFUC=b}catch(g){a.uiUtil().errMsgBox(g.message,g.code)}null!=b&&void 0!=b&&void 0!=b.length&&(d=b.length-1);if(0<d){c=[];for(var h=0;h<d;h++){var p=h+1,k={};k.index=p;k.cert=b[p].signcert;c[h]=k}a.certsList={list:c}}else a.certsList=null,f=0}return f}function H(b,c){if(!b||!c)return!1;if(!a.certsList)return a.uiUtil().msgBox(c.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var d=a.loadUI("certview")({type:null,args:{type:"Base64",idx:parseInt(k.selectedIndex()),cert:a.certsList.list[parseInt(k.selectedIndex())-1].cert},onConfirm:function(){d.dispose();b.focus()},onCancel:function(){d.dispose();b.focus()}});d.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function U(b,c,d){if(!b||!c)return!1;if(!a.certsList)return a.uiUtil().msgBox(c.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;a.nimservice().GetAllMediaList(0,function(f,e){1==h||5==h?a.nimservice().GetAllUserCertListNum(h,m,"",a.ESVS.Policy,function(){a.uiUtil().loadingBox(!0,"us-div-list-load",5);Dialog=a.loadUI("storageselect")({type:"CERT_COPY",args:{sourceDevice:h,sourceDrive:m},onConfirm:function(b,e){Dialog.dispose();if(a.nimservice())a.nimservice().CopyCert(h,m,b,e,k.selectedIndex(),!1,function(b,e){0==b?(a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_COPY_SUCCESS),d&&d(0)):a.uiUtil().errMsgBox(e,b);a.uiUtil().loadingBox(!1,"us-div-list-load")});else return a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),!1},onCancel:function(){Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");b.focus()}});Dialog.show()}):(a.uiUtil().loadingBox(!0,"us-div-list-load",5),Dialog=a.loadUI("storageselect")({type:"CERT_COPY",args:{sourceDevice:h,sourceDrive:m},onConfirm:function(b,e){Dialog.dispose();if(a.nimservice())a.nimservice().CopyCert(h,m,b,e,k.selectedIndex(),!1,function(b,e){0==b?(a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_COPY_SUCCESS),d&&d(0)):a.uiUtil().errMsgBox(e,b);a.uiUtil().loadingBox(!1,"us-div-list-load")});else return a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),!1},onCancel:function(){Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");b.focus()}}),Dialog.show())});return!0}function V(b,c,d){if(!b||!c)return!1;if(!a.certsList)return a.uiUtil().msgBox(c.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;4<=a.ESVS.Mode?a.nimservice()?a.nimservice().ChangePassword(h,m,parseInt(k.selectedIndex()),function(b,e){0==b?(s("redraw",h,m,c,""),a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_SUCCESS),d&&d(0)):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(e,b))}):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD)):(Dialog=a.loadUI("changepassword")({type:null,args:null,onConfirm:function(f,e){if(null==f||0>=f.length||null==e||0>=e.length)return a.uiUtil().msgBox(c.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),!1;var l=parseInt(k.selectedIndex());if(1>l)return a.uiUtil().msgBox(c.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;if(a.CONST.__PF_M_LS.device===h||a.CONST.__PF_M_SS.device===h)try{var g=a.PFUC[l],n,p;n=p=null;var r=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(g.signpri),u=a.usWebToolkit.pkcs8.checkUserCertPassword(r,f);if(!1===u){var r=null,z={code:-1,message:c.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD};throw z;}n=a.usWebToolkit.pkcs8.changePassword(r,f,e,"Base64");r=null;if("undefined"!==typeof g.kmcert){r=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(g.kmpri);u=a.usWebToolkit.pkcs8.checkUserCertPassword(r,f);if(!1===u)throw r=null,z={code:-1,message:c.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD},z;p=a.usWebToolkit.pkcs8.changePassword(r,f,e,"Base64")}r=null;try{var y={};y.signcert=g.signcert;y.signpri=n;null!==p&&(y.kmcert=g.kmcert,y.kmpri=p);if(a.CONST.__PF_M_LS.device===h){a.PFSH.SaveUserCert(g.ca,y,document.domain,!1);g=y=null;v(h,m,c,"");var P=t();P?k.redrawList(P.list,P.list.length):k.redrawList(null,0);a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_SUCCESS);d&&d(0)}else a.CCPFSH().SaveUserCert(g.ca,y,!1,function(b){0==b?(g=y=null,s("redraw",h,m,c,""),(b=t())?k.redrawList(b.list,b.list.length):k.redrawList(null,0),a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_SUCCESS),d&&d(0)):a.uiUtil().errMsgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,b)})}catch(M){switch(M.code){case 1E7:0<=M.detail.indexOf("115010")?a.uiUtil().msgBox(c.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,M.detail);break;default:a.uiUtil().errMsgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,M.code);break}}finally{}}catch(q){a.uiUtil().errMsgBox(q.message,q.code)}finally{}f=e="";Dialog.dispose();setTimeout(function(){b.focus()},10)},onCancel:function(){Dialog.dispose();setTimeout(function(){b.focus()},10)}}),Dialog.show());return!0}function W(b,c,d){function f(b,c){if(1>b)return c.dispose(),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){e.focus()},10),!1;if(a.CONST.__PF_M_LS.device===h){try{a.PFSH.DeleteUserCertByIndex(b,document.domain)}catch(f){return c.dispose(),a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(l.IDS_MSGBOX_CERT_DELETE_ERROR,f.code),setTimeout(function(){e.focus()},10),!1}finally{}a.certsList&&(a.certsList=null);v(h,m,l,"");var r=t();r?k.redrawList(r.list,r.list.length):k.redrawList(null,0);c.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");a.uiUtil().msgBox(l.IDS_MSGBOX_CERT_DELETE_SUCCESS);setTimeout(function(){e.focus()},10);d&&d(0);return!0}a.CONST.__PF_M_SS.device===h&&a.CCPFSH().DeleteUserCertByIndex(b,function(b,g){if(0==b){a.certsList&&(a.certsList=null);s("redraw",h,m,l,"");var f=t();f?k.redrawList(f.list,f.list.length):k.redrawList(null,0);c.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");a.uiUtil().msgBox(l.IDS_MSGBOX_CERT_DELETE_SUCCESS);setTimeout(function(){e.focus()},10);d&&d(0)}else c.dispose(),a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(l.IDS_MSGBOX_CERT_DELETE_ERROR,b),setTimeout(function(){e.focus()},10)})}if(!b||!c)return!1;var e=b,l=c;if(!a.certsList)return a.uiUtil().msgBox(l.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;confirm(l.IDS_CONFIRMBOX_WARNING_DELETE_CERT)?4<=a.ESVS.Mode?a.nimservice()?a.nimservice().DeleteCertificate(h,m,parseInt(k.selectedIndex()),function(b,c){0==b?(s("redraw",h,m,l,""),a.uiUtil().msgBox(l.IDS_MSGBOX_CERT_DELETE_SUCCESS),d&&d(0)):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(c,b))}):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(l.IDS_MSGBOX_NIM_ERROR_UNLOAD)):(b=null,b=a.CONST.__USFB_M_HSMKEY.device===h?a.loadUI("pin"):a.loadUI("password"),Dialog=b({type:null,args:null,onConfirm:function(b){var c=parseInt(k.selectedIndex());if(2&a.ESVS.Mode)if(a.CONST.__PF_M_LS.device===h){if(!a.PFUC)return!1;try{var d=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[c].signpri),e=a.usWebToolkit.pkcs8.checkUserCertPassword(d,b);!1===e?a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD):f(c,Dialog)}catch(m){a.uiUtil().errMsgBox(m.message,m.code)}finally{}}else if(a.CONST.__PF_M_SS.device===h){if(!a.CCPFSH())return!1;try{d=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[c].signpri),e=a.usWebToolkit.pkcs8.checkUserCertPassword(d,b),!1===e?a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD):f(c,Dialog)}catch(z){a.uiUtil().errMsgBox(z.message,z.code)}finally{}}},onCancel:function(){Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){e.focus()},10)}}),Dialog.show()):setTimeout(function(){e.focus()},10);return!0}function X(b,c){if(null==b||0>=b.length||null==c)return!1;if(0<b.length&&-1<b.indexOf(".")){var d=b.split("."),d=d[d.length-1].toLowerCase();if("pfx"!=d&&"p12"!=d)return a.uiUtil().msgBox(c.IDS_MSGBOX_FILE_ERROR_NOT_PFX),!1}else return a.uiUtil().msgBox(c.IDS_MSGBOX_FILE_ERROR_READ),!1;return!0}function Y(b,c){if(null==b)return!1;if(4<=a.ESVS.Mode)a.nimservice()?(SSDialog=a.loadUI("storageselect")({type:"CERT_IMPORT",args:null,onConfirm:function(d,e){SSDialog.dispose();a.nimservice().ImportCert(d,e,function(f,p){if(0==f){if(h==d&&m==e)s("redraw",h,m,b,"");else{var r=t();r?k.redrawList(r.list,r.list.length):k.redrawList(null,0)}a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_IMPORT_SUCCESS);c&&c(0)}else a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(p,f)})},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");SSDialog.dispose()}}),SSDialog.show()):a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD);else if(a.uiUtil().isItPortableDevice())a.uiUtil().ImportFromBackupStore();else{var d=document.getElementById("us-cert-manage-file-search-hidden");if("safari"==a.browserName&&6>parseFloat(a.browserVersion))return a.uiUtil().msgBox(b.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_SAFARI),!1;if("opera"==a.browserName||"safari"==a.browserName||"msie"==a.browserName&&8===parseInt(a.browserVersion))d.style.display="block";d.value="";if(""!=d.value){var f=d.onchange,e=d.parentNode;e.removeChild(d);d=document.createElement("input");d.setAttribute("type","file",0);d.setAttribute("accept","application/x-pkcs12",0);d.setAttribute("id","us-cert-manage-file-search-hidden",0);d.className="us-layout-cert-manage-file-search-hidden";d.onchange=f;e.appendChild(d)}d.click()}return!0}function T(b,c){function d(b,c,d,f){if(0===b)a.uiUtil().msgBox(e.IDS_MSGBOX_CERT_IMPORT_SUCCESS),h===c&&m===d&&(a.CONST.__USFB_M_SMARTCARD.device===h&&0===m&&v(h,m,e,f),a.CONST.__PF_M_SS.device===h?s("redraw",h,m,e,""):v(h,m,e,""),(b=t())?k.redrawList(b.list,b.list.length):k.redrawList(null,0));else switch(b){case 4823E4:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4843E4:a.uiUtil().msgBox(e.IDS_MSGBOX_HSM_ERROR_CERT_ALREADY_EXISTS);break;case 4844E4:a.uiUtil().msgBox(e.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(e.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 49000004:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 49000005:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4123E4:b=a.plugin().GetLastErrorMessage();b=a.certUtil().getLocalDate(b);b=e.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+e.IDS_NEWEST_CERT_EXPIRATION_DATE+b;a.uiUtil().msgBox(b);break;default:switch(d=0,d=a.CONST.__PF_M_LS.device===c?b:a.plugin().GetLastErrorCode(),d){case 3509:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;default:a.uiUtil().errMsgBox(e.IDS_MSGBOX_CERT_IMPORT_ERROR,d)}}}function f(b,c,f,g,l){a.CCPFSH().SetP12OnMemory(b,c,function(b,h,k){if(0==b)b=k.aluc[k.index],a.usWebToolkit.x509Certificate.parser(b.signcert,"Base64"),k=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),k=a.certUtil().getIssuerEnName(k),a.CCPFSH().SaveUserCert(k,b,!0,function(b){c="";l.dispose();0==b?d(b,f,g,""):a.uiUtil().errMsgBox(e.IDS_MSGBOX_CERT_IMPORT_ERROR,h);setTimeout(function(){n.focus()},10)});else{switch(b){case 1E7:0<=h.indexOf("115010")?a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(e.IDS_MSGBOX_CERT_IMPORT_ERROR,h);break;default:a.uiUtil().errMsgBox(e.IDS_MSGBOX_CERT_IMPORT_ERROR,b)}c="";l.dispose();setTimeout(function(){n.focus()},10)}})}if(!b||!c)return!1;var e=c,l=null,g=null,n=document.getElementById("us-cert-manage-get-cert-btn");if("opera"==a.browserName||"safari"==a.browserName)b.style.display="none";if(window.FileReader){var p=b.files;if(0<p.length){var r=p[0];if(!0==X(r.name,e)){var u=new FileReader;u.readAsBinaryString?(u.readAsBinaryString(r),u.addEventListener("load",function(){var b=u.result,c=b.length;if(r.size===c)g=a.usWebToolkit.util.encode64(b,c);else return a.uiUtil().msgBox(e.IDS_MSGBOX_FILE_ERROR_READ),!1})):(u.readAsArrayBuffer(r),u.addEventListener("load",function(){var b=u.result,c=null;try{var d=String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(b)));try{c=decodeURIComponent(escape(d))}catch(f){if(f instanceof URIError)c=d;else throw f;}}catch(l){return a.uiUtil().msgBox(e.IDS_MSGBOX_FILE_ERROR_READ),!1}b=c.length;if(r.size===b)g=a.usWebToolkit.util.encode64(c,b);else return a.uiUtil().msgBox(e.IDS_MSGBOX_FILE_ERROR_READ),!1}))}else return setTimeout(function(){n.focus()},10),!1}else return setTimeout(function(){n.focus()},10),!1}else{if("msie"==a.browserName&&8===parseInt(a.browserVersion))p=document.getElementById("us-div-cert-manage"),p.onselectstart=function(){return!0},b.select(),l=document.selection.createRange().text,b.style.display="none",p.onselectstart=function(){return!1};else if("msie"==a.browserName&&9===parseInt(a.browserVersion)){if(l=b.value,-1<l.indexOf("fakepath"))return a.uiUtil().msgBox(e.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_IE9),setTimeout(function(){n.focus()},10),!1}else l=b.value;if(!1==X(l,e))return setTimeout(function(){n.focus()},10),!1}Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(b){Dialog.dispose();SSDialog=a.loadUI("storageselect")({type:"CERT_IMPORT",args:null,onConfirm:function(c,h){if(a.CONST.__USFB_M_HSMKEY.device===c||a.CONST.__USFB_M_SMARTCARD.device===c){SSDialog.dispose();var k=null,k=a.CONST.__USFB_M_SMARTCARD.device===c?"PIN_SAVE_TOKEN":"PIN_SECURITY_TOKEN";PINDialog=a.loadUI("pin")({type:k,args:null,onConfirm:function(f){if(a.plugin().valid){var k=0,k=null!=l?a.plugin().ImportPfxCert_HSM(l,b,c,h,f):a.plugin().ImportPfxCertString_HSM(g,b,c,h,f);d(k,c,h,f)}else a.uiUtil().msgBox(e.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD);b=f="";PINDialog.dispose();setTimeout(function(){n.focus()},10)},onCancel:function(){b="";PINDialog.dispose();setTimeout(function(){n.focus()},10)}});PINDialog.show()}else if(a.CONST.__PF_M_SS.device===c&&a.CCPFSH())a.CCPFSH().IsCCPFSHAvailable(function(d){0==d?f(g,b,c,h,SSDialog):a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.PKI,function(d,l){0==d?f(g,b,c,h,SSDialog):(b="",SSDialog.dispose(),setTimeout(function(){n.focus()},10),a.uiUtil().errMsgBox(e.IDS_MSGBOX_CERT_IMPORT_ERROR,d))})});else if(a.CONST.__PF_M_LS.device===c){if(!a.PFSH)return a.uiUtil().msgBox("unsupport html5 storage"),!1;k=0;try{var p=a.PFSH.SetP12OnMemory(g,b),r=p.aluc[p.index];a.usWebToolkit.x509Certificate.parser(r.signcert,"Base64");var m=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),u=a.certUtil().getIssuerEnName(m);a.PFSH.SaveUserCert(u,r,document.domain,!0)}catch(q){switch(k=q.code,q.code){case 1E7:0<=q.detail.indexOf("115010")?a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(e.IDS_MSGBOX_CERT_IMPORT_ERROR,q.detail);break;default:a.uiUtil().errMsgBox(e.IDS_MSGBOX_CERT_IMPORT_ERROR,q.code)}}d(k,c,h,"");b="";SSDialog.dispose();setTimeout(function(){n.focus()},10)}},onCancel:function(){b="";SSDialog.dispose();setTimeout(function(){n.focus()},10)}});SSDialog.show()},onCancel:function(){Dialog.dispose();setTimeout(function(){n.focus()},10)}});Dialog.show();return!0}function Z(b,c,d){if(!b||!c)return!1;if(!a.certsList)return a.uiUtil().msgBox(c.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var f=document.getElementById("us-cert-manage-put-cert-out-btn");4==a.ESVS.Mode||6==a.ESVS.Mode?a.nimservice()&&null!=a.nimservice()?a.nimservice().ExportCert(h,m,parseInt(k.selectedIndex()),1,"file",function(b,f){0==b?(a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_EXPORT_SUCCESS),d&&d(0)):a.uiUtil().errMsgBox(f,b);a.uiUtil().loadingBox(!1,"us-div-list-load")}):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD)):2&a.ESVS.Mode?(Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(b){var d=parseInt(k.selectedIndex());if(2&a.ESVS.Mode){if(!a.PFUC)return b="",!1;try{var g=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[d].signpri),n=a.usWebToolkit.pkcs8.checkUserCertPassword(g,b),g="";if(!1===n)a.uiUtil().msgBox(c.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);else if(h==a.CONST.__PF_M_LS.device)if(a.uiUtil().isItPortableDevice()){var p=a.PFSH.GetP12ForBuToMo(d,"hex");a.uiUtil().ExportToBackupStore(p.p12,p.key);p=null}else{var p=a.PFSH.GetP12ForBuToPc(d,b,"binary"),r=p.p12,m=p.dn,q=a.certUtil().getCN(m)+".p12";a.fileUtil().save(q,r);r=m=p=null}else h==a.CONST.__PF_M_SS.device&&(a.uiUtil().isItPortableDevice()?a.CCPFSH().GetP12ForBuToMo(d,"hex",function(c,d,g,h){0==c&&(a.uiUtil().ExportToBackupStore(h,g),p=null);b="";Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){f.focus()},10)}):a.CCPFSH().GetP12ForBuToPc(d,b,"base64",function(c,d,g,h){if(0==c){c=a.usWebToolkit.util.decode64(h);d=Array(c.length);for(h=0;h<c.length;h++)d[h]=c.charCodeAt(h);c=new Uint8Array(d);g=a.certUtil().getCN(g)+".p12";a.fileUtil().save(g,c)}b="";Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){f.focus()},10)}))}catch(s){a.uiUtil().errMsgBox(s.message,s.code)}finally{}}h!=a.CONST.__PF_M_SS.device&&(b="",Dialog.dispose(),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){f.focus()},10))},onCancel:function(){Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){f.focus()},10)}}),Dialog.show()):a.uiUtil().msgBox(c.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD);return!0}function da(b){if(!b)return!1;var c=a.loadUI("swinfo")({type:null,args:null,onConfirm:function(){c.dispose();setTimeout(function(){b.focus()},10)},onCancel:function(){c.dispose();setTimeout(function(){b.focus()},10)}});c.show();return!0}function I(){var a=document.getElementById("us-cert-manage-cert-copy-btn");a.readOnly=!1;a.disabled=!1}function N(){var a=document.getElementById("us-cert-manage-cert-copy-btn");a.readOnly=!0;a.disabled=!0}function G(){var a=document.getElementById("us-cert-manage-pw-change-btn");a.readOnly=!1;a.disabled=!1}function Q(){var a=document.getElementById("us-cert-manage-pw-change-btn");a.readOnly=!0;a.disabled=!0}function E(){var a=document.getElementById("us-cert-manage-put-cert-out-btn");a.readOnly=!1;a.disabled=!1}function O(){var a=document.getElementById("us-cert-manage-put-cert-out-btn");a.readOnly=!0;a.disabled=!0}function C(){var a=document.getElementById("us-cert-manage-get-cert-btn");a.readOnly=!1;a.disabled=!1}function F(){var a=document.getElementById("us-cert-manage-cert-delete-btn");a.readOnly=!1;a.disabled=!1}function $(){var a=document.getElementById("us-cert-manage-cert-delete-btn");a.readOnly=!0;a.disabled=!0}function D(b){b==a.CONST.__PF_M_SS.device?(N(),G(),C(),F(),a.uiUtil().isItSupportingPFCertBackUp()?E():O()):b==a.CONST.__PF_M_LS.device?(N(),G(),C(),F(),a.uiUtil().isItSupportingPFCertBackUp()?E():O()):b==a.CONST.__USFB_M_HDD.device?(I(),G(),E(),C(),F()):b==a.CONST.__USFB_M_DISK.device?(I(),G(),E(),C(),F()):b==a.CONST.__USFB_M_HSMKEY.device?(N(),Q(),O(),C(),F()):b==a.CONST.__USFB_M_SMARTCARD.device?(I(),G(),E(),C(),F()):b==a.CONST.__USFB_M_MOBILE.device?(I(),Q(),E(),C(),$()):b==a.CONST.__PF_M_CLOUDSIGN.device?(N(),Q(),O(),$(),b=document.getElementById("us-cert-manage-get-cert-btn"),b.readOnly=!0,b.disabled=!0):(I(),G(),E(),F(),C())}function R(b,c,d,f){if(a.CONST.__USFB_M_DISK.device>b||!c||!d||!f)return!1;var e=a.loadUI("driveselect")({type:"DEVICE_REMOVABLE_DISK",args:c,onConfirm:function(c){0<c&&(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==h?s("redraw",b,c,f,""):(c=v(b,c,f,""),0!=c?(a.uiUtil().errMsgBox(f.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),k.redrawList(null,0)):(c=t())?k.redrawList(c.list,c.list.length):k.redrawList(null,0)));a.ESVS.Embedded?setTimeout(function(){e.dispose()},10):e.dispose();setTimeout(function(){d.focus()},10)},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");e.dispose();setTimeout(function(){d.focus()},10)}});e.show();return!0}function aa(b,c,d,f){if(a.CONST.__USFB_M_DISK.device>b||!d||!f)return!1;var e=a.loadUI("sectokenselect")({type:b,args:c,onConfirm:function(c){if(0<c)if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==h)s("redraw",b,c,f,"");else if(c=v(b,c,f,""),0!=c){switch(c){case 4812E4:case 4813E4:a.uiUtil().msgBox(f.IDS_MSGBOX_HSM_ERROR_CONNECTION);break;default:a.uiUtil().errMsgBox(f.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c)}k.redrawList(null,0)}else(c=t())?k.redrawList(c.list,c.list.length):k.redrawList(null,0);a.ESVS.Embedded?setTimeout(function(){e.dispose()},10):e.dispose();setTimeout(function(){d.focus()},10)},onCancel:function(){e.dispose();setTimeout(function(){d.focus()},10)}});e.show();return!0}function ea(b,c){if(!b||!c)return!1;var d=null;h=a.CONST.__USFB_M_DISK.device;m=0;a.certsList&&(a.certsList=null);k.redrawList(null,-1);if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==h)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_DISK.device,function(e){if(0<e){for(var f=[],g=0;g<e;g++){var h=g+1,k={};k.index=h;k.name=a.nimservice().GetDiskDriveName(h);f[g]=k}d={list:f}}else return-1===e&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage()),a.certsList=null,!1;R(a.CONST.__USFB_M_DISK.device,d,b,c)});else return a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else{if(a.plugin().valid){var f=a.plugin().GetDiskListNum();if(0<f){for(var e=[],l=0;l<f;l++){var g=l+1,n={};n.index=g;n.name=a.plugin().GetDiskDriveName(g);e[l]=n}d={list:e}}else return-1===f&&(a.plugin().GetLastErrorCode(),a.plugin().GetLastErrorMessage()),a.certsList=null,!1}else return a.uiUtil().msgBox(c.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),!1;R(a.CONST.__USFB_M_DISK.device,d,b,c)}return!0}function fa(b,c){if(!b||!c)return!1;var d=null;h=a.CONST.__USFB_M_HSMKEY.device;m=0;D(h);a.certsList&&(a.certsList=null);k.redrawList(null,-1);if(1&a.ESVS.Mode)if(a.plugin().valid){var f=[],e=a.plugin().GetHSMInstallListNum();if(0<e)for(var l=0;l<e;l++){var g=l+1,n={},p=a.plugin().GetHSMInstallDriverName(g).split("|");n.index=g;n.name=p[0];n.driver=p[1];n.passage=p[2];n.validity=p[3];f[l]=n}d={list:f}}else return a.uiUtil().msgBox(c.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),!1;else if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_HSMKEY.device,function(e){if(0<e){for(var f=[],g=0;g<e;g++){var h=g+1,k={},l=a.nimservice().GetSecureTokenName(h).split("|");k.index=h;k.name=l[0];k.driver=l[1];k.passage=l[2];f[g]=k}d={list:f}}else a.nimservice().GetLastErrorCode();aa(a.CONST.__USFB_M_HSMKEY.device,d,b,c)});else return a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;4&a.ESVS.Mode||aa(a.CONST.__USFB_M_HSMKEY.device,d,b,c);return!0}function ga(b,c){if(!b||!c)return!1;h=a.CONST.__USFB_M_SMARTCARD.device;m=0;D(h);a.certsList&&(a.certsList=null);k.redrawList(null,-1);if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==h)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_SMARTCARD.device,function(d){if(0<d){for(var f=[],e=0;e<d;e++){var h=e+1,g={};g.index=h;g.name=a.nimservice().GetSmartCardName(h);f[e]=g}driveList={list:f}}else return-1===d&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage()),a.certsList=null,!1;R(a.CONST.__USFB_M_SMARTCARD.device,driveList,b,c)});else return a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function ha(b,c){if(!b||!c)return!1;h=a.CONST.__USFB_M_MOBILE.device;m=0;D(h);a.certsList&&(a.certsList=null);k.redrawList(null,-1);if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==h)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_MOBILE.device,function(b){if(0<b)s("redraw",a.CONST.__USFB_M_MOBILE.device,0,c,"");else return a.ERROR.Code=11003,a.ERROR.Message=B.IDS_MSGBOX_NOT_INSTALL_MOBILE,confirm(B.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)?(document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"))&&a.uiUtil().msgBox(B.IDS_MSGBOX_BLOCK_POPUP_WINDOW)):a.uiUtil().loadingBox(!1,"us-div-list-load"),!1});else return a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function J(b,c){if(!b||!c)return!1;a.uiUtil().MsgBox(c.IDS_MSGBOX_NOT_SUPPORTED_MEDIA);return!0}function ia(b,c){if(!b||!c)return!1;D(h);ba=a.loadUI("gridlist");k=ba({type:"certslist",tblid:"us-cert-manage-tbl-list",tbltitleid:"us-cert-manage-tbl-list-th",titlelistid:"us-cert-manage-grid-head-div",titlerowid:"us-cert-manage-list-title-row",titleelementid:"us-cert-manage-list-title-element",titledividerid:"us-cert-manage-list-title-divider",titlelistcn:"us-layout-grid-head-div",titlerowcn:"us-layout-grid-head-row",titleelementcn:"us-layout-grid-row-title-element",titledividercn:"us-layout-grid-row-title-divider",tblbodyid:"us-cert-manage-tbl-list-td",datalistid:"us-cert-manage-grid-body-div",datarowid:"us-cert-manage-list-body-row",dataelementid:"us-cert-manage-list-data-element",datalistcn:"us-layout-grid-body-div",datarowcn:"us-layout-grid-body-row",dataelementcn:"us-layout-grid-row us-layout-grid-row-data-element",dataselectcn:"us-layout-grid-row us-layout-grid-row-data-selected-element",textObj:c});var d=!0;"opera"==a.browserName&&(d=!1);k.drawList(b,b.length,null,0,L,d);4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==h?s("redraw",h,0,c,"",b,d):a.CONST.__PF_M_CLOUDSIGN.device==h?s("redraw",h,m,c,"",b,d):(d=v(h,0,c,""),0!=d?a.uiUtil().errMsgBox(c.IDS_MSGBOX_COMMON_ERROR_GET_CERT,d):(d=t())?k.redrawList(d.list,d.list.length):k.redrawList(null,0));return!0}function A(b){if(!b)return!1;K(b,B,"close");for(var c=a.ESVS.Media.list.split("|"),d=0;d<c.length;d++){var f=a.CONST.medias[c[d]];if(void 0!=f&&null!=f){var e=document.getElementById("us-cert-manage-btn-"+f.name);void 0!=e&&null!=e&&"us-layout-storage-btn-none"!=e.className&&(b===e?(e.className="us-layout-storage-btn-on",setTimeout(function(){e.focus()},10)):e.className="us-layout-storage-btn-off")}}return!0}function ja(b){if(null==b||void 0==b)return!1;var c=!a.uiUtil().isItSupportingThisStorage(b);!1==c&&null!=a.ESVS.Media&&null!=a.ESVS.Media.list&&0>a.ESVS.Media.list.indexOf(b.name)&&(c=!0);if(c)return!1;var c=document.getElementById("us-cert-manage-storage-btn-list"),d=document.createElement("li");d.setAttribute("id","us-cert-manage-storage-btn-li-"+b.name,0);d.setAttribute("mediaIndex",b.mediaIndex,0);7==b.mediaIndex&&(d.className="line-first");"hidden"===b.visibility?(d.style.display="none",d.style.visibility="hidden"):(d.style.display="block",d.style.visibility="visible");var f=document.createElement("button");f.setAttribute("type","button",0);f.setAttribute("id","us-cert-manage-btn-"+b.name,0);f.setAttribute("title",b.label,0);f.setAttribute("tabindex",b.tabIndex,0);b.disabled?(f.onclick=function(){a.uiUtil().msgBox(B.IDS_MSGBOX_NOT_SUPPORTED_MEDIA)},f.className="us-layout-storage-btn-none"):(f.onclick=b.onclick,b.device===h?(f.className="us-layout-storage-btn-on",setTimeout(function(){f.focus()},10)):f.className="us-layout-storage-btn-off");d.appendChild(f);if("harddisk"!==b.name&&"webstorage"!==b.name){var e=document.createElement("span");e.className="us-drive-select";f.appendChild(e)}e=document.createElement("span");e.className="us-img-storage";var k=document.createElement("img");k.setAttribute("id","us-cert-manage-img-"+b.name,0);k.setAttribute("alt",b.label,0);b.disabled?k.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+b.name+"_d.png",0):k.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+b.name+".png",0);e.appendChild(k);f.appendChild(e);e=document.createElement("span");e.setAttribute("id","us-cert-manage-lbl-"+b.name,0);e.className="us-layout-lbl-storage";e.appendChild(document.createTextNode(b.label));f.appendChild(e);d.appendChild(f);c.appendChild(d);return!0}function K(b,c,d){if("no_more"==d)a.uiUtil().msgBox(c.IDS_MSGBOX_NOT_MORE_MEDIA);else{b=document.getElementById("us-cert-manage-storage-wrap");"open"==d?(b.className="us-layout-storage-more-wrap",b=document.getElementById("us-cert-manage-storage-more-btn"),b.setAttribute("title",c.IDS_STORAGE_MORE_VIEW+c.IDS_STORAGE_MORE_VIEW_HIDDEN+c.IDS_BUTTON,0),b.onclick=function(){K(this,c,"close")},b=document.getElementById("us-cert-manage-storage-more-btn-img"),b.setAttribute("alt",c.IDS_STORAGE_MORE_VIEW+c.IDS_STORAGE_MORE_VIEW_HIDDEN,0),b.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_close.png",0)):(b.className="us-layout-storage-wrap",b=document.getElementById("us-cert-manage-storage-more-btn"),b.setAttribute("title",c.IDS_STORAGE_MORE_VIEW+c.IDS_STORAGE_MORE_VIEW_SHOW+c.IDS_BUTTON,0),b.onclick=function(){K(this,c,"open")},b=document.getElementById("us-cert-manage-storage-more-btn-img"),b.setAttribute("alt",c.IDS_STORAGE_MORE_VIEW+c.IDS_STORAGE_MORE_VIEW_SHOW,0),b.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));b=a.ESVS.Media.list.split("|");for(var f=0;f<b.length;f++){var e=a.CONST.medias[b[f]];if(void 0!=e&&null!=e&&(e=document.getElementById("us-cert-manage-storage-btn-li-"+e.name),void 0!=e&&null!=e)){var h=e.getAttribute("mediaIndex");"open"==d?(e.style.display="block",e.style.visibility="visible"):6<h?(e.style.display="none",e.style.visibility="hidden"):(e.style.display="block",e.style.visibility="visible")}}}return!0}function S(){k.restoreOnMouseEvent();h==a.CONST.__PF_M_CLOUDSIGN.device&&closeSession();q.onCancel()}function x(a){var c=document.querySelector(".us-layout-storage-btn-on span img").alt,d=document.querySelector(".us-layout-storage-btn-on span img").src,f=document.getElementById("us-cert-manage-img-current-storage");f.setAttribute("alt",c,0);f.setAttribute("src",d,0);f=document.getElementById("us-cert-manage-lbl-current-storage");f.innerHTML=c;0>k.selectedIndex()&&(document.getElementById("us-layout-cert-manage-detail-box-subject").innerHTML="<b style='color: red;'>"+a.IDS_DETAIL_BOX_NOT_SELECTED+"</b>",document.getElementById("us-layout-cert-manage-detail-box-expire-data").innerHTML="",document.getElementById("us-layout-cert-manage-detail-box-savepath-data").innerHTML="")}function ka(a,c,d){switch(q.args.type){case 1:U(a,c,d);break;case 2:V(a,c,d);break;case 3:Y(c,d);break;case 4:Z(a,c,d);break;case 5:W(a,c,d)}}var la=function(){var b;b=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");b.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/layout/certmanage.html?V="+a.ver,!1);b.send(null);return b.responseText},ca=function(){var b;b=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");b.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/certmanage_"+a.ESVS.Language+".js?V="+a.ver,!1);b.send(null);return b.responseText},B=eval(eval(ca)()),ba=null,k=null,w=a.ESVS.TabIndex,L=0,h=a.CONST.__USFB_M_HDD.device,m=0;null!=a.ESVS.Media&&null!=a.ESVS.Media.defaultdevice?h=a.uiUtil().getMediaDevice(a.ESVS.Media.defaultdevice):2==a.ESVS.Mode&&(h=a.CONST.__PF_M_LS.device);return function(){var b=eval(la),c=eval(eval(ca)());a.ESVS.TargetObj.innerHTML=b();var d=document.getElementById("us-cert-manage-lbl-title");d.appendChild(document.createTextNode(c.IDS_CERT_MANAGEMENT));d.setAttribute("tabindex",w++,0);b=document.getElementById("us-cert-manage-cls-img-btn");b.setAttribute("title",c.IDS_CLOSE_CERT_MANAGEMENT_CLOSE,0);b.onclick=function(){S()};document.getElementById("us-cert-manage-cls-btn-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_close_btn.png",0);document.getElementById("us-cursor-disabled").setAttribute("title",c.IDS_SENSE_READER_INTRO,0);b=document.getElementById("us-cert-manage-logo-img");b.setAttribute("alt",c.IDS_LOGO,0);b.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/main_cert_logo.png",0);b.setAttribute("tabindex",w++,0);document.getElementById("us-cert-manage-legend-storage").appendChild(document.createTextNode(c.IDS_STORAGE_SELECT));for(var b=0,f=a.ESVS.Media.list.split("|"),e=null,l=0;l<f.length;l++){var g=a.CONST.medias[f[l]];if(void 0!=g&&null!=g){switch(g.device){case a.CONST.__USFB_M_DISK.device:g.label=c.IDS_STORAGE_REMOVABLE;g.disabled=2==a.ESVS.Mode;g.onclick=function(){ea(this,c);A(this);x(c)};break;case a.CONST.__USFB_M_HSMKEY.device:g.label=c.IDS_STORAGE_SECTOKEN;g.disabled=!q.args||1!=q.args.type&&2!=q.args.type&&4!=q.args.type?!("win"==a.osName&&2!=a.ESVS.Mode):!0;g.onclick=function(){fa(this,c);A(this);x(c)};break;case a.CONST.__USFB_M_SMARTCARD.device:g.label=c.IDS_STORAGE_SAVETOKEN;g.disabled=!("win"==a.osName&&2!=a.ESVS.Mode);g.onclick=function(){ga(this,c);A(this);x(c)};break;case a.CONST.__USFB_M_MOBILE.device:g.label=c.IDS_STORAGE_MOBILEPHONE;g.disabled=!q.args||2!=q.args.type&&5!=q.args.type?2==a.ESVS.Mode:!0;g.onclick=function(){ha(this,c);A(this);x(c)};break;case a.CONST.__USFB_M_HDD.device:g.label=c.IDS_STORAGE_HARDDISK;g.disabled=2==a.ESVS.Mode;g.onclick=function(){if(this&&c)if(h=a.CONST.__USFB_M_HDD.device,m=0,D(h),a.certsList&&(a.certsList=null),k.redrawList(null,-1),4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==h)s("redraw",a.CONST.__USFB_M_HDD.device,0,c,"");else{var b=v(a.CONST.__USFB_M_HDD.device,0,c,"");0!=b?(a.uiUtil().errMsgBox(c.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),k.redrawList(null,0)):(b=t())?k.redrawList(b.list,b.list.length):k.redrawList(null,0)}A(this);x(c)};break;case a.CONST.__USFB_M_MOBILETOKEN.device:g.label=c.IDS_STORAGE_MOBILETOKEN;g.disabled=!0;g.readOnly=!0;g.onclick=function(){this&&c&&(h=a.CONST.__USFB_M_MOBILEOTKEN.device,m=0,a.certsList&&(a.certsList=null),k.redrawList(null,-1),4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==h&&s("redraw",a.CONST.__USFB_M_MOBILETOKEN.device,0,c,""));A(this);x(c)};break;case a.CONST.__PF_M_SS.device:g.label=c.IDS_STORAGE_SS;g.disabled=1==a.ESVS.Mode;g.onclick=function(){this&&c&&(h=a.CONST.__PF_M_SS.device,m=0,D(h),a.certsList&&(a.certsList=null),k.redrawList(null,-1),s("redraw",a.CONST.__PF_M_SS.device,0,c,""));A(this);x(c)};break;case a.CONST.__PF_M_LS.device:g.label=c.IDS_STORAGE_LS;g.disabled=1==a.ESVS.Mode;g.onclick=function(){if(this&&c){h=a.CONST.__PF_M_LS.device;m=0;D(h);a.certsList&&(a.certsList=null);k.redrawList(null,-1);var b=v(a.CONST.__PF_M_LS.device,0,c,"");0!=b?(a.uiUtil().errMsgBox(c.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),k.redrawList(null,0)):(b=t())?k.redrawList(b.list,b.list.length):k.redrawList(null,0)}A(this);x(c)};break;case a.CONST.__PF_M_TOUCHSIGN.device:g.label=c.IDS_STORAGE_TOUCHSIGN;g.disabled=!0;g.onclick=function(){J(this,c);x(c)};break;case a.CONST.__PF_M_SMARTSIGN.device:g.label=c.IDS_STORAGE_SMARTSIGN;g.disabled=!0;g.onclick=function(){J(this,c);x(c)};break;case a.CONST.__PF_M_WEBSECTOKEN.device:g.label=c.IDS_STORAGE_WEBSECTOKEN;g.disabled=!0;g.onclick=function(){J(this,c);x(c)};break;case a.CONST.__PF_M_WEBSOFTTOKEN.device:g.label=c.IDS_STORAGE_WEBSOFTTOKEN;g.disabled=!0;g.onclick=function(){J(this,c);x(c)};break;case a.CONST.__PF_M_CLOUDSIGN.device:g.label=c.IDS_STORAGE_CLOUDSIGN;g.disabled=1==a.ESVS.Mode;g.onclick=function(){this&&c&&(h=a.CONST.__PF_M_CLOUDSIGN.device,m=0,D(h),a.certsList&&(a.certsList=null),k.redrawList(null,-1),s("redraw",a.CONST.__PF_M_CLOUDSIGN.device,0,c,""));A(this);x(c)};break;default:g.label=c.IDS_STORAGE_ETC,g.disabled=!0,g.onclick=function(){J(this,c);x(c)}}g.tabIndex=w;g.mediaIndex=b+1;g.visibility=6<g.mediaIndex?"hidden":"visible";ja(g)&&(w++,b++);null==e&&(e=g)}}f=document.getElementById("us-cert-manage-storage-more-btn");null!=f&&void 0!=f&&(f.setAttribute("title",c.IDS_STORAGE_MORE_VIEW+c.IDS_STORAGE_MORE_VIEW_SHOW+c.IDS_BUTTON,0),6<b?(f.style.display="block",f.style.visibility="visible",f.setAttribute("tabindex",w++,0),f.onclick=function(){K(this,c,"open")}):(f.setAttribute("disabled","disabled",0),f.style.display="none",f.style.visibility="hidden",f.onclick=function(){K(this,c,"no_more")}),b=document.getElementById("us-cert-manage-storage-more-btn-img"),b.setAttribute("alt",c.IDS_STORAGE_MORE_VIEW+c.IDS_STORAGE_MORE_VIEW_SHOW,0),b.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));document.getElementById("us-cert-manage-tbl-list").style.summary=c.IDS_CERT_LIST_TABLE_SUMMARY;document.getElementById("us-cert-manage-tbl-list-caption").appendChild(document.createTextNode(c.IDS_CERT_LIST_CAPTION));a.ESVS.Mode&2&&a.uiUtil().loadingBox(!0,"us-div-list-load",0);b=[{title:c.IDS_CERT_STATUS},{title:c.IDS_CERT_CLASSIFY},{title:c.IDS_CERT_USER},{title:c.IDS_CERT_ISSUER},{title:c.IDS_CERT_EXPIRATION_DAY}];L=w++;ia(b,c);document.getElementById("us-cert-manage-file-search-hidden").onchange=function(){T(this,c)};null!=q.args?(document.getElementById("us-div-cert-manage-btns").style.display="none",document.getElementById("us-fieldset-cert-manage-title").appendChild(document.createTextNode(c.IDS_DETAIL_BOX_TITLE)),-1<k.selectedIndex()?(b=parseInt(k.selectedIndex()),a.usWebToolkit.x509Certificate.parser(a.certsList.list[b-1].cert,"Base64"),document.getElementById("us-layout-cert-manage-detail-box-subject").innerHTML="<b>"+a.certUtil().getCN(a.usWebToolkit.x509Certificate.getSubjectName())+"</b>",document.getElementById("us-layout-cert-manage-detail-box-expire-data").innerHTML=a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotBefore())+" ~ "+a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotAfter()),a.certsList.list[b-1].path&&(document.getElementById("us-layout-cert-manage-detail-box-savepath-data").innerHTML=a.certsList.list[b-1].path)):document.getElementById("us-layout-cert-manage-detail-box-subject").innerHTML="<b style='color: red;'>"+c.IDS_DETAIL_BOX_NOT_SELECTED+"</b>",document.getElementById("us-layout-cert-manage-detail-box-expire-lbl").innerHTML=c.IDS_DETAIL_BOX_EXPIRE_DATE+" : ",document.getElementById("us-layout-cert-manage-detail-box-savepath-lbl").innerHTML=c.IDS_DETAIL_BOX_SAVE_PATH+" : ",b=document.getElementById("us-cert-manage-detail-view-btn"),b.setAttribute("tabindex",w++,0),b.value=c.IDS_DETAIL_BOX_BTN_VIEW,b.title=c.IDS_DETAIL_BOX_BTN_VIEW,b.onclick=function(){H(this,c)},b=document.getElementById("us-cert-manage-sw-info-btn"),b.setAttribute("tabindex",w++,0),b.setAttribute("class","btn-action"),b.value=c.IDS_DETAIL_BOX_BTN_ACTIONS[q.args.type],b.title=c.IDS_DETAIL_BOX_BTN_ACTIONS[q.args.type],b.onclick=function(){ka(this,c,function(a){0==a&&S()})},x(c)):(document.getElementById("us-div-cert-manage-detail").style.display="none",b=document.getElementById("us-cert-manage-cert-view-btn"),b.setAttribute("value",c.IDS_CERT_VIEW,0),b.setAttribute("title",c.IDS_CERT_VIEW+c.IDS_BUTTON,0),b.setAttribute("tabindex",w++,0),b.onclick=function(){H(this,c)},b=document.getElementById("us-cert-manage-pw-change-btn"),b.setAttribute("value",c.IDS_PW_CHANGE,0),b.setAttribute("title",c.IDS_PW_CHANGE+c.IDS_BUTTON,0),b.setAttribute("tabindex",w++,0),b.onclick=function(){V(this,c)},b=document.getElementById("us-cert-manage-cert-copy-btn"),b.setAttribute("value",c.IDS_CERT_COPY,0),b.setAttribute("title",c.IDS_CERT_COPY+c.IDS_BUTTON,0),b.setAttribute("tabindex",w++,0),b.onclick=function(){U(this,c)},b=document.getElementById("us-cert-manage-cert-delete-btn"),b.setAttribute("value",c.IDS_CERT_DELETE,0),b.setAttribute("title",c.IDS_CERT_DELETE+c.IDS_BUTTON,0),b.setAttribute("tabindex",w++,0),b.onclick=function(){W(this,c)},b=document.getElementById("us-cert-manage-get-cert-btn"),b.setAttribute("value",c.IDS_CERT_GET,0),b.setAttribute("title",c.IDS_CERT_GET+c.IDS_BUTTON,0),b.setAttribute("tabindex",w++,0),b.onclick=function(){Y(c)},b=document.getElementById("us-cert-manage-put-cert-out-btn"),b.setAttribute("value",c.IDS_CERT_PUT_OUT,0),b.setAttribute("title",c.IDS_CERT_PUT_OUT+c.IDS_BUTTON,0),b.setAttribute("tabindex",w++,0),b.onclick=function(){Z(this,c)},b=document.getElementById("us-cert-manage-sw-info-btn"),b.setAttribute("value",c.IDS_SW_INFO,0),b.setAttribute("title",c.IDS_SW_INFO+c.IDS_BUTTON,0),b.setAttribute("tabindex",w++,0),b.onclick=function(){da(this)});document.getElementById("us-cert-manage-lbl-notice").appendChild(document.createTextNode(c.IDS_NOTICE));var n=document.getElementById("us-cert-manage-cls-btn");n.setAttribute("value",c.IDS_CANCEL,0);n.setAttribute("title",c.IDS_CANCEL+c.IDS_BUTTON,0);n.setAttribute("tabindex",w++,0);n.onclick=function(){S()};n.onkeydown=function(a){a=a||window.event;var b=a.which||a.keyCode;9==b&&a.shiftKey&&(n.onblur=function(){setTimeout(function(){document.getElementById("us-cert-manage-sw-info-btn").focus()},10)});9!=b||a.shiftKey||(n.onblur=function(){setTimeout(function(){d.focus()},10)})};d.onkeydown=function(a){a=a||window.event;9==(a.which||a.keyCode)&&a.shiftKey&&(d.onblur=function(){setTimeout(function(){n.focus()},10)})};return document.getElementById("us-div-cert-manage")}()};return function(q){var t=a.uiLayerLevel,s=a.uiUtil().getOverlay(t),v=T({type:q.type,args:q.args,onConfirm:q.onConfirm,onCancel:q.onCancel});v.style.zIndex=t+1;document.body.insertBefore(s,document.body.firstChild);var H=window.onresize;return{show:function(){draggable(v,document.getElementById("us-div-cert-manage-title"));s.style.display="block";a.uiUtil().offsetResize(v);window.onresize=function(){a.uiUtil().offsetResize(v)};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;setTimeout(function(){a:for(var q=a.ESVS.Media.list.split("|"),s=0;s<q.length;s++){var t=a.CONST.medias[q[s]];if(void 0!=t&&null!=t&&"us-layout-storage-btn-on"==document.getElementById("us-cert-manage-btn-"+t.name).className)break a}},10)},hide:function(){s.style.display="none";v.style.display="none"},dispose:function(){window.onresize=function(){H&&H()};v.parentNode.removeChild(v);s.parentNode.removeChild(s);a.uiLayerLevel-=10;a.ESVS.TabIndex-=30}}}};