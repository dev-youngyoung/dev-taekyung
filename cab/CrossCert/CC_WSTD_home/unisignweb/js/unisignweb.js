var UnisignWebEngine=function(B,ka){function Fa(){if(!(p.Mode&4))return null;eval(C({eval:!1,intergrity:!1,name:"nimservice",url:"unisignweb/js/nimservice.js"}));return eval("__nimservice")(a)}function Ga(){if(!(p.Mode&2))return null;eval(C({eval:!1,intergrity:!1,name:"nimservice",url:"unisignweb/js/sharestorage.js"}));return eval("__crosscertlocalstorage")(a)}function C(a){var d=null,d=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");"undefined"==typeof p.SRCPath&&(p=window.ESVS);d.open("GET",p.SRCPath+a.url+"?V="+X,!1);d.send(null);if(200==d.status){if(!0===a.intergrity){var c={};c.name=a.name+".js";c.data=d.responseText;M[ua++]=c}return null==a.eval||!0==a.eval?eval(d.responseText):d.responseText}H=!1;return null}function va(){a.nimservice()?a.nimservice().GetE2EInfo(function(b,d,c){0==b?a.touchEn_pubkey="-----BEGIN CERTIFICATE-----"+c+"-----END CERTIFICATE-----":a.ESVS.SecureKeyboardType=""}):setTimeout(va,1E3)}function Ha(){E&&aa.log("Do retry to initialize module.");VerifyPFLicense()&&(__ForgeryUtil=new F.FORGERY)}function Ia(b){var d;if(!b||0>=b.length)return null;var c=b+".js";d=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");"undefined"==typeof p.SRCPath&&(p=window.ESVS);a.uiUtil().isItPortableDevice()?"gridlist"!=b?(c="m_"+c,d.open("GET",p.SRCPath+"unisignweb/js/mobile/m_"+b+".js?V="+X,!1)):d.open("GET",p.SRCPath+"unisignweb/js/"+b+".js?V="+X,!1):d.open("GET",p.SRCPath+"unisignweb/js/"+b+".js?V="+X,!1);d.send(null);var f=d.responseText,e=null;"certprocessing.js"!=c&&(e=a.forgeryUtil().verify(c,f),"success"!=e&&null!=e&&(a.uiUtil().flagAlert(e),H=!1));eval(d.responseText);return eval("__"+b)(a)}function k(a,d){var c={};c.resultCode=a?a:0;c.resultMessage=d?d:"";c.jsonSignedData="";c.certAttrs="";c.certIndex="";c.b64RValue="";c.hashValue="";c.encryptedData="";c.decryptedData="";c.signedData="";c.theCert="";c.theDN="";c.thePri="";c.kmCert="";c.kmPri="";c.curDrive="";c.curDevice="";c.tokenLabel="";c.password="";c.pin="";c.mac="";return c}function Y(b,d,c,f,e,g,h,m){if(b)wa(b,d,c,f,e,g,h,m);else{var l=a.loadUI("ssn")({type:null,onConfirm:function(a){wa(a,d,c,f,e,g,h,m);l.dispose()},onCancel:function(){m(k(-1,a.uiUtil().getUserCancelErrCodeNMsg()));l.dispose()}});l.show()}}function wa(b,d,c,f,e,g,h,m){a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_VID_VERIFY_MESSAGE);var l=k();l.certAttrs=e;l.curDevice=g;l.tokenLabel=h;if("undefined"!==typeof d&&"undefined"!==typeof c)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(g))a.nimservice()?a.nimservice().VerifyVID(d,c,b,function(b,d){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0==b?(l.signedData=f,m(l)):(a.ERROR.Code=b,a.ERROR.Message=d,m(k(b,d)))}):(a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER,a.uiUtil().createLoadingBox("hide","us-div-loading-dialog"),m(k(a.ERROR.Code,a.ERROR.Message)));else{a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");try{var n=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[d].signcert),s=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[d].signpri),r=a.usWebToolkit.pkcs8.verifyVID(s,c,b,n);c=b="";r?(l.signedData=f,m(l)):(a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_MSGBOX_VID_ERROR_VERIFICATION,m(k(a.ERROR.Code,a.ERROR.Message)))}catch(q){c=b="",a.ERROR.Code=q.code,a.ERROR.Message=q.message,m(k(q.code,q.message))}c=b=""}}function xa(b){try{var d=a.PFSH.GetP12ForBuToPc(1,b,"binary"),c=d.p12,f=a.certUtil().getCN(d.dn),f=f+".p12";a.fileUtil().save(f,c)}catch(e){alert("failure\nerr code : "+e.code+"\nerr msg : "+e.message)}}function ya(){var b=null,d=null,c=null;try{b=a.PFSH.GetP12ForBuToMo(1,"hex"),d=b.key,c=b.p12}catch(f){d=window.console||{log:function(){}};E&&(d.log("***** GetP12ForBuToMo error *****"),d.log("e.code : ",f.code,"e.message : ",f.message,"e.detail : ",f.detail));alert("failure\nerr code : "+f.code+"\nerr msg : "+f.message);return}try{b="default";"android"===a.osName?"android samsung"===a.browserName||"android lg"===a.browserName||"android browser"===a.browserName?b="default":"android chrome"===a.browserName&&(b="chrome"):"ios"==a.osName&&("ios safari"===a.browserName?b="default":"ios chrome"===a.browserName&&(b="googlechrome"));var e=window.location.href.split(/[?#]/)[0],g=e.lastIndexOf("/"),e=e.substr(0,g+1)+a.ESVS.SRCPath+"unisignweb/rsrc/layout/mobile/w2a/m_exportcertresult.html";UniSignW2A.backupStore(e,b,c,d,"0","recall")}catch(h){alert("failure\ne : "+h)}}function za(b){try{a.CCPFSH().GetP12ForBuToPc(1,b,"base64",function(b,d,e,g){b=a.usWebToolkit.util.decode64(g);d=Array(b.length);for(g=0;g<b.length;g++)d[g]=b.charCodeAt(g);b=new Uint8Array(d);e=a.certUtil().getCN(e);e+=".p12";a.fileUtil().save(e,b)})}catch(d){alert("failure\nerr code : "+d.code+"\nerr msg : "+d.message)}}function Aa(){var b=null,d=null;a.CCPFSH().GetP12ForBuToMo(1,"base64",function(c,f,e,g){if(0==c){b=e;c=a.usWebToolkit.util.decode64(g);d=crosscert.util.bytesToHex(c);try{c="default";"android"===a.osName?"android samsung"===a.browserName||"android lg"===a.browserName||"android browser"===a.browserName?c="default":"android chrome"===a.browserName&&(c="chrome"):"ios"==a.osName&&("ios safari"===a.browserName?c="default":"ios chrome"===a.browserName&&(c="googlechrome"));var h=window.location.href.split(/[?#]/)[0],m=h.lastIndexOf("/"),h=h.substr(0,m+1)+a.ESVS.SRCPath+"unisignweb/rsrc/layout/mobile/w2a/m_exportcertresult.html";UniSignW2A.backupStore(h,c,d,b,"0","recall")}catch(l){alert("failure\ne : "+l)}}else h=window.console||{log:function(){}},E&&(h.log("***** GetP12ForBuToMo error *****"),h.log("rv : ",c,"msg : ",f)),alert("failure\nerr code : "+c+"\nerr msg : "+f)})}function I(b,d,c,f,e){a.SELCERTINFO={index:b,pw:d,curdevice:c,cert:f,certattrs:e}}function da(b,d,c,f,e,g,h,m,l){var n={},s=k();if("undefined"!==typeof f&&"undefined"!==typeof e)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(g))if(a.nimservice()){var r=function(b){if(!b)return"";var c=null;if("SHA1"==d||"sha1"==d)c="1.3.14.3.2.26";else if("MD5"==d||"md5"==d)c="1.2.840.113549.2.5";else if("SHA256"==d||"sha256"==d)c="2.16.840.1.101.3.4.2.1";b=crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.SEQUENCE,!0,[crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.SEQUENCE,!0,[crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.OID,!1,crosscert.asn1.oidToDer(c).getBytes()),crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.NULL,!1,"")]),crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.OCTETSTRING,!1,b)]);return a.usWebToolkit.asn1.toDer(b).getBytes()},q=0,t=[];if(b)for(var u in b){var v=a.usWebToolkit.util.decode64(b[u]),v=r(v),v=a.usWebToolkit.util.encode64(v);t[q]=v;q++}a.nimservice().GetSignDataP7(f,e,1,t,!1,h,function(d,h,q,r,t,u){if(0!=d)a.ERROR.Code=d,a.ERROR.Message=h,a.uiUtil().errMsgBox(h,a.ERROR.Code),l(k(a.ERROR.Code,a.ERROR.Message));else{d=0;if("object"==typeof q)for(var v in b)n[v]=q[d++];else n=q;I(f,e,g,c,a.certUtil().getTheCertAttributes(c,"Base64"));s.jsonSignedData=n;s.b64RValue=r;s.tokenLabel=u;s.certAttrs=a.certUtil().getTheCertAttributes(c,"Base64");l(s)}f=e=cert=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");null!=m&&setTimeout(function(){m.dispose()},10)})}else l(null),null!=m&&setTimeout(function(){m.dispose()},10);else null!=m&&setTimeout(function(){m.dispose()},10);else l(null),null!=m&&setTimeout(function(){m.dispose()},10)}if(B&&ka){var R=B.Mode,A=B.EncAlgo,N=B.HashAlgo,O=B.UniCRS,z=B.DebugConsole,U=B.SecureKeyboardType,ea=B.PKI,ma=B.SRCPath,Z=B.Language,T=B.TargetObj,ba=B.TabIndex,ca=B.Embedded,$=B.LimitNumOfTimesToTryToInputPW,na=B.CMPIP,fa=B.CMPPort,oa=B.CMPURL,pa=B.SHARESTORAGE,V=B.NimCheckURL,D=B.Media,qa=B.Organization,ga=B.Policy,ha=B.ShowExpiredCerts,K=B.LimitMinNewPWLen,L=B.LimitMaxNewPWLen,W=B.LimitNewPWPattern,ra=B.ChangePWByNPKINewPattern,ia=B.CertRequestPageEnable,Ka=B.License,E=!1,G=function(a){!1!=E&&window.console&&window.console.log&&window.console.log(a)},H=null,X="1.0.62.10",sa=null,p={};if(!R||"undefined"===typeof R||1>R||6<R)R=2;p.Mode=R;A&&"undefined"!==typeof A||(A="3des");p.EncAlgo=A;N&&"undefined"!==typeof N||(N="sha256");p.HashAlgo=N;ma||(ma="");p.SRCPath=ma;U?"ahnlab"==U&&(eval(C({eval:!1,intergrity:!1,name:"astx2.min.js",url:"unisignweb/framework/keyboard/astx2.min.js"})),eval(C({eval:!1,intergrity:!1,name:"astx2_custom.js",url:"unisignweb/framework/keyboard/astx2_custom.js"}))):U="";p.SecureKeyboardType=U;p.DebugConsole=z?z:!0;ea||(ea="NPKI");p.PKI=ea;Z=Z?"ko-kr"==Z.toLowerCase()?"ko_kr":"en_us":!navigator.browserLanguage||"ko"!=navigator.browserLanguage.toLowerCase()&&"kr"!=navigator.browserLanguage.toLowerCase()&&"ko-kr"!=navigator.browserLanguage.toLowerCase()?!document.documentElement.lang||"ko"!=document.documentElement.lang.toLowerCase()&&"kr"!=document.documentElement.lang.toLowerCase()&&"ko-kr"!=document.documentElement.lang.toLowerCase()?!navigator.language||"ko"!=navigator.language.toLowerCase()&&"kr"!=navigator.language.toLowerCase()&&"ko-kr"!=navigator.language.toLowerCase()?"en_us":"ko_kr":"ko_kr":"ko_kr";p.Language=Z;V||(V="../install/VestCert_Obj_check.html");p._NimCheckURL=V;if(!1==ca||!ca){var Ca=function(){!T&&document.body&&(T=document.createElement("div"),T.style.width="0px",T.style.height="0px",document.body.insertBefore(T,document.body.firstChild));T?p.TargetObj=T:setTimeout(Ca,500)};setTimeout(Ca,300)}p.TargetObj=T;if(0>ba||!ba)ba=0;p.TabIndex=ba;ca||(ca=!1);p.Embedded=ca;if(0>=$||10<$||!$)$=3;p.LimitNumOfTimesToTryToInputPW=$;na||(na="211.192.169.70");p.CMPIP=na;if(0>fa||!fa)fa=4502;p.CMPPort=fa;oa||(oa="http://ca.crosscert.com:9992/webcmp/");p.CMPURL=oa;pa||(pa="http://testca.crosscert.com/pftest/");p.SHARESTORAGE=pa;D?(D.list=D.list?D.list.toLowerCase():null,D.defaultdevice?(D.defaultdevice=D.defaultdevice.toLowerCase(),null!=D.list&&(D.defaultdevice=0>D.list.indexOf(D.defaultdevice)?D.list.split("|")[0]:D.defaultdevice)):D.defaultdevice=null):D={defaultdevice:null,list:"removable|sectoken|savetoken|mobilephone|harddisk|mobiletoken|webstorage|cloudsign|sharestorage|touchsign|smartsign|websectoken|websofttoken"};if(void 0==D.defaultdevice||null==D.defaultdevice)D.defaultdevice=2==R?"webstorage":"harddisk";p.Media=D;qa||(qa=null);p.Organization=qa;ga||(ga=null);p.Policy=ga;"boolean"!==typeof ha&&(ha=!0);p.ShowExpiredCerts=ha;if("NPKI"===p.PKI){if(10>K||64<K||!K)K=10;p.LimitMinNewPWLen=K;if(10>L||64<L||!L||K>L)L=64;p.LimitMaxNewPWLen=L;W=2}else{if(8>K||64<K||!K)K=8;p.LimitMinNewPWLen=K;if(8>L||64<L||!L||K>L)L=64;p.LimitMaxNewPWLen=L;if(0>W||2<W||!W)W=0}p.LimitNewPWPattern=W;ra||(ra=!1);p.ChangePWByNPKINewPattern=ra;"undefined"===typeof ia&&(ia=1);p.CertRequestPageEnable=ia;p.License=Ka;if(0>O||!O)O="disabled";p.UniCRS=O;window.ESVS=p;var ja=null,M=[],ua=0,A={};A.name=ka.NAME;A.data=ka.DATA;M[ua++]=A;var P=[{eval:!0,intergrity:!0,name:"json2",url:"unisignweb/framework/json2.js"},{eval:!0,intergrity:!0,name:"Blob",url:"unisignweb/framework/Blob.js"},{eval:!1,intergrity:!0,name:"FileSaver",url:"unisignweb/framework/FileSaver.js"},{eval:!1,intergrity:!0,name:"UniSignW2AUtil",url:"unisignweb/framework/UniSignW2AUtil.js"},{eval:!1,intergrity:!0,name:"UniSignW2AExtension",url:"unisignweb/framework/UniSignW2AExtension.js"},{eval:!0,intergrity:!0,name:"draggable",url:"unisignweb/framework/draggable.js"},{eval:!0,intergrity:!0,name:"jsustoolkitErrCode",url:"jsustoolkit/jsustoolkitErrCode.js"},{eval:!0,intergrity:!0,name:"asn1",url:"jsustoolkit/toolkit/asn1.js"},{eval:!0,intergrity:!0,name:"jsbn",url:"jsustoolkit/toolkit/jsbn.js"},{eval:!0,intergrity:!0,name:"oids",url:"jsustoolkit/toolkit/oids.js"},{eval:!0,intergrity:!0,name:"util",url:"jsustoolkit/toolkit/util.js"},{eval:!0,intergrity:!0,name:"unicode",url:"jsustoolkit/toolkit/unicode.js"},{eval:!0,intergrity:!0,name:"aes",url:"jsustoolkit/crypto/aes.js"},{eval:!0,intergrity:!0,name:"des",url:"jsustoolkit/crypto/des.js"},{eval:!0,intergrity:!0,name:"desofb",url:"jsustoolkit/crypto/desofb.js"},{eval:!0,intergrity:!0,name:"seed",url:"jsustoolkit/crypto/seed.js"},{eval:!0,intergrity:!0,name:"rc2",url:"jsustoolkit/crypto/rc2.js"},{eval:!0,intergrity:!0,name:"hmac",url:"jsustoolkit/crypto/hmac.js"},{eval:!0,intergrity:!0,name:"md5",url:"jsustoolkit/crypto/md5.js"},{eval:!0,intergrity:!0,name:"sha1",url:"jsustoolkit/crypto/sha1.js"},{eval:!0,intergrity:!0,name:"sha256",url:"jsustoolkit/crypto/sha256.js"},{eval:!0,intergrity:!0,name:"rsa",url:"jsustoolkit/crypto/rsa.js"},{eval:!0,intergrity:!0,name:"prng",url:"jsustoolkit/crypto/prng.js"},{eval:!0,intergrity:!0,name:"random",url:"jsustoolkit/crypto/random.js"},{eval:!0,intergrity:!0,name:"pki",url:"jsustoolkit/toolkit/pki.js"},{eval:!0,intergrity:!0,name:"pkcs5",url:"jsustoolkit/toolkit/pkcs5.js"},{eval:!0,intergrity:!0,name:"pkcs8",url:"jsustoolkit/toolkit/pkcs8.js"},{eval:!0,intergrity:!0,name:"pkcs7",url:"jsustoolkit/toolkit/pkcs7.js"},{eval:!0,intergrity:!0,name:"pkcs7asn1",url:"jsustoolkit/toolkit/pkcs7asn1.js"},{eval:!0,intergrity:!0,name:"pkcs12",url:"jsustoolkit/toolkit/pkcs12.js"},{eval:!0,intergrity:!0,name:"x509Certificate",url:"jsustoolkit/toolkit/x509Certificate.js"},{eval:!0,intergrity:!0,name:"cmpasn1",url:"jsustoolkit/toolkit/cmpasn1.js"},{eval:!0,intergrity:!0,name:"cmp",url:"jsustoolkit/toolkit/cmp.js"},{eval:!0,intergrity:!0,name:"usWebCMPXMLHttp",url:"jsustoolkit/webcmp/usWebCMPXMLHttp.js"},{eval:!0,intergrity:!0,name:"usWebCMP",url:"jsustoolkit/webcmp/usWebCMP.js"}];"Enabled"===O&&(P.push({eval:!1,intergrity:!0,name:"unicrs_nimservice",url:"unicrsv3/js/unicrs_nimservice.js"}),P.push({eval:!1,intergrity:!0,name:"unicrsv3client",url:"unicrsv3/js/unicrsv3client.js"}),P.push({eval:!1,intergrity:!0,name:"unicrsv3",url:"unicrsv3/js/unicrsv3.js"}));var Da=[{eval:!1,intergrity:!0,name:"npkicacerts",url:"unisignweb/js/storage/ins/npkicacerts.js"},{eval:!1,intergrity:!0,name:"encryptstorage",url:"unisignweb/js/storage/enc/encryptstorage.js"},{eval:!1,intergrity:!0,name:"localstorage",url:"unisignweb/js/storage/ls/localstorage.js"},{eval:!1,intergrity:!0,name:"localstoragehandler",url:"unisignweb/js/storage/ls/localstoragehandler.js"},{eval:!1,intergrity:!0,name:"storagehandler",url:"unisignweb/js/storage/storagehandler.js"},{eval:!1,intergrity:!0,name:"storageerrcode",url:"unisignweb/js/storage/err/storageerrcode.js"}];new function(){for(var a=0;a<P.length;a++)0==a?"object"!==typeof JSON&&C(P[a]):1==a||2==a?document.createElementNS&&(2==a?(eval(C(P[a])),ja=eval("saveAs")):C(P[a])):3==a?(C(P[3]),C(P[4]),a=4):C(P[a]);if(2&p.Mode){for(var d=null,a=0;a<Da.length;a++)d=eval(C(Da[a]));try{sa=new StorageHandler(1,{enc_algo:p.EncAlgo,hash_algo:p.HashAlgo,pki:p.PKI,domain:document.domain,error_code:d})}catch(c){sa=null}}};var F={BSUTIL:function(){}};F.BSUTIL.prototype={isKeyProtected:function(){return"touchen"==a.ESVS.SecureKeyboardType&&a.bsUtil().isTouchEnKeyUsable()||"ahnlab"==a.ESVS.SecureKeyboardType&&a.bsUtil().isAhnlabProtectorUsable()?!0:!1},GetKeyboardType:function(){if("touchen"==a.ESVS.SecureKeyboardType){if("undefined"!=typeof TouchEnNxInit&&!1!=TouchEnNxInit)return a.ESVS.SecureKeyboardType}else if("ahnlab"==a.ESVS.SecureKeyboardType&&!0==a.isSKModule)return a.ESVS.SecureKeyboardType;return""},isTouchEnKeyUsable:function(){return"undefined"==typeof TouchEnNxInit||!1==TouchEnNxInit?!1:!0},ahnlabInit:function(){0<=U.indexOf("ahnlab")&&"undefined"!=typeof $ASTX2&&"undefined"!=typeof $ASTX2.init&&"undefined"!=typeof $ASTX2.initNonE2E&&!1!=a.isSKModule&&$ASTX2.initNonE2E(2189)},isAhnlabProtectorUsable:function(){return 2&a.ESVS.Mode||"undefined"==typeof $ASTX2||"undefined"==typeof $ASTX2.init||"undefined"==typeof $ASTX2.initNonE2E?!1:a.isSKModule},GetAhnlabEncInputInfo:function(a){return{type:3,value:{pageID:$ASTX2.getE2EPageID()+"",inputID:$ASTX2.getE2EInputID(document.getElementById(a))}}},SetSecurityStatus:function(b){b=document.getElementById(b);"touchen"==a.ESVS.SecureKeyboardType&&this.isTouchEnKeyUsable()?b.setAttribute("data-enc","on"):b.setAttribute("data-enc","off")},SetReScan:function(b,d){"touchen"==a.ESVS.SecureKeyboardType&&this.isTouchEnKeyUsable()&&TK_Rescan_HTML(b,d)},TouchEn_Clear:function(b,d){"touchen"==a.ESVS.SecureKeyboardType&&this.isTouchEnKeyUsable()&&TK_Clear(b,d)},GetEncryptPwd:function(b,d,c){null==a.touchEn_pubkey||0>=a.touchEn_pubkey.length?c(""):TK_GetEncCrossCert?TK_GetEncCrossCert(b,d,a.touchEn_pubkey,function(a){a?c({type:8,value:{data:a}}):c("")}):c("")},GetDecryptPwd:function(b,d){var c=GetEncDataFun("-----BEGIN CERTIFICATE-----MIIDZzCCAk+gAwIBAgIBATANBgkqhkiG9w0BAQsFADBKMQswCQYDVQQGEwJLUjESMBAGA1UEChMJQ3Jvc3NDZXJ0MQ4wDAYDVQQLEwVTVExhYjEXMBUGA1UEAxMOQ3Jvc3NDZXJ0V2ViVjMwHhcNMTQwNjI1MDAwMDAwWhcNMjkxMjMxMjM1OTAwWjBKMQswCQYDVQQGEwJLUjESMBAGA1UEChMJQ3Jvc3NDZXJ0MQ4wDAYDVQQLEwVTVExhYjEXMBUGA1UEAxMOQ3Jvc3NDZXJ0V2ViVjMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDIm9p0HiCrpFVSfRVdnC3V4kEC75F8bUWV/Ewa7TmuirbVOYsdtSpz+Yceh+Tindducrf6zGNlhhNpyhFQ6+4/f0qLdwALapojECOUQg/lISRD2FO88hEhBj/rOjZiVzHYyHm8K2bTtBJXNauBBCb1yUKNdHuAvw4xub/jcgZ2PRtWORrQwuStcGBSSnqCIHZcGb5KKdHtY15ppcZoZBXB75kKKdK8qJm/6A/bBW0S+o3ooN+oaGrFFEVH61AHi45sBHGO4e1oyRT8dfIgKUzUQOKSZ1r3Wln4CSqQR8tZOd/T+LzzSB7r4N/rzNo3T4oO5O6lkQBw3NZg25nMXBj7AgMBAAGjWDBWMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFJ7NboZBgBMwRmav8MSGpsMab+NjMA4GA1UdDwEB/wQEAwIGwDAXBgNVHSAEEDAOMAwGCiqDGoyaRAUEAQEwDQYJKoZIhvcNAQELBQADggEBAIU2d1CH6vsZaTAeSCdBM1tKcl/8YpnUSqt3w6DB45E9akGCODgEI1K/KPtRIhrjBBYopQJN9Z3F411xiw2Te0LJQKA9snAtRZCEbL/1FzjyUXKEv5QB9Zgch4KvbqhOdVb1bJsztJH1kV/lbeNbil2TI1NntWbKyPWDKlzdPsGbSAgaFkUtbt7fxcGJBoXAEsaohtNiDM3chfJWv4d0dlDito5isOMIMDN+bfLcBp745T+wEpig6bfbVZnDjzGbXhJJjVvFKydQrZfrLBnVLCpElD1xN1Ipw+6UGJXEuxqXS51drnG9jVU1FL9JDtDE7BNByXV2V9y9b1/6PSeSYMw=-----END CERTIFICATE-----",b,d);if(0>=c.length)return"";var c=a.usWebToolkit.util.decode64(c),f=c.substr(0,256),c=c.substr(256,c.length),e=a.usWebToolkit.pki.privateKeyFromBase64("MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDIm9p0HiCrpFVSfRVdnC3V4kEC75F8bUWV/Ewa7TmuirbVOYsdtSpz+Yceh+Tindducrf6zGNlhhNpyhFQ6+4/f0qLdwALapojECOUQg/lISRD2FO88hEhBj/rOjZiVzHYyHm8K2bTtBJXNauBBCb1yUKNdHuAvw4xub/jcgZ2PRtWORrQwuStcGBSSnqCIHZcGb5KKdHtY15ppcZoZBXB75kKKdK8qJm/6A/bBW0S+o3ooN+oaGrFFEVH61AHi45sBHGO4e1oyRT8dfIgKUzUQOKSZ1r3Wln4CSqQR8tZOd/T+LzzSB7r4N/rzNo3T4oO5O6lkQBw3NZg25nMXBj7AgMBAAECggEATCIZ/geRDpMHbo7aFPS40HtVgO+6nyY5Snq9x1pQkdVDHhkAmv2uZuVESmn4i6irodcXy67V6inAJF3zxGpFuQNuHw/CjJKgfL4bQqDvt12kjbsDzKlxpr7gcz1cdmXxHPy4dpliJOYqL77Gn+gbgRwojdavKGVZ1bVRBdi4axaImRM8khRckQnQbypLuFAIoptbKLo940P/LC3lFmVZDvDW0I4CG/gvTpxdDo58y7jeMngeklJDJ+aKv1Ji6Cqo0eSNhjz1hBm6Go1eob/7JxyZ07Vykr9y718SoHhjGMDlX6zoR1NV0/bYDuwRhddcokvJxGvFKudSNgZI7tVpQQKBgQD/IT8wPbbwyftCZsYdnqCLKhyoxg492ci5aLKfHZNVhOatFlIPKCqvWDVAQPqMIisFk1X7PNajEK8y2SOwy6rhy36fqrAf9WC8yYpUiInf4SdItHoQiCKDq0vmae/Jua4Rwmiut2L4soLyTTXvQ7b51Hv+ZkcuDHqewvGca1YZLQKBgQDJSwEasIPwNbvANIajgsrB6jpegtEn58dpzF0dM9ErEts+xhf2h3VRglbhRm3mroy72Dul+urmUD/9tGNOmF9ON3teVmBzmvB5QZUlDaHtfoHA5MTL35f0Hpt8T7sGzIu97HxLSbD5WuoIPSMO/1yX3m4Vi7oJfgctWfojso8DxwKBgQCS7yLlNaXWp3z9kRMom+L6QxaeXPJ2zKa9oX6+BNqFtjTkGqbH8+ohcju49bNWYZdFbsVmHHPBFirQrh3QBHw17mzOqA8nWLqN/8SbSsedGJ73UHm8a6r1CgJ8gSaIl1eZAs4nUZa+hJDF25HkaqtG1wlSSrVT3/v+02czHt5HQQKBgQC6klKLsmAYHTXQiN7iXzAfXEKNpyLFogcrAMitcIHHMssT+/fqANO0oOJ2GxlyXwcCdQGUbmWa43bsaG5DQufTT4mBfv4XKN0LBsZ+eYxE3KTXbTMa5DurgVMMfboUKzK67p6mCb+G38VbrY75L6da/Ed8oO3mLnHojyVSQQZdsQKBgAar8TGlK5fe+TKFa81jR5n8pD9rVHpLoagsjK3ueA7tnRHwXHxVTItGU/S9HyZxPuA1EA9VVSol73a924Q569sFd/sd9rJCF5Z3EUmM3IXKpfEhA5E5lJ9ZkqjjWVgNiu2cJG4MDdAB3FSJ0tB+WjAHUrXWkQrF7D+Av0XUP0uB").decrypt(f);if(32>e.length)return"";f=e.substr(0,16);e=e.substr(16,e.length);f=a.usWebToolkit.cipher.algorithms.seed.startDecrypting(f,e);f.update(a.usWebToolkit.util.createBuffer(c));f.finish();return f.output.getBytes()}};F.UI=function(){this._errormsglang=eval(eval(function(){return C({eval:!1,intergrity:!1,name:"errormsg_"+p.Language,url:"unisignweb/rsrc/lang/errormsg_"+p.Language+".js"})})())};F.UI.prototype={isValidDevice:function(b){for(var d in a.CONST.medias)if(a.CONST.medias[d].device===b)return!0;return!1},getMediaName:function(b){var d="",c;for(c in a.CONST.medias)if(a.CONST.medias[c].device===b){d=a.CONST.medias[c].name;break}return d},getMediaDevice:function(b){var d=-1,c;for(c in a.CONST.medias)if(a.CONST.medias[c].name===b){d=a.CONST.medias[c].device;break}return d},isItPortableDevice:function(){return"android"===a.osName||"ios"===a.osName?!0:!1},isItLGAndroidBrowser:function(){return"android lg"===a.browserName?!0:!1},isItSamsungAndroidBrowser:function(){return"android samsung"===a.browserName?!0:!1},isItSupportingPFCertBackUp:function(){if(!(2&a.ESVS.Mode))return!1;if(this.isItPortableDevice())return"android samsung"===a.browserName||"android lg"===a.browserName||"android browser"===a.browserName||"android chrome"===a.browserName||"ios safari"===a.browserName||"ios chrome"===a.browserName?!0:!1;if("chrome"===a.browserName)return!0;if("msie"===a.browserName){if(10<=parseInt(a.browserVersion))return!0}else{if("firefox"===a.browserName)return parseInt(a.browserVersion),!0;if("safari"===a.browserName){if(6.1<=parseFloat(a.browserVersion))return!0}else if("opera"===a.browserName)return parseInt(a.browserVersion),!0}return!1},isItPFDevice:function(b){switch(b){case a.CONST.__PF_M_SS.device:case a.CONST.__PF_M_LS.device:case a.CONST.__PF_M_TOUCHSIGN.device:case a.CONST.__PF_M_SMARTSIGN.device:case a.CONST.__PF_M_WEBSECTOKEN.device:case a.CONST.__PF_M_WEBSOFTTOKEN.device:case a.CONST.__PF_M_CLOUDSIGN.device:return!0}return!1},isItSupportingThisStorage:function(b){if(!b)return!1;var d=!1;if(1===(255&a.ESVS.Mode)||4===a.ESVS.Mode)switch(b.device){case a.CONST.__USFB_M_DISK.device:case a.CONST.__USFB_M_HSMKEY.device:case a.CONST.__USFB_M_SMARTCARD.device:case a.CONST.__USFB_M_MOBILE.device:case a.CONST.__USFB_M_HDD.device:case a.CONST.__USFB_M_MOBILETOKEN.device:d=this.isItPortableDevice()?!1:!0;break;default:d=!1}else if(2===(255&a.ESVS.Mode))switch(b.device){case a.CONST.__PF_M_SS.device:case a.CONST.__PF_M_LS.device:case a.CONST.__PF_M_CLOUDSIGN.device:d=!0;break;case a.CONST.__PF_M_TOUCHSIGN.device:case a.CONST.__PF_M_SMARTSIGN.device:case a.CONST.__PF_M_WEBSECTOKEN.device:case a.CONST.__PF_M_WEBSOFTTOKEN.device:d=this.isItPortableDevice()?!1:!0;break;default:d=!1}else if(3===(255&a.ESVS.Mode)||6===(255&a.ESVS.Mode))switch(b.device){case a.CONST.__USFB_M_DISK.device:case a.CONST.__USFB_M_HSMKEY.device:case a.CONST.__USFB_M_SMARTCARD.device:case a.CONST.__USFB_M_MOBILE.device:case a.CONST.__USFB_M_HDD.device:case a.CONST.__USFB_M_MOBILETOKEN.device:d=this.isItPortableDevice()?!1:!0;break;case a.CONST.__PF_M_LS.device:case a.CONST.__PF_M_SS.device:case a.CONST.__PF_M_CLOUDSIGN.device:d=!0;break;case a.CONST.__PF_M_TOUCHSIGN.device:case a.CONST.__PF_M_SMARTSIGN.device:case a.CONST.__PF_M_WEBSECTOKEN.device:case a.CONST.__PF_M_WEBSOFTTOKEN.device:d=this.isItPortableDevice()?!1:!0;break;default:d=!1}return d},getScrollTop:function(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop},getScrollLeft:function(){return self.pageXOffset?self.pageXOffset:document.documentElement&&document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft},getViewportHeight:function(){return window.undefined!=window.innerHeight?window.innerHeight:"CSS1Compat"==document.compatMode?document.documentElement.clientHeight:document.body?document.body.clientHeight:window.undefined},getViewportWidth:function(){return window.undefined!=window.innerWidth?window.innerWidth:"CSS1Compat"==document.compatMode?document.documentElement.clientWidth:document.body?document.body.clientWidth:window.undefined},getStyle:function(a,d,c){if(!a||!d||!c)return null;var f=null;return f=a.currentStyle?a.currentStyle[d]:window.getComputedStyle?window.getComputedStyle(a,"").getPropertyValue(c):null},getNumSize:function(a){if(!a)return-1;a=a.toLowerCase();var d="";if(-1<a.indexOf("px"))d=a.substring(0,a.indexOf("px"));else return-1;return parseInt(d)},getOverlay:function(a){if(0>a||!a)return null;var d=document.createElement("div");d.style.zIndex=a;d.style.backgroundImage="none";d.style.margin="0px";d.style.cursor="auto";d.style.display="none";d.onclick=null;d.style.position="fixed";d.style.width="100%";d.style.height="100%";d.style.top="0";d.style.left="0";d.style.filter="alpha(opacity=50)";d.style.backgroundColor="#000";d.style.opacity="0.5";return d},isLoadingBox:function(a){a=document.getElementById(a);return null!=a&&"none"!=a.style.display?!0:!1},loadingBox:function(b,d,c){if(null==d||""==d)d="us-div-list-load";d=document.getElementById(d);if(null!=d){document.getElementById("us-cert-processing-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/processing-img.gif",0);null==c&&(c=0);var f=document.getElementById("us-cert-processing-text");f.innerHTML="";f.appendChild(document.createTextNode(this._errormsglang.IDS_CERT_LOADING_MSG[c]));d.style.display=b?"":"none"}},createLoadingBox:function(b,d,c){if(null==d||""==d)d="us-div-loading-dialog";null==document.getElementById(d)?"hide"!=b&&(a.ESVS.TargetObj.innerHTML='<div id="us-div-loading-dialog" class="us-layout-loading-o"></div><div class="us-layout-loading"><span class="us-layout-cert-processing-img"><img id="us-div-loading-dialog-img" class="us-layout-cert-processing-img"></span><span id="us-div-loading-dialog-text" class="us-layout-cert-processing-text"></span></div>',document.getElementById("us-div-loading-dialog-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/processing-img.gif",0),b=document.getElementById("us-div-loading-dialog-text"),b.innerHTML="",b.appendChild(document.createTextNode(c))):"change"==b?(b=document.getElementById("us-div-loading-dialog-text"),b.innerHTML="",b.appendChild(c)):a.ESVS.TargetObj.innerHTML=""},addCapsLockEvent:function(a,d,c,f){a=document.getElementById(a);var e=document.getElementById(d);if(!e||!a)return null;document.getElementById(d+"-text").appendChild(document.createTextNode(c));var g=function(){e&&(e.style.display="block")},h=!1,m=!1;a.onkeyup=function(a){a=a||event;a.which&&16==a.which&&(h=!1)};a.onkeydown=function(a){a=a||event;var b=0;a.which&&16==a.which&&(h=!0);window.event?b=a.keyCode:a.which&&(b=a.which);b&&20==b?m?(m=!1,e&&(e.style.display="none")):(m=!0,g()):b&&13==b&&f&&f(a?a:event)};a.onkeypress=function(a){a=a||event;var b=0,d=!1;window.event?(b=a.keyCode,d=a.shiftKey):a.which&&(b=a.which,d=h);65<=b&&90>=b&&!d?(m=!0,g()):97<=b&&122>=b&&d?(m=!0,g()):(m=!1,e&&(e.style.display="none"))};try{-1!=navigator.appVersion.toLowerCase().indexOf("win")&&(document.msCapsLockWarningOff=!0)}catch(l){}},offsetResize:function(a,d){if(a){var c=this.getViewportHeight()/2-a.offsetHeight/2,f=this.getViewportWidth()/2-a.offsetWidth/2;0>c&&(c=0);0>f&&(f=0);a.style.position="fixed";!d||"center"!=d&&"center"!=d.split(",")[0]?d&&"center"!=d?(a.style.top=d.split(",")[0]+"px","center"==d.split(",")[1]?a.style.left=f+"px":a.style.left=d.split(",")[1]+"px"):(a.style.top="30px",a.style.left=f+"px"):(a.style.top=c+"px",a.style.left=f+"px")}},setCookie:function(a){localStorage.setItem("cookie",JSON.stringify(a))},getCookie:function(){var a=localStorage.getItem("cookie");return a?JSON.parse(a):null},setFirstFocus:function(a){a&&("string"==typeof a&&(a=document.getElementById(a)),a&&(a.focus(),setTimeout(function(){a.focus()},10)))},setRotationTabFocus:function(a,d,c){function f(a){return"string"==typeof a?document.getElementById(a):a}a&&d&&c&&(a=f(a),d=f(d),c=f(c),a.onkeydown=function(e){var g=e||window.event;9==(g.which||g.keyCode)&&(a.onblur=function(){setTimeout(function(){(g.shiftKey?d:c).focus()},10)})})},msgBox:function(a){a&&alert(a)},flagAlert:function(a){a&&!1!=H&&alert(a)},errMsgBox:function(a,d){a&&alert(a+"\n\nError Code [ "+d+" ]")},getErrorMessageLang:function(){return this._errormsglang},getUserCancelErrCodeNMsg:function(){11003!=a.ERROR.Code&&210020!=a.ERROR.Code&&(a.ERROR.Code=999,a.ERROR.Message=this._errormsglang.IDS_ERROR_USER_CANCEL)},CheckPwdPattern:function(b){var d=!0;a.ESVS.LimitMinNewPWLen>b.length&&(d=!1);if("NPKI"===a.ESVS.PKI||2===a.ESVS.LimitNewPWPattern){var c=/^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[^a-zA-Z0-9])/g;c.exec(b)||(d=!1)}else 1===a.ESVS.LimitNewPWPattern&&(c=/^(?=.*[a-zA-Z])(?=.*[0-9])/g,c.exec(b)||(d=!1));if("NPKI"===a.ESVS.PKI&&(c=/['"\\|]/g,c.exec(b)&&(d=!1),2<b.length)){for(c=0;c<b.length-2;c++)if(b.charAt(c)===b.charAt(c+1)&&b.charAt(c)===b.charAt(c+2)){d=!1;break}for(c=0;c<b.length-2;c++)if(b.charCodeAt(c)===b.charCodeAt(c+1)-1&&b.charCodeAt(c)===b.charCodeAt(c+2)-2){d=!1;break}}return d}};F.CERT=function(){var a=eval(eval(function(){return C({intergrity:!1,name:"errormsg_"+p.Language,url:"unisignweb/rsrc/lang/certlist_"+p.Language+".js"})})());this._certOidNameTable={};this._certOidNameTable["1.2.410.200004.5.1.1.5"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.1.1.7"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.2.1.1"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.2.1.2"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.3.1.1"]=a.IDS_AGENCY_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.3.1.2"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.3.1.9"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.4.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.4.1.2"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.4.1.3"]=a.IDS_SERVER_CERTIFICATE;this._certOidNameTable["1.2.410.200004.5.5.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.5.1.2"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200005.1.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200005.1.1.5"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200012.1.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200012.1.1.3"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.2.1.7.1"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.2.1.7.2"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.2.1.7.3"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200004.5.1.1.9"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.1.1.9.2"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200005.1.1.4"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200005.1.1.6.2"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200004.5.4.1.101"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.4.1.102"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.4.1.103"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200004.5.4.1.104"]=a.IDS_PERSON_ELECTRONIC_CIVIL_APPEAL;this._certOidNameTable["1.2.410.200012.1.1.101"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200012.1.1.103"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200012.1.1.105"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.1.1.1.1.1.1.1.1.1"]=a.IDS_VERISIGN;this._certOidNameTable.restriction=a.IDS_RESTRICTION;this._certCAOidTable={};this._certCAOidTable.crosscert="1.2.410.200004.5.4";this._certCAOidTable.yessign="1.2.410.200005.1.1";this._certCAOidTable.koscom="1.2.410.200004.5.1";this._certCAOidTable.ktnet="1.2.410.200012.1.1";this._certCAOidTable.kica="1.2.410.200004.5.2";this._certCAOidTable.inipass="1.2.410.200004.5.5";this._certCAOidTable.verisign="1.1.1.1.1.1";this._certCANameTable={};this._certCANameTable.crosscert=a.IDS_CA_CROSSCERT;this._certCANameTable.yessign=a.IDS_CA_YESSIGN;this._certCANameTable.koscom=a.IDS_CA_KOSCOM;this._certCANameTable.ktnet=a.IDS_CA_KTNET;this._certCANameTable.kica=a.IDS_CA_KICA;this._certCANameTable.verisign=a.IDS_VERISIGN;this._certCANameTable.inipass=a.IDS_CA_INIPASS;this._certValidState={};this._certValidState.valid=a.IDS_CERT_STATE_VALID;this._certValidState.invalid=a.IDS_CERT_STATE_INVALID;this._certValidState.notice1=a.IDS_CERT_STATE_NOTICE_1;this._certValidState.notice2=a.IDS_CERT_STATE_NOTICE_2;this.certDNAttribute=[];this.certDNAttribute[0]="cn";this.certDNAttribute[1]="c";this.certDNAttribute[2]="l";this.certDNAttribute[3]="s";this.certDNAttribute[4]="st";this.certDNAttribute[5]="street";this.certDNAttribute[6]="o";this.certDNAttribute[7]="ou";this.certDNAttribute[8]="dnqualifier";this.certDNAttribute[9]="dc";this.certDNAttribute[10]="serialnumber";this.certDNAttribute[11]="e"};F.CERT.prototype={getCN:function(a){if(!a)return"undefined";var d=null,c=a.replace(/(^\s*)|(\s*$)/gi,"").split("="),f=c.length,e=[],g=0;if(1<f){for(var h=0;h<f;h++)if(-1!=c[h].indexOf(","))for(var m=c[h].split(","),l=m.length,n=0;n<l;n++)e[g++]=m[n];else e[g++]=c[h];for(c=0;c<g;c++)if(this.certDNAttribute[0]==e[c].toLowerCase()){d=e[++c];break}if(g<=c+1)return null===d?this.getOU(a):d;a=this.certDNAttribute.length;do{++c;for(n=1;n<a;n++)if(this.certDNAttribute[n]==e[c].toLowerCase())return d;d=d+", "+e[c]}while(c<g)}return"undefined"},getO:function(a){if(!a)return"undefined";var d=null,c=a.replace(/\s/g,"").replace(/(^\s*)|(\s*$)/gi,"").split("="),f=c.length;a=[];var e=0;if(1<f){for(var g=0;g<f;g++)if(-1!=c[g].indexOf(","))for(var h=c[g].split(","),m=h.length,l=0;l<m;l++)a[e++]=h[l];else a[e++]=c[g];for(c=0;c<e;c++)if(this.certDNAttribute[6]==a[c].toLowerCase()){d=a[++c];break}if(e<=c+1)return null===d?"undefined":d;f=this.certDNAttribute.length;do{++c;for(l=0;l<f;l++)if(this.certDNAttribute[l]==a[c].toLowerCase())return d;d=d+", "+a[c]}while(c<e)}return"undefined"},getOU:function(a){if(!a)return"undefined";var d=null,c=a.replace(/(^\s*)|(\s*$)/gi,"").split("="),f=c.length;a=[];var e=0;if(1<f){for(var g=0;g<f;g++)if(-1!=c[g].indexOf(","))for(var h=c[g].split(","),m=h.length,l=0;l<m;l++)a[e++]=h[l];else a[e++]=c[g];for(c=0;c<e;c++)if(this.certDNAttribute[7]==a[c].toLowerCase()){d=a[++c];break}if(e<=c+1)return null===d?"undefined":d;f=this.certDNAttribute.length;do{++c;for(l=0;l<f;l++)if(this.certDNAttribute[l]==a[c].toLowerCase())return d;d=d+", "+a[c]}while(c<e)}return"undefined"},getLocalDate:function(a){if(!a)return"undefined";var d=new Date(a);a=d.getFullYear();var c=d.getMonth()+1,d=d.getDate();10>c&&(c="0"+c);10>d&&(d="0"+d);return a+"-"+c+"-"+d},getLocalDateNTime:function(a){if(!a)return"undefined";var d=new Date(a);a=d.getFullYear();var c=d.getMonth()+1,f=d.getDate(),e=d.getHours(),g=d.getMinutes(),d=d.getSeconds();10>c&&(c="0"+c);10>f&&(f="0"+f);10>e&&(e="0"+e);10>g&&(g="0"+g);10>d&&(d="0"+d);return a+"-"+c+"-"+f+" "+e+":"+g+":"+d},getCertType:function(a){if(!a)return"undefined";a=this._certOidNameTable[a];return null==a||""==a?this._certOidNameTable.restriction:a},getIssuerName:function(a){if(!a)return"undefined";var d=null;return d=-1!=a.indexOf(this._certCAOidTable.crosscert)?this._certCANameTable.crosscert:-1!=a.indexOf(this._certCAOidTable.yessign)?this._certCANameTable.yessign:-1!=a.indexOf(this._certCAOidTable.koscom)?this._certCANameTable.koscom:-1!=a.indexOf(this._certCAOidTable.ktnet)?this._certCANameTable.ktnet:-1!=a.indexOf(this._certCAOidTable.kica)?this._certCANameTable.kica:-1!=a.indexOf(this._certCAOidTable.verisign)?this._certCANameTable.verisign:-1!=a.indexOf(this._certCAOidTable.inipass)?this._certCANameTable.inipass:"undefined"},getIssuerEnName:function(a){if(!a)return"undefined";var d=null;return d=-1!=a.indexOf(this._certCAOidTable.crosscert)?"crosscert":-1!=a.indexOf(this._certCAOidTable.yessign)?"yessign":-1!=a.indexOf(this._certCAOidTable.koscom)?"koscom":-1!=a.indexOf(this._certCAOidTable.ktnet)?"ktnet":-1!=a.indexOf(this._certCAOidTable.kica)?"kica":-1!=a.indexOf(this._certCAOidTable.verisign)?"verisign":-1!=a.indexOf(this._certCAOidTable.inipass)?"inipass":"undefined"},getExpirationState:function(a){if(!a)return"undefined";a=new Date(a);var d=(new Date).getTime();a=a.getTime()-d;return 0<a?2592E6<=a?this._certValidState.valid:this._certValidState.notice1+parseInt(a/1E3/60/60/24)+this._certValidState.notice2:this._certValidState.invalid},getExpirationStateValue:function(a){if(!a)return-1;a=new Date(a);var d=(new Date).getTime();a=a.getTime()-d;return 0<a?2592E6<=a?0:1:2},getTheCertAttributes:function(b,d){if(!b||!d)return{};a.usWebToolkit.x509Certificate.parser(b,d);var c=null;try{c=a.usWebToolkit.x509Certificate.getVersion()}catch(f){}var e=null;try{e=a.usWebToolkit.x509Certificate.getSerialNumber()}catch(g){}var h=null;try{h=a.usWebToolkit.x509Certificate.getSignAlgo()}catch(m){}var l=null;try{l=a.usWebToolkit.x509Certificate.getIssuerName()}catch(n){}var k=null;try{k=a.usWebToolkit.x509Certificate.getNotBefore()}catch(r){}var q=null;try{q=a.usWebToolkit.x509Certificate.getNotAfter()}catch(t){}var u=null;try{u=a.usWebToolkit.x509Certificate.getSubjectName()}catch(v){}var y=null;try{y=a.usWebToolkit.x509Certificate.getPublickey()}catch(w){}var Q=null;try{Q=a.usWebToolkit.x509Certificate.getAuthorityKeyIndentifier()}catch(la){}var p=null;try{p=a.usWebToolkit.x509Certificate.getSubjectKeyIdentifier()}catch(S){}var Ba=null;try{Ba=a.usWebToolkit.x509Certificate.getKeyUsage()}catch(Na){}var Ea=null;try{Ea=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid()}catch(Oa){}var x=null;try{x=a.usWebToolkit.x509Certificate.getSubjectAltName()}catch(A){}var z=null;try{z=a.usWebToolkit.x509Certificate.getAuthorityInfoAccess()}catch(B){}var C=null;try{C=a.usWebToolkit.x509Certificate.getcRLDistributionPoints()}catch(F){}var D=null;try{D=a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS()}catch(G){}var E=null;try{E=a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice()}catch(I){}var H=null;try{H=a.usWebToolkit.x509Certificate.getSignature()}catch(J){}return{version:c,serialNumber:e,signAlgo:h,issuerName:l,validateFrom:k,validateTo:q,subjectName:u,publicKey:y,authorityKeyIndentifier:Q,subjectKeyIndentifier:p,keyUsage:Ba,policiesOid:Ea,subjectAltName:x,authorityInfoAccess:z,crlDistributionPoints:C,policiesCps:D,policiesUserNotice:E,signature:H}}};F.FORGERY=function(){this._lang=eval(eval(function(){"undefined"==typeof p.Language&&(p=window.ESVS);return C({eval:!1,intergrity:!1,name:"forgery_"+p.Language,url:"unisignweb/rsrc/lang/forgery_"+p.Language+".js"})})());this._md=a.usWebToolkit.md.algorithms.sha256.create();this._integrityList=[];var b=C({eval:!1,intergrity:!1,name:"unisign",url:"unisignweb/integrity/unisign.js"}),d=null;if(!(1&a.ESVS.Mode)){var c=window.console||{log:function(){}};null!=b||11<b.length?a.logger(" >>>> SignData : ["+b.length+"] "+b.substring(0,10)+"..."+b.substring(b.length-10,b.length)):a.logger(" >>>> SignData ERROR : "+b);var f=null,e,g;try{e=b,f=a.usWebToolkit.pkcs7.messageFromBase64(b),g=b,f.verify()}catch(h){a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : "+h.code);H=!1;a.logger(H+" >> signdata :: ("+(e==g)+") "+this._lang.IDS_MSGBOX_ERROR_VERIFY_SIGNED_DATA_OF_MD_TABLE+"\nerror code : "+h.code+"\nerror msg : "+h.message+"\na:"+e+"\nb:"+g);E&&c.log("error code : ",h.code,"\nerror msg : ",h.message);return}G("verify result : "+f.verifyResult);if(!0==f.verifyResult)a.intergrity.data=f.content;else if(-1<navigator.userAgent.indexOf("compatible"))a.nimservice()?a.nimservice().VerifySignedData(null,b,function(b,d){0!=b?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1368"),H=!1):a.intergrity.data=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(d))}):(a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1509"),H=!1);else{a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1513");H=!1;a.logger(">> verifyResult :: "+this._lang.IDS_MSGBOX_ERROR_VERIFY_SIGNED_DATA_OF_MD_TABLE);return}try{d=a.usWebToolkit.pki.certificateToBase64(f.certificates[0])}catch(m){a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : "+m.code);H=!1;a.logger(">> certificate error :: "+this._lang.IDS_MSGBOX_ERROR_GET_THE_CERT_FROM_SIGNED_DATA);E&&c.log("error code : ",m.code,"\nerror msg : ",m.message);return}}a.usWebToolkit.x509Certificate.parser(d,"Base64");ta();b=a.usWebToolkit.x509Certificate.getSubjectName();if(!b||0>=b.length||"cn=crosscertwebv3,ou=stlab,o=crosscert,c=kr"!==b.toLowerCase())a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1401"),H=!1,a.logger(">> get dn : "+this._lang.IDS_MSGBOX_ERROR_VERIFY_THE_CERT);else if(b=a.usWebToolkit.x509Certificate.getSubjectKeyIdentifier(),!b||0>=b.length||"9ecd6e86418013304666aff0c486a6c31a6fe363"!==b)a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1411"),H=!1,a.logger(">> get ski : "+this._lang.IDS_MSGBOX_ERROR_VERIFY_THE_CERT)};F.FORGERY.prototype={verify:function(b,d){ta();var c=a.intergrity.getList();if(!c||0>=c.length)return null;if(!b||!d)return this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE;var f=null;this._md.start();this._md.update(d);for(var f=this._md.digest().toHex(),e=0;e<c.length;e++)if(c[e].name==b){if(c[e].data==f)return"success";var g=window.console||{log:function(){}};a.logger("*** Suspicion Forgery ***\nintergrity file name : "+c[e].name+"\nintergrity file md data : "+c[e].data+"\ndownloaded file name : "+b+"\ndownloaded file md data : "+f+"\n"+this._lang.IDS_MSGBOX_WARNING_SUSPICION_FORGERY);E&&(g.log("*** Suspicion Forgery ***"),g.log("intergrity file name : ",c[e].name,"\nintergrity file md data : ",c[e].data),g.log("downloaded file name : ",b,"\ndownloaded file md data : ",f));break}return this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE}};CheckIntergrity=function(){ta();var b=null,d=null;G("==================================== CheckIntergrity START");for(var c=0;c<M.length;c++)if(b=M[c].name,d=M[c].data,rstr=a.forgeryUtil().verify(b,d),"success"===rstr)M[c].name=null,M[c].data=null,M[c]=null;else if(rstr){M[c].name=null;M[c].data=null;M[c]=null;a.uiUtil().flagAlert(rstr);H=!1;break}else return!1;return!0};F.FILE=function(){};F.FILE.prototype={save:function(a,d){if(a&&!(0>=a.length)&&d){var c=new Blob([d],{type:"application/octet-stream"});ja(c,a)}}};var x=O=null,J=0,A=null,N=navigator.platform,z=navigator.userAgent,O=0<=N.indexOf("Win")?"win":0<=N.indexOf("Mac")?"mac":0<=N.indexOf("Linux")?"linux":0<=N.indexOf("iPhone")||0<=N.indexOf("iPad")||0<=N.indexOf("iPod")?"ios":"unknown";0<=z.indexOf("Android")&&(O="android");"android"===O?0<=z.indexOf("SAMSUNG")?(x="android samsung",A=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("OPR")?(x="android opera",A=/OPR\/([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("Opera")?(x="android opera classic",A=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("Firefox")?(x="android firefox",A=/Firefox\/([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("NAVER")?x="android naver":0<=z.indexOf("DaumApps")?(x="android daum",A=/DaumApps\/([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("nate_app")?x="android nate":0<=z.indexOf("UCBrowser")?(x="android uc",A=/UCBrowser\/([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("Chrome")?0<=z.indexOf("Version")?(x=0<=z.indexOf("LG")?"android lg":"android browser",A=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("LG")?((A=/Chrome\/([0-9]{1,}[.0-9]{0,})/)&&A.exec(z)&&(J=parseFloat(RegExp.$1)),x=39>J?"android lg":"android chrome"):(x="android chrome",A=/Chrome\/([0-9]{1,}[.0-9]{0,})/):(x="unknown",J=0):"ios"===O?0<=z.indexOf("CriOS")?(x="ios chrome",A=/CriOS\/([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("NAVER")?x="ios naver":0<=z.indexOf("DaumApps")?(x="ios daum",A=/DaumApps\/([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("Coast")?(x="ios opera coast",A=/Coast\/([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("Safari")?(x="ios safari",A=/Version\/([0-9]{1,}[.0-9]{0,})/):(x="unknown",J=0):0<=z.indexOf("MSIE")?(x="msie","BackCompat"==document.compatMode?J=5:document.documentMode?J=document.documentMode:A=/MSIE ([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("Chrome")?(x="chrome",A=/Chrome\/([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("Firefox")?(x="firefox",A=/Firefox\/([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("Safari")?(x="safari",A=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("Opera")?(x="opera",A=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=z.indexOf("rv:11.")?(x="msie",A=/rv:([0-9]{1,}[.0-9]{0,})/):(x="unknown",J=0);A&&A.exec(z)&&(J=parseFloat(RegExp.$1));var ta=function(){return"msie"==x?10>J:"chrome"==x?10>J:"firefox"==x?10>J:"safari"==x?6.1>J:"opera"==x?15>J:!0},aa=window.console||{log:function(){}};E&&(aa.log("UI ver : ",X,"\nplatform : ",N,"\nuseragent : ",z),aa.log("OS name : ",O,"\nbrowser name : ",x,"\nbrowser version : ",J));var a={ver:X,nimVersion:"2.5.10.0",osName:O,browserName:x,browserVersion:J,usWebToolkit:window.crosscert,isAvailable:function(){return E?!0:null==H?!1:H},isSKModule:null,touchEn_pubkey:null,intergrity:{data:null,list:null,getList:function(){null==this.list&&(this.list=this.parser(this.data));return this.list},parser:function(a){"string"!==typeof a&&(a=new String(a));var d=[];a=a.split(/\r\n|\r|\n/g);for(var c=0;c<a.length;c++){var f=a[c].split("|"),e={};e.name=f[0];e.data=f[1];d[c]=e}return d}},logger:function(a){},trace:G,nimCheckUrl:V,plugin:function(){return document.getElementById("unisignwebplugin")},nimservice:function(){return La},options:{img_src:null},ubiKeyEnv:{version:"1,3,0,7",siteInfo:"CROSSCERT|http://www.ubikey.co.kr/infovine/download.html",securityInfo:"CROSSCERT|NULL",downloadURL:"http://www.ubikey.co.kr/infovine/download.html"},usimEnv:{sitecode:"303010001",modecode:"0003",siteURL:document.location.hostname,serviceIP:"service.smartcert.kr",servicePort:"443",downloadURL:"http://download.smartcert.kr"},xmlNormalizer:{using:!1,installcheck:!1,name:"Q0NYbWxOb3JtYWxpemVyLmRsbA==",version:"1.0.0.0"},uiUtil:function(){return __UIUtil},certUtil:function(){return __CertUtil},forgeryUtil:function(){return __ForgeryUtil},fileUtil:function(){return __FileUtil},bsUtil:function(){return __BSUtil},uiLayerLevel:1E4,certsList:null,reInitialize:Ha,loadUI:Ia,currentObject:null,CCPFSH:function(){return Ma},ESVS:p,STATUS:{HadCheckedLicense:!1},PFSH:sa,PFUC:null,ERROR:{Code:0,Message:null},CONST:{__USFB_M_DISK:{device:1,name:"removable"},__USFB_M_HSMKEY:{device:2,name:"sectoken"},__USFB_M_SMARTCARD:{device:3,name:"savetoken"},__USFB_M_MOBILE:{device:4,name:"mobilephone"},__USFB_M_HDD:{device:5,name:"harddisk"},__USFB_M_MOBILETOKEN:{device:6,name:"mobiletoken"},__USFB_M_ETC:{device:9,name:"USFB_M_ETC"},__PF_M_LS:{device:11,name:"webstorage"},__PF_M_SS:{device:21,name:"sharestorage"},__PF_M_TOUCHSIGN:{device:12,name:"touchsign"},__PF_M_SMARTSIGN:{device:13,name:"smartsign"},__PF_M_WEBSECTOKEN:{device:14,name:"websectoken"},__PF_M_WEBSOFTTOKEN:{device:15,name:"websofttoken"},__PF_M_CLOUDSIGN:{device:16,name:"cloudsign"},__PF_M_ETC:{device:19,name:"PF_M_ETC"},medias:{}},SELCERTINFO:{index:0,pw:null,curdevice:5,cert:null,certattrs:null}};__UIUtil=new F.UI;__CertUtil=new F.CERT;__ForgeryUtil=new F.FORGERY;__FileUtil=new F.FILE;__BSUtil=new F.BSUTIL;"ahnlab"==a.ESVS.SecureKeyboardType?(a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_KS_INSTALL_CHECK),$ASTX2.init(function(){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");a.isSKModule=!0},function(){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");a.isSKModule=!1;$ASTX2.getLastError()})):"touchen"==a.ESVS.SecureKeyboardType&&va();var La=Fa(a),Ma=Ga(a);a.CONST.medias={removable:a.CONST.__USFB_M_DISK,sectoken:a.CONST.__USFB_M_HSMKEY,savetoken:a.CONST.__USFB_M_SMARTCARD,mobilephone:a.CONST.__USFB_M_MOBILE,harddisk:a.CONST.__USFB_M_HDD,mobiletoken:a.CONST.__USFB_M_MOBILETOKEN,sharestorage:a.CONST.__PF_M_SS,webstorage:a.CONST.__PF_M_LS,touchsign:a.CONST.__PF_M_TOUCHSIGN,smartsign:a.CONST.__PF_M_SMARTSIGN,websectoken:a.CONST.__PF_M_WEBSECTOKEN,websofttoken:a.CONST.__PF_M_WEBSOFTTOKEN,cloudsign:a.CONST.__PF_M_CLOUDSIGN};VerifyPFLicense=function(){return!0};if(VerifyPFLicense())return V=function(){CheckIntergrity()?(M=null,!1==E&&null==H&&(H=!0)):G("## It couldnt check intergrity of files.")},null!=a.intergrity.data?V():setTimeout(V,1E3),E&&aa.log("Is this Browser supporting plugin free cert backup? ",a.uiUtil().isItSupportingPFCertBackUp()),!0==p.DebugConsole&&(document.onkeydown=function(a){a=a||window.event;var d=a.keyCode;try{123==d&&(+"\v1"?a.preventDefault():a.keyCode=a.returnValue=0)}catch(c){}}),{Available:function(){return a.isAvailable()},IsValidity:function(){return!1==a.isAvailable()?(a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE),!1):a.nimservice()?!0:!1},GetLastError:function(b){!1==a.isAvailable()?a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE):(b(a.ERROR.Code,a.ERROR.Message),a.ERROR.Code=0,a.ERROR.Message=null)},SetEmbeddedUI:function(b){!1==a.isAvailable()?a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE):a.ESVS.Embedded=b?!0:!1},SignDataP1:function(b,d,c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||!c||document.getElementById("us-div-cert-select"))return!1;var f=k(),e=function(a){1==c.length?c(a):(null==a&&(a=k()),c(a.signedData,a.theCert,a.theDN))};a.reInitialize();var g=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:d},onConfirm:function(d,c,l,n,s,r,q){f.theCert=d;f.theDN=c;if("undefined"!==typeof n&&"undefined"!==typeof s)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(r))a.nimservice()?(l=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().GetSignDataP1(n,s,l,null,function(b,c,l){0!=b?(a.ERROR.Code=b,a.ERROR.Message=c,a.uiUtil().errMsgBox(c,a.ERROR.Code),e(k(a.ERROR.Code,a.ERROR.Message))):(f.signedData=l,I(n,s,r,d,a.certUtil().getTheCertAttributes(d,"Base64")),e(f));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){g.dispose()},10)})):(e(null),setTimeout(function(){g.dispose()},10));else if(r==a.CONST.__PF_M_CLOUDSIGN.device)a.uiUtil().loadingBox(!0,"us-div-list-load",1),reqGenSignNonVerifyPin(n,a.usWebToolkit.util.encodeUtf8(b),"Y",function(b,d,c){0!=b&&(a.ERROR.Code=b,a.ERROR.Message=d,setTimeout(function(){g.dispose()},10),e(k(b,d)));f.signedData=c;setTimeout(function(){g.dispose()},10);e(f)});else{try{var t=window.console||{log:function(){}};E&&(t.log("b64 cert : ",a.PFUC[n].signcert),t.log("b64 pri : ",a.PFUC[n].signpri));var u=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[n].signcert),v=a.usWebToolkit.pkcs8.decryptRsaPrivateKeyFromBase64(a.PFUC[n].signpri,s);c=null;switch(a.usWebToolkit.pki.oids[u.signatureOid]){case "sha1WithRSAEncryption":c=crosscert.md.algorithms.sha1.create();break;case "kcdsaWithSHA1":u.md=crosscert.md.algorithms.sha1.create();break;case "md5WithRSAEncryption":c=crosscert.md.algorithms.md5.create();break;case "sha256WithRSAEncryption":c=crosscert.md.algorithms.sha256.create();break;case "RSASSA-PSS":c=crosscert.md.algorithms.sha256.create()}c.update(a.usWebToolkit.util.encodeUtf8(b));var y=v.sign(c);f.signedData=a.usWebToolkit.util.encode64(y);e(f)}catch(w){a.ERROR.Code=w.code,a.ERROR.Message=w.message,a.uiUtil().errMsgBox(l,a.ERROR.Code),e(k(a.ERROR.Code,a.ERROR.Message))}setTimeout(function(){g.dispose()},10);n=s=u=pri=null}},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message));g.dispose()}});g.show();return!0}},VerifySignedDataP1:function(b,d,c,f){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(b&&d&&c||f(-1),a.reInitialize(),!(1&a.ESVS.Mode))if(4&a.ESVS.Mode)a.nimservice()&&(b=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().VerifySignature(b,d,c,function(b,d){0!=b&&(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage());f(b);a.uiUtil().loadingBox(!1,"us-div-list-load")}));else{d=a.usWebToolkit.util.decode64(d);c=a.usWebToolkit.pki.certificateFromBase64(c);var e="1.2.840.113549.1.1.5"==c.signatureOid||"1.2.410.200004.1.9"==c.signatureOid?a.usWebToolkit.md.sha1.create():"1.2.840.113549.1.1.4"==c.signatureOid?a.usWebToolkit.md.md5.create():"1.2.840.113549.1.1.11"==c.signatureOid||"1.2.840.113549.1.1.10"==c.signatureOid?a.usWebToolkit.md.sha256.create():null;e.update(a.usWebToolkit.util.encodeUtf8(b));var g;try{g=c.publicKey.verify(e.digest().getBytes(),d)}catch(h){a.ERROR.Code=h.code,a.ERROR.Message=h.message,g=!1}g?f(0):f(a.ERROR.Code)}},SignDataP7:function(b,d,c,f,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||!e||document.getElementById("us-div-cert-select"))return!1;var g=k(),h=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.signedData,a.curDevice,a.certAttrs,a.b64RValue))};a.reInitialize();var m=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:d},onConfirm:function(d,e,s,r,q,t,u){var v=s;g.certAttrs=s;if("undefined"!==typeof r&&"undefined"!==typeof q)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(t))a.nimservice()?(d=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().GetSignDataP7(r,q,0,d,c,f,function(b,d,c,l,f,s){0!=b?(a.ERROR.Code=b,a.ERROR.Message=d,h(k(b,d))):(null==v&&a.CONST.__USFB_M_MOBILETOKEN.device==t?(v=a.certUtil().getTheCertAttributes(f,"Base64"),g.certAttrs=v,I(r,q,t,f,v)):I(r,q,t,e,v),g.signedData=c,g.curDevice=t,g.b64RValue=l,g.tokenLabel=s,h(g));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){m.dispose()},10);r=q=e=w=null})):(h(null),setTimeout(function(){m.dispose()},10));else if(t==a.CONST.__PF_M_CLOUDSIGN.device)a.uiUtil().loadingBox(!0,"us-div-list-load",1),reqGetCertR(r,function(d,c,l){0!=d&&(g.resultCode=d,g.resultMessage=c,setTimeout(function(){m.dispose()},10),h(k(d,c)));reqGenSignNonVerifyPin(r,a.usWebToolkit.util.encodeUtf8(b),"Y",function(d,c,f){0!=d?(a.ERROR.Code=d,a.ERROR.Message=c,h(k(d,c))):(I(r,q,t,e,v),d=a.usWebToolkit.util.decode64(f),c=a.usWebToolkit.pki.certificateFromBase64(e),f=crosscert.pkcs7.createSignedData(),f.signWithP1(d,b,c,null,null),g.signedData=a.usWebToolkit.pkcs7.messageToBase64(f),g.curDevice=t,g.b64RValue=l,h(g));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){m.dispose()},10)})});else{try{var y=window.console||{log:function(){}};E&&(y.log("b64 cert : ",a.PFUC[r].signcert),y.log("b64 pri : ",a.PFUC[r].signpri));e=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[r].signcert);var w=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[r].signpri),Q=a.usWebToolkit.pkcs7.createSignedData();Q.sign(b,e,w,q,null,null);var p=a.usWebToolkit.pkcs8.decryptPrivateKeyInfo(w,q),Ja=a.usWebToolkit.pkcs8.getPrivateKeyAttributesRandom(p);g.signedData=a.usWebToolkit.pkcs7.messageToBase64(Q);g.b64RValue=a.usWebToolkit.util.encode64(Ja);g.curDevice=t;h(g)}catch(S){a.ERROR.Code=S.code,a.ERROR.Message=S.message,112047==S.code&&(a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_MATTCHED_PWD),a.uiUtil().errMsgBox(a.ERROR.Message,a.ERROR.Code),h(k(S.code,S.message))}setTimeout(function(){m.dispose()},10);r=q=e=w=null}},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message));m.dispose()}});m.show();return!0}},VerifySignedDataP7:function(b,d){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b)return null;var c=null;a.reInitialize();if(!(1&a.ESVS.Mode))if(2&a.ESVS.Mode){c=null;try{c=a.usWebToolkit.pkcs7.messageFromBase64(b),c.verify()}catch(f){if(a.ERROR.Code=f.code,a.ERROR.Message=f.message,d)d(null);else return null}if(c.verifyResult)if(c=c.content,d)d(c);else return c}else if(4&a.ESVS.Mode)a.nimservice()&&a.nimservice().VerifySignedData(null,b,function(b,c){0!=b?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),d(null)):d(a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(c)));a.uiUtil().loadingBox(!1,"us-div-list-load")});else{c=null;try{c=a.usWebToolkit.pkcs7.messageFromBase64(b),c.verify()}catch(e){a.ERROR.Code=e.code,a.ERROR.Message=e.message,d(null)}if(c.verifyResult)if(c=c.content,d)d(c);else return c;else d(null)}}},SignDataP7Ext:function(b,d,c,f,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d&&!c||document.getElementById("us-div-cert-select")||!e)return!1;var g=k(),h=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.resultMessage,a.signedData,a.certIndex,a.password,a.curDevice,a.curDrive))};b||(b="DIGITAL_SIGNATURE_P7_EXT");a.reInitialize();var m=a.loadUI("certselect")({type:b,args:{dn:f},onConfirm:function(b,d,e,f,q){4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(f)&&(a.nimservice()?a.nimservice().GetSignDataP7(d,e,0,c,!0,null,function(b,c,l,y,w,Q){0!=b?(a.ERROR.Code=b,a.ERROR.Message=c,a.uiUtil().errMsgBox(c,a.ERROR.Code),h(k(b,c))):(g.resultCode=b,g.resultMessage=c,g.signedData=l,g.certIndex=d,g.password=e,g.curDevice=f,g.curDrive=q,g.tokenLabel=Q,h(g));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){m.dispose()},10)}):h(k(rv,rvMsg)))},onCancel:function(){m.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});m.show();return!0}},SelectMedia:function(b,d){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d)return!1;var c=b;c||(c="CERT_STORAGE");var f=k(),e=function(a){1==d.length?d(a):(null==a&&(a=k(-1)),d(a.curDevice,a.curDrive,a.pin))};a.reInitialize();Dialog=a.loadUI("storageselect")({type:c,args:null,onConfirm:function(b,d){f.curDevice=b;f.curDrive=d;Dialog.dispose();2===b||3===b?(c=2===b?"PIN_SECURITY_TOKEN":"PIN_SAVE_TOKEN",PINDialog=a.loadUI("pin")({type:c,args:null,onConfirm:function(a){PINDialog.dispose();f.pin=a;e(f)},onCancel:function(){PINDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}}),PINDialog.show()):e(f)},onCancel:function(){Dialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}});Dialog.show()}},SelectMediaForCertImporting:function(b){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b)return!1;var d=k(),c=function(a){1==b.length?b(a):(null==a&&(a=k(-1)),b(a.resultCode,a.resultMessage,a.curDevice,a.curDrive,a.pin,a.password))};a.reInitialize();Dialog=a.loadUI("storageselect")({type:"CERT_STORAGE",args:null,onConfirm:function(b,e){Dialog.dispose();d.curDevice=b;d.curDrive=e;2===b||3===b?(PWDialog=a.loadUI("password")({type:null,args:null,onConfirm:function(g){PWDialog.dispose();var h=null,h=2===b?"PIN_SECURITY_TOKEN":"PIN_SAVE_TOKEN";PINDialog=a.loadUI("pin")({type:h,args:null,onConfirm:function(a){PINDialog.dispose();d.pin=a;d.password=g;c(d);g=null},onCancel:function(){PINDialog.dispose();g=null;a.uiUtil().getUserCancelErrCodeNMsg();c(k(a.ERROR.Code,a.ERROR.Message))}});PINDialog.show()},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();c(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show()):c(d)},onCancel:function(){Dialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();c(k(a.ERROR.Code,a.ERROR.Message))}});Dialog.show()}},ExportCert:function(b,d,c,f,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b)return null;var g=k(),h=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.resultMessage,a.theCert,a.thePri,a.kmCert,a.kmPri))};a.reInitialize();4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(c)&&(a.nimservice()?a.nimservice().ExportCertEx(c,f,b,d,function(a,b,d,c,e,f){g.resultCode=a;g.resultMessage=b;g.theCert=d;g.thePri=c;g.kmCert=e;g.kmPri=f;h(g)}):h(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)));return null}},ImportCert:function(b,d,c,f,e,g,h,m,l){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(1>e||0>g)return-1;k();var n=function(a){1==l.length?l(a):(null==a&&(a=k(-1)),l(a.resultCode,a.resultMessage))};a.reInitialize();4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(e)&&(a.nimservice()?a.nimservice().ImportCertEx(e,g,h,m,b,d,c,f,function(a,b){n(k(a,b))}):n(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)));return-1}},IssueCert:function(b,d,c){function f(b,d,c){if(4<=a.ESVS.Mode)return a.nimservice()?(IssuingDialog=a.loadUI("certprocessing")({type:"CERT_ISSUE",args:null,onConfirm:null,onCancel:null}),IssuingDialog.show(),a.nimservice().IssueCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,b,d,"",g,h,function(b,d){m.resultCode=b;m.resultMessage=d;if(0!=b)return a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=12913==a.ERROR.Code?"\uc120\ud0dd\ud558\uc2e0 \ub514\uc2a4\ud06c\uac00 \uc4f0\uae30\uae08\uc9c0 \uc0c1\ud0dc\uc785\ub2c8\ub2e4.\r\n\uc4f0\uae30\uae08\uc9c0 \ud574\uc81c \ud6c4 \ubc1c\uae09 \ud574\uc8fc\uc2dc\uae38 \ubc14\ub78d\ub2c8\ub2e4.":a.nimservice().GetLastErrorMessage(),IssuingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message,!0,function(){l(m)}),!1;IssuingDialog.dispose(b,0,null,!0,function(){l(m)});return!0})):l(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE)),!1;d=null;d=2===b?a.loadUI("pin"):a.loadUI("newpassword");PWDialog=d({type:null,args:null,onConfirm:function(d){PWDialog.dispose();if(2&a.ESVS.Mode&&a.uiUtil().isItPFDevice(b)){IssuingDialog=a.loadUI("certprocessing")({type:"CERT_ISSUE",args:null,onConfirm:null,onCancel:null});IssuingDialog.show();var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/certbackup_"+a.ESVS.Language+".js?V="+a.ver,!1);c.send(null);var e=eval(c.responseText);setTimeout(function(c){if(b==a.CONST.__PF_M_LS.device){if(!a.PFSH)return l(null),!1;try{a.PFSH.LoadAllCerts(document.domain)}catch(f){301E5===f.code?(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain)):(c=window.console||{log:function(){}},E&&(c.log("***** Plugin Free LoadAllCerts error *****"),c.log("e.code : ",f.code,"e.message : ",f.message,"e.detail : ",f.detail)))}try{a.usWebToolkit.usWebCMP.issueCert(g,h,d,document.domain,"",a.PFSH,function(b,c,g){1===b?IssuingDialog.dispose(0,0,null,!0,function(){var b=a.loadUI("confirm")({type:null,args:{msg:e.IDS_CONFIRMBOX_WILL_YOU_BACKUP_CERT},onConfirm:function(){b.dispose();a.uiUtil().isItPortableDevice()?ya():xa(d);d=null;l(m)},onCancel:function(){b.dispose();d=null;a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message))}});b.show()}):(2===b?(a.ERROR.Code=-1,a.ERROR.Message=c,IssuingDialog.dispose(-1,a.ERROR.Code,a.ERROR.Message,!0,function(){l(k(a.ERROR.Code,a.ERROR.Message))})):(a.ERROR.Code=g.code,a.ERROR.Message=g.message,IssuingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!0,function(){l(k(a.ERROR.Code,a.ERROR.Message))})),d=null)})}catch(n){a.ERROR.Code=n.code,a.ERROR.Message=n.message,IssuingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!0,function(){l(k(a.ERROR.Code,a.ERROR.Message))}),d=null}}else if(b==a.CONST.__PF_M_SS.device)try{var q=function(b,d,c,g){a.CCPFSH().SaveUserCert(c,d,!0,function(a,b){g(a)})},r=function(b,c,g){1==b?IssuingDialog.dispose(0,0,null,!0,function(){var b=a.loadUI("confirm")({type:null,args:{msg:e.IDS_CONFIRMBOX_WILL_YOU_BACKUP_CERT},onConfirm:function(){b.dispose();a.uiUtil().isItPortableDevice()?Aa():za(d);d=null;l(m)},onCancel:function(){b.dispose();d=null;a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message))}});b.show()}):2==b?IssuingDialog.dispose(b,b,c,!0,function(){l(k(b,c))}):3==b&&(b=g.code,IssuingDialog.dispose(b,b,g.message,!0,function(){l(k(g.code,g.message))}))};a.CCPFSH().GetCCStorageHandler(p.EncAlgo,p.HashAlgo,p.PKI,function(b,c){a.usWebToolkit.usWebCMP.issueCert(g,h,d,document.domain,"",c,r,null,null,q)})}catch(u){a.ERROR.Code=u.code,a.ERROR.Message=u.message,IssuingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!0,function(){l(k(u.code,u.message))}),d=null}},1E3)}},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message));PWDialog.dispose()}});PWDialog.show()}function e(){a.nimservice().GetAllMediaList(0,function(b,d){n=a.loadUI("storageselect")({type:"CERT_STORAGE_ISSUE",args:null,onConfirm:function(b,d,c){n.dispose();4&a.ESVS.Mode?f(b,d,""):3===b?(PINDialog=a.loadUI("pin")({type:"PIN_SAVE_TOKEN",args:null,onConfirm:function(a){PINDialog.dispose();f(b,d,a)},onCancel:function(){PINDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message))}}),PINDialog.show()):f(b,d,"")},onCancel:function(){n.dispose();a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message))}});n.show()})}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c)return!1;var g=b,h=d,m=k(),l=function(a){1==c.length?c(a):(null==a&&(a=k(-1)),c(a.resultCode,a.resultMessage))};a.reInitialize();if(g&&h)e();else{var n=a.loadUI("certissue")({type:null,args:null,onConfirm:function(a,b){g=a;h=b;n.dispose();e()},onCancel:function(){n.dispose();a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message))}});n.show()}return!0}},IssueKMCert:function(b){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(b&&!document.getElementById("us-div-cert-select")){var d=k();a.reInitialize();var c=a.loadUI("certselect")({type:"CERT_RENEWAL_KMCERT",args:{dn:null},onConfirm:function(f,e,g,h,m,l){c.dispose();if(confirm(e)){if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(g))return a.nimservice()?(RenewingDialog=a.loadUI("certprocessing")({type:"CERT_ISSUE",args:null,onConfirm:null,onCancel:null}),RenewingDialog.show(),a.nimservice().IssueKMCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,g,h,m,"","",function(c,g){0==c?RenewingDialog.dispose(0,0,null,!0,function(){b(d)}):(a.ERROR.Code=c,a.ERROR.Message=12913==a.ERROR.Code?"\uc120\ud0dd\ud558\uc2e0 \ub514\uc2a4\ud06c\uac00 \uc4f0\uae30\uae08\uc9c0 \uc0c1\ud0dc\uc785\ub2c8\ub2e4.\r\n\uc4f0\uae30\uae08\uc9c0 \ud574\uc81c \ud6c4 \ubc1c\uae09 \ud574\uc8fc\uc2dc\uae38 \ubc14\ub78d\ub2c8\ub2e4.":g,RenewingDialog.dispose(c,a.ERROR.Code,a.ERROR.Message,!0,function(){b(c)}))})):b(k(-1)),!1}else a.uiUtil().getUserCancelErrCodeNMsg(),b(k(a.ERROR.Code,a.ERROR.Message))},onCancel:function(){c.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();b(k(a.ERROR.Code,a.ERROR.Message))}});c.show();return!0}},RenewCert:function(b){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(b&&!document.getElementById("us-div-cert-select")){var d=k(),c=function(a){1==b.length?b(a):(null==a&&(a=k(-1)),b(a.resultCode,a.resultMessage))};a.reInitialize();var f=a.loadUI("certselect")({type:"CERT_RENEWAL",args:{dn:null},onConfirm:function(b,g,h,m,l,n){f.dispose();b=!0;h!=a.CONST.__USFB_M_MOBILETOKEN.device&&(b=confirm(g));if(b){if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(h))return a.nimservice()?(g=a.loadUI("certprocessing"),RenewingDialog=g({type:"CERT_RENEWAL",args:null,onConfirm:null,onCancel:null}),RenewingDialog.show(),a.nimservice().RenewCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,h,m,l,"","",function(b,g){0==b?RenewingDialog.dispose(0,0,null,!0,function(){c(d)}):(a.ERROR.Code=b,13018==a.ERROR.Code?g=a.ERROR.Message="\uc120\ud0dd\ud558\uc2e0 \ub514\uc2a4\ud06c\uac00 \uc4f0\uae30\uae08\uc9c0 \uc0c1\ud0dc\uc785\ub2c8\ub2e4.\r\n\uc4f0\uae30\uae08\uc9c0 \ud574\uc81c \ud6c4 \uac31\uc2e0 \ud574\uc8fc\uc2dc\uae38 \ubc14\ub78d\ub2c8\ub2e4.":a.ERROR.Message=g,RenewingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message,!0,function(){c(k(b,g))}))})):c(null),!1;if(2&a.ESVS.Mode&&a.uiUtil().isItPFDevice(h)){g=a.loadUI("certprocessing");RenewingDialog=g({type:"CERT_RENEWAL",args:null,onConfirm:null,onCancel:null});RenewingDialog.show();m=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");m.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/certbackup_"+a.ESVS.Language+".js?V="+a.ver,!1);m.send(null);var s=eval(m.responseText);m=function(b,d,g){1==b?RenewingDialog.dispose(0,0,null,!0,function(){var b=a.loadUI("confirm")({type:null,args:{msg:s.IDS_CONFIRMBOX_WILL_YOU_BACKUP_CERT},onConfirm:function(){b.dispose();a.CONST.__PF_M_LS.device===h?a.uiUtil().isItPortableDevice()?ya():xa(n):a.CONST.__PF_M_SS.device===h&&(a.uiUtil().isItPortableDevice()?Aa():za(n));pw=null;c(resultObejct)},onCancel:function(){b.dispose();pw=null;a.uiUtil().getUserCancelErrCodeNMsg();c(k(a.ERROR.Code,a.ERROR.Message))}});b.show()}):2==b?RenewingDialog.dispose(b,b,d,!0,function(){c(k(b,d))}):3==b&&(b=g.code,RenewingDialog.dispose(b,b,g.message,!0,function(){c(k(b,g.message))}))};a.CONST.__PF_M_LS.device===h?a.usWebToolkit.usWebCMP.update(a.PFUC[l].signcert,a.PFUC[l].signpri,a.PFUC[l].kmcert,a.PFUC[l].kmpri,n,document.domain,"",a.PFSH,m):a.CONST.__PF_M_SS.device===h&&a.usWebToolkit.usWebCMP.update(a.PFUC[l].signcert,a.PFUC[l].signpri,a.PFUC[l].kmcert,a.PFUC[l].kmpri,n,document.domain,"",a.CCPFSH,m,null,null,null,function(b,d,c,g){a.CCPFSH().SaveUserCert(c,d,!1,function(a,b){g(a)})})}else a.uiUtil().errMsgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_SUPPORT_DEVICE,-1)}},onCancel:function(){f.dispose();a.uiUtil().getUserCancelErrCodeNMsg();c(k(a.ERROR.Code,a.ERROR.Message))}});f.show();return!0}},RevocateCert:function(b){function d(b,d,e,l){var n=a.loadUI("certrevoke")({type:null,args:null,onConfirm:function(k){n.dispose();if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(e))if(a.nimservice()){var r=a.loadUI("certprocessing");RevokingDialog=r({type:"CERT_REVOCATION",args:null,onConfirm:null,onCancel:null});RevokingDialog.show();a.nimservice().RevokeCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,e,l,b,k,function(a,b){c.resultCode=a;0===a?RevokingDialog.dispose(0,null,null,!0,function(){f(c)}):RevokingDialog.dispose(a,a,b,!0,function(){f(c)})})}else f(null);else if(2&a.ESVS.Mode&&a.uiUtil().isItPFDevice(e)){r=a.loadUI("certprocessing");RevokingDialog=r({type:"CERT_REVOCATION",args:null,onConfirm:null,onCancel:null});RevokingDialog.show();var q=function(){if(e==a.CONST.__PF_M_LS.device)return a.PFSH;if(e==a.CONST.__PF_M_SS.device)return a.CCPFSH()};setTimeout(function(){G("b64 cert : ",a.PFUC[b].signcert);G("b64 pri : ",a.PFUC[b].signpri);var e=a.usWebToolkit.usWebCMP.revReason.keyCompromise;switch(k){case 1:e=a.usWebToolkit.usWebCMP.revReason.keyCompromise;G("cause : keyCompromise");break;case 3:e=a.usWebToolkit.usWebCMP.revReason.afilationChanged;G("cause : afilationChanged");break;case 5:e=a.usWebToolkit.usWebCMP.revReason.superseded,G("cause : superseded")}try{a.usWebToolkit.usWebCMP.revocation(a.PFUC[b].signcert,a.PFUC[b].signpri,a.PFUC[b].kmcert,d,document.domain,e,q(),function(e,l,m){b=0;d=null;1===e?RevokingDialog.dispose(0,0,null,!0,function(){f(c)}):2===e?(a.ERROR.Code=-1,a.ERROR.Message=l,c.resultCode=a.ERROR.Code,c.resultMessage=a.ERROR.Message,RevokingDialog.dispose(-1,a.ERROR.Code,a.ERROR.Message,!0,function(){f(c)})):(a.ERROR.Code=m.code,a.ERROR.Message=m.message,c.resultCode=a.ERROR.Code,c.resultMessage=a.ERROR.Message,RevokingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!0,function(){f(c)}))})}catch(l){b=0,d=null,a.ERROR.Code=l.code,a.ERROR.Message=l.message,c.resultCode=a.ERROR.Code,c.resultMessage=a.ERROR.Message,RevokingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!0,function(){f(c)})}},1E3)}},onCancel:function(){n.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f(k(a.ERROR.Code,a.ERROR.Message))}});n.show()}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(b&&!document.getElementById("us-div-cert-select")){var c=k(),f=function(a){1==b.length?b(a):(null==a&&(a=k(-1)),b(a.resultCode,a.resultMessage))};a.reInitialize();var e=a.loadUI("certselect")({type:"CERT_REVOCATION",args:{dn:null},onConfirm:function(b,c,m,l,n){e.dispose();var s=a.loadUI("confirm")({type:null,args:{msg:b},onConfirm:function(){s.dispose();d(c,m,l,n)},onCancel:function(){s.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f(k(a.ERROR.Code,a.ERROR.Message))}});s.show()},onCancel:function(){e.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f(k(a.ERROR.Code,a.ERROR.Message))}});e.show();return!0}},SOECert:function(b){function d(b,d,e,l){4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(e)&&(a.nimservice()?(RevokingDialog=a.loadUI("certprocessing")({type:"CERT_SOE",args:null,onConfirm:null,onCancel:null}),RevokingDialog.show(),a.nimservice().RevokeCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,e,l,b,6,function(a,b){c.resultCode=a;0===a?RevokingDialog.dispose(0,null,null,!0,function(){f(c)}):RevokingDialog.dispose(a,a,b,!0,function(){f(c)})})):f(null))}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(b&&!document.getElementById("us-div-cert-select")){var c=k(),f=function(a){1==b.length?b(a):(null==a&&(a=k(-1)),b(a.resultCode,a.resultMessage))};a.reInitialize();var e=a.loadUI("certselect")({type:"CERT_SOE",args:{dn:null},onConfirm:function(b,c,m,l,n){e.dispose();var s=a.loadUI("confirm")({type:null,args:{msg:b},onConfirm:function(){s.dispose();d(c,m,l,n)},onCancel:function(){s.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f(k(a.ERROR.Code,a.ERROR.Message))}});s.show()},onCancel:function(){e.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f(k(a.ERROR.Code,a.ERROR.Message))}});e.show();return!0}},VerifyVID:function(b,d){function c(b,d,c,g,s,r){if("PFS"==r)try{G("b64 cert : ",a.PFUC[d].signcert);G("b64 pri : ",a.PFUC[d].signpri);var q=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[d].signcert),t=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[d].signpri),u=a.usWebToolkit.pkcs8.verifyVID(t,c,b,q);c=b="";u?e(f):e(null)}catch(v){c=b="",a.ERROR.Code=v.code,a.ERROR.Message=v.message,e(k(v.code,v.message))}else"NIM"==r?(a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_VID_VERIFY_MESSAGE),a.nimservice().VerifyVID(d,c,b,function(d,g){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0==d?e(f):(a.ERROR.Code=d,a.ERROR.Message=g,e(k(d,g)));c=b=""})):"CLOUDSIGN"==r&&reqVerifyVID(d,b,function(b,d,c){0!=b?(a.ERROR.Code=b,a.ERROR.Message=d,e(k(b,d))):c?e(f):(a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_MSGBOX_VID_ERROR_VERIFICATION,e(k(-1,a.ERROR.Message)))})}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d||document.getElementById("us-div-cert-select"))return!1;var f=k(),e=function(a){1==d.length?d(a):(null==a&&(a=k(-1)),d(a.resultCode,a.resultMessage))};a.reInitialize();var g=a.loadUI("certselect")({type:"VID_VERIFICATION",args:{dn:null},onConfirm:function(d,f,l,n,s){g.dispose();if(b)c(b,d,f,l,n,s);else{var r=a.loadUI("ssn")({type:null,onConfirm:function(a){c(a,d,f,l,n,s);r.dispose()},onCancel:function(){r.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}});r.show()}},onCancel:function(){g.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}});g.show();return!0}},ManageCert:function(){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{a.reInitialize();var b=a.loadUI("certmanage")({type:"CERT_MANAGEMENT",onConfirm:null,onCancel:function(){b.dispose();a.uiUtil().getUserCancelErrCodeNMsg();_rvCallback(k(a.ERROR.Code,a.ERROR.Message))}});b.show();return!0}},ManageCertByType:function(b){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{a.reInitialize();var d=a.loadUI("certmanage")({type:"CERT_MANAGEMENT",args:{type:b},onConfirm:null,onCancel:function(){d.dispose();a.uiUtil().getUserCancelErrCodeNMsg();_rvCallback(k(a.ERROR.Code,a.ERROR.Message))}});d.show();return!0}},ImportCertFromMobileApp:function(b,d,c){function f(){try{try{a.PFSH.SelectStorage(1)}catch(c){G("***** Plugin Free SelectStorage error *****"),G("e.code : ",c.code,"e.message : ",c.message,"e.detail : ",c.detail),alert("error : "+c.detail),h(k(c.code,c.message))}try{a.PFSH.LoadAllCerts(document.domain)}catch(e){301E5===e.code?(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain)):(G("***** Plugin Free LoadAllCerts error *****"),G("e.code : ",e.code,"e.message : ",e.message,"e.detail : ",e.detail),alert("error : "+e.detail),h(k(e.code,e.message)))}var f=a.PFSH.SetP12HexOnMemory(b,d),s=f.aluc[f.index];a.usWebToolkit.x509Certificate.parser(s.signcert,"Base64");var r=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),q=a.certUtil().getIssuerEnName(r);a.PFSH.SaveUserCert(q,s,document.domain,!0);h(g)}catch(t){G("***** Plugin Free MobileImportCert error *****"),G("e.code : ",t.code,"e.message : ",t.message,"e.detail : ",t.detail),alert("error : "+t.detail),h(null)}}function e(){a.CCPFSH().SetP12HexOnMemory(b,d,function(b,d,e){0==b?(b=e.aluc[e.index],a.usWebToolkit.x509Certificate.parser(b.signcert,"Base64"),d=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),d=a.certUtil().getIssuerEnName(d),a.CCPFSH().SaveUserCert(d,b,!0,function(a){h(k(a))})):(alert("error : "+d),c(k(b,d)))})}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{var g=k(),h=function(a){1==c.length?c(a):(null==a&&(a=k(-1)),c(a.resultCode,a.resultMessage))};d&&b||h(null);a.reInitialize();a.PFSH||h(null);SSDialog=a.loadUI("storageselect")({type:"CERT_STORAGE",args:null,onConfirm:function(b,d){SSDialog.dispose();b==a.CONST.__PF_M_LS.device?f():b==a.CONST.__PF_M_SS.device&&a.CCPFSH().IsCCPFSHAvailable(function(b){0==b?e():a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.PKI,function(a,b){0==a?e():SSDialog.dispose()})})},onCancel:function(){SSDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});SSDialog.show()}},SetSelectedDevice:function(b){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{var d="",c;for(c in a.CONST.medias)if(a.CONST.medias[c].device===b){d=a.CONST.medias[c].name;break}a.ESVS.Media.defaultdevice=d}},NimServiceLoaded:function(){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else return a.nimservice()?a.nimservice().GetIframeLoaded():null},SecureMail:function(b,d,c,f,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{k();var g=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.resultMessage))};if("seed"!=d)a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_SUPPORT_ALGORITHM,g(k(a.ERROR.Code,a.ERROR.Message));else if(null==c||""==c||1>c.length)alert(a.uiUtil().getErrorMessageLang().IDS_NOT_ENCRYPTED_DATA);else{a.reInitialize();var h=0,m=a.loadUI("securemail")({type:"SECURE_MAIL",args:{algorithm:d,data:c,decryptData:this.DecryptFileData,mode:b},onConfirm:function(d,c,e,r){if(3<h)null!=document.getElementById("html_encripted")&&(document.getElementById("html_encripted").innerHTML=""),alert(e.IDS_KEY_TYPE[b]+e.IDS_PASSWORD_WRONG),m.dispose();else{var q=document.getElementById("us-input-secure-mail-password");d=r(d,q.value,c,f);if(-10===d)return a.ERROR.Code=-10,a.ERROR.Message=e.IDS_ALGORITHM_ALERT,m.dispose(),g(k(a.ERROR.Code,a.ERROR.Message));if(-11===d){a.ERROR.Code=-11;a.ERROR.Message=e.IDS_KEY_TYPE[b]+e.IDS_PASSWORD_WRONG;if(4<h)return m.dispose(),g(k(a.ERROR.Code,a.ERROR.Message));h+=1;alert(e.IDS_KEY_TYPE[b]+e.IDS_DISCORDANCE_PASSWORD.replace("@",h));q.value=""}else{if(-12===d)return m.dispose(),g(k(-12));if(-13===d){a.ERROR.Code=-13;a.ERROR.Message=e.IDS_KEY_TYPE[b]+e.IDS_PASSWORD_WRONG;if(4<h)return m.dispose(),g(k(-13));h+=1;alert(e.IDS_KEY_TYPE[b]+e.IDS_DISCORDANCE_PASSWORD.replace("@",h));q.value=""}else m.dispose(),g(k(d))}}},onCancel:function(){m.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g(k(a.ERROR.Code,a.ERROR.Message))}});m.show()}}},DecryptFileData:function(b,d,c,f){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{var e,g=d;e=0;for(d=d.length;16>d;d++)g+="abcdefghijklmnopqrstuvwxyz".substr(e++,1);e=g+"0123450123456789";d=b.toLowerCase();if("seed"==d)g=e.substring(0,16),e=e.substring(16,32);else if("3des"==d)g=e.substring(0,24),e=e.substring(24,32);else if("rc2"==d)g=e.substring(0,5),e=e.substring(5,13);else if("des"==d)g=e.substring(0,8),e=e.substring(8,16);else return-10;c=a.usWebToolkit.util.decode64(c);"3des"==d&&(b="des");d=null;try{var h=a.usWebToolkit.cipher.algorithms[b].startDecrypting(g,e);h.update(a.usWebToolkit.util.createBuffer(c));if(!1==h.finish())return-11;0==f||null==f?d=h.output.toHex():1==f&&(d=h.output.getBytes())}catch(m){return a.ERROR.Code=m.code,a.ERROR.Message=m.message,-12}if(0==f||null==f)try{d=a.usWebToolkit.unicode.hex2UTF8(d)}catch(l){return-13}return d}},getFileDownload:function(b,d){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if("function"==typeof ja){if(null==d||""==d||1>d.length){var c=document.location.href.split("/");d=c[c.length-1]}c=new Blob([b],{type:"application/otect-stream"});try{ja(c,d)}catch(f){alert(a.uiUtil().getErrorMessageLang().IDS_ERROR_BROWSER_NOT_SUPPORT)}}else alert(a.uiUtil().getErrorMessageLang().IDS_ERROR_BROWSER_NOT_SUPPORT)},SignData_noConWithHash:function(b,d,c,f,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!e||!b||document.getElementById("us-div-cert-select"))return!1;k();var g=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.jsonSignedData,a.b64RValue,a.certAttrs))};a.reInitialize();var h=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:d},onConfirm:function(a,d,e,k,r,q){da(b,c,a,k,r,q,f,h,g)},onCancel:function(){h.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g(null)}});h.show();return!0}},SignData_noConWithHashEx:function(b,d,c,f,e,g){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d||!g)return!1;k();var h=function(a){1==g.length?g(a):(null==a&&(a=k(-1)),g(a.jsonSignedData,a.b64RValue,a.certAttrs))};a.reInitialize();if(!1==b){var m=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:c},onConfirm:function(a,b,c,g,k,t){da(d,f,a,g,k,t,e,m,h)},onCancel:function(){m.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});m.show()}else da(d,f,a.SELCERTINFO.cert,a.SELCERTINFO.index,a.SELCERTINFO.pw,a.SELCERTINFO.curdevice,e,null,h)}},SignDataP7NVID_noConWithHash:function(b,d,c,f,e,g){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||document.getElementById("us-div-cert-select")||!g)return!1;k();var h=function(a){1==g.length?g(a):(null==a&&(a=k(-1)),g(a.resultCode,a.signedData,a.certAttrs,a.curDevice))};a.reInitialize();var m=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION",args:{dn:d},onConfirm:function(d,g,f,r,q,t){var u={};if("undefined"!==typeof d&&"undefined"!==typeof g)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(t))if(a.nimservice()){f=function(b){if(!b)return"";var d=null;if("SHA1"==c||"sha1"==c)d="1.3.14.3.2.26";else if("MD5"==c||"md5"==c)d="1.2.840.113549.2.5";else if("SHA256"==c||"sha256"==c)d="2.16.840.1.101.3.4.2.1";b=crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.SEQUENCE,!0,[crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.SEQUENCE,!0,[crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.OID,!1,crosscert.asn1.oidToDer(d).getBytes()),crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.NULL,!1,"")]),crosscert.asn1.create(crosscert.asn1.Class.UNIVERSAL,crosscert.asn1.Type.OCTETSTRING,!1,b)]);return a.usWebToolkit.asn1.toDer(b).getBytes()};r=0;var v=[];if(b)for(var y in b){var w=a.usWebToolkit.util.decode64(b[y]),w=f(w),w=a.usWebToolkit.util.encode64(w);v[r]=w;r++}a.nimservice().GetSignDataP7(d,g,1,v,!1,null,function(c,f,s,r,v,y){if(0!=c)a.ERROR.Code=c,a.ERROR.Message=f,a.uiUtil().errMsgBox(f,a.ERROR.Code),h(k(c,f));else{c=0;if("object"==typeof s)for(var w in b)u[w]=s[c++];else u=s;null==q&&a.CONST.__USFB_M_MOBILETOKEN.device==t&&(q=a.certUtil().getTheCertAttributes(v,"Base64"));Y(e,d,g,u,q,t,y,h)}g=e="";a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){m.dispose()},10)})}else h(null),setTimeout(function(){m.dispose()},10);else setTimeout(function(){m.dispose()},10);else h(null),setTimeout(function(){m.dispose()},10)},onCancel:function(){m.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});m.show();return!0}},VerifySignData_noConWithHash:function(b,d,c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||!d)return!1;a.reInitialize();if(1&a.ESVS.Mode)a.plugin();else if(4&a.ESVS.Mode)a.nimservice()&&a.nimservice().VerifySignedDataWithHashValue(b,d,function(b,d){0!=b&&(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage());c(b)});else{var f=null;try{var e=a.usWebToolkit.util.decode64(b),f=a.usWebToolkit.pkcs7.messageFromBase64(d);f.verifyWithHash(e)}catch(g){return a.ERROR.Code=g.code,a.ERROR.Message=g.message,null}return f.verifyResult}return!1}},SignMultiDataP7:function(b,d,c,f,e,g){if(!b&&!d||!g||document.getElementById("us-div-cert-select"))return!1;var h=k(),m=function(a){1==g.length?g(a):(null==a&&(a=k(-1)),g(a.jsonSignedData,a.b64RValue,a.certAttrs,a.curDevice))};a.reInitialize();var l=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:c},onConfirm:function(c,g,r,q,t,u){var v={},y=r;if("undefined"!==typeof q&&"undefined"!==typeof t)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(u))if(a.nimservice()){c=0;var w=[];if(b)if("object"==typeof b)for(var p in b)w[c++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b[p]));else w=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b));else if("object"==typeof jsonPlainData)for(p in jsonPlainData)w[c++]=d[p];else w=d;a.nimservice().GetSignDataP7(q,t,0,w,f,e,function(c,e,f,n,r,p){if(0!=c)a.ERROR.Code=c,a.ERROR.Message=e,m(k(c,e));else{c=0;e=b;d&&(e=d);if("object"==typeof f)for(var Q in e)e=f[c++],w[c-1]&&""!=w[c-1]||(e=""),v[Q]=e;else v=f;null==y&&a.CONST.__USFB_M_MOBILETOKEN.device==u&&(y=a.certUtil().getTheCertAttributes(r,"Base64"));I(q,t,u,g,y);h.jsonSignedData=v;h.b64RValue=n;h.certAttrs=y;h.curDevice=u;h.tokenLabel=p;m(h)}q=t=g=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");l.dispose()})}else m(null),l.dispose();else l.dispose(),q=t=g=pri=null;else m(null),l.dispose()},onCancel:function(){l.dispose();a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}});l.show();return!0},SignMultiDataP7NVerifyVID:function(b,d,c,f,e,g){if(!b&&!d||!g||document.getElementById("us-div-cert-select"))return!1;k();var h=function(a){1==g.length?g(a):(null==a&&(a=k(-1)),g(a.resultCode,a.signedData,a.certAttrs,a.curDevice))};a.reInitialize();var m=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:c},onConfirm:function(c,g,s,r,q,t){var u={},v=s;if("undefined"!==typeof r&&"undefined"!==typeof q)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(t))if(a.nimservice()){c=0;var y=[];if(b)if("object"==typeof b)for(var w in b)y[c++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b[w]));else y=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b));else if("object"==typeof b)for(w in jsonPlainData)y[c++]=d[w];else y=d;a.nimservice().GetSignDataP7(r,q,0,y,f,null,function(c,f,l,s,w,p){if(0!=c)a.ERROR.Code=c,a.ERROR.Message=f,h(k(c,f));else{c=0;f=b;d&&(f=d);if("object"==typeof l)for(var x in f)f=l[c++],y[c-1]&&""!=y[c-1]||(f=""),u[x]=f;else u=l;null==v&&a.CONST.__USFB_M_MOBILETOKEN.device==t&&(v=a.certUtil().getTheCertAttributes(w,"Base64"));I(r,q,t,g,v);Y(e,r,q,u,v,t,p,h)}r=q=g=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");m.dispose()})}else h(null),m.dispose();else r=q=g=pri=null,m.dispose();else h(null),m.dispose()},onCancel:function(){m.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});m.show();return!0},Base64Encoding:function(b){b=a.usWebToolkit.util.encodeUtf8(b);return(b=a.usWebToolkit.util.encode64(b))?b:null},Base64Decoding:function(b){b=a.usWebToolkit.util.decode64(b);return(b=a.usWebToolkit.util.decodeUtf8(b))?b:null},SignPersonInfoReqP7:function(b,d,c,f,e){if(!b||!d||4>d.length||!e||document.getElementById("us-div-cert-select"))return!1;var g=k(),h=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.signedData,a.certAttrs))};a.reInitialize();f=null;try{f=a.usWebToolkit.util.encodeUtf8(b)}catch(m){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT UTIL ERROR] during encoding utf8 character set.\ndetail : "+m;h(k(a.ERROR.Code,a.ERROR.Message));return}b=null;try{b=a.usWebToolkit.asn1.create(a.usWebToolkit.asn1.Class.UNIVERSAL,a.usWebToolkit.asn1.Type.UTF8,!1,f)}catch(l){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during creating useragreement asn.1 struct.\ndetail : "+l;h(k(a.ERROR.Code,a.ERROR.Message));return}f=0;"1"===d.charAt(0)&&(f|=128);"1"===d.charAt(1)&&(f|=64);"1"===d.charAt(2)&&(f|=32);"1"===d.charAt(3)&&(f|=16);d=String.fromCharCode(4);var n=String.fromCharCode(f);f=null;try{f=a.usWebToolkit.asn1.create(a.usWebToolkit.asn1.Class.UNIVERSAL,a.usWebToolkit.asn1.Type.BITSTRING,!1,d+n)}catch(s){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during creating useragree asn.1 struct.\ndetail : "+s;h(k(a.ERROR.Code,a.ERROR.Message));return}d=null;try{d=a.usWebToolkit.asn1.create(a.usWebToolkit.asn1.Class.UNIVERSAL,a.usWebToolkit.asn1.Type.SEQUENCE,!0,[b,f])}catch(r){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during creating personinforeq asn.1 struct.\ndetail : "+r;h(k(a.ERROR.Code,a.ERROR.Message));return}b=null;try{b=a.usWebToolkit.asn1.toDer(d)}catch(q){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during converting object to der format.\ndetail : "+q;h(k(a.ERROR.Code,a.ERROR.Message));return}var t=null;try{t=a.usWebToolkit.util.encode64(b.getBytes())}catch(u){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT UTIL ERROR] during encoding base64 string.\ndetail : "+u;h(k(a.ERROR.Code,a.ERROR.Message));return}var v=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:c},onConfirm:function(b,d,c,e,f,m){"undefined"!==typeof e&&"undefined"!==typeof f&&4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(m)&&(a.nimservice()?a.nimservice().GetSignDataP7(e,f,0,t,!0,null,function(b,d,e){0!=b?(a.ERROR.Code=b,a.ERROR.Message=d,h(k(b,d))):(g.signedData=e,g.certAttrs=c,h(g));a.uiUtil().loadingBox(!1,"us-div-list-load");v.dispose()}):(h(null),v.dispose()))},onCancel:function(){v.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});v.show();return!0},SignMultiDataP1:function(b,d,c){if(!b||!c||document.getElementById("us-div-cert-select"))return!1;var f=k(),e=function(a){1==c.length?c(a):(null==a&&(a=k(-1)),c(a.jsonSignedData,a.theCert,a.theDN))};a.reInitialize();var g=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:d},onConfirm:function(d,c,l,n,s,r){var q={};if("undefined"!==typeof n&&"undefined"!==typeof s)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(r))if(a.nimservice()){l=0;var t=[];if(b)if("object"==typeof b)for(var u in b)t[l++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b[u]));else t=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b));a.nimservice().GetSignDataP1(n,s,t,null,function(l,u,w,p,la,x){if(0!=l)a.ERROR.Code=l,a.ERROR.Message=u,a.uiUtil().errMsgBox(u,a.ERROR.Code),e(k(l,u));else{l=0;if("object"==typeof w)for(var S in b)u=w[l++],t[l-1]&&""!=t[l-1]||(u=""),q[S]=u;else q=w;I(n,s,r,d,a.certUtil().getTheCertAttributes(d,"Base64"));f.jsonSignedData=q;f.theCert=d;f.theDN=c;f.tokenLabel=x;e(f)}a.uiUtil().loadingBox(!1,"us-div-list-load");g.dispose()})}else e(null),g.dispose();else n=s=cert=pri=null,g.dispose();else g.dispose()},onCancel:function(){g.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}});g.show();return!0},VerifySignedDataP7ExcludedContent:function(b,d,c){if(!d)return null;a.reInitialize();if(4&a.ESVS.Mode)a.nimservice()&&(b=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().VerifySignedData(b,d,function(b,d){0!=b&&(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage());c(b);a.uiUtil().loadingBox(!1,"us-div-list-load")}));else{var f=null;try{f=a.usWebToolkit.pkcs7.messageFromBase64(d),f.verify(void 0,a.usWebToolkit.util.encodeUtf8(b))}catch(e){a.ERROR.Code=e.code;a.ERROR.Message=e.message;_rvCallback(e.code);return}if(!0==f.verifyResult)return _rvCallback(0),0;_rvCallback(-1);return-1}},SignDataP7AndVerifyVID:function(b,d,c,f){if(!b&&!plainB64Text||!f||document.getElementById("us-div-cert-select"))return!1;var e=k(),g=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.resultCode,a.signedData,a.certAttrs,a.curDevice))};a.reInitialize();var h=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION",args:{dn:d},onConfirm:function(d,f,n,s,r,q){var t=r;if("undefined"!==typeof d&&"undefined"!==typeof f)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(q))a.nimservice()?(n=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().GetSignDataP7(d,f,0,n,!0,null,function(b,e,n,r,u,v){0!=b?(a.ERROR.Code=b,a.ERROR.Message=e,g(k(b,e))):(null==t&&a.CONST.__USFB_M_MOBILETOKEN.device==q?(t=a.certUtil().getTheCertAttributes(u,"Base64"),I(d,f,q,u,t)):I(d,f,q,s,t),Y(c,d,f,n,t,q,v,g));f=c="";a.uiUtil().loadingBox(!1,"us-div-list-load");h.dispose()})):(g(null),setTimeout(function(){h.dispose()},10));else if(q==a.CONST.__PF_M_CLOUDSIGN.device){a.uiUtil().loadingBox(!0,"us-div-list-load",1);var u=function(d,c,m,n,q,r){reqVerifyVID(d,c,function(c,n,u){0==c?u?reqGetCertR(d,function(c,n,u){0!=c&&(e.resultCode=c,e.resultMessage=n,setTimeout(function(){h.dispose()},10),r(k(c,n)));reqGenSignNonVerifyPin(d,a.usWebToolkit.util.encodeUtf8(b),"Y",function(b,c,n){0!=b?(a.ERROR.Code=b,a.ERROR.Message=c,g(k(b,c))):(I(d,f,q,s,t),b=a.usWebToolkit.util.decode64(n),c=a.usWebToolkit.pki.certificateFromBase64(s),n=crosscert.pkcs7.createSignedData(),n.signWithP1(b,m,c,null,null),e.certAttrs=t,e.signedData=a.usWebToolkit.pkcs7.messageToBase64(n),e.curDevice=q,e.b64RValue=u,g(e));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){h.dispose()},10)})}):(a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_MSGBOX_VID_ERROR_VERIFICATION,a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){h.dispose()},10),r(k(a.ERROR.Code,a.ERROR.Message))):(a.ERROR.Code=c,a.ERROR.Message=n,a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){h.dispose()},10),r(k(c,n)))})};if(c)u(d,c,b,r,q,g);else{var v=a.loadUI("ssn")({type:null,onConfirm:function(a){u(d,a,b,r,q,g);v.dispose()},onCancel:function(){g(k(-1,a.uiUtil().getUserCancelErrCodeNMsg()));v.dispose()}});v.show()}}else{try{var y=window.console||{log:function(){}};E&&(y.log("b64 cert : ",a.PFUC[d].signcert),y.log("b64 pri : ",a.PFUC[d].signpri));s=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[d].signcert);var w=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[d].signpri),p=a.usWebToolkit.pkcs7.createSignedData();p.sign(b,s,w,f,null,null);var la=a.usWebToolkit.pkcs7.messageToBase64(p);Y(c,d,f,la,r,q,"",g);h.dispose()}catch(x){a.ERROR.Code=x.code,a.ERROR.Message=x.message,a.uiUtil().errMsgBox(x.message,a.ERROR.Code),g(k(x.code,x.message))}setTimeout(function(){h.dispose()},10);d=f=s=w=null}},onCancel:function(){h.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g(k(a.ERROR.Code,a.ERROR.Message))}});h.show();return!0},MakeHash:function(b,d,c,f){function e(b,c){if(null==b||0>=b.length)c(0,"");else if(4&a.ESVS.Mode)if(a.nimservice())if("FilePath"===l){var e=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b));a.nimservice().HashData(1,e,d,function(b,d){0==b?c(b,d):(a.ERROR.Code=b,c(b,""))})}else e=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().HashData(0,e,d,function(b,d){0==b?c(b,d):(a.ERROR.Code=b,c(b,""))});else a.ERROR.Code=-1,c(-1,"");else if("FilePath"!==l)try{var e=a.usWebToolkit.util.encodeUtf8(h),f=crosscert.md.algorithms[m.toLowerCase()].create();f.start();f.update(e);c(0,a.usWebToolkit.util.encode64(f.digest().getBytes()))}catch(g){a.ERROR.Code=g.code,a.ERROR.Message=g.message,c(g.code,"")}}function g(a){e(a,function(a,b){0!=a?r(k(a)):(n[q]=b,q++,h.length==q?(s.hashValue=n,r(s)):g(h[q]))})}if(!b)return null;var h=b,m=d,l=c,n=[];m&&"undefined"!==typeof m||(m="SHA256");var s=k(),r=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.resultCode,a.hashValue))};"string"===typeof b&&(h=[b]);var q=0;g(h[q])},EncryptData:function(b,d,c,f,e){function g(b,d,c,e,f,g){4&a.ESVS.Mode&&(a.nimservice()?(d=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c)),a.nimservice().EnvelopData("kmcert",b,d,function(b,d,c){h.resultCode=b;0==b?h.encryptedData=c:(a.ERROR.Message=-2==b?a.uiUtil().getErrorMessageLang().IDS_NO_KMCERT:d,a.ERROR.Code=b,h.resultCode=b,h.resultMessage=a.ERROR.Message);f(h);g.dispose()})):(a.ERROR.Code=-1,f(null),g.dispose()))}if(!b||!e||document.getElementById("us-div-cert-select"))return!1;a.reInitialize();var h=k(),m=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.encryptedData))};if(c&&0<c.length)g(c,b,null,m);else{var l=a.loadUI("certselect")({type:"ENCRYPT_P7",args:{dn:d},onConfirm:function(a,d,e){g(a,c,b,e,m,l)},onCancel:function(){l.dispose();a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}});l.show()}return!0},EncryptDataWithSymmKey:function(b,d,c,f,e){if(!c||!d)return null;var g="",h="",g="",m=0,l=k(),n=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.encryptedData))};b=b.toLowerCase();if("seed"==b){h=d.substring(0,16);g=crosscert.util.bytesToHex(h);d=h.length;for(i=0;i<16-d;i++)g+="00";b64SymmKey=a.usWebToolkit.util.encode64(crosscert.util.hexToBytes(g));g="0123456789012345"}else if("3des"==b){m=3;b="des";h=d.substring(0,24);g=crosscert.util.bytesToHex(h);d=h.length;for(i=0;i<24-d;i++)g+="00";b64SymmKey=a.usWebToolkit.util.encode64(crosscert.util.hexToBytes(g));g="01234567"}else return null;if(4&a.ESVS.Mode)if(a.nimservice()){c=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c));var h=a.usWebToolkit.util.encode64(g),s=0;"utf-8"==f.toLowerCase()&&(s=1);a.nimservice().EncryptData(m,h,b64SymmKey,c,1,s,function(b,d){l.resultCode=b;0==b?l.encryptedData=d:a.ERROR.Code=b;n(l)})}else a.ERROR.Code=-1,n(null);else try{s=crosscert.cipher.algorithms[b].startEncrypting(h,g),s.update(crosscert.util.createBuffer(c)),s.finish(),l.encryptedData=a.usWebToolkit.util.encode64(s.output.getBytes()),n(l)}catch(r){a.ERROR.Code=r.code,a.ERROR.Message=r.message,n(k(a.ERROR.Code,a.ERROR.Message))}},DecryptDataWithSymmKey:function(b,d,c,f,e,g){if(!c||!d)return null;var h="",m="",l=0,n=k(),s=function(a){1==g.length?g(a):(null==a&&(a=k(-1)),g(a.resultCode,a.decryptedData))},r="";b=b.toLowerCase();if("seed"==b)h=d.substring(0,16),m="0123456789012345",r=a.usWebToolkit.util.encode64(d);else if("3des"==b){l=3;b="des";h=d.substring(0,24);r=crosscert.util.bytesToHex(h);d=h.length;for(i=0;i<24-d;i++)r+="00";r=a.usWebToolkit.util.encode64(crosscert.util.hexToBytes(r));m="01234567"}else return;if(4&a.ESVS.Mode)if(a.nimservice()){var h=a.usWebToolkit.util.encode64(m),q=0;"utf-8"==f.toLowerCase()&&(q=1);f=0;"utf-8"==e.toLowerCase()&&(f=1);a.nimservice().DecryptData(l,h,r,c,q,f,function(b,d){n.resultCode=b;0==b?n.decryptedData=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(d)):a.ERROR.Code=b;s(n)})}else a.ERROR.Code=-1,s(null);else try{var q=a.usWebToolkit.util.decode64(c),t=crosscert.cipher.algorithms[b].startDecrypting(h,m);t.update(crosscert.util.createBuffer(q));t.finish();n.decryptedData=t.output.getBytes();s(n)}catch(u){a.ERROR.Code=u.code,a.ERROR.Message=u.message,s(k(a.ERROR.Code,a.ERROR.Message))}},SetConfigInfo:function(b){b.Mode&&(a.ESVS.Mode=p.Mode=R=b.Mode);b.PKI&&(a.ESVS.PKI=p.PKI=ea=b.PKI);"undefined"!=typeof b.SecureKeyboardType&&(a.ESVS.SecureKeyboardType=p.SecureKeyboardType=U=b.SecureKeyboardType,"ahnlab"==U&&(eval(C({eval:!1,intergrity:!1,name:"astx2.min.js",url:"unisignweb/framework/keyboard/astx2.min.js"})),eval(C({eval:!1,intergrity:!1,name:"astx2_custom.js",url:"unisignweb/framework/keyboard/astx2_custom.js"}))));b.Language&&("ko-kr"==b.Language.toLowerCase()?a.ESVS.Language=p.Language=Z="ko_kr":a.ESVS.Language=p.Language=Z="en_us",__FileUtil=__ForgeryUtil=__CertUtil=__UIUtil=null,__UIUtil=new F.UI,__CertUtil=new F.CERT,__ForgeryUtil=new F.FORGERY,__FileUtil=new F.FILE);if(b.Media){var d=b.Media;d.list=d.list?d.list.toLowerCase():null;d.defaultdevice?(d.defaultdevice=d.defaultdevice.toLowerCase(),null!=d.list&&(d.defaultdevice=0>d.list.indexOf(d.defaultdevice)?d.list.split("|")[0]:d.defaultdevice)):d.defaultdevice=null;if(void 0==d.defaultdevice||null==d.defaultdevice)d.defaultdevice=2==R?"webstorage":"harddisk";a.ESVS.Media=p.Media=d}b.TabIndex&&(a.ESVS.TabIndex=p.TabIndex=ba=b.TabIndex);b.LimitNumOfTimesToTryToInputPW&&(a.ESVS.LimitNumOfTimesToTryToInputPW=p.LimitNumOfTimesToTryToInputPW=$=b.LimitNumOfTimesToTryToInputPW);b.Policy&&(a.ESVS.Policy=p.Policy=ga=b.Policy);b.ShowExpiredCerts&&(a.ESVS.ShowExpiredCerts=p.ShowExpiredCerts=ha=b.ShowExpiredCerts);b.LimitMinNewPWLen&&(a.ESVS.LimitMinNewPWLen=p.LimitMinNewPWLen=K=b.LimitMinNewPWLen);b.LimitMaxNewPWLen&&(a.ESVS.LimitMaxNewPWLen=p.LimitMaxNewPWLen=L=b.LimitMaxNewPWLen);b.LimitNewPWPattern&&(a.ESVS.LimitNewPWPattern=p.LimitNewPWPattern=W=b.LimitNewPWPattern);"undefined"===typeof b.CertRequestPageEnable&&(a.ESVS.CertRequestPageEnable=p.CertRequestPageEnable=ia=b.CertRequestPageEnable)},SignFileP7:function(b,d,c,f,e,g){if(document.getElementById("us-div-cert-select")||!g||!b||0<c&&!f)return!1;var h=k(),m=function(a){1==g.length?g(a):(null==a&&(a=k(-1)),g(a.resultCode,a.signedData,a.curDevice))};a.reInitialize();var l=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_FILE",args:{dn:d},onConfirm:function(d,g,r,q,t,u){4&a.ESVS.Mode?a.nimservice()?(r=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),q="",null!=f&&(q=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(f))),r=[r,c,q],a.nimservice().GetSignFileP7(d,g,r,e,null,function(b,e,f,q,r,t){0!=b?(a.ERROR.Code=b,a.ERROR.Message=e,m(k(b,e))):(h.curDevice=u,h.signedData=f,h.tokenLabel=t,0<c&&(b=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(f)),h.signedData=b),m(h));d=g=cert=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");l.dispose()})):(m(null),l.dispose()):(m(null),l.dispose())},onCancel:function(){l.dispose();a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}});l.show();return!0},SignMultiFileP7:function(b,d,c,f,e,g){if(!b||!g||document.getElementById("us-div-cert-select"))return!1;var h=k(),m=function(a){1==g.length?g(a):(null==a&&(a=k(-1)),g(a.resultCode,a.jsonSignedData,a.curDevice))};a.reInitialize();var l=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_FILE",args:{dn:d},onConfirm:function(d,g,r,q,t,u){var v={};if(4&a.ESVS.Mode)if(a.nimservice()){r=0;q=[];t=[];if(b)if("object"==typeof b)for(var p in b)b[p]&&""!=b[p]&&(q[r++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b[p])));else q=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b));if(f)if(r=0,"object"==typeof b)for(p in f)b[p]&&""!=b[p]&&(t[r++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(f[p])));else t=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(f));p=[q,c,t];a.nimservice().GetSignFileP7(d,g,p,e,null,function(e,f,q,r,t,p){if(0!=e)a.ERROR.Code=e,a.ERROR.Message=f,m(k(e,f));else{e=0;if(0<c)if("object"==typeof q)for(var y in b)f=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(q[e++])),b[e-1]&&""!=b[e-1]||(f=""),v[y]=f;else v=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(q));else if("object"==typeof q)for(y in b)v[y]=b[y]&&""!=b[y]?q[e++]:"";else v=q;h.curDevice=u;h.jsonSignedData=v;h.tokenLabel=p;m(h)}d=g=cert=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");l.dispose()})}else m(null),l.dispose();else m(null),l.dispose()},onCancel:function(){l.dispose();a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}});l.show();return!0},SetUBIKeyEnvInfo:function(b,d,c,f){a.ubiKeyEnv={version:b,siteInfo:d,securityInfo:c,downloadURL:f}},SetXMLNormalizerInfo:function(b,d){a.xmlNormalizer={using:!0,installcheck:!1,name:a.usWebToolkit.util.encode64(b),version:d}},SetMobileTokenEnvInfo:function(b,d,c,f,e,g){var h=g;if("undefined"!==typeof g||null==g||0>=g.length)h="http://download.smartcert.kr";a.usimEnv={sitecode:b,modecode:d,siteURL:c,serviceIP:f,servicePort:e,downloadURL:h}},DecryptData:function(b,d){function c(d,c,g,k){4&a.ESVS.Mode&&(a.nimservice()?a.nimservice().DeenvelopData("kmcert",d,c,b,function(b,d,c){f.resultCode=b;0==b?f.decryptedData=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(c)):a.ERROR.Code=b;e(f);k.dispose()}):(a.ERROR.Code=-1,e(null),k.dispose()))}if(!b||!d||document.getElementById("us-div-cert-select"))return!1;var f=k(),e=function(a){1==d.length?d(a):(null==a&&(a=k(-1)),d(a.resultCode,a.decryptedData))};a.reInitialize();var g=a.loadUI("certselect")({type:"ENCRYPT_P7",args:{dn:null},onConfirm:function(a,b,d){c(a,b,d,g)},onCancel:function(){g.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}});g.show();return!0},VerifyKeyPair:function(b){function d(b,d,c,h,r,q){4&a.ESVS.Mode&&a.nimservice().GetSignDataP7(c,h,0,e,!0,null,function(b,d,e,h,l,m){0!=b?(a.ERROR.Code=b,a.ERROR.Message=d,g.errmsg=d,f(k(a.ERROR.Code,g))):a.nimservice().VerifySignedData(null,e,function(b,d){0!=b?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),g.signcert=a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_SIGN+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+a.uiUtil().getErrorMessageLang().IDS_VERIFY_SIGN+")",q(0)):a.nimservice().ValidateCertificate(c,function(b,d,c,e){g.signcert=0==b?999==c?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_SIGN+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_OK:a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_SIGN+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+e+")":a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_SIGN+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+d+")";q(0)})});a.uiUtil().loadingBox(!1,"us-div-list-load")})}function c(b,d,c,h,r,q){4&a.ESVS.Mode&&a.nimservice().EnvelopData("kmcert",c,e,function(b,e,m){0==b?a.nimservice().DeenvelopData("kmcert",c,h,m,function(b,c,e){g.kmcert=0==b?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_OK:-2==b?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_NONE:a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+c+")";q&&q.dispose();b=k();b.certAttrs=d;b.resultMessage=g;f(b)}):(g.kmcert=-2==b?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_NONE:a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+e+")",q&&q.dispose(),b=k(),b.certAttrs=d,b.resultMessage=g,f(b))})}if(!b)return!1;k();var f=function(a){1==b.length?b(a):(null==a&&(a=k(-1)),b(a.resultCode,a.resultMessage))},e="1234",g={errmsg:"",signcert:"",kmcert:""};a.reInitialize();var h=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:null},onConfirm:function(a,b,e,f,g,k){d(a,e,f,g,k,function(b){c(a,e,f,g,k,h)})},onCancel:function(){h.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g.errmsg=a.ERROR.Message;f(k(a.ERROR.Code,g))}});h.show();return!0},VerifyP7SignedFileWithFile:function(b,d,c,f,e,g){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c||1==f&&!e)return null;a.reInitialize();if(4&a.ESVS.Mode&&a.nimservice()){var h=null;null!=b&&(h=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)));b=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(c));e=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(e));a.nimservice().VerifySignedFile(h,d,b,f,e,function(b,d,c){0!=b?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),g(b,null)):1==f?(d=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(d)),g(b,d,c)):g(b,a.usWebToolkit.util.decode64(d),c);a.uiUtil().loadingBox(!1,"us-div-list-load")})}}},VerifyP7SignedDataWithFile:function(b,d,c,f,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d||1==c&&!f)return null;a.reInitialize();if(4&a.ESVS.Mode&&a.nimservice()){var g=null;null!=b&&(g=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)));b=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(f));a.nimservice().VerifySignedFile(g,0,d,c,b,function(b,d){if(0!=b)a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),e(b,null);else if(1==c){var f=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(d));e(b,f)}else e(b,a.usWebToolkit.util.decode64(d));a.uiUtil().loadingBox(!1,"us-div-list-load")})}}},RenewCertNSignedSubjectDn:function(b,d,c,f,e,g){function h(b,d,c,g,h,k,l,m){b=!0;c!=a.CONST.__USFB_M_MOBILETOKEN.device&&(b=confirm(d));if(b&&4<=a.ESVS.Mode)return a.nimservice()?(RenewingDialog=a.loadUI("certprocessing")({type:"CERT_RENEWAL",args:null,onConfirm:null,onCancel:null}),RenewingDialog.show(),a.nimservice().RenewCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,c,g,h,k,l,function(b,d){n.resultCode=b;n.resultMessage=d;n.certAttrs=m;n.curDevice=c;n.curDrive=g;if(0==b)RenewingDialog.dispose(0,0,null,!0,function(){s(n)});else if(a.ERROR.Code=a.nimservice().GetLastErrorCode(),13018==a.ERROR.Code?(a.ERROR.Message="\uc120\ud0dd\ud558\uc2e0 \ub514\uc2a4\ud06c\uac00 \uc4f0\uae30\uae08\uc9c0 \uc0c1\ud0dc\uc785\ub2c8\ub2e4.\r\n\uc4f0\uae30\uae08\uc9c0 \ud574\uc81c \ud6c4 \uac31\uc2e0 \ud574\uc8fc\uc2dc\uae38 \ubc14\ub78d\ub2c8\ub2e4.",n.resultMessage="\uc120\ud0dd\ud558\uc2e0 \ub514\uc2a4\ud06c\uac00 \uc4f0\uae30\uae08\uc9c0 \uc0c1\ud0dc\uc785\ub2c8\ub2e4.\r\n\uc4f0\uae30\uae08\uc9c0 \ud574\uc81c \ud6c4 \uac31\uc2e0 \ud574\uc8fc\uc2dc\uae38 \ubc14\ub78d\ub2c8\ub2e4."):a.ERROR.Message=a.nimservice().GetLastErrorMessage(),null!=m&&m.subjectName){var k=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(m.subjectName));a.nimservice().ConvertStringFormat(k,f,function(b,d,c){a.nimservice().GetSignDataP7(h,l,0,c,!0,null,function(d,c,f){RenewingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message,e,function(){n.signedData=f;s(n);a.uiUtil().loadingBox(!1,"us-div-list-load")})})})}else RenewingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message,e,function(){s(n)}),a.uiUtil().loadingBox(!1,"us-div-list-load")})):s(null),!1}function m(b,d){if(a.bsUtil().isKeyProtected()){var c=[];c[0]=b;a.nimservice().CheckComplexPin(c,function(a,b){d(a)})}else c=a.uiUtil().CheckPwdPattern(b),d(!0==c?0:-1)}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(g&&!document.getElementById("us-div-cert-select")){var l=b;b&&a.uiUtil().isValidDevice(b)||(c=null,l=d=-1);var n=k(),s=function(a){1==g.length?g(a):(null==a&&(a=k(-1)),g(a.resultCode,a.certAttrs,a.signedData))};a.reInitialize();var r=a.loadUI("certselect")({type:"CERT_RENEWAL_SIGN",args:{device:l,drive:d,dn:c},onConfirm:function(b,d,c,e,f,g,l){r.dispose();a.CONST.__USFB_M_HSMKEY.device!=c&&a.CONST.__USFB_M_SMARTCARD.device!=c&&a.CONST.__USFB_M_MOBILETOKEN.device!=c?m(g,function(m){0==m?h(b,d,c,e,f,g,g,l):(PWDialog=a.loadUI("newpassword")({type:null,args:{pw:g},onConfirm:function(a){PWDialog.dispose();h(b,d,c,e,f,a,g,l)},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();s(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show())}):h(b,d,c,e,f,g,g,l)},onCancel:function(){r.dispose();a.uiUtil().getUserCancelErrCodeNMsg();s(k(a.ERROR.Code,a.ERROR.Message))}});r.show();return!0}},SetOptions:function(b,d){a.options[b]=d},MakeTaxXMLDSIG:function(b,d,c,f){function e(b,d){var c="",e;for(e in g)c+=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(g[e])),c+="|";a.nimservice().XMLDllInitialize(a.xmlNormalizer.name,a.xmlNormalizer.version,function(e,f){if(0!=e)a.ERROR.Code=e,a.ERROR.Message=f,a.uiUtil().loadingBox(!1,"us-div-list-load"),b.dispose(),m(k(e,f));else{var g=a.usWebToolkit.util.encode64("XN_NormalizeDataEx"),h=a.usWebToolkit.util.encode64("XN_Free"),l=a.usWebToolkit.util.encode64("XN_GetLastErrorMsg");a.nimservice().XMLDllAction(g,h,l,c,function(c,e,f){a.nimservice().XMLDllFinalize(function(g,h){if(0!=c)a.ERROR.Code=c,a.ERROR.Message=e,a.uiUtil().loadingBox(!1,"us-div-list-load"),b.dispose(),m(k(c,e));else{var l=f.split("|");d(l)}})})}})}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(!1==a.xmlNormalizer.using)a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_XML_NORMALIZER);else{if(!b||!f||document.getElementById("us-div-cert-select"))return!1;var g=b;"string"===typeof b&&(g=[b]);var h=k(),m=function(b){1==f.length?f(b):(null==b&&(b=k(-1)),f(b.signedData,b.b64RValue,b.certAttrs));null==a.currentObject};a.reInitialize();var l=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_XML",args:{dn:d},onConfirm:function(b,d,f,k,t,u){if("undefined"!==typeof f&&"undefined"!==typeof k){if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(t))if(a.nimservice()){var v,y,w;v=f;y=k;w={};var x=0;"sha256WithRSAEncryption"!=d.signAlgo&&(x=1);var z=C({eval:!0,intergrity:!1,name:"xml_template_"+p.Language,url:"unisignweb/rsrc/lang/xml_template_"+p.Language+".js"}),A="sha1";1!=x&&(A="sha256");e(l,function(b){for(var e in b)if(!(null==b[e]||0>=b[e].length||"undefined"==b[e]||"undefined"==g[e])){var f=b[e].split(";"),k={};k.key=e;k.plainText=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(f[0]));var n=crosscert.md.algorithms[A].create();n.start();n.update(a.usWebToolkit.util.decode64(f[1]));f=a.usWebToolkit.util.encode64(n.digest().getBytes());k.Signature=z.XMLSignatureTemplate[x].replace("$$DV$$",f);k.SignedInfo=z.XMLSignedInfoTemplate[x].replace("$$DV$$",f);k.Signature=k.Signature.replace("$$Cert$$",u);g[e]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(k.SignedInfo));w[e]=k}a.nimservice().GetSignDataP1(v,y,g,c,function(b,c,e,f,g,k){h.resultCode=b;h.resultMessage=c;if(0!=b)a.ERROR.Code=b,a.ERROR.Message=c;else{"string"==typeof e&&(e=[e]);for(var n in e)w[n].Signature=w[n].Signature.replace("$$Sign$$",e[n]),b=w[n].plainText.substr(0,w[n].plainText.indexOf(z.KEY_START)),b+=w[n].Signature,b+=w[n].plainText.substr(w[n].plainText.indexOf(z.KEY_START),w[n].plainText.length),e[n]=b;I(v,y,t,u,d);h.signedData=e;h.b64RValue=f;h.certAttrs=d;h.tokenLabel=k}m(h);a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){l.dispose()},10)})})}else m(null),setTimeout(function(){l.dispose()},10);f=k=cert=pri=null}else m(null),setTimeout(function(){l.dispose()},10)},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message));l.dispose()}});l.show();return!0}},DecryptWithUserSymmKey:function(b,d,c,f,e){function g(d,c,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(0==b){for(;-1<c.indexOf("-");)c=c.replace("-","");if(10>c.length)return-11}else if(1==b&&6>c.length)return-11;var f,g=c;f=0;for(c=c.length;16>c;c++)g+="abcdefghijklmnopqrstuvwxyz".substr(f++,1);f=g+"0123450123456789";g=f.substring(0,16);f=f.substring(16,32);e=a.usWebToolkit.util.decode64(e);c=null;try{var h=a.usWebToolkit.cipher.algorithms[d].startDecrypting(g,f);h.update(a.usWebToolkit.util.createBuffer(e));if(!1==h.finish())return-11;c=h.output.getBytes()}catch(k){return a.ERROR.Code=k.code,a.ERROR.Message=k.message,-12}return c}}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{var h=k(),m=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.decryptedData))};if("seed"!=d)a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_SUPPORT_ALGORITHM,m(k(a.ERROR.Code,a.ERROR.Message));else if(null==f||""==f||1>f.length)alert(a.uiUtil().getErrorMessageLang().IDS_NOT_ENCRYPTED_DATA);else{a.reInitialize();var l=0,n=a.loadUI("securemail")({type:"SECURE_MAIL",args:{algorithm:d,data:f,decryptData:g,mode:b},onConfirm:function(d,c,e,f){3<l?(null!=document.getElementById("html_encripted")&&(document.getElementById("html_encripted").innerHTML=""),alert(e.IDS_KEY_TYPE[b]+e.IDS_PASSWORD_WRONG),n.dispose()):(f=document.getElementById("us-input-secure-mail-password"),d=g(d,f.value,c),h.resultCode=d,-10===d?(a.ERROR.Code=-10,a.ERROR.Message=e.IDS_ALGORITHM_ALERT,n.dispose(),m(h)):-11===d?(a.ERROR.Code=-11,a.ERROR.Message=e.IDS_KEY_TYPE[b]+e.IDS_PASSWORD_WRONG,4<l?(n.dispose(),m(h)):(l+=1,alert(e.IDS_KEY_TYPE[b]+e.IDS_DISCORDANCE_PASSWORD.replace("@",l)),f.value="")):-12===d?(n.dispose(),m(h)):-13===d?(a.ERROR.Code=-13,a.ERROR.Message=e.IDS_KEY_TYPE[b]+e.IDS_PASSWORD_WRONG,4<l?(n.dispose(),m(h)):(l+=1,alert(e.IDS_KEY_TYPE[b]+e.IDS_DISCORDANCE_PASSWORD.replace("@",l)),f.value="")):(h.resultCode=0,h.decryptedData=d,m(h),n.dispose()))},onCancel:function(){n.dispose();a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}});n.show()}}},EncryptDataWithCert:function(b,d,c){if(!b||!c)return!1;var f=k(),e=function(a){1==c.length?c(a):(null==a&&(a=k(-1)),c(a.resultCode,a.encryptedData))};a.reInitialize();try{var g=a.usWebToolkit.pki.certificateFromBase64(d),h=a.usWebToolkit.pkcs7.createEnvelopedData();h.addRecipient(g);h.encContent.algorithm=a.usWebToolkit.pki.oids["seed-CBC"];h.content=a.usWebToolkit.util.createBuffer(b);h.encrypt();f.encryptedData=a.usWebToolkit.pkcs7.messageToBase64(h);e(f)}catch(m){a.ERROR.Code=m.code,a.ERROR.Message=m.message,e(k(a.ERROR.Code,a.ERROR.Message))}},GetMacAddress:function(b,d){if(!d)return!1;var c=k();a.reInitialize();4&a.ESVS.Mode&&a.nimservice().GetMacAddress(b,function(b,e,g){0!=b?(a.ERROR.Code=b,a.ERROR.Message=e,d(k(a.ERROR.Code,a.ERROR.Message))):(c.mac=g,d(c))})},GetUserDN:function(b){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||document.getElementById("us-div-cert-select"))return!1;var d=k();a.reInitialize();var c=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:null},onConfirm:function(f,e,g,h,m,l,n){var s=g;d.certAttrs=g;"undefined"!==typeof h&&"undefined"!==typeof m&&(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(l)?a.nimservice()?(f=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8("abcdefghijklmnopqrstuvwxyz1234567890~!@#$%^&amp;*()\ud55c\uae00")),a.nimservice().GetSignDataP7(h,m,0,f,!0,null,function(f,g,n,p,v,y){0!=f?(a.ERROR.Code=f,a.ERROR.Message=g,b(k(f,g))):(null==s&&a.CONST.__USFB_M_MOBILETOKEN.device==l?(s=a.certUtil().getTheCertAttributes(v,"Base64"),d.certAttrs=s,I(h,m,l,v,s)):I(h,m,l,e,s),d.DNValue=s.subjectName,d.certAttrs=s,b(d));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){c.dispose()},10);h=m=e=pri=null})):(b(null),setTimeout(function(){c.dispose()},10)):(a.ERROR.Code=-1,a.ERROR.Message=IDS_ERROR_NOT_SUPPORT_DEVICE,b(k(rv,rvMsg))))},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();b(k(a.ERROR.Code,a.ERROR.Message));c.dispose()}});c.show();return!0}},GetRValueFromKey:function(b,d){if(!d)return!1;var c=k(),f=a.SELCERTINFO.pw;a.reInitialize();if(4&a.ESVS.Mode)if(null==b){var e=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:null},onConfirm:function(b,f,m,l,n,s,r){var q=m;if("undefined"!==typeof l&&"undefined"!==typeof n)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(s))a.nimservice()?(b=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8("abcdefghijklmnopqrstuvwxyz1234567890~!@#$%^&amp;*()\ud55c\uae00")),a.nimservice().GetSignDataP7(l,n,0,b,!1,null,function(b,g,m,r,p,t){0!=b?(a.ERROR.Code=b,a.ERROR.Message=g,d(k(b,g))):(null==q&&a.CONST.__USFB_M_MOBILETOKEN.device==s?(q=a.certUtil().getTheCertAttributes(p,"Base64"),I(l,n,s,p,q)):I(l,n,s,f,q),a.nimservice().EncryptVIDRandom(a.SELCERTINFO.index,a.SELCERTINFO.pw,2,function(b,e,f){0!=b?(a.ERROR.Code=b,a.ERROR.Message=e,d(k(a.ERROR.Code,a.ERROR.Message))):(c.RValue=f,d(c))}));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){e.dispose()},10);l=n=f=u=null})):(d(null),setTimeout(function(){e.dispose()},10));else if(s==a.CONST.__PF_M_CLOUDSIGN.device)a.uiUtil().loadingBox(!0,"us-div-list-load",1),reqGetCertR(l,function(b,g,m){0!=b&&(c.resultCode=b,c.resultMessage=g,setTimeout(function(){e.dispose()},10),d(k(b,g)));reqGenSignNonVerifyPin(l,a.usWebToolkit.util.encodeUtf8("abcdefghijklmnopqrstuvwxyz1234567890~!@#$%^&amp;*()\ud55c\uae00"),"Y",function(b,g,r){0!=b?(a.ERROR.Code=b,a.ERROR.Message=g,d(k(b,g))):(I(l,n,s,f,q),c.b64RValue=m,d(c));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){e.dispose()},10)})});else{try{var p=window.console||{log:function(){}};E&&(p.log("b64 cert : ",a.PFUC[l].signcert),p.log("b64 pri : ",a.PFUC[l].signpri));f=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[l].signcert);var u=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[l].signpri),v=a.usWebToolkit.pkcs8.decryptPrivateKeyInfo(u,n),y=a.usWebToolkit.pkcs8.getPrivateKeyAttributesRandom(v);c.b64RValue=a.usWebToolkit.util.encode64(y);d(c)}catch(w){a.ERROR.Code=w.code,a.ERROR.Message=w.message,112047==w.code&&(a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_MATTCHED_PWD),a.uiUtil().errMsgBox(a.ERROR.Message,a.ERROR.Code),d(k(w.code,w.message))}setTimeout(function(){e.dispose()},10);l=n=f=u=null}},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();d(k(a.ERROR.Code,a.ERROR.Message));e.dispose()}});e.show()}else a.nimservice().EncryptVIDRandom(a.SELCERTINFO.index,f,2,function(b,e,f){0!=b?(a.ERROR.Code=b,a.ERROR.Message=e,d(k(a.ERROR.Code,a.ERROR.Message))):(c.RValue=f,d(c))})},SignDataP7WithDN:function(b,d,c){var f=a.SELCERTINFO.pw;if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(a.SELCERTINFO.curdevice))if(a.nimservice()){var e=k();if("object"==typeof b){var g={},h=0,m=[],l;for(l in b)m[h++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b[l]));a.nimservice().GetSignDataP7(a.SELCERTINFO.index,f,0,m,d,null,function(d,f,h,l,p,u){if(0!=d)a.ERROR.Code=d,a.ERROR.Message=f,c(k(d,f));else{d=0;if("object"==typeof h)for(var v in b)f=h[d++],m[d-1]&&""!=m[d-1]||(f=""),g[v]=f;else g=h;e.jsonSignedData=g;e.certAttrs=a.SELCERTINFO.certattrs;e.curDevice=a.SELCERTINFO.curdevice;e.tokenLabel=u;c(e);certIndex=pw=cert=pri=null}})}else h=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().GetSignDataP7(a.SELCERTINFO.index,f,0,h,d,null,function(b,d,f,g,h,l){0!=b?(a.ERROR.Code=b,a.ERROR.Message=d,c(k(b,d))):(e.certAttrs=a.SELCERTINFO.certattrs,e.signedData=f,e.curDevice=a.SELCERTINFO.curdevice,e.tokenLabel=l,c(e));certIndex=pw=cert=pri=null})}else c(null);else a.ERROR.Code=-1,a.ERROR.Message=IDS_ERROR_NOT_SUPPORT_DEVICE,c(k(rv,rvMsg))},SignData_noConWithHashWithDN:function(b,d,c){da(b,d,a.SELCERTINFO.cert,a.SELCERTINFO.index,a.SELCERTINFO.pw,a.SELCERTINFO.curdevice,null,null,c)},SignDataP7AndVerifyVIDWithDN:function(b,d,c,f){var e=a.SELCERTINFO.pw;if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(a.SELCERTINFO.curdevice))if(a.nimservice())if(k(),"object"==typeof b){var g={},h=0,m=[],l;for(l in b)m[h++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b[l]));a.nimservice().GetSignDataP7(a.SELCERTINFO.index,e,0,m,c,null,function(c,h,l,q,p,u){if(0!=c)a.ERROR.Code=c,a.ERROR.Message=h,f(k(c,h));else{c=0;if("object"==typeof l)for(var v in b)h=l[c++],m[c-1]&&""!=m[c-1]||(h=""),g[v]=h;else g=l;Y(d,a.SELCERTINFO.index,e,g,a.SELCERTINFO.certattrs,a.SELCERTINFO.curdevice,u,f)}})}else h=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().GetSignDataP7(a.SELCERTINFO.index,e,0,h,c,null,function(b,c,g,h,l,m){0!=b?(a.ERROR.Code=b,a.ERROR.Message=c,f(k(b,c))):Y(d,a.SELCERTINFO.index,e,g,a.SELCERTINFO.certattrs,a.SELCERTINFO.curdevice,m,f);pw=d=""});else f(null);else a.ERROR.Code=-1,a.ERROR.Message=IDS_ERROR_NOT_SUPPORT_DEVICE,f(k(rv,rvMsg))},SignDataP1WithDN:function(b,d){var c=a.SELCERTINFO.pw;if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(a.SELCERTINFO.curdevice))if(a.nimservice()){var f=k();if("object"==typeof b){var e={},g=0,h=[],m;for(m in b)h[g++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b[m]));a.nimservice().GetSignDataP1(a.SELCERTINFO.index,c,h,null,function(c,g,m,r,q,p){if(0!=c)a.ERROR.Code=c,a.ERROR.Message=g,d(k(c,g));else{c=0;if("object"==typeof m)for(var u in b)g=m[c++],h[c-1]&&""!=h[c-1]||(g=""),e[u]=g;else e=m;f.jsonSignedData=e;f.theCert=a.SELCERTINFO.cert;f.theDN=a.SELCERTINFO.certattrs.subjectName;d(f)}})}else g=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().GetSignDataP1(a.SELCERTINFO.index,c,g,null,function(b,c,e){0!=b?(a.ERROR.Code=b,a.ERROR.Message=c,a.uiUtil().errMsgBox(c,a.ERROR.Code),d(k(a.ERROR.Code,a.ERROR.Message))):(f.theCert=a.SELCERTINFO.cert,f.theDN=a.SELCERTINFO.certattrs.subjectName,f.signedData=e,d(f))})}else d(null);else a.ERROR.Code=-1,a.ERROR.Message=IDS_ERROR_NOT_SUPPORT_DEVICE,d(k(rv,rvMsg))},MakeTaxXMLDSIGWithDN:function(b,d){function c(b){var c="",e;for(e in f)c+=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(f[e])),c+="|";a.nimservice().XMLDllInitialize(a.xmlNormalizer.name,a.xmlNormalizer.version,function(e,f){if(0!=e)a.ERROR.Code=e,a.ERROR.Message=f,d(k(e,f));else{var g=a.usWebToolkit.util.encode64("XN_NormalizeDataEx"),h=a.usWebToolkit.util.encode64("XN_Free"),l=a.usWebToolkit.util.encode64("XN_GetLastErrorMsg");a.nimservice().XMLDllAction(g,h,l,c,function(c,e,f){a.nimservice().XMLDllFinalize(function(g,h){if(0!=c)a.ERROR.Code=c,a.ERROR.Message=e,a.uiUtil().loadingBox(!1,"us-div-list-load"),Dialog.dispose(),d(k(c,e));else{var l=f.split("|");b(l)}})})}})}if(!1==a.xmlNormalizer.using)a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_XML_NORMALIZER);else{if(!b||!d)return!1;var f=b;"string"===typeof b&&(f=[b]);var e=a.SELCERTINFO.pw,g=k();if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(a.SELCERTINFO.curdevice))if(a.nimservice()){var h,m;h=a.SELCERTINFO.cert;m={};var l=0;"sha256WithRSAEncryption"!=a.SELCERTINFO.certattrs.signAlgo&&(l=1);var n=C({eval:!0,intergrity:!1,name:"xml_template_"+p.Language,url:"unisignweb/rsrc/lang/xml_template_"+p.Language+".js"}),s="sha1";1!=l&&(s="sha256");c(function(b){for(var c in b)if(!(null==b[c]||0>=b[c].length||"undefined"==b[c]||"undefined"==f[c])){var k=b[c].split(";"),p={};p.key=c;p.plainText=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(k[0]));var v=crosscert.md.algorithms[s].create();v.start();v.update(a.usWebToolkit.util.decode64(k[1]));k=a.usWebToolkit.util.encode64(v.digest().getBytes());p.Signature=n.XMLSignatureTemplate[l].replace("$$DV$$",k);p.SignedInfo=n.XMLSignedInfoTemplate[l].replace("$$DV$$",k);p.Signature=p.Signature.replace("$$Cert$$",h);f[c]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(p.SignedInfo));m[c]=p}a.nimservice().GetSignDataP1(a.SELCERTINFO.index,e,f,null,function(b,c,e,f,h,k){g.resultCode=b;g.resultMessage=c;if(0!=b)a.ERROR.Code=b,a.ERROR.Message=c;else{"string"==typeof e&&(e=[e]);for(var l in e)m[l].Signature=m[l].Signature.replace("$$Sign$$",e[l]),b=m[l].plainText.substr(0,m[l].plainText.indexOf(n.KEY_START)),b+=m[l].Signature,b+=m[l].plainText.substr(m[l].plainText.indexOf(n.KEY_START),m[l].plainText.length),e[l]=b;g.signedData=e;g.certAttrs=a.SELCERTINFO.certattrs;g.tokenLabel=k}d(g)})})}else d(null);else a.ERROR.Code=-1,a.ERROR.Message=IDS_ERROR_NOT_SUPPORT_DEVICE,d(k(rv,rvMsg))}},VerifyVIDWithDN:function(b,d){function c(b,c,f,g,p,r){if("PFS"==r)try{G("b64 cert : ",a.PFUC[c].signcert);G("b64 pri : ",a.PFUC[c].signpri);var q=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[c].signcert),t=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[c].signpri),u=a.usWebToolkit.pkcs8.verifyVID(t,f,b,q);f=b="";u?d(e):d(null)}catch(v){f=b="",a.ERROR.Code=v.code,a.ERROR.Message=v.message,d(k(v.code,v.message))}else"NIM"==r?a.nimservice().VerifyVID(c,f,b,function(c,g){0==c?d(e):(a.ERROR.Code=c,a.ERROR.Message=g,d(k(c,g)));f=b=""}):"CLOUDSIGN"==r?reqVerifyVID(c,b,function(b,c,f){0!=b?(a.ERROR.Code=b,a.ERROR.Message=c,d(k(b,c))):f?d(e):(a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_MSGBOX_VID_ERROR_VERIFICATION,d(k(-1,a.ERROR.Message)))}):(a.ERROR.Code=-1,a.ERROR.Message=IDS_ERROR_NOT_SUPPORT_DEVICE,d(k(u,rvMsg)))}var f=a.SELCERTINFO.pw,e=k();if(b)c(b,a.SELCERTINFO.index,f,a.uiUtil().getErrorMessageLang().IDS_MSGBOX_VID_SUCCESS_VERIFICATION,a.uiUtil().getErrorMessageLang().IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM");else{var g=a.loadUI("ssn")({type:null,onConfirm:function(b){c(b,a.SELCERTINFO.index,f,a.uiUtil().getErrorMessageLang().IDS_MSGBOX_VID_SUCCESS_VERIFICATION,a.uiUtil().getErrorMessageLang().IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM");g.dispose()},onCancel:function(){g.dispose();a.uiUtil().getUserCancelErrCodeNMsg();d(k(a.ERROR.Code,a.ERROR.Message))}});g.show()}},likeActiveX:function(b){if(null==b)return!1;var d=!1,d=b.dn?0!=a.SELCERTINFO.index&&a.SELCERTINFO.certattrs&&a.SELCERTINFO.certattrs.subjectName==b.dn?a.SELCERTINFO.pw&&""!=a.SELCERTINFO.pw?!1:!0:!0:!0,c=!1;b.content&&"object"==typeof b.content&&(c=!0);switch(b.operation){case "GetUserDN":this.GetUserDN(b.callback);break;case "GetRValueFromKey":d?this.GetRValueFromKey(null,b.callback):this.GetRValueFromKey(b.dn,b.callback);break;case "SignDataP7WithDN":d?c?this.SignMultiDataP7(b.content,null,null,!0,null,b.callback):this.SignDataP7(b.content,null,!0,null,b.callback):this.SignDataP7WithDN(b.content,!0,b.callback);break;case "SignDataExcludeContentWithDN":d?c?this.SignMultiDataP7(b.content,null,null,!1,null,b.callback):this.SignDataP7(b.content,null,!1,null,b.callback):this.SignDataP7WithDN(b.content,!1,b.callback);break;case "SignData_noConWithHashWithDN":d?this.SignData_noConWithHash(b.content,null,b.alg,null,b.callback):this.SignData_noConWithHashWithDN(b.content,b.alg,b.callback);break;case "SignDataP7AndVerifyVIDWithDN":d?c?this.SignMultiDataP7NVerifyVID(b.content,null,null,!0,b.ssn,b.callback):this.SignDataP7AndVerifyVID(b.content,null,b.ssn,b.callback):this.SignDataP7AndVerifyVIDWithDN(b.content,b.ssn,!0,b.callback);break;case "SignDataP1WithDN":d?c?this.SignMultiDataP1(b.content,null,b.callback):this.SignDataP1(b.content,null,b.callback):this.SignDataP1WithDN(b.content,b.callback);break;case "MakeTaxXMLDSIGWithDN":d?this.MakeTaxXMLDSIG(b.content,null,null,b.callback):this.MakeTaxXMLDSIGWithDN(b.content,b.callback);break;case "VerifyVIDWithDN":d?this.VerifyVID(b.ssn,b.callback):this.VerifyVIDWithDN(b.ssn,b.callback)}}};E&&aa.log("It stop to load unisignweb module.")}else alert("Failed to initialize Unisign Core.")};