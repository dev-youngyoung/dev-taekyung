var __certmanagesub=function(a){var C=function(g){function y(a){if(!a)return alert("UI load error."),!1;var c=document.createElement("div");document.body.insertBefore(c,document.body.firstChild);c.innerHTML=a;return!0}function m(b){if(!b)return!1;var c=a.loadUI("certview")({type:null,args:{type:u,idx:h,cert:B},onConfirm:function(){c.dispose();b.focus()},onCancel:function(){c.dispose();b.focus()}});c.show();return!0}function e(b,c){if(!b||!c)return!1;Dialog=a.loadUI("changepassword")({type:null,args:null,onConfirm:function(s,l){if(null==s||0>=s.length||null==l||0>=l.length)return!1;try{var f=parseInt(h),e=a.PFUC[f],q,n;q=n=null;var r=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(e.signpri),k=a.usWebToolkit.pkcs8.checkUserCertPassword(r,s);if(!1===k){var r=null,m={code:-1,message:c.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD};throw m;}q=a.usWebToolkit.pkcs8.changePassword(r,s,l,"Base64");r=null;if("undefined"!==typeof e.kmcert){r=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(e.kmpri);k=a.usWebToolkit.pkcs8.checkUserCertPassword(r,s);if(!1===k)throw r=null,m={code:-1,message:c.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD},m;n=a.usWebToolkit.pkcs8.changePassword(r,s,l,"Base64")}var r=null,p={};p.signcert=e.signcert;p.signpri=q;null!==n&&(p.kmcert=e.kmcert,p.kmpri=n);if(a.CONST.__PF_M_LS.device===d)try{a.PFSH.SaveUserCert(e.ca,p,document.domain,!1),e=p=null,g.onConfirm(!0),a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_SUCCESS)}catch(t){switch(console.log("***** SANDBOX.PFSH.SaveUserCert *****"),console.log("e.code : ",t.code,"e.message : ",t.message,"e.detail : ",t.detail),t.code){case 1E7:0<=t.detail.indexOf("115010")?a.uiUtil().msgBox(c.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,t.detail);break;default:a.uiUtil().errMsgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,t.code);break}}finally{}else a.CONST.__PF_M_SS.device===d&&a.CCPFSH().SaveUserCert(e.ca,p,!1,function(d){0==d?(e=p=null,g.onConfirm(!0),a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_SUCCESS)):a.uiUtil().errMsgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,d);s=l="";Dialog.dispose();setTimeout(function(){b.focus()},10)})}catch(z){console.log("***** ChangePW error *****"),console.log("Err Code : ",z.code,"\nErr Msg : ",z.message),a.uiUtil().errMsgBox(z.message,z.code)}a.CONST.__PF_M_LS.device===d&&(s=l="",Dialog.dispose(),setTimeout(function(){b.focus()},10))},onCancel:function(){Dialog.dispose();setTimeout(function(){b.focus()},10)}});Dialog.show();return!0}function v(b,c){if(!b||!c)return!1;confirm(c.IDS_CONFIRMBOX_WARNING_DELETE_CERT)?(Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(e){if(null==e||0>=e.length)return!1;try{var l=parseInt(h),f=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[l].signpri),k=a.usWebToolkit.pkcs8.checkUserCertPassword(f,e),f="";if(!1===k)a.uiUtil().msgBox(c.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);else if(d==a.CONST.__PF_M_LS.device)try{a.PFSH.DeleteUserCertByIndex(l,document.domain),g.onConfirm(!0),a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_DELETE_SUCCESS)}catch(q){console.log("***** DeleteUserCertByIndex error *****"),console.log("e.code : ",q.code,"e.message : ",q.message,"e.detail : ",q.detail),a.uiUtil().errMsgBox(c.IDS_MSGBOX_CERT_DELETE_ERROR,q.code)}else d==a.CONST.__PF_M_SS.device&&a.CCPFSH().DeleteUserCertByIndex(l,function(d,f){0==d?(g.onConfirm(!0),a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_DELETE_SUCCESS)):a.uiUtil().errMsgBox(c.IDS_MSGBOX_CERT_DELETE_ERROR,d);e="";Dialog.dispose();setTimeout(function(){b.focus()},10)})}catch(n){console.log("***** CheckUserCertPassword error *****"),console.log("Err Code : ",n.code,"\nErr Msg : ",n.message),a.uiUtil().errMsgBox(n.message,n.code)}d==a.CONST.__PF_M_LS.device&&(e="",Dialog.dispose(),setTimeout(function(){b.focus()},10))},onCancel:function(){Dialog.dispose();setTimeout(function(){b.focus()},10)}}),Dialog.show()):b.focus();return!0}function A(b,c){if(!b||!c)return!1;var e=document.getElementById("m-us-cert-manage-sub-put-cert-out-btn");Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(b){var f=parseInt(h);if(!a.PFUC)return b="",console.log("[error] SANDBOX.PFUC is null"),!1;try{var k=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[f].signpri),g=a.usWebToolkit.pkcs8.checkUserCertPassword(k,b),k="";console.log("ExportPFX : bRv=",g);if(!1===g)a.uiUtil().msgBox(c.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);else if(d==a.CONST.__PF_M_LS.device){var n=a.PFSH.GetP12ForBuToPc(f,b,"binary"),r=n.p12,m=n.dn,A=a.certUtil().getCN(m)+".p12";console.log("ExportPFX : fileName=",A);a.fileUtil().save(A,r);r=m=n=null}else d==a.CONST.__PF_M_SS.device&&a.CCPFSH().GetP12ForBuToPc(f,b,"base64",function(c,d,f,h){if(0==c){c=a.usWebToolkit.util.decode64(h);d=Array(c.length);for(h=0;h<c.length;h++)d[h]=c.charCodeAt(h);c=new Uint8Array(d);f=a.certUtil().getCN(f)+".p12";console.log("ExportPFX : fileName=",f);console.log("ExportPFX : binary =",c);a.fileUtil().save(f,c)}b="";Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){e.focus()},10)})}catch(p){console.log("***** CheckUserCertPassword error *****"),console.log("Err Code : ",p.code,"\nErr Msg : ",p.message),a.uiUtil().errMsgBox(p.message,p.code)}finally{}d!=a.CONST.__PF_M_SS.device&&(b="",Dialog.dispose(),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){e.focus()},10))},onCancel:function(){Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){e.focus()},10)}});Dialog.show();return!0}var w=function(){var b;b=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");b.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/layout/mobile/m_certmanagesub.html?V="+a.ver,!1);b.send(null);return b.responseText},x=function(){var b;b=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");b.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/certmanage_"+a.ESVS.Language+".js?V="+a.ver,!1);b.send(null);return b.responseText},k=a.ESVS.TabIndex,u=g.args.type,h=g.args.idx,d=g.args.device,B=g.args.cert;return function(){var b=eval(w),c=eval(eval(x)());y(b());document.getElementById("m-us-lbl-cert-manage-sub-title").appendChild(document.createTextNode(c.IDS_CERT_MANAGEMENT));if(null!==h&&null!==B){a.usWebToolkit.x509Certificate.parser(B,u);var d=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),l=a.usWebToolkit.x509Certificate.getSubjectName(),f=a.usWebToolkit.x509Certificate.getNotAfter(),b=a.certUtil().getIssuerName(d);"undefined"==b&&(b=a.certUtil().getO(l));var l=a.certUtil().getCN(l),d=a.certUtil().getCertType(d),C=a.certUtil().getLocalDate(f),f=a.certUtil().getExpirationStateValue(f),q=document.getElementById("m-us-img-cert-manage-sub");if(0===f)q.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/mobile/m_cert_valid_small.png",0);else if(1===f)q.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/mobile/m_cert_valid_1_month_small.png",0);else if(2===f)q.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/mobile/m_cert_invalid_small.png",0);else return;f=document.getElementById("m-us-div-cert-manage-sub-info").getElementsByTagName("span");f[0].appendChild(document.createTextNode(l));f[1].appendChild(document.createTextNode(c.IDS_CERT_ISSUER));f[2].appendChild(document.createTextNode(b));f[3].appendChild(document.createTextNode(c.IDS_CERT_CLASSIFY));f[4].appendChild(document.createTextNode(d));f[5].appendChild(document.createTextNode(c.IDS_CERT_EXPIRATION_DAY));f[6].appendChild(document.createTextNode(C))}b=document.getElementById("m-us-cert-manage-sub-cert-view-btn");b.setAttribute("value",c.IDS_CERT_VIEW,0);b.setAttribute("title",c.IDS_CERT_VIEW+c.IDS_BUTTON,0);b.setAttribute("tabindex",k,0);b.onclick=function(){m(this)};b=document.getElementById("m-us-cert-manage-sub-pw-change-btn");b.setAttribute("value",c.IDS_PW_CHANGE,0);b.setAttribute("title",c.IDS_PW_CHANGE+c.IDS_BUTTON,0);b.setAttribute("tabindex",k+1,0);b.onclick=function(){e(this,c)};b=document.getElementById("m-us-cert-manage-sub-cert-copy-btn");b.setAttribute("value",c.IDS_CERT_COPY,0);b.setAttribute("title",c.IDS_CERT_COPY+c.IDS_BUTTON,0);b.setAttribute("tabindex",k+2,0);b.onclick=function(){};b.readOnly=!0;b.disabled=!0;b=document.getElementById("m-us-cert-manage-sub-cert-delete-btn");b.setAttribute("value",c.IDS_CERT_DELETE,0);b.setAttribute("title",c.IDS_CERT_DELETE+c.IDS_BUTTON,0);b.setAttribute("tabindex",k+3,0);b.onclick=function(){v(this,c)};b=document.getElementById("m-us-cert-manage-sub-put-cert-out-btn");b.setAttribute("value",c.IDS_CERT_PUT_OUT,0);b.setAttribute("title",c.IDS_CERT_PUT_OUT+c.IDS_BUTTON,0);b.setAttribute("tabindex",k+4,0);b.onclick=function(){A(this,c)};b=document.getElementById("m-us-cert-manage-sub-ccl-btn");b.setAttribute("value",c.IDS_CERT_CANCEL,0);b.setAttribute("title",c.IDS_CERT_CANCEL+c.IDS_BUTTON,0);b.setAttribute("tabindex",k+5,0);b.onclick=function(){g.onCancel()};b=document.getElementById("m-us-cert-manage-sub-cls-btn-img");b.setAttribute("alt",c.IDS_PASSWORD_CLOSE,0);b.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/mobile/m_x-btn.png",0);b=document.getElementById("m-us-cert-manage-sub-cls-btn");b.setAttribute("tabindex",k+7,0);b.onclick=function(){g.onCancel()};return document.getElementById("m-us-div-cert-manage-sub")}()};return function(g){var y=a.uiLayerLevel,m=a.uiUtil().getOverlay(y),e=C({type:g.type,args:g.args,onConfirm:g.onConfirm,onCancel:g.onCancel,onTerminate:g.onTerminate});e.style.zIndex=y+1;a.ESVS.TargetObj.insertBefore(m,a.ESVS.TargetObj.firstChild);var v=window.onorientationchange;return{show:function(){m.style.display="block";var g=a.uiUtil().getNumSize(a.uiUtil().getStyle(e,"height","height")),g=-1===g?a.uiUtil().getScrollTop()+a.uiUtil().getViewportHeight()/6:a.uiUtil().getScrollTop()+(a.uiUtil().getViewportHeight()-g)/3;e.style.top=0>g?"0px":g+"px";e.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(e,"width","width")))/2+"px";e.style.display="block";var w=0,x=0,k=0,u=0;0==window.orientation||180==window.orientation?(w=a.uiUtil().getViewportWidth(),x=a.uiUtil().getViewportHeight()):(k=a.uiUtil().getViewportWidth(),u=a.uiUtil().getViewportHeight());window.addEventListener("orientationchange",function(){var h=0,d=0;"android chrome"==a.browserName||"unknown"==a.browserName?0==window.orientation||180==window.orientation?0<w?(h=w,d=x):(h=u+87,d=k-40):0<k?(h=k,d=u):(h=x+87,d=w-40):(h=a.uiUtil().getViewportWidth(),d=a.uiUtil().getViewportHeight());var g=a.uiUtil().getNumSize(a.uiUtil().getStyle(e,"width","width"));-1<g&&(h=a.uiUtil().getScrollLeft()+(h-g)/2+"px",e.style.left=h);h=a.uiUtil().getNumSize(a.uiUtil().getStyle(e,"height","height"));d=-1===h?a.uiUtil().getScrollTop()+d/6:a.uiUtil().getScrollTop()+(d-h)/3;e.style.top=d+"px";v&&v()});a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;setTimeout(function(){var a=e.getElementsByTagName("input");if(0<a.length)for(var d=0;d<a.length;d++)"m-us-cert-manage-sub-cert-view-btn"==a[d].id&&a[d].focus()},10)},hide:function(){m.style.display="none";e.style.display="none"},dispose:function(){window.addEventListener("orientationchange",function(){v&&v()});e.parentNode.parentNode.removeChild(e.parentNode);m.parentNode.removeChild(m);a.uiLayerLevel-=10;a.ESVS.TabIndex-=30}}}};