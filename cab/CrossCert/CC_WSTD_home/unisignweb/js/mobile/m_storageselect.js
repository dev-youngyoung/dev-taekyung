var __storageselect=function(b){var t=function(d){function r(a){if(!a)return alert("UI load error."),!1;if("CERT_STORAGE"===d.type)b.ESVS.TargetObj.innerHTML=a;else{var c=document.createElement("div");document.body.insertBefore(c,document.body.firstChild);c.innerHTML=a}return!0}function l(a){if(b.CONST.__USFB_M_DISK.device>k||(b.CONST.__USFB_M_DISK.device===k||b.CONST.__USFB_M_HSMKEY.device===k)&&1>m)return b.uiUtil().msgBox(a.IDS_MSGBOX_ERROR_PLEASE_SELECT_STORAGE),!1;if("CERT_COPY"==d.type&&d.args.sourceDevice===k&&d.args.sourceDrive===m)return b.uiUtil().msgBox(a.IDS_MSGBOX_ERROR_WARNING_SAME_STORAGE),!1;if(("CERT_COPY"===d.type||"CERT_IMPORT"===d.type||"CERT_STORAGE"===d.type)&&b.CONST.__USFB_M_SMARTCARD.device===k&&0===m&&!confirm(a.IDS_CONFIRMBOX_WARNING_CHANGE_CERT))return!1;d.onConfirm(k,m);return!0}function g(a){if(!a)return!1;for(var c=b.ESVS.Media.list.split("|"),h=0;h<c.length;h++){var f=b.CONST.medias[c[h]];void 0!=f&&null!=f&&(f=document.getElementById("m-us-btn-storage-"+f.name),void 0!=f&&null!=f&&"m-us-layout-storage-btn-none"!=f.className&&(a===f?(f.className="m-us-layout-storage-btn-on",f.focus()):f.className="m-us-layout-storage-btn-off"))}return!0}function q(a){if(null==a||void 0==a)return!1;var c=!b.uiUtil().isItSupportingThisStorage(a);!1==c&&null!=b.ESVS.Media&&null!=b.ESVS.Media.list&&0>b.ESVS.Media.list.indexOf(a.name)&&(c=!0);if(c)return!1;var c=document.getElementById("m-us-btn-storage-btn-list"),h=document.createElement("li");h.setAttribute("id","m-us-storage-btn-li-"+a.name,0);h.setAttribute("mediaIndex",a.mediaIndex,0);5==a.mediaIndex&&(h.className="line-first");"hidden"===a.visibility?(h.style.display="none",h.style.visibility="hidden"):(h.style.display="block",h.style.visibility="visible");var f=document.createElement("button");f.setAttribute("type","button",0);f.setAttribute("id","m-us-btn-storage-"+a.name,0);f.setAttribute("title",a.label,0);f.setAttribute("tabindex",a.tabIndex,0);a.disabled?(f.onclick=function(){},f.className="m-us-layout-storage-btn-none"):(f.onclick=a.onclick,a.device===k?(f.className="m-us-layout-storage-btn-on",f.focus()):f.className="m-us-layout-storage-btn-off");h.appendChild(f);if("harddisk"!==a.name&&"webstorage"!==a.name){var e=document.createElement("span");e.className="m-us-drive-select";f.appendChild(e)}e=document.createElement("span");e.className="m-us-img-storage";var d=document.createElement("img");d.setAttribute("id","m-us-img-storage-"+a.name,0);d.setAttribute("alt",a.label,0);a.disabled?d.setAttribute("src",b.ESVS.SRCPath+"unisignweb/rsrc/img/mobile/m_media_"+a.name+"_d.png",0):d.setAttribute("src",b.ESVS.SRCPath+"unisignweb/rsrc/img/mobile/m_media_"+a.name+".png",0);e.appendChild(d);f.appendChild(e);e=document.createElement("span");e.setAttribute("id","m-us-lbl-storage-"+a.name,0);e.className="m-us-layout-lbl-storage";e.appendChild(document.createTextNode(a.label));f.appendChild(e);h.appendChild(f);c.appendChild(h);return!0}var s=function(){var a;a=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");a.open("GET",b.ESVS.SRCPath+"unisignweb/rsrc/layout/mobile/m_storageselect.html?V="+b.ver,!1);a.send(null);return a.responseText},p=function(){var a;a=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");a.open("GET",b.ESVS.SRCPath+"unisignweb/rsrc/lang/storageselect_"+b.ESVS.Language+".js?V="+b.ver,!1);a.send(null);return a.responseText};eval(eval(p)());var n=b.ESVS.TabIndex,k=b.CONST.__USFB_M_DISK.device,m=0,k=b.CONST.__PF_M_LS.device;return function(){var a=eval(s),c=eval(eval(p)());r(a());document.getElementById("m-us-storage-select-lbl-title").appendChild(document.createTextNode(c.IDS_STORAGE_SELECTION));a=document.getElementById("m-us-storage-select-cls-btn-img");a.setAttribute("alt",c.IDS_STORAGE_SELECTION_CLOSE,0);a.setAttribute("src",b.ESVS.SRCPath+"unisignweb/rsrc/img/mobile/m_x-btn.png",0);a=document.getElementById("m-us-storage-select-notice-lbl");"CERT_STORAGE"===d.type?a.appendChild(document.createTextNode(c.IDS_SAVE_NOTICE)):a.appendChild(document.createTextNode(c.IDS_COPY_NOTICE));for(var a=0,h=b.ESVS.Media.list.split("|"),f=0;f<h.length;f++){var e=b.CONST.medias[h[f]];if(void 0!=e&&null!=e){switch(e.device){case b.CONST.__PF_M_LS.device:e.label=c.IDS_STORAGE_LS;e.disabled=1==b.ESVS.Mode||"CERT_COPY"==d.type;e.onclick=function(){this&&c&&(this.focus(),k=b.CONST.__PF_M_LS.device,l(c));g(this)};break;case b.CONST.__PF_M_SS.device:e.label=c.IDS_STORAGE_SS;e.disabled=1==b.ESVS.Mode||"CERT_COPY"==d.type;e.onclick=function(){this&&c&&(this.focus(),k=b.CONST.__PF_M_SS.device,l(c));g(this)};break;case b.CONST.__PF_M_TOUCHSIGN.device:e.label=c.IDS_STORAGE_TOUCHSIGN;e.disabled=!0;e.onclick=function(){};break;case b.CONST.__PF_M_SMARTSIGN.device:e.label=c.IDS_STORAGE_SMARTSIGN;e.disabled=!0;e.onclick=function(){};break;case b.CONST.__PF_M_WEBSECTOKEN.device:e.label=c.IDS_STORAGE_WEBSECTOKEN;e.disabled=!0;e.onclick=function(){};break;case b.CONST.__PF_M_WEBSOFTTOKEN.device:e.label=c.IDS_STORAGE_WEBSOFTTOKEN;e.disabled=!0;e.onclick=function(){};break;default:e.label=c.IDS_STORAGE_ETC,e.disabled=!0,e.onclick=function(){}}e.tabIndex=n;e.mediaIndex=a+1;e.visibility="visible";q(e)&&(n++,a++,1==a&&document.getElementById("m-us-btn-storage-"+e.name).focus())}}document.getElementById("m-us-storage-select-warning-lbl").appendChild(document.createTextNode(c.IDS_WARNING));a=document.getElementById("m-us-storage-select-cancel-btn");a.setAttribute("value",c.IDS_CANCEL,0);a.setAttribute("title",c.IDS_CANCEL+c.IDS_BUTTON,0);a.setAttribute("tabindex",n++,0);a.onclick=function(){d.onCancel()};a=document.getElementById("m-us-storage-select-cls-img-btn");a.setAttribute("tabindex",n++,0);a.onclick=function(){d.onCancel()};return document.getElementById("m-us-div-storage-select")}()};return function(d){var r=b.uiLayerLevel,l=b.uiUtil().getOverlay(r),g=t({type:d.type,args:d.args,onConfirm:d.onConfirm,onCancel:d.onCancel});g.style.zIndex=r+1;b.ESVS.TargetObj.insertBefore(l,b.ESVS.TargetObj.firstChild);var q=window.onorientationchange;return{show:function(){l.style.display="block";var d=b.uiUtil().getNumSize(b.uiUtil().getStyle(g,"height","height")),d=-1===d?b.uiUtil().getScrollTop()+b.uiUtil().getViewportHeight()/6:b.uiUtil().getScrollTop()+(b.uiUtil().getViewportHeight()-d)/3;g.style.top=0>d?"0px":d+"px";g.style.left=b.uiUtil().getScrollLeft()+(b.uiUtil().getViewportWidth()-b.uiUtil().getNumSize(b.uiUtil().getStyle(g,"width","width")))/2+"px";g.style.display="block";var p=0,n=0,k=0,m=0;0==window.orientation||180==window.orientation?(p=b.uiUtil().getViewportWidth(),n=b.uiUtil().getViewportHeight()):(k=b.uiUtil().getViewportWidth(),m=b.uiUtil().getViewportHeight());window.addEventListener("orientationchange",function(){var a=0,c=0;"android chrome"==b.browserName||"unknown"==b.browserName?0==window.orientation||180==window.orientation?0<p?(a=p,c=n):(a=m+87,c=k-40):0<k?(a=k,c=m):(a=n+87,c=p-40):(a=b.uiUtil().getViewportWidth(),c=b.uiUtil().getViewportHeight());var d=b.uiUtil().getNumSize(b.uiUtil().getStyle(g,"width","width"));-1<d&&(a=b.uiUtil().getScrollLeft()+(a-d)/2+"px",g.style.left=a);a=b.uiUtil().getNumSize(b.uiUtil().getStyle(g,"height","height"));c=-1===a?b.uiUtil().getScrollTop()+c/6:b.uiUtil().getScrollTop()+(c-a)/3;g.style.top=c+"px";q&&q()});b.uiLayerLevel+=10;b.ESVS.TabIndex+=30;setTimeout(function(){for(var a=b.ESVS.Media.list.split("|"),c=0;c<a.length;c++){var d=b.CONST.medias[a[c]];if(void 0!=d&&null!=d&&(d=document.getElementById("m-us-btn-storage-"+d.name),void 0!=d&&null!=d)){d.focus();break}}},10)},hide:function(){l.style.display="none";g.style.display="none"},dispose:function(){window.addEventListener("orientationchange",function(){q&&q()});"CERT_STORAGE"===d.type?g.parentNode.removeChild(g):g.parentNode.parentNode.removeChild(g.parentNode);l.parentNode.removeChild(l);b.uiLayerLevel-=10;b.ESVS.TabIndex-=30}}}};