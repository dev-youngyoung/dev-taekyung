var __certselect=function(a){var P=function(g){function w(){if(!a.certsList)return null;var c=null,c=a.certsList,b=c.list.length,d=[],e=g.args.dn,h=null;null!=a.ESVS.Policy&&(-1!=a.ESVS.Policy.indexOf("|")?h=a.ESVS.Policy.split("|"):(h=[],h[0]=a.ESVS.Policy));var f=null;null!=a.ESVS.Organization&&(-1!=a.ESVS.Organization.indexOf("|")?f=a.ESVS.Organization.split("|"):(f=[],f[0]=a.ESVS.Organization));for(var A=0;A<b;A++){a.usWebToolkit.x509Certificate.parser(c.list[A].cert,"Base64");var k=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),l=a.usWebToolkit.x509Certificate.getSubjectName(),m=a.usWebToolkit.x509Certificate.getNotAfter(),n=a.usWebToolkit.x509Certificate.getNotAfter(),F=c.list[A].index,t=a.certUtil().getIssuerName(k);"undefined"==t&&(t=a.certUtil().getO(l));if(null==e||l.toLowerCase()==e.toLowerCase()){if(null!=a.ESVS.Policy){for(var x=0;x<h.length&&h[x]!=k;x++);if(h.length<=x)continue}if(null!=a.ESVS.Organization&&("CERT_RENEWAL"==g.type||"CERT_RENEWAL_SIGN"==g.type||"CERT_RENEWAL_KMCERT"==g.type||"CERT_REVOCATION"==g.type||"CERT_SOE"==g.type||"CERT_RENEWAL_SIGN"==g.type)){for(x=0;x<f.length&&f[x].toLowerCase()!=a.certUtil().getO(l).toLowerCase();x++);if(f.length<=x)continue}if(a.ESVS.ShowExpiredCerts||2!==a.certUtil().getExpirationStateValue(n))x=[""],x[1]=a.certUtil().getCertType(k),x[2]=a.certUtil().getCN(l),x[3]=t,x[4]=a.certUtil().getLocalDate(m),x[5]=F,x[6]=a.certUtil().getExpirationStateValue(n),d.push(x)}}return c={list:d}}function r(c,b,d,e,h,f,A){function k(){var a=w();"draw"==c?a?l.drawList(f,f.length,a.list,a.list.length,J,A):l.drawList(f,f.length,null,0,J,A):"redraw"==c&&(a?l.redrawList(a.list,a.list.length):l.redrawList(null,0))}if(a.CONST.__USFB_M_DISK.device>b||0>d||!e)return-1;var p=0;q=d;a.certsList&&(a.certsList=null);if(b==a.CONST.__PF_M_SS.device&&a.CCPFSH())a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.PKI,function(b,c){0==b&&a.CCPFSH().GetCertificateList(function(b,c){if(0==b){var d=0;(a.PFUC=c)&&(d=c.length-1);if(0<d){for(var e=[],f=0;f<d;f++){var h=f+1,g={};g.index=h;g.cert=c[h].signcert;e[f]=g}a.certsList={list:e}}(d=w())?l.redrawList(d.list,d.list.length):l.redrawList(null,0);return!0}return!1})});else if(b==a.CONST.__PF_M_CLOUDSIGN.device){if(g.CS_phoneNumber)F(g.CS_phoneNumber);else{var m=a.loadUI("phoneNumber"),n=m({type:"phoneNumber",args:null,onConfirm:function(a){L=a;F(a);n.dispose()},onCancel:function(){n.dispose()}});n.show()}var F=function(b){a.uiUtil().loadingBox(!0,"us-div-list-load",0);reqMemberInfo(b,function(c,d,e){if(0!=c)return a.uiUtil().loadingBox(!1,"us-div-list-load",0),alert(d+"\n\nError Code [ "+c+" ]"),!1;c=parseInt(e.split("|")[0]);if(0<c)t(b);else{if(-1==c){a.uiUtil().loadingBox(!1,"us-div-list-load",0);var f=m({type:"double",args:null,onCancel:function(){f.dispose()}})}else a.uiUtil().loadingBox(!1,"us-div-list-load",0),f=m({type:"joinus",args:{flag:parseInt(e.split("|")[1].split("=")[1]),pNumber:b},onCancel:function(){f.dispose()}});f.show()}})},t=function(b){reqGetCert(b,function(b,c,d){if(0!=b)return a.uiUtil().loadingBox(!1,"us-div-list-load",0),a.uiUtil().errMsgBox(c,b),!1;if(0<d.length){b=[];for(c=0;c<d.length;c++){var e={};e.index=c+1;e.cert=d[c];b[c]=e}a.certsList={list:b}}(d=w())?l.redrawList(d.list,d.list.length):l.redrawList(null,0);a.uiUtil().loadingBox(!1,"us-div-list-load",0);return!0})}}else a.nimservice()?a.nimservice().GetAllMediaList(0,function(c,e){0==c?a.nimservice().GetAllUserCertListNum(b,d,"",a.ESVS.Policy,function(c,d){p=d;if(0==c)0<p?a.nimservice().GetAllUserCert(d,function(b,c){0==b?a.certsList={list:c}:a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),b);a.uiUtil().loadingBox(!1,"us-div-list-load");k()}):(k(),a.uiUtil().loadingBox(!1,"us-div-list-load"));else{if(b==a.CONST.__USFB_M_MOBILE.device&&(11003==c||11004==c))return a.ERROR.Code=11003,a.ERROR.Message=C.IDS_MSGBOX_NOT_INSTALL_MOBILE,confirm(C.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)?(document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"))&&a.uiUtil().msgBox(C.IDS_MSGBOX_BLOCK_POPUP_WINDOW)):a.uiUtil().loadingBox(!1,"us-div-list-load"),!1;if(-1===p)c=-1;else{var e=a.nimservice().GetLastErrorCode(),f=a.nimservice().GetLastErrorMessage();a.uiUtil().errMsgBox(f,c);c=e}k();done=1;a.uiUtil().loadingBox(!1,"us-div-list-load")}}):(c=-1,k(),done=1,a.uiUtil().loadingBox(!1,"us-div-list-load"))}):(k(),a.uiUtil().msgBox(e.IDS_MSGBOX_NIM_ERROR_UNLOAD))}function y(c,b,d,e){if(a.CONST.__USFB_M_DISK.device>c||0>b||!d)return-1;var h=0,f=0;q=b;a.certsList&&(a.certsList=null);if(a.CONST.__PF_M_LS.device===c&&2&a.ESVS.Mode){if(!a.PFSH)return-1;try{a.PFSH.SelectStorage(1)}catch(g){}try{a.PFSH.LoadAllCerts(document.domain)}catch(k){301E5===k.code&&(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain))}c=null;try{c=a.PFSH.GetUserCerts(document.domain),a.PFUC=c}catch(l){}c&&(h=c.length-1);if(0<h){b=[];for(d=0;d<h;d++){e=d+1;var m={};m.index=e;m.cert=c[e].signcert;b[d]=m}a.certsList={list:b}}else a.certsList=null,f=0}else if(a.CONST.__PF_M_LS.device!==c&&1&a.ESVS.Mode)if(a.plugin().valid)if("GPKI"==a.ESVS.PKI?a.plugin().SetGPKI():a.ESVS.PKI&&"NPKI"!=a.ESVS.PKI&&a.plugin().SetPCA(a.ESVS.PKI),h=a.CONST.__USFB_M_SMARTCARD.device===c?a.plugin().GetAllUserCertListNum(c,b,e):a.plugin().GetAllUserCertListNum(c,b,""),0<h){b=[];for(d=0;d<h;d++)e=d+1,m={},m.index=e,m.cert=a.plugin().GetUserSignCertFromCertList(e),b[d]=m;a.certsList={list:b}}else 0===h?f=0:(h=a.plugin().GetLastErrorCode(),a.plugin().GetLastErrorMessage(),f=h),a.certsList=null;else return a.uiUtil().msgBox(d.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),-1;return f}function B(c,b){if(!c||!b)return!1;if(!a.certsList||0>l.selectedIndex())return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var d=a.loadUI("certverify")({type:null,args:{idx:parseInt(l.selectedIndex())},onConfirm:function(){d.dispose();c.focus()},onCancel:function(){d.dispose();c.focus()}});d.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function Y(c,b){if(!c||!b)return!1;if(!a.certsList||0>l.selectedIndex())return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var d=a.loadUI("certview")({type:null,args:{type:"Base64",idx:parseInt(l.selectedIndex()),cert:a.certsList.list[parseInt(l.selectedIndex())-1].cert},onConfirm:function(){d.dispose();c.focus()},onCancel:function(){d.dispose();c.focus()}});d.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function Q(c,b,d,e){if(a.CONST.__USFB_M_DISK.device>c||!b||!d||!e)return!1;var h=a.loadUI("driveselect")({type:"DEVICE_REMOVABLE_DISK",args:b,onConfirm:function(b){0<b&&(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k?r("redraw",c,b,e,""):(b=y(c,b,e,""),0!=b?(a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),l.redrawList(null,0)):(b=w())?l.redrawList(b.list,b.list.length):l.redrawList(null,0)));a.ESVS.Embedded?setTimeout(function(){h.dispose()},10):h.dispose();d.focus();a.uiUtil().loadingBox(!1,"us-div-list-load")},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");h.dispose();d.focus()}});h.show();return!0}function R(c,b,d,e){if(a.CONST.__USFB_M_DISK.device>c||!d||!e)return!1;var h=a.loadUI("sectokenselect")({type:c,args:b,onConfirm:function(f){if(0<f){var A=b.list[f-1].name;if(("CERT_RENEWAL"==g.type||"CERT_RENEWAL_SIGN"==g.type||"CERT_RENEWAL_KMCERT"==g.type)&&-1!=A.indexOf("BIO")){a.uiUtil().msgBox(e.IDS_MSGBOX_BLOCK_BIOTOKEN_FORISSUE);return}if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k)r("redraw",c,f,e,"");else if(f=y(c,f,e,""),0!=f){switch(f){case 4812E4:case 4813E4:a.uiUtil().msgBox(e.IDS_MSGBOX_HSM_ERROR_CONNECTION);break;default:a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,f)}l.redrawList(null,0)}else(f=w())?l.redrawList(f.list,f.list.length):l.redrawList(null,0)}a.ESVS.Embedded?setTimeout(function(){h.dispose()},10):h.dispose();d.focus()},onCancel:function(){h.dispose();d.focus()}});h.show();return!0}function Z(c,b,d,e){if(a.CONST.__USFB_M_DISK.device>c||!b||!d||!e)return!1;var h=a.loadUI("driveselect")({type:"DEVICE_SAVE_TOKEN",args:b,onConfirm:function(b){h.dispose();if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k)r("redraw",c,b,e,"");else if(a.plugin().valid){var g=a.plugin().CheckSmartCard();0===g?(PINDialog=a.loadUI("pin")({type:"PIN_SAVE_TOKEN",args:null,onConfirm:function(b){g=a.plugin().CheckPinNumberSCard(b);if(0!=g){switch(g){case 49000004:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 49000005:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;default:a.uiUtil().errMsgBox(e.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN,f)}l.redrawList(null,0)}else{var f=y(c,0,e,b);0!=f?(a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,f),l.redrawList(null,0)):(b=w())?l.redrawList(b.list,b.list.length):l.redrawList(null,0)}a.ESVS.Embedded?setTimeout(function(){PINDialog.dispose()},10):PINDialog.dispose();setTimeout(function(){d.focus()},10)},onCancel:function(){PINDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){d.focus()},10)}}),PINDialog.show()):(a.uiUtil().msgBox(e.IDS_MSGBOX_SMART_CARD_UNCONNECTED),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){d.focus()},10))}else a.uiUtil().msgBox(e.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){d.focus()},10)},onCancel:function(){h.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");d.focus()}});h.show();return!0}function $(c,b){if(!c||!b)return!1;var d=null;k=a.CONST.__USFB_M_DISK.device;q=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);E(b);z();if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_DISK.device,function(e){if(0<e){for(var f=[],h=0;h<e;h++){var g=h+1,k={};k.index=g;k.name=a.nimservice().GetDiskDriveName(g);f[h]=k}d={list:f}}else return-1===e&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage()),a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,!1;Q(a.CONST.__USFB_M_DISK.device,d,c,b)});else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else{if(a.plugin().valid){var e=a.plugin().GetDiskListNum();if(0<e){for(var h=[],f=0;f<e;f++){var g=f+1,v={};v.index=g;v.name=a.plugin().GetDiskDriveName(g);h[f]=v}d={list:h}}else return-1===e&&(a.plugin().GetLastErrorCode(),a.plugin().GetLastErrorMessage()),a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,!1}else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),!1;Q(a.CONST.__USFB_M_DISK.device,d,c,b)}return!0}function G(c,b){if(!c||!b)return!1;var d=null;k=a.CONST.__USFB_M_HSMKEY.device;q=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);aa(b);z();if(1&a.ESVS.Mode)if(a.plugin().valid){var e=[],h=a.plugin().GetHSMInstallListNum();if(0<h)for(var f=0;f<h;f++){var g=f+1,v={},p=a.plugin().GetHSMInstallDriverName(g).split("|");v.index=g;v.name=p[0];v.driver=p[1];v.passage=p[2];v.validity=p[3];e[f]=v}else-1===h&&(a.plugin().GetLastErrorCode(),a.plugin().GetLastErrorMessage());d={list:e}}else return a.uiUtil().msgBox(b.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD),!1;else if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_HSMKEY.device,function(e){if(0<e){for(var f=[],h=0;h<e;h++){var g=h+1,k={},A=a.nimservice().GetSecureTokenName(g).split("|");k.index=g;k.name=A[0];k.driver=A[1];k.passage=A[2];f[h]=k}d={list:f}}else a.nimservice().GetLastErrorCode();R(a.CONST.__USFB_M_HSMKEY.device,d,c,b)});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;4&a.ESVS.Mode||R(a.CONST.__USFB_M_HSMKEY.device,d,c,b);return!0}function P(c,b){if(!c||!b)return!1;var d=null;k=a.CONST.__USFB_M_SMARTCARD.device;q=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);E(b);z();if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_SMARTCARD.device,function(e){if(0<e){for(var h=[],f=0;f<e;f++){var g=f+1,k={};k.index=g;k.name=a.nimservice().GetSmartCardName(g);h[f]=k}d={list:h}}else return-1===e&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage()),a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),!1;Z(a.CONST.__USFB_M_SMARTCARD.device,d,c,b)});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),!1;return!0}function S(c,b){if(!c||!b)return!1;k=a.CONST.__USFB_M_MOBILETOKEN.device;q=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);E(b);z();if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_MOBILETOKEN.device,function(b){0<b?document.getElementById("us-confirm-btn").click():(a.ERROR.Code=210020,a.ERROR.Message=C.IDS_MSGBOX_NOT_INSTALL_SMARTCERT,confirm(C.IDS_CONFIRMBOX_NOT_INSTALL_SMARTCERT)?(document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.usimEnv.downloadURL,"usim_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.usimEnv.downloadURL,"usim_url","top=100px, left=100px, height=500px, width=380px"))&&a.uiUtil().msgBox(C.IDS_MSGBOX_BLOCK_POPUP_WINDOW)):(l.redrawList(null,-1),document.getElementById("us-div-cert-select").style.display=""))});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function ba(c,b){if(!c||!b)return!1;var d=[function(){S(c,b)},function(){ca(c,b)}],e=a.loadUI("mobileselect")({type:null,args:null,onConfirm:function(a){d[a]();e.dispose()},onCancel:function(){e.dispose()}});e.show();return!0}function ca(c,b){if(!c||!b)return!1;k=a.CONST.__USFB_M_MOBILE.device;q=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);E(b);z();if(4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k)if(a.nimservice())a.nimservice().GetDiskListNum(a.CONST.__USFB_M_MOBILE.device,function(c){if(0<c)r("redraw",a.CONST.__USFB_M_MOBILE.device,0,b,"");else return a.ERROR.Code=11003,a.ERROR.Message=C.IDS_MSGBOX_NOT_INSTALL_MOBILE,document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"))&&a.uiUtil().msgBox(C.IDS_MSGBOX_BLOCK_POPUP_WINDOW),!1});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function H(c,b){if(!c||!b)return!1;a.uiUtil().MsgBox(b.IDS_MSGBOX_NOT_SUPPORTED_MEDIA);return!0}function E(a){if(!a)return!1;var b=document.getElementById("us-lbl-pw");b.removeChild(b.lastChild);b.appendChild(document.createTextNode(a.IDS_PASSWORD));document.getElementById("us-lbl-pw2").innerHTML=C.IDS_PASSWORD_DESCRIPTION;return!0}function aa(a){if(!a)return!1;var b=document.getElementById("us-lbl-pw");b.removeChild(b.lastChild);b.appendChild(document.createTextNode(a.IDS_PIN));document.getElementById("us-lbl-pw2").innerHTML="";return!0}function K(c){if(null==c||0>=c.length)return!1;var b=document.getElementById("us-pw-text");b.value=c;b.readOnly=!0;b.disabled=!0;k==a.CONST.__PF_M_CLOUDSIGN.device&&(document.getElementById("us-div-pw").style.display="none");return!0}function z(){k!=a.CONST.__PF_M_CLOUDSIGN.device&&(document.getElementById("us-div-pw").style.display="block");var c=document.getElementById("us-pw-text");c&&(c.value="",c.readOnly=!1,c.disabled=!1)}function M(c,b,d){function e(){a.certsList&&(a.certsList=null);l.redrawList(null,-1);z();b=""}if(4&a.ESVS.Mode){if(null==d)return!1}else if(null==b||0>=b.length||null==d)return!1;a.certsList&&(a.certsList=null);if(0<c){var h=[],f={},g=null;if(4&a.ESVS.Mode)f.index=c,a.nimservice().GetSelectUserCert(c,function(b,c){if(0==b){f.cert=c;h[0]=f;a.certsList={list:h};if(g=w())return l.redrawList(g.list,g.list.length),!0;e();return!1}e();return!1});else{f.index=c;f.cert=a.plugin().GetUserSignCertFromCertList(c);h[0]=f;a.certsList={list:h};if(g=w())return l.redrawList(g.list,g.list.length),K(b),b="",!0;e();return!1}}else{c=a.plugin().GetLastErrorCode();a.plugin().GetLastErrorMessage();switch(c){case 4301E4:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c)}e();return!1}}function da(c,b,d){if(null==c||0>=c.length||null==b||0>=b.length||null==d)return!1;a.plugin().valid?(c=a.plugin().GetPfxCertList(c,b),M(c,b,d)):a.uiUtil().msgBox(d.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD)}function ea(c,b,d){if(null==c||0>=c.length||null==b||0>=b.length||null==d)return!1;var e=!1;if(1&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k)a.plugin().valid?(e=a.plugin().GetPfxCertListString(c,b),e=M(e,b,d)):a.uiUtil().msgBox(d.IDS_MSGBOX_PLUGIN_ERROR_UNLOAD);else a:if(c&&b&&d){var e=0,h={};try{var f=a.PFSH.SetP12OnMemory(c,b),e=f.index;a.PFUC=h=f.aluc}catch(g){switch(g.code){case 1E7:0<=g.detail.indexOf("115010")?a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,g.detail);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,g.code)}e=!1;break a}a.certsList&&(a.certsList=null);d=[];c={};f=null;c.index=e;c.cert=h[e].signcert;d[0]=c;a.certsList={list:d};(f=w())?(l.redrawList(f.list,f.list.length),K(b),e=!0):(a.certsList=null,l.redrawList(null,-1),z(),e=!1)}else e=!1;return e}function T(c,b){if(null==c||0>=c.length||null==b)return!1;if(0<c.length&&-1<c.indexOf(".")){var d=c.split("."),d=d[d.length-1].toLowerCase();if("pfx"!=d&&"p12"!=d)return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_NOT_PFX),!1}else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1;return!0}function fa(c){if(null==c)return!1;if(4&a.ESVS.Mode)if(k=a.CONST.__USFB_M_ETC.device,q=0,a.nimservice())a.nimservice().GetCertListWithP12(a.CONST.__USFB_M_ETC.device,0,"","",function(b,e){if(0==b)b=M(1,"",c,function(a){b=a;return 0==b?!0:!1});else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(e,b),!1});else return pw="",a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD),rv;else{var b=document.getElementById("us-file-search-hidden");if("safari"==a.browserName&&6>parseFloat(a.browserVersion))return a.uiUtil().msgBox(c.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_SAFARI),!1;if("opera"==a.browserName||"safari"==a.browserName||"msie"==a.browserName&&8===parseInt(a.browserVersion))b.style.display="block";b.value="";if(""!=b.value){var d=b.onchange,e=b.parentNode;e.removeChild(b);b=document.createElement("input");b.setAttribute("type","file",0);b.setAttribute("accept","application/x-pkcs12",0);b.setAttribute("id","us-file-search-hidden",0);b.className="us-layout-file-search-hidden";b.onchange=d;e.appendChild(b)}b.click();return!0}}function ga(c,b){if(!c||!b)return!1;k=a.CONST.__USFB_M_ETC.device;q=0;var d=null,e=null,h=document.getElementById("us-confirm-btn"),f=document.getElementById("us-cert-search-btn");if("opera"==a.browserName||"safari"==a.browserName)c.style.display="none";if(window.FileReader){var g=c.files;if(0<g.length){var l=g[0];if(!0==T(l.name,b)){var p=new FileReader;p.readAsBinaryString?(p.readAsBinaryString(l),p.addEventListener("load",function(){var c=p.result,d=c.length;if(l.size===d)e=a.usWebToolkit.util.encode64(c,d);else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1})):(p.readAsArrayBuffer(l),p.addEventListener("load",function(){var c=p.result,d=null;try{var f=String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(c)));try{d=decodeURIComponent(escape(f))}catch(h){if(h instanceof URIError)d=f;else throw h;}}catch(g){return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1}c=d.length;if(l.size===c)e=a.usWebToolkit.util.encode64(d,c);else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1}))}else return setTimeout(function(){f.focus()},10),!1}else return setTimeout(function(){f.focus()},10),!1}else{if("msie"==a.browserName&&8===parseInt(a.browserVersion))g=document.getElementById("us-div-cert-select"),g.onselectstart=function(){return!0},c.select(),d=c.value,c.style.display="none",g.onselectstart=function(){return!1};else if("msie"==a.browserName&&9===parseInt(a.browserVersion)){if(d=c.value,-1<d.indexOf("fakepath"))return a.uiUtil().msgBox(b.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_IE9),setTimeout(function(){f.focus()},10),!1}else d=c.value;if(!1==T(d,b))return setTimeout(function(){f.focus()},10),!1}Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(a){var c=!1,c=null!=d?da(d,a,b):ea(e,a,b);a="";Dialog.dispose();!0===c?setTimeout(function(){h.focus()},10):setTimeout(function(){f.focus()},10)},onCancel:function(){Dialog.dispose();setTimeout(function(){f.focus()},10)}});Dialog.show();return!0}function ha(a){if(!a)return!1;a=a||window.event;13==(a.which||a.keyCode)&&document.getElementById("us-confirm-btn").click();return!0}function u(){g.onConfirm=U;N=!1}function ia(c){function b(b){function f(){V++;V>=a.ESVS.LimitNumOfTimesToTryToInputPW?a.ESVS.Embedded?(h.value="",setTimeout(function(){h.focus()},10)):(a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_BEFORE+a.ESVS.LimitNumOfTimesToTryToInputPW+e.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_AFTER),O()):(h.value="",setTimeout(function(){h.focus()},10))}a.bsUtil().TouchEn_Clear();if(a.CONST.__USFB_M_MOBILETOKEN.device!=k&&(!a.certsList||0>l.selectedIndex()))return a.uiUtil().msgBox(e.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),u(),h.value="",setTimeout(function(){h.focus()},10),!1;if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(k)){if(!a.nimservice())return!1;var p=function(){var f=parseInt(l.selectedIndex());if("DIGITAL_SIGNATURE_P7"===g.type){var m=a.nimservice().GetCert(f);if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),u(),!1;var n=a.certUtil().getTheCertAttributes(m,"Base64");d(e.IDS_MSGBOX_SIGN_ERROR,m,n,f,b,k)}else if("DIGITAL_SIGNATURE_P7_EXT"===g.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==g.type)d(e.IDS_MSGBOX_SIGN_ERROR,f,b,k,q);else if("DIGITAL_SIGNATURE_P7_XML"===g.type){m=a.nimservice().GetCert(f);if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),u(),!1;n=a.certUtil().getTheCertAttributes(m,"Base64");d(e.IDS_MSGBOX_SIGN_ERROR,n,f,b,k,m)}else if("DIGITAL_SIGNATURE_P1"===g.type){m=a.nimservice().GetCert(f);if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),u(),!1;a.usWebToolkit.x509Certificate.parser(m,"Base64");n=a.usWebToolkit.x509Certificate.getSubjectName();if(!n||0>=n.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-2),u(),!1;d(m,n,e.IDS_MSGBOX_SIGN_ERROR,f,b,k)}else if("CERT_RENEWAL"==g.type||"CERT_RENEWAL_KMCERT"==g.type){m=a.certsList.list[f-1].cert;if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-1),u(),!1;a.usWebToolkit.x509Certificate.parser(m,"Base64");var p=a.usWebToolkit.x509Certificate.getNotAfter();if(!p||0>=p.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-2),u(),!1;"CERT_RENEWAL"==g.type?d(p,c.IDS_CONFIRMBOX_CERT_RENEWAL,k,q,f,b):d(p,c.IDS_CONFIRMBOX_KMCERT_ISSUE,k,q,f,b)}else if("CERT_REVOCATION"==g.type)d(e.IDS_CONFIRMBOX_CERT_REVOCATION,f,b,k,q);else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===g.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"==g.type){p={signErr:e.IDS_MSGBOX_SIGN_ERROR,verifySuc:e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:e.IDS_MSGBOX_VID_ERROR_VERIFICATION};m=a.certsList.list[f-1].cert;if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),u(),!1;n=a.certUtil().getTheCertAttributes(m,"Base64");d(f,b,p,m,n,k);h.value=""}else if("DIGITAL_SIGNATURE_P7_FILE"===g.type){m=a.certsList.list[f-1].cert;if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),u(),!1;n=a.certUtil().getTheCertAttributes(m,"Base64");d(f,b,e.IDS_MSGBOX_SIGN_ERROR,e.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,n,k)}else if("ENCRYPT_P7"==g.type)d(f,b,e.IDS_MSGBOX_ENCRYPT_ERROR);else if("VID_VERIFICATION"===g.type)d(f,b,e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,e.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM");else if("CERT_RENEWAL_SIGN"==g.type){m=a.certsList.list[f-1].cert;if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-1),u(),!1;a.usWebToolkit.x509Certificate.parser(m,"Base64");p=a.usWebToolkit.x509Certificate.getNotAfter();if(!p||0>=p.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-2),u(),!1;n=a.certUtil().getTheCertAttributes(m,"Base64");d(p,c.IDS_CONFIRMBOX_CERT_RENEWAL,k,q,f,b,n)}else"CERT_SOE"==g.type?d(e.IDS_CONFIRMBOX_CERT_SOE,f,b,k,q):d()};if(a.CONST.__USFB_M_MOBILETOKEN.device==k){if("DIGITAL_SIGNATURE_P7"===g.type)d(e.IDS_MSGBOX_SIGN_ERROR,null,null,-1,"",k);else if("DIGITAL_SIGNATURE_P1"===g.type)d(null,"",e.IDS_MSGBOX_SIGN_ERROR,-1,"",k);else if("CERT_RENEWAL"==g.type)d("",c.IDS_CONFIRMBOX_CERT_RENEWAL,k,q,-1,"");else if("CERT_RENEWAL_KMCERT"==g.type)d("",c.IDS_CONFIRMBOX_KMCERT_ISSUE,k,q,-1,"");else if("CERT_REVOCATION"==g.type)d(e.IDS_CONFIRMBOX_CERT_REVOCATION,-1,"",k,q);else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===g.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"===g.type){var m={signErr:e.IDS_MSGBOX_SIGN_ERROR,verifySuc:e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:e.IDS_MSGBOX_VID_ERROR_VERIFICATION};d(-1,"",m,null,null,k)}else"DIGITAL_SIGNATURE_P7_FILE"===g.type?d(-1,"",e.IDS_MSGBOX_SIGN_ERROR,e.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,null,k):"ENCRYPT_P7"==g.type?d(-1,b,e.IDS_MSGBOX_ENCRYPT_ERROR):"VID_VERIFICATION"===g.type?d(-1,"",e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,e.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM"):"CERT_RENEWAL_SIGN"==g.type?d("",c.IDS_CONFIRMBOX_CERT_RENEWAL,k,q,-1,"",null):"CERT_SOE"==g.type?d(e.IDS_CONFIRMBOX_CERT_SOE,-1,"",k,q):d();h.value="";a.ESVS.Embedded&&z();return!0}var n=parseInt(l.selectedIndex());if(k==a.CONST.__USFB_M_ETC.device||k==a.CONST.__USFB_M_HSMKEY.device||"CERT_RENEWAL_SIGN"!=g.type&&"DIGITAL_SIGNATURE_P1"!==g.type&&"DIGITAL_SIGNATURE_P7"!==g.type&&"DIGITAL_SIGNATURE_P7_EXT"!=g.type&&"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"!=g.type&&"DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"!==g.type&&"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"!==g.type&&"VID_VERIFICATION"!==g.type)return p(),h.value="",a.ESVS.Embedded&&z(),!0;if(!b)return a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){h.focus()},10),u(),!1;m=a.usWebToolkit.util.encode64("1234");a.nimservice().CheckPassword(n,b,m,function(b,c,d,g){if(0==b)return p(),h.value="",a.ESVS.Embedded&&z(),!0;u();"Enabled"===a.ESVS.UniCRS?a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED_URS):a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED);f();a.uiUtil().loadingBox(!1,"us-div-list-load")})}else if(2&a.ESVS.Mode){if(!b&&k!=a.CONST.__PF_M_CLOUDSIGN.device)return a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){h.focus()},10),u(),!1;if(k==a.CONST.__PF_M_CLOUDSIGN.device)t=!0;else{if(!a.PFUC)return!1;n=parseInt(l.selectedIndex());m=null;try{m=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[n].signpri)}catch(F){}var t=!1;try{t=a.usWebToolkit.pkcs8.checkUserCertPassword(m,b)}catch(r){}finally{m=""}}if(!1===t)a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED),u(),f();else{t=null;k==a.CONST.__PF_M_CLOUDSIGN.device?(n=parseInt(l.selectedIndex()),t=a.certsList.list[n-1].cert):t=a.PFUC[n].signcert;if("DIGITAL_SIGNATURE_P7"===g.type){if(!t||0>=t.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),u(),!1;var s=a.certUtil().getTheCertAttributes(t,"Base64");d(e.IDS_MSGBOX_SIGN_ERROR,t,s,n,b,k,L)}else if("DIGITAL_SIGNATURE_P1"===g.type){if(!t||0>=t.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),u(),!1;s=a.certUtil().getTheCertAttributes(t,"Base64");d(t,s.subjectName,e.IDS_MSGBOX_SIGN_ERROR,n,b,k,L)}else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"==g.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"==g.type){m={signErr:e.IDS_MSGBOX_SIGN_ERROR,verifySuc:e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:e.IDS_MSGBOX_VID_ERROR_VERIFICATION};if(!t||0>=t.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),u(),!1;s=a.certUtil().getTheCertAttributes(t,"Base64");d(n,b,m,t,s,k)}else if("CERT_RENEWAL"==g.type||"CERT_RENEWAL_KMCERT"==g.type){if(!t||0>=t.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-1),u(),!1;a.usWebToolkit.x509Certificate.parser(t,"Base64");m=a.usWebToolkit.x509Certificate.getNotAfter();if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-2),u(),!1;"CERT_RENEWAL"==g.type?d(m,e.IDS_CONFIRMBOX_CERT_RENEWAL,k,q,n,b):d(m,c.IDS_CONFIRMBOX_KMCERT_ISSUE,k,q,n,b)}else"CERT_REVOCATION"===g.type?d(e.IDS_CONFIRMBOX_CERT_REVOCATION,n,b,k,q):"VID_VERIFICATION"===g.type?a.CONST.__PF_M_CLOUDSIGN.device==k?d(n,b,e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,e.IDS_MSGBOX_VID_ERROR_VERIFICATION,"CLOUDSIGN"):d(n,b,e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,e.IDS_MSGBOX_VID_ERROR_VERIFICATION,"PFS"):d();h.value="";a.ESVS.Embedded&&z();return!0}}return!1}l.restoreOnMouseEvent();if(!c)return!1;var d=g.onConfirm;if(!1==N)U=g.onConfirm,N=!0;else return!1;g.onConfirm=function(){};var e=c,h=document.getElementById("us-pw-text"),f=h.value;"touchen"==a.ESVS.SecureKeyboardType&&a.bsUtil().isTouchEnKeyUsable()?4&a.ESVS.Mode&&("CERT_RENEWAL"==g.type||"CERT_REVOCATION"==g.type||"CERT_SOE"==g.type||"CERT_RENEWAL_KMCERT"==g.type)?b(f):a.bsUtil().GetEncryptPwd("us-keyboard-secure-frm","us-pw-text",function(a){b(a)}):("ahnlab"==a.ESVS.SecureKeyboardType&&a.bsUtil().isAhnlabProtectorUsable()&&(4&a.ESVS.Mode&&("CERT_RENEWAL"==g.type||"CERT_REVOCATION"==g.type||"CERT_SOE"==g.type||"CERT_RENEWAL_KMCERT"==g.type)||(f=a.bsUtil().GetAhnlabEncInputInfo("us-pw-text"))),b(f))}function D(c){if(!c)return!1;I(c,C,"close");for(var b=a.ESVS.Media.list.split("|"),d=0;d<b.length;d++){var e=a.CONST.medias[b[d]];void 0!=e&&null!=e&&(e=document.getElementById("us-btn-"+e.name),void 0!=e&&null!=e&&"us-layout-storage-btn-none"!=e.className&&(e.className=c===e?"us-layout-storage-btn-on":"us-layout-storage-btn-off"))}return!0}function ja(c){if(null==c||void 0==c)return!1;var b=!a.uiUtil().isItSupportingThisStorage(c);!1==b&&null!=a.ESVS.Media&&null!=a.ESVS.Media.list&&0>a.ESVS.Media.list.indexOf(c.name)&&(b=!0);if(b)return!1;var b=document.getElementById("us-storage-btn-list"),d=document.createElement("li");d.setAttribute("id","us-storage-btn-li-"+c.name,0);d.setAttribute("mediaIndex",c.mediaIndex,0);7==c.mediaIndex&&(d.className="line-first");"hidden"===c.visibility?(d.style.display="none",d.style.visibility="hidden"):(d.style.display="block",d.style.visibility="visible");var e=document.createElement("button");e.setAttribute("type","button",0);e.setAttribute("id","us-btn-"+c.name,0);e.setAttribute("tabindex",c.tabIndex,0);c.disabled?(e.onclick=function(){a.uiUtil().msgBox(C.IDS_MSGBOX_NOT_SUPPORTED_MEDIA)},e.className="us-layout-storage-btn-none"):(e.onclick=c.onclick,e.className=c.device===k?"us-layout-storage-btn-on":"us-layout-storage-btn-off");d.appendChild(e);if("harddisk"!==c.name&&"webstorage"!==c.name){var h=document.createElement("span");h.className="us-drive-select";e.appendChild(h)}h=document.createElement("span");h.className="us-img-storage";var f=document.createElement("img");f.setAttribute("id","us-img-"+c.name,0);c.disabled?f.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+"_d.png",0):f.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+".png",0);h.appendChild(f);e.appendChild(h);h=document.createElement("span");h.setAttribute("id","us-lbl-"+c.name,0);h.className="us-layout-lbl-storage";h.appendChild(document.createTextNode(c.label));e.appendChild(h);d.appendChild(e);b.appendChild(d);return!0}function I(c,b,d){if("no_more"==d)a.uiUtil().msgBox(b.IDS_MSGBOX_NOT_MORE_MEDIA);else{if(c=document.getElementById("us-storage-wrap"))"open"==d?(c.className="us-layout-storage-more-wrap",c=document.getElementById("us-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN+b.IDS_BUTTON,0),c.onclick=function(){I(this,b,"close")},c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_close.png",0)):(c.className="us-layout-storage-wrap",c=document.getElementById("us-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.onclick=function(){I(this,b,"open")},c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));c=a.ESVS.Media.list.split("|");for(var e=0;e<c.length;e++){var h=a.CONST.medias[c[e]];if(void 0!=h&&null!=h){var f=document.getElementById("us-storage-btn-li-"+h.name);if(void 0!=f&&null!=f){var g=f.getAttribute("mediaIndex");"open"==d?(f.style.display="block",f.style.visibility="visible"):6<g?(f.style.display="none",f.style.visibility="hidden"):(f.style.display="block",f.style.visibility="visible");1==g&&document.getElementById("us-btn-"+h.name)}}}}return!0}function O(){l.restoreOnMouseEvent();k==a.CONST.__PF_M_CLOUDSIGN.device&&closeSession();g.onCancel()}var ka=function(){var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+(a.ESVS.Embedded?"unisignweb/rsrc/layout/certselect_embedded.html?V="+a.ver:"unisignweb/rsrc/layout/certselect.html?V="+a.ver),!1);c.send(null);return c.responseText},W=function(){var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/certselect_"+a.ESVS.Language+".js?V="+a.ver,!1);c.send(null);return c.responseText},C=eval(eval(W)()),X=null,l=null,V=0,s=a.ESVS.TabIndex,J=0,k=a.CONST.__USFB_M_HDD.device,q=0,L=null;if(null!=a.ESVS.Media&&null!=a.ESVS.Media.defaultdevice){if(k=a.uiUtil().getMediaDevice(a.ESVS.Media.defaultdevice),k==a.CONST.__USFB_M_SMARTCARD.device||k==a.CONST.__USFB_M_DISK.device)q=1}else 2==a.ESVS.Mode&&(k=a.CONST.__PF_M_LS.device);var N=!1,U=null;return function(){var c=eval(ka),b=eval(eval(W)());a.ESVS.TargetObj.innerHTML=c();g.args.device&&a.uiUtil().isValidDevice(g.args.device)&&(k=g.args.device,q=g.args.drive);c=document.getElementById("us-lbl-title");if(a.ESVS.Embedded)d=document.getElementById("us-lbl-title"),d.appendChild(document.createTextNode(b.IDS_CERT_SELECTION+" "+b.IDS_CERT_SELECTION_PURPOSE_SIGN)),d.setAttribute("tabindex",s++,0),d=document.getElementById("us-cursor-disabled"),d.setAttribute("tabindex",s++,0);else{c.appendChild(document.createTextNode(b.IDS_CERT_SELECTION));c.setAttribute("title",b.IDS_SENSE_READER_INTRO,0);c.setAttribute("tabindex",s++,0);d=document.getElementById("us-cls-img-btn");d.setAttribute("title",b.IDS_CLOSE_CERT_SELECTION_CLOSE,0);d.onclick=function(){O()};document.getElementById("us-cls-btn-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_close_btn.png",0);d=document.getElementById("us-cursor-disabled");d=document.getElementById("us-logo-img");d.setAttribute("alt",b.IDS_LOGO,0);null!=a.options.logo?d.setAttribute("src",a.options.logo,0):d.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/main_cert_logo.png",0);var d=document.getElementById("us-legend-storage");d.appendChild(document.createTextNode(b.IDS_STORAGE_SELECT))}d=0;if(a.ESVS.Media.list!=a.CONST.__PF_M_CLOUDSIGN.name){for(var e=a.ESVS.Media.list.split("|"),h=0;h<e.length;h++){var f=a.CONST.medias[e[h]];if(void 0!=f&&null!=f){switch(f.device){case a.CONST.__USFB_M_DISK.device:f.label=b.IDS_STORAGE_REMOVABLE;f.disabled=2==a.ESVS.Mode;f.onclick=function(){$(this,b);D(this)};break;case a.CONST.__USFB_M_HSMKEY.device:f.label=b.IDS_STORAGE_SECTOKEN;f.disabled=!("win"==a.osName&&2!=a.ESVS.Mode);f.onclick=function(){G(this,b);D(this)};break;case a.CONST.__USFB_M_SMARTCARD.device:f.label=b.IDS_STORAGE_SAVETOKEN;f.disabled=!("win"==a.osName&&2!=a.ESVS.Mode);f.onclick=function(){P(this,b);D(this)};break;case a.CONST.__USFB_M_MOBILE.device:f.label=b.IDS_STORAGE_MOBILEPHONE;f.disabled=2==a.ESVS.Mode;f.onclick=function(){ba(this,b);D(this)};break;case a.CONST.__USFB_M_HDD.device:f.label=b.IDS_STORAGE_HARDDISK;f.disabled=2==a.ESVS.Mode;f.onclick=function(){if(this&&b)if(k=a.CONST.__USFB_M_HDD.device,q=0,a.certsList&&(a.certsList=null),l.redrawList(null,-1),E(b),z(),4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k)r("redraw",a.CONST.__USFB_M_HDD.device,0,b,"");else{var c=y(a.CONST.__USFB_M_HDD.device,0,b,"");0!=c?(a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),l.redrawList(null,0)):(c=w())?l.redrawList(c.list,c.list.length):l.redrawList(null,0)}D(this)};break;case a.CONST.__USFB_M_MOBILETOKEN.device:f.label=b.IDS_STORAGE_MOBILETOKEN;f.disabled=2==a.ESVS.Mode;f.onclick=function(){document.getElementById("us-div-cert-select").style.display="none";S(this,b);D(this)};break;case a.CONST.__PF_M_SS.device:f.label=b.IDS_STORAGE_SS;f.disabled=1==a.ESVS.Mode;f.onclick=function(){this&&b&&(k=a.CONST.__PF_M_SS.device,q=0,a.certsList&&(a.certsList=null),l.redrawList(null,-1),E(b),z(),r("redraw",a.CONST.__PF_M_SS.device,0,b,""));D(this)};break;case a.CONST.__PF_M_LS.device:f.label=b.IDS_STORAGE_LS;f.disabled=1==a.ESVS.Mode;f.onclick=function(){if(this&&b){k=a.CONST.__PF_M_LS.device;q=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);E(b);z();var c=y(a.CONST.__PF_M_LS.device,0,b,"");0!=c?(a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),l.redrawList(null,0)):(c=w())?l.redrawList(c.list,c.list.length):l.redrawList(null,0)}D(this)};break;case a.CONST.__PF_M_TOUCHSIGN.device:f.label=b.IDS_STORAGE_TOUCHSIGN;f.disabled=!0;f.onclick=function(){H(this,b)};break;case a.CONST.__PF_M_SMARTSIGN.device:f.label=b.IDS_STORAGE_SMARTSIGN;f.disabled=!0;f.onclick=function(){H(this,b)};break;case a.CONST.__PF_M_WEBSECTOKEN.device:f.label=b.IDS_STORAGE_WEBSECTOKEN;f.disabled=!0;f.onclick=function(){H(this,b)};break;case a.CONST.__PF_M_WEBSOFTTOKEN.device:f.label=b.IDS_STORAGE_WEBSOFTTOKEN;f.disabled=!0;f.onclick=function(){H(this,b)};break;case a.CONST.__PF_M_CLOUDSIGN.device:f.label=b.IDS_STORAGE_CLOUDSIGN;f.disabled=1==a.ESVS.Mode;f.onclick=function(){this&&b&&(k=a.CONST.__PF_M_CLOUDSIGN.device,q=0,a.certsList&&(a.certsList=null),l.redrawList(null,-1),E(b),K("123456789012345678901234567890"),r("redraw",a.CONST.__PF_M_CLOUDSIGN.device,0,b,""));D(this)};break;default:f.label=b.IDS_STORAGE_ETC,f.disabled=!0,f.onclick=function(){H(this,b)}}f.tabIndex=s;f.mediaIndex=d+1;f.visibility=6<f.mediaIndex?"hidden":"visible";ja(f)&&(s++,d++)}}e=document.getElementById("us-storage-more-btn");null!=e&&void 0!=e&&(e.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),6<d?(e.style.display="block",e.style.visibility="visible",e.setAttribute("tabindex",s++,0),e.onclick=function(){I(this,b,"open")}):(e.setAttribute("disabled","disabled",0),e.style.display="none",e.style.visibility="hidden",e.onclick=function(){I(this,b,"no_more")}),d=document.getElementById("us-storage-more-btn-img"),d.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW,0),d.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0))}d=document.getElementById("us-tbl-list-caption");d.setAttribute("tabindex",s++,0);d.appendChild(document.createTextNode(b.IDS_CERT_LIST_CAPTION));document.getElementById("us-tbl-list").setAttribute("title",b.IDS_CERT_LIST_CAPTION);a.ESVS.Mode&2&&a.uiUtil().loadingBox(!0,"us-div-list-load",0);var u=[{title:b.IDS_CERT_STATUS},{title:b.IDS_CERT_CLASSIFY},{title:b.IDS_CERT_USER},{title:b.IDS_CERT_ISSUER},{title:b.IDS_CERT_EXPIRATION_DAY}];J=s++;setTimeout(function(){if(u&&b){X=a.loadUI("gridlist");l=X({type:"certslist",tblid:"us-tbl-list",tbltitleid:"us-tbl-list-th",titlelistid:"us-grid-head-div",titlerowid:"us-list-title-row",titleelementid:"us-list-title-element",titledividerid:"us-list-title-divider",titlelistcn:"us-layout-grid-head-div",titlerowcn:"us-layout-grid-head-row",titleelementcn:"us-layout-grid-row-title-element",titledividercn:"us-layout-grid-row-title-divider",tblbodyid:"us-tbl-list-td",datalistid:"us-grid-body-div",datarowid:"us-list-body-row",dataelementid:"us-list-data-element",datalistcn:"us-layout-grid-body-div",datarowcn:"us-layout-grid-body-row",dataelementcn:"us-layout-grid-row us-layout-grid-row-data-element",dataselectcn:"us-layout-grid-row us-layout-grid-row-data-selected-element",textObj:b});var c=!0;"opera"==a.browserName&&(c=!1);l.drawList(u,u.length,null,0,J,c);4&a.ESVS.Mode&&a.CONST.__PF_M_LS.device!==k?r("redraw",k,q,b,"",u,c):a.CONST.__PF_M_CLOUDSIGN.device==k?r("redraw",k,q,b,"",u,c):(c=y(k,0,b,""),0!=c?a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c):(c=w())?l.redrawList(c.list,c.list.length):l.redrawList(null,0))}},100);d=document.getElementById("us-lbl-pw");d.appendChild(document.createTextNode(b.IDS_PASSWORD));e=document.getElementById("us-lbl-pw2");e.innerHTML=b.IDS_PASSWORD_DESCRIPTION;document.getElementById("us-file-search-hidden").onchange=function(){ga(this,b)};h=document.getElementById("us-cert-search-btn");h.setAttribute("value",b.IDS_CERT_SEARCH,0);h.onclick=function(){fa(b)};"Enabled"===a.ESVS.UniCRS&&4&a.ESVS.Mode&&(h.readOnly=!0,h.disabled=!0);a.uiUtil().addCapsLockEvent("us-pw-text","us-err-msg-capslock",b.IDS_MSGBOX_CAPSLOCK_ON,ha);f=document.getElementById("us-pw-text");f.value="";f.setAttribute("title",b.IDS_PASSWORD_LABEL+b.IDS_PASSWORD_DESCRIPTION);var v=document.getElementById("us-pw-text-lbl");v&&v.appendChild(document.createTextNode(b.IDS_PASSWORD_LABEL+b.IDS_PASSWORD_DESCRIPTION));a.ESVS.Embedded||(4&a.ESVS.Mode&&("CERT_RENEWAL"==g.type||"CERT_REVOCATION"==g.type||"CERT_SOE"==g.type||"CERT_RENEWAL_KMCERT"==g.type)?(document.getElementById("us-div-cert").style.display="none",document.getElementById("disabledpw").innerHTML='<input id="us-confirm-btn" class="us-normal-btn btn-confirm h35" type="button" />'):document.getElementById("enabledpw").innerHTML='<input id="us-confirm-btn" class="us-normal-btn btn-confirm h35" type="button" />');v=document.getElementById("us-confirm-btn");v.setAttribute("value",b.IDS_CONFIRM,0);v.onclick=function(){ia(b)};var p=document.getElementById("us-cert-verify-btn");p&&(p.setAttribute("value",b.IDS_CERT_VERIFY,0),p.onclick=function(){B(this,b)});var m=document.getElementById("us-cert-view-btn");m.setAttribute("value",b.IDS_CERT_VIEW,0);m.onclick=function(){Y(this,b)};var n=document.getElementById("us-cert-proposal-btn");n.setAttribute("value",b.IDS_CERT_PROPOSAL,0);n.setAttribute("title",b.IDS_SENSE_READER_BLANK_LINK,0);n.onclick=function(){this&&("firefox"==a.browserName?window.open("https://raadmin.crosscert.com/customer/tk/Main.jsp?","crosscert_url","scrollbars=1"):window.open("https://raadmin.crosscert.com/customer/tk/Main.jsp?"),this.focus())};0==a.ESVS.CertRequestPageEnable&&(n.readOnly=!0,n.disabled=!0);a.ESVS.Embedded?(f.setAttribute("tabindex",s++,0),v.setAttribute("tabindex",s++,0),h.setAttribute("tabindex",s++,0),n.setAttribute("tabindex",s++,0),m.setAttribute("tabindex",s++,0),p&&p.setAttribute("tabindex",s++,0)):(f.setAttribute("tabindex",s++,0),"none"!=document.getElementById("us-div-cert").style.display&&v.setAttribute("tabindex",s++,0),h.setAttribute("tabindex",s++,0),n.setAttribute("tabindex",s++,0),m.setAttribute("tabindex",s++,0),p&&p.setAttribute("tabindex",s++,0),"none"==document.getElementById("us-div-cert").style.display&&v.setAttribute("tabindex",s++,0),h=document.getElementById("us-cls-btn"),h.setAttribute("value",b.IDS_CLOSE,0),h.setAttribute("title",b.IDS_CLOSE+b.IDS_BUTTON,0),h.setAttribute("tabindex",s++,0),h.onclick=function(){O()},a.uiUtil().setRotationTabFocus(h,p,c),a.uiUtil().setRotationTabFocus(c,h,document.getElementById("us-btn-mobiletoken")),document.getElementById("us-lbl-notice").appendChild(document.createTextNode(b.IDS_NOTICE)));null!=a.options.popup&&(document.getElementById("us-div-cert-select").className=document.getElementById("us-div-cert-select").className+" popup");if(a.ESVS.Media.list==a.CONST.__PF_M_CLOUDSIGN.name){k=a.CONST.__PF_M_CLOUDSIGN.device;(h=document.getElementById("us-div-storage"))&&h.parentElement.removeChild(h);f=["us-cert-search-btn","us-cert-proposal-btn","us-cert-view-btn","us-cert-verify-btn"];for(h=0;h<f.length;h++)v=document.getElementById(f[h]),v.style.display="none",v.style.visibility="hidden";document.getElementById("us-lbl-notice").style["text-align"]="center";h=document.getElementById("us-ul-bottom-btns");h=h.children[h.children.length-1];v=document.getElementById("enabledpw");v.children[0].style.width="80px";h.parentElement.removeChild(h);v.parentElement.appendChild(h);h.style["margin-top"]="35px";h.style["margin-left"]="4px";h.children[0].style.height="36px";h.children[0].style.width="80px";document.getElementById("us-pw-text").style.width="363px";c.insertBefore(document.createTextNode(b.IDS_STORAGE_CLOUDSIGN+" "),c.firstChild);d.removeChild(d.firstChild);d.appendChild(document.createTextNode(b.IDS_PIN));e.innerHTML=b.IDS_PIN_DESCRIPTION;K("123456789012345678901234567890")}return document.getElementById("us-div-cert-select")}()};return function(g){function w(){function g(){0<r.value.length?r.value="":(5>w&&setTimeout(g,10),w++)}var r=document.getElementById("us-pw-text"),w=0;g();a.uiUtil().setFirstFocus("us-lbl-title");if(a.ESVS.Media.list!=a.CONST.__PF_M_CLOUDSIGN.name)for(var y=a.ESVS.Media.list.split("|"),B=0;B<y.length;B++){var G=a.CONST.medias[y[B]];if(void 0!=G&&null!=G&&"us-layout-storage-btn-on"==document.getElementById("us-btn-"+G.name).className){a.bsUtil().SetSecurityStatus("us-pw-text");a.bsUtil().SetReScan("us-keyboard-secure-frm","us-pw-text");break}}}var r=P({type:g.type,args:g.args,onConfirm:g.onConfirm,onCancel:g.onCancel});if(!a.ESVS.Embedded&&(null==a.options.popup||-1<a.options.popup.indexOf("overlay=true"))){g=a.uiLayerLevel;var y=a.uiUtil().getOverlay(g);r.style.zIndex=g+1;document.body.insertBefore(y,document.body.firstChild)}var B=window.onresize;return{show:function(){a.ESVS.Embedded?(r.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(r,"width","width")))/2+"px",r.style.display="block"):null==a.options.popup?(draggable(r,document.getElementById("us-div-title")),y.style.display="block",a.uiUtil().offsetResize(r)):(-1<a.options.popup.indexOf("move=true")?draggable(r,document.getElementById("us-div-title")):document.getElementById("us-div-title").style.cursor="default",-1<a.options.popup.indexOf("overlay=true")&&(y.style.display="block"),a.uiUtil().offsetResize(r,a.options.popup));window.onresize=a.ESVS.Embedded?function(){r&&(r.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(r,"width","width")))/2+"px");B&&B()}:function(){r&&a.uiUtil().offsetResize(r,a.options.popup);B&&B()};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;a.bsUtil().ahnlabInit();setTimeout(function(){w()},10)},hide:function(){a.ESVS.Embedded||(y.style.display="none",r.style.display="none")},dispose:function(){window.onresize=function(){B&&B()};if(!a.ESVS.Embedded&&(null==a.options.popup||-1<a.options.popup.indexOf("overlay=true"))){var g=r.parentNode;g&&g.removeChild(r);y.parentNode&&y.parentNode.removeChild(y);a.uiLayerLevel-=10;a.ESVS.TabIndex-=30}}}}};