<!-- 
<script type="text/javascript" src="/cab/realgrid/realgridjs-lic.js"></script>
<script type="text/javascript" src="/cab/realgrid/realgridjs.1.1.24.min.js"></script>
<script type="text/javascript" src="/cab/realgrid/realgridjs-api.1.1.24.js"></script>
<script type="text/javascript" src="/cab/realgrid/jszip.min.js"></script>
<script type="text/javascript" src="/cab/realgrid/import/shim.js"></script>
<script type="text/javascript" src="/cab/realgrid/import/xlsx.js"></script>
 -->
 
<script type="text/javascript" src="../../../../cab/realgrid/realgridjs-lic.js"></script>
<script type="text/javascript" src="../../../../cab/realgrid/realgridjs.1.1.34.min.js"></script> <!-- 운영 -->
<!-- <script type="text/javascript" src="../../../../cab/realgrid/realgridjs_eval.1.1.34.min.js"></script> --> <!-- 개발 -->
<script type="text/javascript" src="../../../../cab/realgrid/realgridjs-api.1.1.34.js"></script>
<script type="text/javascript" src="../../../../cab/realgrid/jszip.min.js"></script>
<script type="text/javascript" src="../../../../cab/realgrid/import/shim.js"></script>
<script type="text/javascript" src="../../../../cab/realgrid/import/xlsx.js"></script>

<div class="div_table">
	<div class="util-row">
	    <div class="push-left">
	        <h3>계약서 작성 업체정보</h3>
	    </div>
	</div>
	<table>
		<colgroup>
			<col width="15%">
			<col width="35%">
			<col width="15%">
			<col width="35%">
		</colgroup>
		<tr>
			<th>업체명</th>
			<td>{{member_name}}</td>
			<th>사업자번호</th>
			<td>{{vendcd2}}</td>
		</tr>
		<tr>
			<th>대표자명</th>
			<td>{{boss_name}}</td>
			<th>계약서종류</th>
			<td>
				<select name="template_cd" onchange="setColumns(this.value);" style="width:300">
					<option value="">-------------------------------- 선&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;택 --------------------------------</option>
					<!-- LOOP START 'template' -->
					<option value="{{template.template_cd}}">{{template.template_name}}</option>
					<!-- LOOP END 'template' -->
				</select>
			</td>
		</tr>
	</table>
</div>

<div class="div_table">
	<div class="util-row">
	    <div class="push-right" style="z-index:1">
			<div style="z-index:10;position: relative; float: left; top:3px;left:100px;opacity:0;" class=" auth_css"><input type="file" name="upload_xls" style="width:100px; cursor:pointer;" onchange="excelRead();this.value=''"></div>
			<button type="button" class="sbtn color2 ico-excel auth_css"><span></span>엑셀업로드</button>
			<button type="button" class="sbtn color2 ico-download"  onClick="excelDown()"><span></span>엑셀다운로드</button>
		</div>
	</div>
	<table>
		<tr>
			<td>
				<div id="realgrid" style="width: 100%; height: 500px;"></div>
			</td>
		</tr>
	</table>
</div>
<!-- 
<div class="div_table lineTable">
	<table>
		<colgroup>
			<col width="30%"> 
			<col> 
		</colgroup>
		<tr> 
			<th ></th>
			<th>입력 구분</th>   
		</tr>
		<tr>
			<th>구분</th> 
			<td align="left" style="line-height:28px; padding-left: 15px;" valign="top"> - <span style="color: red">업적급여</span> 항목 입력방식<br />&nbsp;&nbsp;&nbsp;(예시) 2,000,000 또는 2000000
			<br /> - <span style="color: red">날짜 (생년월일, 계약기간 등)</span> 항목 입력방식<br />&nbsp;&nbsp;&nbsp;(예시) 2020-01-01
			<br /> - <span style="color: red">월 급여</span>는 자동계산으로 입력됨
			
			</td>  
		 </tr>  
	</table>
</div>
 -->

<div class="btn-group-wrap">
	<button type="button" class="btn color ico-request auth_css" onClick="javascript:submitItem()"><span></span>임시저장</button>
</div>

<script language="javascript">

var dataProvider = null;
var gridView = null;
var gTemplateCd = null;

$(document).ready( function(){

	//문서반출 예외페이지
	document.title = "농심 전자계약시스템*";
	
	//alert("{{realgrid_path}}");
    RealGridJS.setRootContext("{{realgrid_path}}");
    //RealGridJS.setTrace(true);

    dataProvider = new RealGridJS.LocalDataProvider();
    gridView = new RealGridJS.GridView("realgrid");
    gridView.setDataSource(dataProvider);
    setOptions();
    setStyle();
    setColumns("");
});

function setOptions() {
    var options =  {
        hideDeletedRows : true,
        indicator:{visible: false }
        ,panel: {visible: false}
        ,footer: {visible: false}
        ,checkBar: {visible: false}
        ,stateBar: {visible: false}
        ,edit: {
            enterToTab: false,
            insertable: true,
            appendable: true,
            updatable: true,
            deletable: true,
            deleteRowsConfirm: false,
            deleteRowsMessage: "삭제하시겠습니까 ?"
        }
        ,displayOptions:{
            //columnWidth : 200
        }
    };
    gridView.setOptions(options);

};

function setStyle(){
    $.getJSON("/cab/realgrid/resource/buyer_style.json", function (data, textStatus, jqXHR) {
        gridView.setStyles(data);
    })
        .done(function (data, textStatus, jqXHR) {
            gridView.setFocus();
        })
        .fail(function (jqxhr, textStatus, error) {
            var err = textStatus + ', ' + error;
            var msg = "gridView failStyleSet: " + err;
            console && console.log(msg);
            alert(msg); 
        });
}

function setColumns(arg) {

	gTemplateCd = arg;
    var columns = [];

	/**
	 * B2C 양식1(사번, 성명, 주민등록번호, 주소, 생년월일, 핸드폰번호, 사원구분 ......)
	 * 2020801 : [인사]근로계약서(종합직/일반직 A)
	 * 2020802 : [인사]근로계약서(종합직/일반직 B)
	 * 2020803 : [인사]근로계약서(서비스_SSP/SP직 A)
	 * 2020804 : [인사]근로계약서(서비스_농협SP직 B)
	 * 2020805 : [인사]근로계약서(서비스_TS직 A)
	 * 2020807 : [인사]근로계약서(서비스_TS직 B)
	 * 2020809 : [카레레스토랑팀]근로계약서(외식서비스_카레 A)
	 * 2020808 : [카레레스토랑팀]근로계약서(외식서비스_N카페 B)
	 * 2020810 : [인사]근로계약서(계약직 A)
	 * 2020818 : [인사]근로계약서(계약직 B)
	 * 2020816 : [카레레스토랑팀]근로계약서(외식시급 A)월60시간 미만
	 * 2020811 : [카레레스토랑팀]근로계약서(외식시급 B)월60시간 이상
	 * 2020819 : [인사]근로계약서(단시간/시급)
	 * 2020820 : [인사]근로계약서(단시간/일급)
	 * 2020821 : [영업기획] 근로계약서(서비스_SP직 A)
	 */
	 gridView.setDisplayOptions({
		    showEmptyMessage: true,
		    emptyMessage: "엑셀업로드를 진행해주세요."
	 });
	 gridView.setIndicator({
		   visible: true  
	 });
	 gridView.setHeader({
		 	height : 28
	 	});
    if (gTemplateCd == '2020801' || gTemplateCd == '2020802' || gTemplateCd == '2020803' || gTemplateCd == '2020804' || gTemplateCd == '2020805' ||
    	gTemplateCd == '2020807' || gTemplateCd == '2020808' || gTemplateCd == '2020809' || gTemplateCd == '2020810' || gTemplateCd == '2020818' ||
    	gTemplateCd == '2020816' || gTemplateCd == '2020811' || gTemplateCd == '2020819' || gTemplateCd == '2020820' || gTemplateCd == '2020821'
    	) {
    	
    	columns.push({name:"emp_no" ,fieldName:"emp_no",dataType:"text" ,header:"사번" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"han_name" ,fieldName:"han_name",dataType:"text" ,header:"성명" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"pers_no" ,fieldName:"pers_no",dataType:"text" ,header:"주민등록번호" ,width:90 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"addr" ,fieldName:"addr",dataType:"text" ,header:"주소" ,width:300 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"birth_date" ,fieldName:"birth_date",dataType:"text" ,header:{text:"생년월일", subText:"(YYYYMMDD)"} ,width:90 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"cela_tel" ,fieldName:"cela_tel",dataType:"text" ,header:"핸드폰번호" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"emp_gubn" ,fieldName:"emp_gubn",dataType:"text" ,header:"사원구분" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"dept_code" ,fieldName:"dept_code",dataType:"text" ,header:"부서코드" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"dept_name" ,fieldName:"dept_name",dataType:"text" ,header:"부서명" ,width:120 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"autt_code" ,fieldName:"autt_code",dataType:"text" ,header:"직급코드" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"autt_name" ,fieldName:"autt_name",dataType:"text" ,header:"직급명" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"loca_name" ,fieldName:"loca_name",dataType:"text" ,header:"근무장소" ,width:120 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"jwrk_name" ,fieldName:"jwrk_name",dataType:"text" ,header:"담당직무" ,width:120 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"job_name" ,fieldName:"job_name",dataType:"text" ,header:"종사업무" ,width:120 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"entr_com_date" ,fieldName:"entr_com_date",dataType:"text" ,header:"입사일자" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"cont_sta_date" ,fieldName:"cont_sta_date",dataType:"text" ,header:"계약시작일자" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"cont_end_date" ,fieldName:"cont_end_date",dataType:"text" ,header:"계약종료일자" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"jeva_amt" ,fieldName:"jeva_amt",dataType:"text" ,header:"기본급" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"work_month_time" ,fieldName:"work_month_time",dataType:"text" ,header:"월근무시간" ,width:70 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"work_month_amt" ,fieldName:"work_month_amt",dataType:"text" ,header:"월급여" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"over_time" ,fieldName:"over_time",dataType:"text" ,header:"연장시간" ,width:70 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"over_labo_alow" ,fieldName:"over_labo_alow",dataType:"text" ,header:"연장수당" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"work_day_time" ,fieldName:"work_day_time",dataType:"text" ,header:"1일근무시간" ,width:70 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"work_week_time" ,fieldName:"work_week_time",dataType:"text" ,header:"1주근무시간" ,width:70 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"pay_amt" ,fieldName:"pay_amt",dataType:"text" ,header:"시급" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"day_pay" ,fieldName:"day_pay",dataType:"text" ,header:"포괄시급(기본급)" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"wday_amt" ,fieldName:"wday_amt",dataType:"text" ,header:"주휴수당" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"etc_amt_yn" ,fieldName:"etc_amt_yn",dataType:"text" ,header:"제수당유무" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"etc_amt" ,fieldName:"etc_amt",dataType:"text" ,header:"제수당금액" ,width:100 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"etc_cont" ,fieldName:"etc_cont",dataType:"text" ,header:"제수당내용" ,width:100 ,readOnly:false , movable:false ,sortable:false});
	    
	/**
	 * B2B 양식1(거래처코드, 계약일자)
	 * 2020904 : [영업] 자금이체 약정서
	 * 2020905 : [영업] 판매장려금 약정서_상품
	 * 2020906 : [영업] 판매장려금 약정서_제품종합
	 * 2020907 : [영업] 판매장려금 약정서_직거래점
	 * 2020908 : [영업] 판매장려금 약정서_판매
	 * 2020917 : [구매] 2020년도 (하도급)공정거래 협약서
	 * 2020928 : [영업] 공정거래및상생협력 협약서(대리점분야)
	 */
	}else if(gTemplateCd == '2020904' || gTemplateCd == '2020905' || gTemplateCd == '2020906' ||
			 gTemplateCd == '2020907' || gTemplateCd == '2020908' || gTemplateCd == '2020917' || gTemplateCd == '2020928'
	){
		gridView.setHeader({
   		 	height : 23
   	 	});
    	columns.push({name:"cust_code" ,fieldName:"cust_code",dataType:"text" ,header:"거래처코드" ,width:150 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"cont_date" ,fieldName:"cont_date",dataType:"text" ,header:"계약일자" ,width:120 ,readOnly:false , movable:false ,sortable:false});
    	
    /* B2B 양식2(거래처코드, 계약일자, 대금결제일, 약정기간)
     * 2020902 : [영업] 거래약정서_직거래점
     * 2020903 : [영업] 거래약정서_특약점
    */
	}else if(gTemplateCd == '2020902' || gTemplateCd == '2020903'){
		gridView.setHeader({
   		 	height : 23
   	 	});
    	columns.push({name:"cust_code" ,fieldName:"cust_code",dataType:"text" ,header:"거래처코드" ,width:150 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"cont_date" ,fieldName:"cont_date",dataType:"text" ,header:"계약일자" ,width:120 ,readOnly:false , movable:false ,sortable:false});
    	if(gTemplateCd == '2020902'){
    		columns.push({name:"payment_day" ,fieldName:"payment_day",dataType:"text" ,header:"대금결제일" ,width:70 ,readOnly:false , movable:false ,sortable:false});
    	}
    	columns.push({name:"cont_date_from" ,fieldName:"cont_date_from",dataType:"text" ,header:"약정기간" ,width:120 ,readOnly:false , movable:false ,sortable:false});
    	
	/* B2B 양식3(거래처코드, 계약일자, 기술자료 내역, 요구 목적, 비밀유지에 관한 사항, 권리 귀속 관계, 대가, 인도일 및 인도방법, 사용기간, 반환 또는 폐기방법 및 반환일 또는 폐기일, 그 밖의 사항)
     * 2020909 : [구매] 기술자료 요구서
    */	
	}else if(gTemplateCd == '2020909'){
		columns.push({name:"cust_code" ,fieldName:"cust_code",dataType:"text" ,header:"거래처코드" ,width:150 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"cont_date" ,fieldName:"cont_date",dataType:"text" ,header:"계약일자" ,width:120 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"tech_comment" ,fieldName:"tech_comment",dataType:"text" ,header:"기술자료 내역" ,width:200 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"req_purpose" ,fieldName:"req_purpose",dataType:"text" ,header:"요구 목적" ,width:200 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"keep_secret" ,fieldName:"keep_secret",dataType:"text" ,header:"비밀유지에 관한 사항" ,width:200 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"attr_of_rights" ,fieldName:"attr_of_rights",dataType:"text" ,header:"권리 귀속 관계" ,width:200 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"cost" ,fieldName:"cost",dataType:"text" ,header:"대가" ,width:200 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"del_method" ,fieldName:"del_method",dataType:"text" ,header:"인도일 및 인도방법" ,width:200 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"per_or_use" ,fieldName:"per_or_use",dataType:"text" ,header:"사용기간" ,width:200 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"discard_method" ,fieldName:"discard_method",dataType:"text" ,header:"반환 또는 폐기방법 및 반환일 또는 폐기일" ,width:200 ,readOnly:false , movable:false ,sortable:false});
    	columns.push({name:"etc_matters" ,fieldName:"etc_matters",dataType:"text" ,header:"그 밖의 사항" ,width:200 ,readOnly:false , movable:false ,sortable:false});
	}else{
		columns.push({name:"cont_select" ,fieldName:"cont_select",header:"계약서종류를 선택해주세요." ,width:0 ,readOnly:false , movable:false ,sortable:false});
		gridView.setDisplayOptions({
		    showEmptyMessage: true,
		    emptyMessage: "계약서종류를 선택해주세요."
		});
		gridView.setIndicator({
			   visible: false  
		 });
	}
 	gridView.setStyles({ 
    	body: { 
    		empty: {
    			foreground: "#8C8C8C", 
    			textAlignment: "center", 
    			lineAlignment: "center", 
    			fontSize: 25, 
    			fontBold: true 
    		} 
    	} 
	});
    dataProvider.setFields(columns);
    gridView.setColumns(columns);
}

function excelRead(){

    var files;

    if(window.event.target)
        files = window.event.target.files;
    else if(window.event.srcElement)
        files = window.event.srcElement.files;

    if(!files) {
        alert("내역업로드 기능은 Internet Explorer 10 이상 또는 크롬(chrome)에서만 이용하실 수 있습니다.");
        return true;
    }
    var i, f;
    for (i = 0, f = files[i]; i != files.length; ++i) {
        var reader = new FileReader();
        var name = f.name;
        reader.onload = function (e) {
            var data = e.target.result;
            //var workbook = XLSX.read(data, { type: 'binary' });
            var arr = fixdata(data);
            workbook = XLSX.read(btoa(arr), { type: 'base64' });
            process_wb(workbook);
            /* DO SOMETHING WITH workbook HERE */
        };
        //reader.readAsBinaryString(f);
        reader.readAsArrayBuffer(f);
    }
}

function process_wb(wb) {
    var output = "";
    output = to_json(wb);
    var sheetNames = Object.keys(output);
    if (sheetNames.length > 0) {
        try{
            output[sheetNames][0];
        }catch(e){
            alert("형식에 맞지 않는 파일입니다.\n\n업로드 파일을 확인 하세요.");
            return;
        }

        var colObj = output[sheetNames][0];
        var rows = output[sheetNames];
        var data = [];
        var pattern = /^[_a-zA-Z0-9-\.]+@[\.a-zA-Z0-9-]+\.[a-zA-Z]+$/;
        var regExp = /^[0-9]+$/;
        var cols = [];
		//var template_cd = document.getElementById("template_cd").value;
		
		//엑셀 열 설정
		cols = ["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","AA","AB","AC","AD"];
		
        for(var i = 1 ; i < rows.length ; i++){
            var row = rows[i];

			/**
			 * 인사계약서 type1
			 * 2020801 : [인사]근로계약서(종합직/일반직 A)
			 * 2020802 : [인사]근로계약서(종합직/일반직 B)
			 * 2020803 : [인사]근로계약서(서비스_SSP/SP직 A)
			 * 2020804 : [인사]근로계약서(서비스_농협SP직 B)
			 * 2020805 : [인사]근로계약서(서비스_TS직 A)
			 * 2020807 : [인사]근로계약서(서비스_TS직 B)
			 * 2020809 : [카레레스토랑팀]근로계약서(외식서비스_카레 A)
			 * 2020808 : [카레레스토랑팀]근로계약서(외식서비스_N카페 B)
			 * 2020810 : [인사]근로계약서(계약직 A)
			 * 2020818 : [인사]근로계약서(계약직 B)
			 * 2020816 : [카레레스토랑팀]근로계약서(외식시급 A)월60시간 미만
			 * 2020811 : [카레레스토랑팀]근로계약서(외식시급 B)월60시간 이상
			 * 2020819 : [인사]근로계약서(단시간/시급)
			 * 2020820 : [인사]근로계약서(단시간/일급)
			 * 2020821 : [영업기획] 근로계약서(서비스_SP직 A)
			 */
    		if (gTemplateCd == '2020801' || gTemplateCd == '2020802' || gTemplateCd == '2020803' || gTemplateCd == '2020804' || gTemplateCd == '2020805' ||
   		    	gTemplateCd == '2020807' || gTemplateCd == '2020808' || gTemplateCd == '2020809' || gTemplateCd == '2020810' || gTemplateCd == '2020818' ||
   		    	gTemplateCd == '2020816' || gTemplateCd == '2020811' || gTemplateCd == '2020819' || gTemplateCd == '2020820' || gTemplateCd == '2020821'
   		    	) {
            	
            	//입력값 validation
				fields = ["emp_no","han_name","pers_no","addr","birth_date","cela_tel","emp_gubn","dept_code","dept_name","autt_code","autt_name","loca_name","jwrk_name","job_name","entr_com_date","cont_sta_date","cont_end_date","jeva_amt","work_month_time","work_month_amt","over_time","over_labo_alow","work_day_time","work_week_time","pay_amt","day_pay","wday_amt","etc_amt_yn","etc_amt","etc_cont"];
            	
            	// 공통
				if(row[cols[0]] == null || row[cols[0]].toString().trim() == ""){alert("사번에 빈값이 들어가 있습니다.(A열,"+(i+1)+"행)");return;}
				if(row[cols[4]] == null || row[cols[4]].toString().trim() == ""){alert("생년월일에 빈값이 들어가 있습니다.(E열,"+(i+1)+"행)");return;}
				if(row[cols[4]].length != 8){alert("생년월일 형식이 올바르지 않습니다. 입력형식:19990102 (E열,"+(i+1)+"행)");return;}
				if(row[cols[5]] == null || row[cols[5]].toString().trim() == ""){alert("핸드폰번호에 빈값이 들어가 있습니다.(F열,"+(i+1)+"행)");return;}
				
				// 입사일자, 계약시작종료일자 구분
            	if(gTemplateCd == '2020801' || gTemplateCd == '2020802' || gTemplateCd == '2020803' || gTemplateCd == '2020804' || gTemplateCd == '2020805' ||
            	   gTemplateCd == '2020807' || gTemplateCd == '2020809' || gTemplateCd == '2020808' || gTemplateCd == '2020821'
            	){
            		if(row[cols[14]] == null || row[cols[14]].toString().trim() == ""){alert("입사일자에 빈값이 들어가 있습니다.(O열,"+(i+1)+"행)");return;}
            		if(row[cols[14]].length != 8){alert("입사일자 형식이 올바르지 않습니다. 입력형식:19990102 (O열,"+(i+1)+"행)");return;}
            	}else{
            		if(row[cols[15]] == null || row[cols[15]].toString().trim() == ""){alert("계약시작일자에 빈값이 들어가 있습니다.(P열,"+(i+1)+"행)");return;}
            		if(row[cols[15]].length != 8){alert("계약시작일자 형식이 올바르지 않습니다. 입력형식:19990102 (P열,"+(i+1)+"행)");return;}
            		if(row[cols[16]] == null || row[cols[16]].toString().trim() == ""){alert("계약종료일자에 빈값이 들어가 있습니다.(Q열,"+(i+1)+"행)");return;}
            		if(row[cols[16]].length != 8){alert("계약종료일자 형식이 올바르지 않습니다. 입력형식:19990102 (Q열,"+(i+1)+"행)");return;}
            	}
				
				// 근무장소
            	if(gTemplateCd != '2020819' && gTemplateCd != '2020820'){
            		if(row[cols[11]] == null || row[cols[11]].toString().trim() == ""){alert("근무장소에 빈값이 들어가 있습니다.(L열,"+(i+1)+"행)");return;}
            	}
				
				// 근무부서
				if(gTemplateCd != '2020816' && gTemplateCd != '2020811'){
					if(row[cols[8]] == null || row[cols[8]].toString().trim() == ""){alert("부서명에 빈값이 들어가 있습니다.(I열,"+(i+1)+"행)");return;}
				}
				
				// 담당직무, 종사업무
				if(gTemplateCd != '2020801' && gTemplateCd != '2020802' && gTemplateCd != '2020810' && gTemplateCd != '2020818'){
					if(row[cols[13]] == null || row[cols[13]].toString().trim() == ""){alert("종사업무에 빈값이 들어가 있습니다.(N열,"+(i+1)+"행)");return;}
				}else{
					if(row[cols[12]] == null || row[cols[12]].toString().trim() == ""){alert("담당직무에 빈값이 들어가 있습니다.(M열,"+(i+1)+"행)");return;}
				}
				
				// 직급, 월급여, 기본급
				if(gTemplateCd != '2020816' && gTemplateCd != '2020811' && gTemplateCd != '2020819' && gTemplateCd != '2020820' ){
					if(row[cols[10]] == null || row[cols[10]].toString().trim() == ""){alert("직급명에 빈값이 들어가 있습니다.(K열,"+(i+1)+"행)");return;}
					if(row[cols[19]] == null || row[cols[19]].toString().trim() == ""){alert("월급여에 빈값이 들어가 있습니다.(T열,"+(i+1)+"행)");return;}
					if(row[cols[17]] == null || row[cols[17]].toString().trim() == ""){alert("기본급에 빈값이 들어가 있습니다.(R열,"+(i+1)+"행)");return;}
					// 연장수당   
					if(gTemplateCd == '2020801' || gTemplateCd == '2020803' || gTemplateCd == '2020805' || gTemplateCd == '2020809' || gTemplateCd == '2020810' || gTemplateCd == '2020821'){
						if(row[cols[20]] == null || row[cols[20]].toString().trim() == ""){alert("연장시간에 빈값이 들어가 있습니다.(U열,"+(i+1)+"행)");return;}
						if(row[cols[21]] == null || row[cols[21]].toString().trim() == ""){alert("연장수당에 빈값이 들어가 있습니다.(V열,"+(i+1)+"행)");return;}
						if(row[cols[18]] == null || row[cols[18]].toString().trim() == ""){alert("월근무시간에 빈값이 들어가 있습니다.(S열,"+(i+1)+"행)");return;}
					}
				}else{
					if(row[cols[22]] == null || row[cols[22]].toString().trim() == ""){alert("1일 근무시간에 빈값이 들어가 있습니다.(W열,"+(i+1)+"행)");return;}
					if(gTemplateCd == '2020816' || gTemplateCd == '2020811'){
						if(row[cols[23]] == null || row[cols[23]].toString().trim() == ""){alert("1주 근무시간에 빈값이 들어가 있습니다.(X열,"+(i+1)+"행)");return;}
						if(row[cols[24]] == null || row[cols[24]].toString().trim() == ""){alert("시급에 빈값이 들어가 있습니다.(Y열,"+(i+1)+"행)");return;}
						if(row[cols[25]] == null || row[cols[25]].toString().trim() == ""){alert("포괄시급에 빈값이 들어가 있습니다.(Z열,"+(i+1)+"행)");return;}
						if(row[cols[26]] == null || row[cols[26]].toString().trim() == ""){alert("주휴수당에 빈값이 들어가 있습니다.(AA열,"+(i+1)+"행)");return;}
						if(row[cols[27]] == null || row[cols[27]].toString().trim() == ""){alert("제수당유무 빈값이 들어가 있습니다.(AB열,"+(i+1)+"행)");return;}
						//if(row[cols[29]] == null || row[cols[29]].toString().trim() == ""){alert("제수당내용 빈값이 들어가 있습니다.(AD열,"+(i+1)+"행)");return;}
					}else if(gTemplateCd == '2020819'){
						if(row[cols[24]] == null || row[cols[24]].toString().trim() == ""){alert("시급에 빈값이 들어가 있습니다.(Y열,"+(i+1)+"행)");return;}
					}else if(gTemplateCd == '2020820'){
						if(row[cols[25]] == null || row[cols[25]].toString().trim() == ""){alert("포괄시급에 빈값이 들어가 있습니다.(Z열,"+(i+1)+"행)");return;}
					}
				}
                
            }else if(gTemplateCd == '2020904' || gTemplateCd == '2020905' || gTemplateCd == '2020906' ||
       			 gTemplateCd == '2020907' || gTemplateCd == '2020908' || gTemplateCd == '2020917' || gTemplateCd == '2020928' || gTemplateCd == '2020909'){
            	
            	if(gTemplateCd == '2020909'){
            		fields = ["cust_code","cont_date","tech_comment","req_purpose","keep_secret","attr_of_rights","cost","del_method","per_or_use","discard_method","etc_matters"];
            	}else{
            		fields = ["cust_code","cont_date"];
            	}
            	
				if(row[cols[0]] == null || row[cols[0]].toString().trim() == ""){alert("거래처 코드에 빈값이 들어가 있습니다.(A열,"+(i+1)+"행)");return;}
				if(row[cols[1]] != null && row[cols[1]].toString().trim() != ""){
					if(row[cols[1]].length != 8 ){alert("계약일자 형식이 올바르지 않습니다. 입력형식:19990102 (B열,"+(i+1)+"행)");return;}
				}
           	}else if(gTemplateCd == '2020902' || gTemplateCd == '2020903'){
				if(gTemplateCd == '2020902'){
					fields = ["cust_code","cont_date","payment_day","cont_date_from"];
					if(row[cols[2]] == null || row[cols[2]].toString().trim() == ""){alert("대금 결제일에 빈값이 들어가 있습니다.(C열,"+(i+1)+"행)");return;}
					if(row[cols[3]] != null && row[cols[2]].toString().trim() != ""){
						if(row[cols[3]].length != 8 ){alert("약정일자 형식이 올바르지 않습니다. 입력형식:19990102 (D열,"+(i+1)+"행)");return;}
					}
				}else{
					fields = ["cust_code","cont_date","cont_date_from"];
					if(row[cols[2]] != null && row[cols[2]].toString().trim() != ""){
						if(row[cols[2]].length != 8 ){alert("약정일자 형식이 올바르지 않습니다. 입력형식:19990102 (C열,"+(i+1)+"행)");return;}
					}
				}
				if(row[cols[0]] == null || row[cols[0]].toString().trim() == ""){alert("거래처 코드에 빈값이 들어가 있습니다.(A열,"+(i+1)+"행)");return;}
				if(row[cols[1]] != null && row[cols[1]].toString().trim() != ""){
					if(row[cols[1]].length != 8 ){alert("계약일자 형식이 올바르지 않습니다. 입력형식:19990102 (B열,"+(i+1)+"행)");return;}
				}
           	}
           
            var rowdata={};
            for(var j = 0 ; j < cols.length; j++){
                if(row[cols[j]]){
                    rowdata[fields[j]] = row[cols[j]].trim();
                }else{
                    rowdata[fields[j]] = "";
                }
            }
            data.push(rowdata);
        }
        dataProvider.setRows(data);
        gridView.closeProgress();
        alert("총 " + dataProvider.getRowCount() + "건이 업로드 되었습니다.");
    }
}

function to_json(workbook) {
    var result = {};
    workbook.SheetNames.forEach(
        function (sheetName) {
            var roa = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName], { header: "A" });
            if (roa.length > 0) {
                result[sheetName] = roa;
            }
        }
    );
    return result;
}

function fixdata(data) {
    var o = "", l = 0, w = 10240;
    for (; l < data.byteLength / w; ++l) o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w, l * w + w)));
    o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w)));
    return o;
}

function excelDown(){
	if(gTemplateCd != ""){
		var fileNmae = "계약서일괄생성";
		
	    gridView.exportGrid({
	        type: "excel",
	        target: "local",
	        fileName: fileNmae+".xlsx",
	        showProgress: false,
	        applyDynamicStyles: false,
	        progressMessage: "다운로드 진행 중입니다.",
	        indicator: "hidden",
	        header: "visible",
	        footer: "hidden",
	        compatibility: "2007",
	        done: function () {  //내보내기 완료 후 실행되는 함수
	        }
	    });
	}else{
		alert("계약서종류를 선택해주세요.");
		return;
	}
}

var submit_chk = false;
function submitItem(){
	if(submit_chk){
		alert("처리 중입니다.");
		return;
	}
	if(dataProvider.getRowCount() == 0){
		alert("계약서 정보가 존재하지 않아 저장을 하실 수 없습니다.");
		return;
	}

	if(!confirm("계약서를 일괄 작성 하시겠습니까?")){
		return;
	}
	
    gridView.commit();
    var currRow = gridView.getCurrent().dataRow;
    var url = "batch_contract_insert_a_nicetcm.jsp";

    var grid_string = "";
    if(dataProvider.getRowCount()>0){
        var jRowsData = dataProvider.getJsonRows(0,dataProvider.getRowCount()-1);
        grid_string =encodeURIComponent(JSON.stringify(jRowsData))
    }

    var data = {
         grid:grid_string
		,template_cd:gTemplateCd
        ,member_no:"{{member_no}}"
    };

    console.log(data);
    submit_chk = true;
    
    document.getElementById("loading").style.display = 'block';
    
    $.ajax({
        url : url,
        type : "post",
        data : data,
        success : function(data) {
            data = data.trim();
            alert(data);
            submit_chk = false;
            document.getElementById("loading").style.display = 'none';
			location.href="/web/buyer/contract/batch_contract_writing_list.jsp";
        },
        error : function(request, status, error) {
            alert("code:" + request.status + "\\n" + "error:" + error);
            submit_chk = false;
            document.getElementById("loading").style.display = 'none';
        }
    });
}

</script>
