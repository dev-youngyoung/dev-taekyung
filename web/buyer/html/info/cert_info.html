<!-- 전자인증 모듈 설정 //-->
<!-- INCLUDE FILE 'layout/crosscert_include.html' -->
<!-- 전자인증 모듈 설정 //-->

<form name="form1" method="post">
	<input type="hidden" name="cert_end_date" value="{{_auth._CERT_END_DATE}}"/>
	<input type="hidden" name="cert_dn" value="{{_auth._CERT_DN}}"/>
	<input type="hidden" name="sign_data"/>

	<div class="common-cert">
		<div class="common-cert-box">
			<h3>공인인증서 안내</h3>
			<p>공인인증서는 인감도장이 사업자용 인감도장, 개인용 인감 도장이 있는 것 처럼 별도로 나누어져 있습니다. 또한 범용(모든 용도)에 쓸 수 있는 인증서와 용도제한(특수용도)용 인증서로 나누어져 있습니다. 나이스다큐 서비스에서 사용가능한 인증서는 범용인증서, 나이스다큐 전용 인증서이므로 사용 불가능한 인증서만 있으신 고객은 용도에 맞는 인증서를 새로 발급 받으셔야 합니다.</p>
		</div>
		<div class="common-cert-box">
			<h3>나이스다큐 사용 가능 인증서</h3>
			<div class="common-cert-info-wrap">
				<div class="common-cert-info-box">
					<h4>나이스다큐 사용가능 (O)</h4>
					<div class="common-cert-info-inner">
						<h5>개인 사업자, 법인 사업자</h5>
						<ul>
							<li>사업자(범용) 인증서</li>
							<li>나이스다큐 전용 인증서</li>
						</ul>
					</div>
					<div class="common-cert-info-inner">
						<h5>개인</h5>
						<ul>
							<li>개인(범용) 인증서<br><br><font style="font-weigth:bold;color:red">(특정업체와 거래하는 경우만 사용 가능)</font></li>
						</ul>
					</div>
				</div>
				<div class="common-cert-info-box color-type1">
					<h4>나이스다큐 사용불가능 (X)</h4>
					<div class="common-cert-info-inner">
						<h5>법인 사업자, 개인사업자, 개인<em>(용도제한용 인증서)</em></h5>
						<ul>
							<li>은행(금융거래)용 인증서</li>
							<li>세금계산서 전용 인증서</li>
							<li>타사 전용 인증서</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="common-cert-box">
			<h3>인증서 등록</h3>
			<ul class="cert-list">
				<li>내PC에 있는 모든 인증서를 확인하시려면 오른쪽 버튼을 누르세요!
					<a href="javascript:certAllView();" class="cert-in-btn"><img src="../html/images/cert_btn1.png"></a>
				</li>
				<li>나이스다큐에 사용 가능한 인증서를 등록하시려면 오른쪽 버튼을 누르세요!
					<a href="javascript:fSign();" class="cert-in-btn"><img src="../html/images/cert_btn2.png"></a>
					<span class="caution-text">(인증서 만료일 : {{member.cert_end_date}})</span>
					<em>※ 사용불가능한 인증서는 보이지 않습니다.</em>
				</li>
				<li>나이스다큐에 사용 가능한 인증서를 새로 발급 받으시려면 다음 내용을 확인하세요.</li>
			</ul>
			<div class="common-cert-info-wrap">
				<div class="common-cert-info-box box-type1">
					<h4>한국전자인증<span>(발급문의 : 1566-0566)</span></h4>
					<div class="common-cert-info-inner">
						<h5>개인 사업자, 법인 사업자</h5>
						<ul class="button-add">
							<li>
								<p>사용자(범용) 인증서 <span>￦80,000(VAT별도)</span></p>
								<a href="javascript:fCrosscerUrl()">신청하기</a>
							</li>
							<li>
								<p>나이스다큐 전용 인증서 <span>￦10,000(VAT별도)</span></p>
								<a href="javascript:fCrosscerUrl()">신청하기</a>
							</li>
						</ul>
					</div>
					<ul class="cert-list">
						<li>본인확인을 위한 서류 (사업자등록증, 대표자신분증, 법인등기부등본)를 한국전자인증에 제출해야 합니다.</li>
						<li>서류를 한국전자인증에 직접 방문(내사 방문)하여 제출하면 당일 발급 가능하며 우체부가 방문해서 수령해갈 경우 인증서 발급까지 7~9일 소요 됩니다.</li>
					</ul>
				</div>
				<div class="common-cert-info-box box-type1">
					<h4>국내 은행<span>(발급문의 : 각 은행 고객센터)</span></h4>
					<div class="common-cert-info-inner">
						<h5>개인 사업자, 법인 사업자</h5>
						<ul>
							<li>
								사업자(범용) 인증서
								<span>￦100,000(VAT별도)</span>
							</li>
						</ul>
					</div>
					<ul class="cert-list">
						<li>고객의 <span class="caution-text">기업계좌</span>를 거래하는 인터넷뱅킹 사이트 공인인증센터에 접속 후 신청 (즉시 발급)</li>
					</ul>
					<div class="common-cert-info-inner">
						<h5>개인</h5>
						<ul>
							<li>
								개인(범용) 인증서
								<span>￦4,000(VAT별도)</span>
							</li>
						</ul>
					</div>
					<ul class="cert-list">
						<li>고객의 <span class="caution-text">개인계좌</span>를 거래하는 인터넷뱅킹 사이트 공인인증센터에 접속 후 신청 (즉시 발급)</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</form>
{{form_script}}



<script type="text/javascript">
    function fSign(sinput){
    	<!-- IFNOT START 'default_user_block' -->
    	<!-- IF START 'auth_select' -->
    	alert("인증서 등록 권한이 없습니다.");
    	if(true)return;
    	<!-- IF END 'auth_select' -->
    	<!-- IFNOT END 'default_user_block' -->
    	
    	var ssn = "";
    	if('{{member.member_gubun}}'=='04'){
    		setUniSign("person");
    		
    		if(sinput==null){
    			try{
    	    		OpenWindow("../info/pop_sign_val.jsp","pop_sign_val","400","150");
    	    		return;
    	    	}catch(err){
    	    		alert("팝업차단을 해제 하세요.");
    	    		return;
    	    	}
    		}
    		ssn = "{{member.jumin_no}}"+sinput;
    		if(ssn.length != 13){
    			alert("주민등록번호가 부정확 합니다."+ssn.length);
    			return;
    		}
    	}else{
    		setUniSign("comp");
    		ssn = "{{member.vendcd}}";
    	}
        

        /* 서명데이타 만들기 */
        var f = document.forms['form1'];
        var	org_data = "nocedocu";	//	서명대상 원본데이타
        var	sign_data = "";
        

        unisign.SignDataNVerifyVID( org_data, null, ssn,
            function(rv, signedText, certAttrs)
            {
                sign_data = signedText;

                if ( null === sign_data || '' === sign_data || false === rv )
                {
                    unisign.GetLastError(
                        function(errCode, errMsg)
                        {
                            if(errCode == "999"){
                                //사용자 취소
                            }else if(errCode == "14208"){
                                alert("선택한 인증서는 귀사의 인증서가 아닙니다.");
                            }else{
                                alert('Error code : ' + errCode + '\n\nError Msg : ' + errMsg);
                            }
                        }
                    );
                } else {
                    //console.log(JSON.stringify(certAttrs,null,2));
                    //인증서 확인 단계
                    var cert_end_date = getFormatDate(certAttrs.validateTo);
                    if (cert_end_date.length < 8){
                        alert("유효하지 않은 인증서입니다.(유효일자 미확인)\n\n다시 한번 인증서를 확인 하십시오.");
                        return;
                    }
                    if (!isValidDate(cert_end_date))
                    {
                        alert("유효하지 않은 인증서입니다.(유효일자 미확인)\n\n다시 한번 인증서를 확인 하십시오.");
                        return;
                    }
                    if (js_isDateCmp(cert_end_date, "{{_sysdate}}"))
                    {
                        alert("유효기간이 지난 인증서 입니다.\n\n다시 한번 인증서를 확인 하십시오.");
                        return;
                    }

                    f['sign_data'].value = sign_data;
                    f['cert_dn'].value=certAttrs.subjectName;
                    f['cert_end_date'].value=cert_end_date;
                    signSubmit();
                }
            }
        );
    }

    function signSubmit(){
        var f = document.forms['form1'];
        f.action="cert_modify.jsp";
        f.submit();
    }


    function certAllView(){
        setUniSign("all");
        var sOrgnData ="123456";
        var sSignData = "";
        var	sVendcd = "{{member.vendcd}}";		//	수급사업자번호
        var ssn = sVendcd;// 사업자등록번호/주민등록번호

        unisign.SignDataNVerifyVID( sOrgnData, null, ssn,
            function(rv, signedText, certAttrs)
            {
                sSignData = signedText;

                if ( null === sSignData || '' === sSignData || false === rv )
                {
                    unisign.GetLastError(
                        function(errCode, errMsg)
                        {
                            if(errCode == "999"){
                                //사용자 취소
                            }else if(errCode == "14208"){
                                alert("선택한 인증서는 귀사의 인증서가 아닙니다.");
                            }else{
                                alert('Error code : ' + errCode + '\n\nError Msg : ' + errMsg);
                            }
                        }
                    );
                } else {
                }
            }
        );
    }

    function fCrosscerUrl()
    {
        window.open('https://raadmin.crosscert.com/customer/dnbkorea/index.html','_blank');
    }
</script>