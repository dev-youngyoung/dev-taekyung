<script language="javascript" type="text/javascript" src="../html/js/jquery-1.7.2.min.js"></script>
<form name="form1" method="post" enctype="multipart/form-data">
	<input type="hidden" name="print_content">
	<input type="hidden" name="asse_no" value="{{assessment.asse_no}}" >
	<input type="hidden" name="div_cd" value="{{assessment.div_cd}}" >
	<input type="hidden" name="saveDiv" >
	<input type="hidden" name="email" >
<div class="cont_warp">
	<style type="text/css" id="__html_style">
	.glabel {
		color: #707070;
		FONT-FAMILY: "돋움", "Arial";
		FONT-SIZE: 9pt;
		/*LINE-HEIGHT: 13pt;*/
		border: 1px solid;
		border-color: #d7d5ca;
		text-align: left;
		background-color: #ffff00
	}
	.itemtable {font-size: 11px;background-color:white;line-height:2.5em}
	td {  font-family: "NanumGothic, Arial"; font-size:12px; font-style: normal; letter-spacing:0; color: black;line-height:150%}
	.lineTable { border-collapse:collapse; border:1px solid black }
	.lineTable td { border:1px solid black }
	.lineTable .noborder { border:0 }
	.itemtable {font-size: 11px;background-color:white;line-height:2.5em}
	</style>
	
	<div id="__html">
		<div style="padding-top: 10px" id="__html_0">
			{{assessment.asse_html}}
		</div>
	</div>
</div>
</form>

<div class="btn-group-wrap">
	<!-- IF START 'del' -->
	<button type="button" class="btn color ico-delete" onclick="del()"/><span></span>이전단계로</button>
	<!-- IF END 'del' -->
	<!-- IF START 'modify' -->
	<button type="button" class="btn color ico-save" onclick="save('20')"/><span></span>임시저장</button>
	<button type="button" class="btn color ico-confirm" onclick="save('50')"/><span></span>평가완료</button>
	<button type="button" class="btn color ico-confirm" onclick="save1('90')"/><span></span>결과전송</button>
	<button type="button" class="btn color ico-print" onclick="print()"/><span></span>인쇄</button>
	<button type="button" class="btn color ico-list" onclick="javascript:history.back()"/><span></span>목록으로</button>
	<!-- IF END 'modify' -->
	<!-- IFNOT START 'modify' -->
	<button type="button" class="btn color ico-confirm" onclick="save1('90')"/><span></span>결과전송</button>
	<button type="button" class="btn color ico-print" onclick="print()"/><span></span>인쇄</button>
	<button type="button" class="btn color ico-list" onclick="javascript:history.back()"/><span></span>목록으로</button>
	<!-- IFNOT END 'modify' -->
</div>

<form name="form2" method="post" action="assessment_delete.jsp">
<input type="hidden" name="asse_no" value="{{assessment.asse_no}}" >
<input type="hidden" name="div_cd" value="{{assessment.div_cd}}" >
<input type="hidden" name="mstatus" value="{{assessment.status}}" >
<input type="hidden" name="mode" value="10">
<input type="hidden" name="ret" value="assessment_checking_flist.jsp">
</form>

<script language="javascript">

var hexDigits = new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");

function hex(x) {
	return isNaN(x) ? "00" : hexDigits[(x - x % 16) / 16] + hexDigits[x % 16];
}

function selectCheck(div){

	if(div=="20") return true; // 임시저장은 선택값 다 입력안해도 저장 가능하도록

	//안전 시트 모두 선택했는지 Check
	for(var i=1; i<15; i++){	//행
		var checkYn = "n";
		for(var j=0; j<=16; j++){	//열
			var checkItem = $("#safetyitem"+i+"_"+j).css("background-color");
            if(checkItem == "yellow" || checkItem == "rgb(255, 255, 0)"){
                checkYn = "y";
                break;
           }
		}
		if(checkYn == "n"){
			alert("안전 평가항목을 모두 선택해주세요");
			return;
		}
	}

   return true;
}

function onItemSet(obj, sheetId){
	<!-- IF START 'modify' -->
	var itemPoint = 0;
	var onClickCurId = $(obj).attr("id");
	var arryItem = onClickCurId.split("_");
	var itemId = arryItem[0];
	var itemSeq = arryItem[1];
	for(var i=0; i<=16; i ++){
		$("#"+itemId+"_"+i).css("background-color","white");
	}

	$(obj).css("background-color","yellow");
	if(itemSeq == "1"){
		itemPoint = 1;
	}else if(itemSeq == "2"){
		itemPoint = 2;
	}else if(itemSeq == "3"){
		itemPoint = 3;
	}else if(itemSeq == "4"){
		itemPoint = 4;
	}else if(itemSeq == "5"){
		itemPoint = 5;
	}else if(itemSeq == "6"){
		itemPoint = 6;
	}else if(itemSeq == "7"){
		itemPoint = 7;
	}else if(itemSeq == "8"){
		itemPoint = 8;
	}else if(itemSeq == "10"){
		itemPoint = 10;
	}else if(itemSeq == "12"){
		itemPoint = 12;
	}else{
		itemPoint = 0;
	}

	$("#"+itemId).html(itemPoint);	//평가항목
	var sheetNm = "";
	var rowCnt = 0;
	if(sheetId == "1"){	//안전
		sheetNm = "safetyitem";
		rowCnt = 15;
	}
	sumSafetyItemPoint(sheetNm, rowCnt);
	culRatingPoint();
	<!-- IF END 'modify' -->
}

function sumSafetyItemPoint(sheetNm, rowCnt){

	var sumPoint = 0;
	for(var i=1; i<rowCnt; i++){
		sumPoint = sumPoint + parseInt($("#"+sheetNm+i).html());	//항목평가 점수
	}
	$("#"+sheetNm+"SumPoint").html(sumPoint.toFixed(1));
}

function culRatingPoint(){

	var totalRating = 0;
	var Rating = "";
	var safetySumPoint = parseInt($("#safetyitemSumPoint").html());		//안전시트의 최종판정 점수

	if(Number(safetySumPoint.toFixed(1))>=91){
		Rating = "A";
		totalRating = 50;
	}else if(81 <= Number(safetySumPoint.toFixed(1)) && Number(safetySumPoint.toFixed(1)) <= 90){
		Rating = "B";
		totalRating = 45;
	}else if(71 <= Number(safetySumPoint.toFixed(1)) && Number(safetySumPoint.toFixed(1)) <= 80){
		Rating = "C";
		totalRating = 40;
	}else if(Number(safetySumPoint.toFixed(1)) <= 70){
		Rating = "D";
		totalRating = 35;
	}
	$("#rating").val(totalRating);
	$("#point").val(safetySumPoint.toFixed(1));
	$("#totalPoint").html(Number(safetySumPoint.toFixed(1)));
	$("#totalRate").html(Rating);
}

function save1(div){

	var f = document.forms['form1'];
	f.action = 'assessment_result_sendmail_f.jsp?asse_no={{assessment.asse_no}}';
	var message = "결과 전송 하시겠습니까?";
	if(confirm(message)){
        OpenWindow("pop_sendEmailSet.jsp", "sendEmailSet", 450, 250);
		//fLayerPop("sendEmailSet", "pop_sendEmailSet.jsp" , 320, 200, 470, 1130);
	}
}

function save(div){

	var f = document.forms['form1'];
	f['saveDiv'].value = div;
	if(selectCheck(div)){
		if(validate(f)){
			/* var d = f['date'].value;
		    if(!isDateFormat(d)) {
		    	alert("YYYY-MM-DD 평가일를 확인해주세요.");
		    	f['date'].focus();
		        return false;
		    } */
		    var message = "";
		    if(div == "20"){	//임시저장
		    	message = "임시 저장 하시겠습니까?";
		    }else if(div == "50"){
		    	message = "평가 완료 하시겠습니까?";
		    }else if(div == "90"){
		    	message = "평가 완료 후 결과 전송 하시겠습니까?";
		    }
			if(confirm(message)){
                setDivInputValue("__html");
				splitHtml(f, 'doc_html', false);
				//alert(f['sector'].value);		//소속
				//alert(f['assessor'].value);	//평가원
				if(div == "90"){
                    OpenWindow("pop_sendEmailSet.jsp", "sendEmailSet", 450, 250);
					//fLayerPop("sendEmailSet", "pop_sendEmailSet.jsp" , 320, 200, 470, 1130);
				}else{
					f.submit();
				}
			}
		}
	}
}

function del(){
	var f = document.forms['form2'];
	var message = "";
	if(f['mstatus'].value == "20")  // 평가중 -> 평가대상
	{
		message = "다시 평가대상 등록을 하시겠습니까?\n평가 진행중인 모든 기록이 삭제됩니다.";
	}
	else if(f['mstatus'].value == "50")  // 평가완료 -> 평가중
	{
		message = "다시 평가할 수 있도록 [평가중] 상태로 돌리시겠습니까?";
	}

	if(confirm(message)){
		f.submit();
	}

}

function isDateFormat(d) {
    var df = /[0-9]{4}-[0-9]{2}-[0-9]{2}/;
    return d.match(df);
}

function print(){
	alert('배경색을 인쇄하려면 브라우저의 [파일] -> [페이지 설정] 메뉴에서 "배경색 및 이미지 인쇄"를 체크해주세요."');
	var f = document.forms['form1'];
	removeInput(document.getElementById("__html_0"), f['print_content']);
	var printPop = window.open("","_blank","width=748, height=700");
	var html = "<html><head>"+$('head').html()+"<style type='text/css'>"+$("#__html_style").html()+"</style></head><body>"+ f['print_content'].value+"</body></html>"
	printPop.document.write(html);
	
	printPop.document.close();
	printPop.print();
	//printPop.close();
}

</script>