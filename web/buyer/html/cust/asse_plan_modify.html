<form novalidate name="form1" method="post" onsubmit="return formSubmit(this);">
<div class="div_table">
	<div class="util-row">
		<div class="push-left">
			<h3>평가대상업체 등록<span class="caution-text"></span></h3>
		</div>
		<!-- IF START 'modify' -->
		<div class="push-right">
			평가상태: <span class="caution-text"><b>작성중</b></span>
		</div>
		<!-- IF END 'modify' -->
	</div>
	<table>
		<colgroup>
			<col width="12%">
			<col width="50%">
			<col width="10%">
			<col width="30%">
		</colgroup>
		<tr>
			<th class="req-check">평가종류</th>
			<td colspan="3">
				<select name="kind_cd" style="width:90px" onchange="chgKindCd()">
					<option value="">---선택---</option>
					<!-- LOOP START 'code_kind_cd' -->
					<option value="{{code_kind_cd.id}}">{{code_kind_cd.name}}</option>
	  				<!-- LOOP END 'code_kind_cd' -->
				</select>		
			</td>
		</tr>
		<tr>
			<th class="req-check">평가명</th>
			<td colspan="3">
				<input type="hidden" name="bid_no" value="{{asse.bid_no}}">
				<input type="hidden" name="bid_deg" value="{{asse.bid_deg}}">
				<input type="text" name="project_name" class="in_readonly" style="width:500px"  value="{{assessment.project_name}}" required="Y" hname="평가명" >
				<button type="button" name="btn_select_bid" class="sbtn ico-search auth_css" onclick="OpenWindows('./pop_search_bid.jsp', 'pop_search_bid', '980', '750');"><span></span>선택</button>
			</td>
		</tr>
		<tr id="tr_supp_member">
			<th class="req-check">평가업체 </th>
			<td colspan="3">
				<input type="hidden" name="member_no" value="{{asse.member_no}}">
				<input type="text" name="member_name" class="in_readonly" size="30" readonly>
			</td>
		</tr>
		<tr>
			<th class="req-check">평가부서</th>
			<td colspan="3">
				<input type="checkbox" name="s_yn" value="Y" onclick="clickDept('s')"/> 본사평가&nbsp;&nbsp;
				( 
				담당자 : <input type="text" name="s_user_name" class="in_readonly" hname="본사평가 담당자" readonly style="width:100px" value="{{asse.s_user_name}}"> 
				<input type="hidden" name="s_user_id" value="{{asse.s_user_id}}">
				<button type="button" style="display:none" name="btn_s_user" class="sbtn ico-search auth_css" onclick="OpenWindows('./pop_asse_charge.jsp?callback=setSUser', 'pop_search_charge', '900', '750');"><span></span>선택</button>
				)
				<br>
				<div id="qc_area">
				<input type="checkbox" name="qc_yn" value="Y" onclick="clickDept('qc')"/> 현장평가&nbsp;&nbsp;
				( 
				담당자 : <input type="text" name="qc_user_name" class="in_readonly" hname="현장평가 담당자" readonly style="width:100px" value="{{asse.qc_user_name}}"> 
				<input type="hidden" name="qc_user_id" value="{{asse.qc_user_id}}">
				<button type="button" style="display:none" name="btn_qc_user" class="sbtn ico-search auth_css" onclick="OpenWindows('./pop_asse_charge.jsp?callback=setQCUser', 'pop_search_charge', '900', '750');"><span></span>선택</button>
				<select name="qc_temlate_cd">
				<!-- LOOP START 'templateQ' -->
				<option value="{{templateQ.template_cd}}">{{templateQ.template_name}}</option>
				<!-- LOOP END 'templateQ' -->
				</select>
				)
				</div>
			</td>
		</tr>
	</table>
</div>
<div class="btn-group-wrap">
	<!-- IFNOT START 'modify' -->
	<button type="submit" class="btn color ico-save auth_css"><span></span>저장</button>
	<button type="button" class="btn color ico-list" onclick="location.href='asse_plan_list.jsp?{{list_query}}'"><span></span>목록으로</button>
	<!-- IFNOT END 'modify' -->
	<!-- IF START 'modify' -->
	<button type="button" class="btn color ico-delete auth_css" onclick="if(confirm('삭제 하시겠습니까?')){location.href='asse_plan_delete.jsp?{{query}}'}"><span></span>삭제</button>
	<button type="submit" class="btn color ico-save auth_css"><span></span>저장</button>
	<button type="button" class="btn color ico-check auth_css" onclick="if(confirm('평가를 시작 하시겠습니까?')){location.href='asse_start.jsp?{{query}}'}"><span></span>평가시작</button>
	<button type="button" class="btn color ico-list" onclick="location.href='asse_plan_list.jsp?{{list_query}}'"><span></span>목록으로</button>
	<!-- IF END 'modify' -->
</div>
</form>
{{form_script}}
<script language="javascript">
function formSubmit(f){
	if(validate(f)){
		if( !(f['s_yn'].checked||f['qc_yn'].checked)){
			alert("평가부서를 선택 하세요.");
			return false;
		}
		var msg = "저장 하시겠습니까?";
		if(confirm(msg)){
			return true;
		}
	}
	return false;
}

function chgKindCd(){
	var f = document.forms['form1'];
	if(f['kind_cd'].value == "R"){
		f['s_yn'].checked = true;
		f['s_yn'].style.display = "none";
		f['project_name'].className = "label";
		f['project_name'].readOnly = false;
		f['qc_yn'].checked = false;
		document.getElementById("tr_supp_member").style.display="none";
		document.getElementById("qc_area").style.display="none";
		f['btn_select_bid'].style.display="none";
		clickDept("s");
		setSUser({"user_id":"{{_auth._USER_ID}}","user_name":"{{_auth._USER_NAME}}"});
		removeAttr("form1","member_name");
	}else{
		f['project_name'].value="";
		f['project_name'].className = "in_readonly";
		f['project_name'].readOnly = true;
		f['btn_select_bid'].style.display="";
		document.getElementById("tr_supp_member").style.display="";
		document.getElementById("qc_area").style.display="";
		f['s_yn'].style.display = "";
		setAttr("form1","member_name","required","Y");
	}
}

function clickDept(gubun){
	var f = document.forms['form1'];
	if(f[gubun+"_yn"].checked){
		f[gubun+"_user_name"].readonly = false;
		f[gubun+"_user_name"].className = "label";
		f["btn_"+gubun+"_user"].style.display = "";
		if(gubun == "qc"){
			f[gubun+"_temlate_cd"].style.display = "";
		}
		setAttr("form1",gubun+"_user_id,"+gubun+"_user_name","required","Y");
	}else{
		f[gubun+"_user_name"].readonly = true;
		f[gubun+"_user_name"].className = "in_readonly";
		f[gubun+"_user_id"].value = "";
		f[gubun+"_user_name"].value = "";
		f["btn_"+gubun+"_user"].style.display = "none";
		if(gubun == "qc"){
			f[gubun+"_temlate_cd"].style.display = "none";
		}
		removeAttr("form1",gubun+"_user_id,"+gubun+"_user_name");
	}
}


function setSUser(data){
	var f = document.forms['form1'];
	f['s_user_id'].value=data["user_id"];
	f['s_user_name'].value=data["user_name"];
}
function setQCUser(data){
	var f = document.forms['form1'];
	f['qc_user_id'].value=data["user_id"];
	f['qc_user_name'].value=data["user_name"];
}

function setData(data){
	var f = document.forms['form1'];
	f['bid_no'].value = data["bid_no"]; 
	f['bid_deg'].value = data["bid_deg"]; 
	f['project_name'].value = data["bid_name"]; 
	f['member_no'].value = data["member_no"]; 
	f['member_name'].value = data["member_name"];
	f['s_yn'].checked = true;
	clickDept('s');
	f['s_user_id'].value=data["charge_id"];
	f['s_user_name'].value=data["charge_name"];
}

clickDept('s');
clickDept('qc');
</script>
