<form name="form1" method="post" enctype="multipart/form-data" action="financeUpdate.jsp">
<input type="hidden" name="asse_no" value="{{assessment.asse_no}}" >
<input type="hidden" name="div_cd" value="{{assessment.div_cd}}" >
<div class="util-row">
<div class="push-right">
	<button type="button" class="sbtn color ico-cancel" onclick="self.close();"><span></span>닫기</button>
</div>
</div>
<div class="cont_warp">	
	<style type="text/css">
	.glabel {
		color: #707070;
		FONT-FAMILY: "돋움", "Arial";
		FONT-SIZE: 9pt;
		/*LINE-HEIGHT: 13pt;*/
		border: 1px solid;
		border-color: #d7d5ca;
		text-align: left;
		background-color: #ffff00
	}
	td {  font-family: "나눔고딕, Arial"; font-size:12px; font-style: normal; letter-spacing:0; color: black;line-height:150%}
	.lineTable { border-collapse:collapse; border:1px solid black }
	.lineTable td { border:1px solid black }
	.lineTable .noborder { border:0 }
	.itemtable {font-size: 11px;line-height:180%;background-color:white;}
	</style>
	<div id="__html">
		<div style="padding-top: 10px" id="__html_0">
			{{assessment.asse_subhtml}}
		</div>
	</div>
</div>			
</form>

<script type="text/javascript">

window.resizeTo(1000,600);

var hexDigits = new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"); 

function hex(x) {
  return isNaN(x) ? "00" : hexDigits[(x - x % 16) / 16] + hexDigits[x % 16];
}


function selectCheck(){

	for(var i=1; i<8; i++){	
		var checkYn = "n";
		for(var j=1; j<=5; j++){	
			var checkItem = $("#operationitem"+i+"_"+j).css("background-color");
			if(checkItem == "yellow"){
				checkYn = "y";
				break;
			}
		}
		if(checkYn == "n"){
			alert("평가항목을 모두 선택해주세요");
			return false;
		}
	}
	return true;
}

function calculation(){
	
	
	//calcProfitability();

	
	//calcSafety();

	
	//calcActivity();


	//calcEndurance();

	
	//calcGrowth();

	
	//calcTotal();
}

function calcProfitability(){
	
	var sales1 = $("#sales1").val().replace(/,/g, '');
	var sales2 = $("#sales2").val().replace(/,/g, '');
	var sales3 = $("#sales3").val().replace(/,/g, '');

	var cost1 = $("#cost1").val().replace(/,/g, '');
	var cost2 = $("#cost2").val().replace(/,/g, '');
	var cost3 = $("#cost3").val().replace(/,/g, '');

	var mCost1 = $("#mCost1").val().replace(/,/g, '');
	var mCost2 = $("#mCost2").val().replace(/,/g, '');
	var mCost3 = $("#mCost3").val().replace(/,/g, '');

	var tCost1 = Number(cost1) + Number(mCost1);
	var tCost2 = Number(cost2) + Number(mCost2);
	var tCost3 = Number(cost3) + Number(mCost3);

	var profitabilityPoint1 = Number(sales1) / Number(tCost1);
	if(isFinite(profitabilityPoint1)){
		$("#profitabilityPoint1").html(profitabilityPoint1.toFixed(3));
		var profitabilityRating1 = "양호";
		if(profitabilityPoint1.toFixed(2) > 1.5){
			profitabilityRating1 = "우수";
		}else if(profitabilityPoint1.toFixed(2) < 0.8){
			profitabilityRating1 = "저조";
		}
		$("#profitabilityRating1").html(profitabilityRating1);
	}
	var profitabilityPoint2 = Number(sales2) / Number(tCost2);
	if(isFinite(profitabilityPoint2)){
		$("#profitabilityPoint2").html(profitabilityPoint2.toFixed(3));
		var profitabilityRating2 = "양호";
		if(profitabilityPoint2.toFixed(2) > 1.5){
			profitabilityRating2 = "우수";
		}else if(profitabilityPoint2.toFixed(2) < 0.8){
			profitabilityRating2 = "저조";
		}
		$("#profitabilityRating2").html(profitabilityRating2);
	}
	var profitabilityPoint3 = Number(sales3) / Number(tCost3);
	if(isFinite(profitabilityPoint3)){
		$("#profitabilityPoint3").html(profitabilityPoint3.toFixed(3));
		var profitabilityRating3 = "양호";
		if(profitabilityPoint3.toFixed(2) > 1.5){
			profitabilityRating3 = "우수";
		}else if(profitabilityPoint3.toFixed(2) < 0.8){
			profitabilityRating3 = "저조";
		}
		$("#profitabilityRating3").html(profitabilityRating3);
	}
}

function calcSafety(){
	
	var currentAssets1 = $("#currentAssets1").val().replace(/,/g, '');
	var currentAssets2 = $("#currentAssets2").val().replace(/,/g, '');
	var currentAssets3 = $("#currentAssets3").val().replace(/,/g, '');
	
	var liabilities1 = $("#liabilities1").val().replace(/,/g, '');
	var liabilities2 = $("#liabilities2").val().replace(/,/g, '');
	var liabilities3 = $("#liabilities3").val().replace(/,/g, '');

	var safetyPoint1 = Number(currentAssets1) / Number(liabilities1);
	if(isFinite(safetyPoint1)){
		$("#safetyPoint1").html(safetyPoint1.toFixed(3));
		var safetyRating1 = "양호";
		if(safetyPoint1.toFixed(2) > 1.5){
			safetyRating1 = "우수";
		}else if(safetyPoint1.toFixed(2) < 0.8){
			safetyRating1 = "저조";
		}
		$("#safetyRating1").html(safetyRating1);
	}

	var safetyPoint2 = Number(currentAssets2) / Number(liabilities2);
	if(isFinite(safetyPoint2)){
		$("#safetyPoint2").html(safetyPoint2.toFixed(3));
		var safetyRating2 = "양호";
		if(safetyPoint2.toFixed(2) > 1.5){
			safetyRating2 = "우수";
		}else if(safetyPoint2.toFixed(2) < 0.8){
			safetyRating2 = "저조";
		}
		$("#safetyRating2").html(safetyRating2);
	}

	var safetyPoint3 = Number(currentAssets3) / Number(liabilities3);
	if(isFinite(safetyPoint3)){
		$("#safetyPoint3").html(safetyPoint3.toFixed(3));
		var safetyRating3 = "양호";
		if(safetyPoint3.toFixed(2) > 1.5){
			safetyRating3 = "우수";
		}else if(safetyPoint3.toFixed(2) < 0.8){
			safetyRating3 = "저조";
		}
		$("#safetyRating3").html(safetyRating3);
	}
}

function calcActivity(){
	
	var sales1 = $("#sales1").val().replace(/,/g, '');
	var sales2 = $("#sales2").val().replace(/,/g, '');
	var sales3 = $("#sales3").val().replace(/,/g, '');
	
	var assets1 = $("#assets1").val().replace(/,/g, '');
	var assets2 = $("#assets2").val().replace(/,/g, '');
	var assets3 = $("#assets3").val().replace(/,/g, '');

	var activityPoint1 = Number(sales1) / Number(assets1);
	if(isFinite(activityPoint1)){
		$("#activityPoint1").html(activityPoint1.toFixed(3));
		var activityRating1 = "양호";
		if(activityPoint1.toFixed(2) > 1.5){
			activityRating1 = "우수";
		}else if(activityPoint1.toFixed(2) < 0.8){
			activityRating1 = "저조";
		}
		$("#activityRating1").html(activityRating1);
	}

	var activityPoint2 = Number(sales2) / Number(assets2);
	if(isFinite(activityPoint2)){
		$("#activityPoint2").html(activityPoint2.toFixed(3));
		var activityRating2 = "양호";
		if(activityPoint2.toFixed(2) > 1.5){
			activityRating2 = "우수";
		}else if(activityPoint2.toFixed(2) < 0.8){
			activityRating2 = "저조";
		}
		$("#activityRating2").html(activityRating2);
	}

	var activityPoint3 = Number(sales3) / Number(assets3);
	if(isFinite(activityPoint3)){
		$("#activityPoint3").html(activityPoint3.toFixed(3));
		var activityRating3 = "양호";
		if(activityPoint3.toFixed(2) > 1.5){
			activityRating3 = "우수";
		}else if(activityPoint3.toFixed(2) < 0.8){
			activityRating3 = "저조";
		}
		$("#activityRating3").html(activityRating3);
	}
}

function calcEndurance(){
	
	var capital1 = $("#capital1").val().replace(/,/g, '');
	var capital2 = $("#capital2").val().replace(/,/g, '');
	var capital3 = $("#capital3").val().replace(/,/g, '');

	var liabilities1 = $("#liabilities1").val().replace(/,/g, '');
	var liabilities2 = $("#liabilities2").val().replace(/,/g, '');
	var liabilities3 = $("#liabilities3").val().replace(/,/g, '');

	var endurancePoint1 = Number(capital1) / Number(liabilities1);
	if(isFinite(endurancePoint1)){
		$("#endurancePoint1").html(endurancePoint1.toFixed(3));
		var enduranceRating1 = "양호";
		if(endurancePoint1.toFixed(2) > 1.5){
			enduranceRating1 = "우수";
		}else if(endurancePoint1.toFixed(2) < 0.8){
			enduranceRating1 = "저조";
		}
		$("#enduranceRating1").html(enduranceRating1);
	}

	var endurancePoint2 = Number(capital2) / Number(liabilities2);
	if(isFinite(endurancePoint2)){
		$("#endurancePoint2").html(endurancePoint2.toFixed(3));
		var enduranceRating2 = "양호";
		if(endurancePoint2.toFixed(2) > 1.5){
			enduranceRating2 = "우수";
		}else if(endurancePoint2.toFixed(2) < 0.8){
			enduranceRating2 = "저조";
		}
		$("#enduranceRating2").html(enduranceRating2);
	}

	var endurancePoint3 = Number(capital3) / Number(liabilities3);
	if(isFinite(endurancePoint3)){
		$("#endurancePoint3").html(endurancePoint3.toFixed(3));
		var enduranceRating3 = "양호";
		if(endurancePoint3.toFixed(2) > 1.5){
			enduranceRating3 = "우수";
		}else if(endurancePoint3.toFixed(2) < 0.8){
			enduranceRating3 = "저조";
		}
		$("#enduranceRating3").html(enduranceRating3);
	}

}

function calcGrowth(){
	

	var capital1 = $("#capital1").val().replace(/,/g, '');
	var capital2 = $("#capital2").val().replace(/,/g, '');
	var capital3 = $("#capital3").val().replace(/,/g, '');
	
	var capital1_1 = $("#capital1").val().replace(/,/g, '');
	var capital2_1 = $("#capital2").val().replace(/,/g, '');
	var capital3_1 = $("#capital3").val().replace(/,/g, '');

	var netIncome1 = $("#netIncome1").val().replace(/,/g, '');
	var netIncome2 = $("#netIncome2").val().replace(/,/g, '');
	var netIncome3 = $("#netIncome3").val().replace(/,/g, '');

	var growthPoint1 = Number(capital1) / ( Number(capital1_1) - Number(netIncome1) );
	if(isFinite(growthPoint1)){
		$("#growthPoint1").html(growthPoint1.toFixed(3));
		var growthRating1 = "양호";
		if(growthPoint1.toFixed(2) > 1.5){
			growthRating1 = "우수";
		}else if(growthPoint1.toFixed(2) < 0.8){
			growthRating1 = "저조";
		}
		$("#growthRating1").html(growthRating1);
	}
	var growthPoint2 = Number(capital2) / ( Number(capital2_1) - Number(netIncome2) );
	if(isFinite(growthPoint2)){
		$("#growthPoint2").html(growthPoint2.toFixed(3));
		var growthRating2 = "양호";
		if(growthPoint2.toFixed(2) > 1.5){
			growthRating2 = "우수";
		}else if(growthPoint2.toFixed(2) < 0.8){
			growthRating2 = "저조";
		}
		$("#growthRating2").html(growthRating2);
	}
	var growthPoint3 = Number(capital3) / ( Number(capital3_1) - Number(netIncome3) );
	if(isFinite(growthPoint3)){
		$("#growthPoint3").html(growthPoint3.toFixed(3));
		var growthRating3 = "양호";
		if(growthPoint3.toFixed(2) > 1.5){
			growthRating3 = "우수";
		}else if(growthPoint3.toFixed(2) < 0.8){
			growthRating3 = "저조";
		}
		$("#growthRating3").html(growthRating3);
	}

}

function calcTotal(){
	
	var profitabilityPoint1 = $("#profitabilityPoint1").html();
	var profitabilityPoint2 = $("#profitabilityPoint2").html();
	var profitabilityPoint3 = $("#profitabilityPoint3").html();

	var safetyPoint1 = $("#safetyPoint1").html();
	var safetyPoint2 = $("#safetyPoint2").html();
	var safetyPoint3 = $("#safetyPoint3").html();

	var activityPoint1 = $("#activityPoint1").html();
	var activityPoint2 = $("#activityPoint2").html();
	var activityPoint3 = $("#activityPoint3").html();

	var endurancePoint1 = $("#endurancePoint1").html();
	var endurancePoint2 = $("#endurancePoint2").html();
	var endurancePoint3 = $("#endurancePoint3").html();

	var growthPoint1 = $("#growthPoint1").html();
	var growthPoint2 = $("#growthPoint2").html();
	var growthPoint3 = $("#growthPoint3").html();
	
	var tPoint1 = (parseFloat(profitabilityPoint1) + parseFloat(safetyPoint1) + parseFloat(activityPoint1) + parseFloat(endurancePoint1) + parseFloat(growthPoint1)) / 5
	if(isFinite(tPoint1)){
		$("#totalPoint1").html(tPoint1.toFixed(3));
	}
	var tPoint2 = (parseFloat(profitabilityPoint2) + parseFloat(safetyPoint2) + parseFloat(activityPoint2) + parseFloat(endurancePoint2) + parseFloat(growthPoint2)) / 5
	if(isFinite(tPoint2)){
		$("#totalPoint2").html(tPoint2.toFixed(3));
	}
	var tPoint3 = (parseFloat(profitabilityPoint3) + parseFloat(safetyPoint3) + parseFloat(activityPoint3) + parseFloat(endurancePoint3) + parseFloat(growthPoint3)) / 5
	if(isFinite(tPoint3)){
		$("#totalPoint3").html(tPoint3.toFixed(3));
	}
}

function onItemSet(obj, sheetId){

	return;
}

function sumSafetyItemPoint(sheetNm, rowCnt){
	
	var sumPoint = 0;
	for(var i=1; i<rowCnt; i++){
		sumPoint = sumPoint + parseFloat($("#"+sheetNm+i).html());	
	}
	$("#"+sheetNm+"SumPoint").html(sumPoint.toFixed(1));	
}

function culRatingPoint(){
	
	var totalPoitn = 0;	
	var totalRating = 0;
	var operationSumPoint = parseFloat($("#operationitemSumPoint").html());		
	totalPoitn = operationSumPoint;		

	$("#rating").val(totalPoitn.toFixed(1));
	$("#point").val(totalPoitn.toFixed(1));
	$("#totalPoint").html(totalPoitn.toFixed(1));
}

function returnTotalPoint(){
	
	if(selectCheck()){
		
		window.returnValue = $("#point").val();
		window.close();
	}
}


function save(){

	var f = document.forms['form1'];
	if(selectCheck()){
		if(validate(f)){
			
			var d = f['ratingDate'].value;
		    if(!isDateFormat(d)) {
		    	alert("YYYY-MM-DD 평가일을 확인해주세요.");
		    	f['ratingDate'].focus();
		        return false;
		    }
		    
			if(confirm("저장 하시겠습니까?")){
				splitHtml(f, 'doc_html', false);
				f.submit();
			}
		}
	}
}

function isDateFormat(d) {
    var df = /[0-9]{4}-[0-9]{2}-[0-9]{2}/;
    return d.match(df);
}

</script> 