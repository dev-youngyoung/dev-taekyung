<form name="form1" method="post" enctype="multipart/form-data">

	<input type="hidden" name="asse_no" value="{{assessment.asse_no}}" >
	<input type="hidden" name="saveDiv" >
	<input type="hidden" name="email" >

<div class="cont_warp">	
	<style type="text/css">
	.glabel {
		color: #707070;
		FONT-FAMILY: "돋움", "Arial";
		FONT-SIZE: 9pt;
		/*LINE-HEIGHT: 13pt;*/
		border: 1px solid;
		border-color: #d7d5ca;
		text-align: left;
		background-color: #ffff00;
	)
	.itemtable {font-size: 11px;background-color:white;line-height:2.5em}
	td {  font-family: "NanumGothic, Arial"; font-size:12px; font-style: normal; letter-spacing:0; color: black;line-height:150%}
	.lineTable { border-collapse:collapse; border:1px solid black }
	.lineTable td { border:1px solid black }
	.lineTable .noborder { border:0 }
	.itemtable {font-size: 11px;background-color:white;line-height:2.5em}
	</style>

	<div id="__html">
		<div style="padding-top: 10px" id="__html_0">
			{{assessment.asse_html}}
		</div>
	</div>
</div>
</form>
<br>

<script language="javascript">

if( window.attachEvent )  // IE의 경우
	window.attachEvent( "onload", convertHtml );
else  // IE가 아닌 경우.
	window.addEventListener( "load", convertHtml , false );

function convertHtml(){
	removeInput2(document.getElementById("__html_0"));
}

var hexDigits = new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");
function hex(x) {
	return isNaN(x) ? "00" : hexDigits[(x - x % 16) / 16] + hexDigits[x % 16];
}

function selectCheck(div){

	if(div=="20") return true; // 임시저장은 선택값 다 입력안해도 저장 가능하도록

   for(var i=1; i<6; i++){
       var checkYn = "n";
          for(var j=1; j<=5; j++){
               var checkItem = $("#operationitem"+i+"_"+j).css("background-color");
               if(checkItem == "yellow"){
                    checkYn = "y";
                    break;
               }
           }
           if(checkYn == "n"){
              alert("경영 일반 평가항목을 모두 선택해주세요");
              return;
           }
   }

   var checkItem = $("#financeitem1").html();
   if(checkItem == "0"){
       alert("재무 관리 평가항목을 모두 선택해주세요");
       return;
   }

   for(var i=1; i<7; i++){
        var checkYn = "n";
        for(var j=1; j<=5; j++){
             var checkItem = $("#processesitem"+i+"_"+j).css("background-color");
             if(checkItem == "yellow"){
                  checkYn = "y";
                  break;
             }
        }
        if(checkYn == "n"){
             alert("내부 프로세스 평가항목을 모두 선택해주세요");
             return;
        }
   }

   for(var i=1; i<3; i++){
        var checkYn = "n";
        for(var j=1; j<=5; j++){
             var checkItem = $("#qualityitem"+i+"_"+j).css("background-color");
             if(checkItem == "yellow"){
                  checkYn = "y";
                  break;
             }
        }
        if(checkYn == "n"){
             alert("품질 관리 평가항목을 모두 선택해주세요");
             return;
        }
   }
   return true;
}

function onItemSet(obj, sheetId){
	return;
}

function sumSafetyItemPoint(sheetNm, rowCnt){
	var sumPoint = 0;
	for(var i=1; i<rowCnt; i++){
		sumPoint = sumPoint + parseFloat($("#"+sheetNm+i).html());
	}
	$("#"+sheetNm+"SumPoint").html(sumPoint.toFixed(1));
}

function culRatingPoint(){
	var totalPoitn = 0;
	var totalRating = 0;
	var operationSumPoint = parseFloat($("#operationitemSumPoint").html());
	var financeSumPoint = parseFloat($("#financeitemSumPoint").html());
	var processesSumPoint = parseFloat($("#processesitemSumPoint").html());
	var qualitySumPoint = parseFloat($("#qualityitemSumPoint").html());
	totalPoitn = operationSumPoint + financeSumPoint + processesSumPoint + qualitySumPoint;
	$("#rating").val(totalPoitn.toFixed(1));
	$("#point").val(totalPoitn.toFixed(1));
	$("#totalPoint").html(totalPoitn.toFixed(1));
}

function openfinance(){
	var f = document.forms['form1'];
	var asse_no = f['asse_no'].value;
    OpenWindow("pop_finance_view.jsp?asse_no="+asse_no,"pop_finance", 900, 500);
	//popup_callback(resultTotalPoint);
}

function popup_callback(resultTotalPoint){
	if(resultTotalPoint != null ||  typeof resultTotalPoint == "undefined"){
		$("#financeitem1").html(resultTotalPoint);
		$("#financeitemSumPoint").html(resultTotalPoint);
		culRatingPoint();
	}
}

function save(div){

	var f = document.forms['form1'];
	f['saveDiv'].value = div;
	if(selectCheck(div)){
		if(validate(f)){
			var d = f['ratingDate'].value;
		    if(!isDateFormat(d)) {
		    	alert("YYYY-MM-DD 평가일을 확인해주세요.");
		    	f['ratingDate'].focus();
		        return false;
		    }
		    var message = "";
		    if(div == "20"){	//임시저장
		    	message = "임시 저장 하시겠습니까?";
		    }else if(div == "50"){
		    	message = "평가 완료 하시겠습니까?";
		    }else if(div == "90"){
		    	message = "평가 완료 후 결과 전송 하시겠습니까?";
		    }
			if(confirm(message)){
				splitHtml(f, 'doc_html', false);
				//alert(f['sector'].value);		//소속
				//alert(f['assessor'].value);	//평가원
				if(div == "90"){
					fLayerPop("sendEmailSet", "pop_sendEmailSet.jsp" , 320, 200, 470, 700);
				}else{
					f.submit();
				}
			}
		}
	}
}

function layerPopCloseEnt(layerID)
{
	var	oNode	=	parent.document.getElementById(layerID);
	if(oNode != null)
	{
		parent.document.body.removeChild(oNode);
	}
}

function isDateFormat(d) {
    var df = /[0-9]{4}-[0-9]{2}-[0-9]{2}/;
    return d.match(df);
}

</script>