<form name="form1" method="post" enctype="multipart/form-data">
	<input type="hidden" name="print_content">
	<input type="hidden" name="asse_no" value="{{assessment.asse_no}}" >
	<input type="hidden" name="div_cd" value="{{assessment.div_cd}}" >
	<input type="hidden" name="saveDiv" >
	<input type="hidden" name="email" >

	<div class="cont_warp">
		<style type="text/css" id="__html_style">
		.glabel {
			color: #707070;
			FONT-FAMILY: "돋움", "Arial";
			FONT-SIZE: 9pt;
			/*LINE-HEIGHT: 13pt;*/
			border: 1px solid;
			border-color: #d7d5ca;
			text-align: left;
			background-color: #ffff00;
			.itemtable {font-size: 11px;background-color:white;line-height:2.5em}
		}
		td {  font-family: "NanumGothic, Arial"; font-size:12px; font-style: normal; letter-spacing:0; color: black;line-height:150%}
		.lineTable { border-collapse:collapse; border:1px solid black }
		.lineTable td { border:1px solid black }
		.lineTable .noborder { border:0 }
		.itemtable {font-size: 11px;background-color:white;line-height:2.5em}
		</style>

		<div id="__html">
			<div style="padding-top: 10px" id="__html_0">
				{{assessment.asse_html}}
			</div>
		</div>
	</div>
</form>

<div class="btn-group-wrap">
	<!-- IF START 'del' -->
	<button type="button" class="btn color ico-delete" onclick="del()"><span></span>이전단계로</button>
	<!-- IF END 'del' -->
	<!-- IF START 'modify' -->
	<button type="button" class="btn color ico-save" onclick="save('20')"><span></span>임시저장</button>
	<button type="button" class="btn color ico-confirm" onclick="save('50')"><span></span>평가완료</button>
	<button type="button" class="btn color ico-print" onclick="print()"><span></span>인쇄</button>
	<button type="button" class="btn color ico-list" onclick="javascript:history.back()"><span></span>목록으로</button>
	<!-- IF END 'modify' -->
	<!-- IFNOT START 'modify' -->
	<button type="button" class="btn color ico-confirm" onclick="save1('90')"><span></span>결과전송</button>
	<button type="button" class="btn color ico-print" onclick="print()"><span></span>인쇄</button>
	<button type="button" class="btn color ico-list" onclick="javascript:history.back()"><span></span>목록으로</button>
	<!-- IFNOT END 'modify' -->
</div>

<form name="form2" method="post" action="assessment_delete.jsp">
<input type="hidden" name="asse_no" value="{{assessment.asse_no}}" >
<input type="hidden" name="div_cd" value="{{assessment.div_cd}}" >
<input type="hidden" name="mstatus" value="{{assessment.status}}" >
<input type="hidden" name="mode" value="10">
<input type="hidden" name="ret" value="assessment_checking_qlist.jsp">
</form>

<script language="javascript">

var hexDigits = new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");

function hex(x) {
	return isNaN(x) ? "00" : hexDigits[(x - x % 16) / 16] + hexDigits[x % 16];
}

function selectCheck(div){

	if(div=="20") return true; // 임시저장은 선택값 다 입력안해도 저장 가능하도록

	//안전 시트 모두 선택했는지 Check
	for(var i=1; i<12; i++){	//행
		var checkYn = "n";
		for(var j=1; j<=4; j++){	//열
			var checkItem = $("#safetyitem"+i+"_"+j).css("background-color");
            if(checkItem == "yellow" || checkItem == "rgb(255, 255, 0)"){
                checkYn = "y";
                break;
           }
		}

		if(checkYn == "n"){
			alert("일반관리 평가항목을 모두 선택해주세요");
			return;
		}
	}

	//품질 시트 모두 선택했는지 Check
	for(var i=1; i<8; i++){
		var checkYn = "n";
		for(var j=1; j<=4; j++){	//열
			var checkItem = $("#deliveryitem"+i+"_"+j).css("background-color");
            if(checkItem == "yellow" || checkItem == "rgb(255, 255, 0)"){
                checkYn = "y";
                break;
           }
		}
		if(checkYn == "n"){
			alert("품질관리 평가항목을 모두 선택해주세요");
			return;
		}
	}

	//납기 시트 모두 선택했는지 Check
	for(var i=1; i<5; i++){
		var checkYn = "n";
		for(var j=1; j<=4; j++){	//열
			var checkItem = $("#qualityitem"+i+"_"+j).css("background-color");
            if(checkItem == "yellow" || checkItem == "rgb(255, 255, 0)"){
                checkYn = "y";
                break;
           }
		}
		if(checkYn == "n"){
			alert("납기관리 평가항목을 모두 선택해주세요");
			return;
		}
	}

   return true;
}

function onItemSet(obj, sheetId){
	<!-- IF START 'modify' -->
	var itemPoint = 0;
	var onClickCurId = $(obj).attr("id");
	var arryItem = onClickCurId.split("_");
	var itemId = arryItem[0];
	var itemSeq = arryItem[1];
	for(var i=1; i<5; i ++){
		$("#"+itemId+"_"+i).css("background-color","white");
	}

	$(obj).css("background-color","yellow");

	var sheetNm = "";
	var rowCnt = 0;
	if(sheetId == "1"){	//일반
		if(itemSeq == "1"){			//S
			itemPoint = 5.2;
		}else if(itemSeq == "2"){	//A
			itemPoint = 5.0;
		}else if(itemSeq == "3"){	//B
			itemPoint = 4.0;
		}else{	//C
			itemPoint = 3.0;
		}
	
		sheetNm = "safetyitem";
		rowCnt = 12;
	}else if(sheetId == "2"){	//품질
		if(itemSeq == "1"){			//S
			itemPoint = 3.2;
		}else if(itemSeq == "2"){	//A
			itemPoint = 3.0;
		}else if(itemSeq == "3"){	//B
			itemPoint = 2.5;
		}else{	//C
			itemPoint = 2.0;
		}
	
		sheetNm = "deliveryitem";
		rowCnt = 8;
	}else if(sheetId == "3"){	//납기
		if(itemSeq == "1"){			//S
			itemPoint = 2.2;
		}else if(itemSeq == "2"){	//A
			itemPoint = 2.0;
		}else if(itemSeq == "3"){	//B
			itemPoint = 1.5;
		}else{	//C
			itemPoint = 1.0;
		}
	
		sheetNm = "qualityitem";
		rowCnt = 5;
	}
	$("#"+itemId).html(itemPoint);	//항목평가
	
	sumSafetyItemPoint(sheetNm, rowCnt);
	culRatingPoint();
	<!-- IF END 'modify' -->
}

function sumSafetyItemPoint(sheetNm, rowCnt){

	var sumPoint = 0;
	for(var i=1; i<rowCnt; i++){
		sumPoint = sumPoint + parseFloat($("#"+sheetNm+i).html());	//항목평가 점수
	}
	$("#"+sheetNm+"SumPoint").html(sumPoint.toFixed(1));
}

function culRatingPoint(){

	var totalPoitn = 0;	//최종점수
	var Rating = "";
	var totalRating = 0;
	var safetySumPoint = parseFloat($("#safetyitemSumPoint").html()) / 1.1;		//안전시트의 최종판정 점수
	var deliverySumPoint = parseFloat($("#deliveryitemSumPoint").html()) / 0.7;	//납기시트의 최종판정 점수
	var qualitySumPoint = parseFloat($("#qualityitemSumPoint").html()) / 0.4;	//품질시트의 최종판정 점수
	totalPoitn = safetySumPoint + deliverySumPoint + qualitySumPoint;		//합산(최종점수)

	if(Number(totalPoitn.toFixed(1))>=100){
		totalRating = 50;
		Rating = "S";
	}else if(90 <= Number(totalPoitn.toFixed(1)) && Number(totalPoitn.toFixed(1)) < 100){
		totalRating = 45;
		Rating = "A";
	}else if(80 <= Number(totalPoitn.toFixed(1)) && Number(totalPoitn.toFixed(1)) < 90){
		totalRating = 40;
		Rating = "B";
	}else if(Number(totalPoitn.toFixed(1)) < 80){
		totalRating = 35;
		Rating = "C";
	}
	$("#rating").val(totalRating);
	$("#point").val(totalPoitn.toFixed(1));
	$("#totalPoint").html(totalPoitn.toFixed(1));
	$("#totalRate").html(Rating);
}

function save1(div){

	var f = document.forms['form1'];
	f.action = 'assessment_result_sendmail_enc.jsp?asse_no={{assessment.asse_no}}';
	var message = "결과 전송 하시겠습니까?";
	if(confirm(message)){
		//fLayerPop("sendEmailSet", "pop_sendEmailSet.jsp" , 320, 200, 470, 1130);
        OpenWindow("pop_sendEmailSet.jsp", "sendEmailSet", 450, 250);
	}
}

function save(div){

	var f = document.forms['form1'];
	f['saveDiv'].value = div;
	if(selectCheck(div)){
		if(validate(f)){
			/* var d = f['date'].value;
		    if(!isDateFormat(d)) {
		    	alert("YYYY-MM-DD 평가일를 확인해주세요.");
		    	f['date'].focus();
		        return false;
		    } */
		    var message = "";
		    if(div == "20"){	//임시저장
		    	message = "임시 저장 하시겠습니까?";
		    }else if(div == "50"){
		    	message = "평가 완료 하시겠습니까?";
		    }else if(div == "90"){
		    	message = "평가 완료 후 결과 전송 하시겠습니까?";
		    }
			if(confirm(message)){
                setDivInputValue("__html");
				splitHtml(f, 'doc_html', false);
				//alert(f['sector'].value);		//소속
				//alert(f['assessor'].value);	//평가원
				if(div == "90"){
                    OpenWindow("pop_sendEmailSet.jsp", "sendEmailSet", 420, 200);
					//fLayerPop("sendEmailSet", "pop_sendEmailSet.jsp" , 320, 200, 470, 1130);
				}else{
					f.submit();
				}
			}
		}
	}
}

function del(){
	var f = document.forms['form2'];
	var message = "";
	if(f['mstatus'].value == "20")  // 평가중 -> 평가대상
	{
		message = "다시 평가대상 등록을 하시겠습니까?\n평가 진행중인 모든 기록이 삭제됩니다.";
	}
	else if(f['mstatus'].value == "50")  // 평가완료 -> 평가중
	{
		message = "다시 평가할 수 있도록 [평가중] 상태로 돌리시겠습니까?";
	}

	if(confirm(message)){
		f.submit();
	}

}

function isDateFormat(d) {
    var df = /[0-9]{4}-[0-9]{2}-[0-9]{2}/;
    return d.match(df);
}

function print(){
	alert('배경색을 인쇄하려면 브라우저의 [파일] -> [페이지 설정] 메뉴에서 "배경색 및 이미지 인쇄"를 체크해주세요."');
	var f = document.forms['form1'];
	removeInput(document.getElementById("__html_0"), f['print_content']);
	var printPop = window.open("","_blank","width=748, height=700");
	var html = "<html><head>"+$('head').html()+"<style type='text/css'>"+$("#__html_style").html()+"</style></head><body>"+ f['print_content'].value+"</body></html>"
	printPop.document.write(html);
	
	printPop.document.close();
	printPop.print();
	printPop.close();
}

</script>